{"ast":null,"code":"/**\r\n * DevExtreme (esm/ui/scheduler/resources/utils.js)\r\n * Version: 22.1.4\r\n * Build date: Fri Jul 22 2022\r\n *\r\n * Copyright (c) 2012 - 2022 Developer Express Inc. ALL RIGHTS RESERVED\r\n * Read about DevExtreme licensing here: https://js.devexpress.com/Licensing/\r\n */\nimport _extends from \"@babel/runtime/helpers/esm/extends\";\nimport { normalizeDataSourceOptions } from \"../../../data/data_source/utils\";\nimport { DataSource } from \"../../../data/data_source/data_source\";\nimport { when, Deferred } from \"../../../core/utils/deferred\";\nimport { compileGetter, compileSetter } from \"../../../core/utils/data\";\nimport { each } from \"../../../core/utils/iterator\";\nimport { extend } from \"../../../core/utils/extend\";\nimport { isDefined } from \"../../../core/utils/type\";\nimport { wrapToArray } from \"../../../core/utils/array\";\nimport { deepExtendArraySafe } from \"../../../core/utils/object\";\nimport { equalByValue } from \"../../../core/utils/common\";\nimport { hasResourceValue } from \"../../../renovation/ui/scheduler/resources/hasResourceValue\";\nexport var getValueExpr = resource => resource.valueExpr || \"id\";\nexport var getDisplayExpr = resource => resource.displayExpr || \"text\";\nexport var getFieldExpr = resource => resource.fieldExpr || resource.field;\nexport var getWrappedDataSource = dataSource => {\n  if (dataSource instanceof DataSource) {\n    return dataSource;\n  }\n\n  var result = {\n    store: normalizeDataSourceOptions(dataSource).store,\n    pageSize: 0\n  };\n\n  if (!Array.isArray(dataSource)) {\n    result.filter = dataSource.filter;\n  }\n\n  return new DataSource(result);\n};\nexport var createResourcesTree = groups => {\n  var leafIndex = 0;\n\n  var make = (group, groupIndex, result, parent) => {\n    result = result || [];\n\n    for (var itemIndex = 0; itemIndex < group.items.length; itemIndex++) {\n      var _group$data;\n\n      var currentGroupItem = group.items[itemIndex];\n      var resultItem = {\n        name: group.name,\n        value: currentGroupItem.id,\n        title: currentGroupItem.text,\n        data: null === (_group$data = group.data) || void 0 === _group$data ? void 0 : _group$data[itemIndex],\n        children: [],\n        parent: parent || null\n      };\n      var nextGroupIndex = groupIndex + 1;\n\n      if (groups[nextGroupIndex]) {\n        make(groups[nextGroupIndex], nextGroupIndex, resultItem.children, resultItem);\n      }\n\n      if (!resultItem.children.length) {\n        resultItem.leafIndex = leafIndex;\n        leafIndex++;\n      }\n\n      result.push(resultItem);\n    }\n\n    return result;\n  };\n\n  return make(groups[0], 0);\n};\nexport var getPathToLeaf = (leafIndex, groups) => {\n  var tree = createResourcesTree(groups);\n\n  var findLeafByIndex = (data, index) => {\n    for (var i = 0; i < data.length; i++) {\n      if (data[i].leafIndex === index) {\n        return data[i];\n      } else {\n        var _leaf = findLeafByIndex(data[i].children, index);\n\n        if (_leaf) {\n          return _leaf;\n        }\n      }\n    }\n  };\n\n  var makeBranch = (leaf, result) => {\n    result = result || [];\n    result.push(leaf.value);\n\n    if (leaf.parent) {\n      makeBranch(leaf.parent, result);\n    }\n\n    return result;\n  };\n\n  var leaf = findLeafByIndex(tree, leafIndex);\n  return makeBranch(leaf).reverse();\n};\nexport var getCellGroups = (groupIndex, groups) => {\n  var result = [];\n\n  if (getGroupCount(groups)) {\n    if (groupIndex < 0) {\n      return;\n    }\n\n    var path = getPathToLeaf(groupIndex, groups);\n\n    for (var i = 0; i < groups.length; i++) {\n      result.push({\n        name: groups[i].name,\n        id: path[i]\n      });\n    }\n  }\n\n  return result;\n};\nexport var getGroupCount = groups => {\n  var result = 0;\n\n  for (var i = 0, len = groups.length; i < len; i++) {\n    if (!i) {\n      result = groups[i].items.length;\n    } else {\n      result *= groups[i].items.length;\n    }\n  }\n\n  return result;\n};\nexport var getGroupsObjectFromGroupsArray = groupsArray => groupsArray.reduce((currentGroups, _ref) => {\n  var {\n    name: name,\n    id: id\n  } = _ref;\n  return _extends({}, currentGroups, {\n    [name]: id\n  });\n}, {});\nexport var getAllGroups = groups => {\n  var groupCount = getGroupCount(groups);\n  return [...new Array(groupCount)].map((_, groupIndex) => {\n    var groupsArray = getCellGroups(groupIndex, groups);\n    return getGroupsObjectFromGroupsArray(groupsArray);\n  });\n};\nexport var getResourceByField = (fieldName, loadedResources) => {\n  for (var i = 0; i < loadedResources.length; i++) {\n    var resource = loadedResources[i];\n\n    if (resource.name === fieldName) {\n      return resource.data;\n    }\n  }\n\n  return [];\n};\nexport var createResourceEditorModel = (resources, loadedResources) => resources.map(resource => {\n  var dataField = getFieldExpr(resource);\n  var dataSource = getResourceByField(dataField, loadedResources);\n  return {\n    editorOptions: {\n      dataSource: dataSource.length ? dataSource : getWrappedDataSource(resource.dataSource),\n      displayExpr: getDisplayExpr(resource),\n      valueExpr: getValueExpr(resource)\n    },\n    dataField: dataField,\n    editorType: resource.allowMultiple ? \"dxTagBox\" : \"dxSelectBox\",\n    label: {\n      text: resource.label || dataField\n    }\n  };\n});\nexport var isResourceMultiple = (resources, resourceField) => {\n  var resource = resources.find(resource => {\n    var field = getFieldExpr(resource);\n    return field === resourceField;\n  });\n  return !!(null !== resource && void 0 !== resource && resource.allowMultiple);\n};\nexport var filterResources = (resources, fields) => resources.filter(resource => {\n  var field = getFieldExpr(resource);\n  return fields.indexOf(field) > -1;\n});\nexport var getPaintedResources = (resources, groups) => {\n  var newGroups = groups || [];\n  var result = resources.find(resource => resource.useColorAsDefault);\n\n  if (result) {\n    return result;\n  }\n\n  var newResources = newGroups.length ? filterResources(resources, newGroups) : resources;\n  return newResources[newResources.length - 1];\n};\nexport var getOrLoadResourceItem = (resources, resourceLoaderMap, field, value) => {\n  var result = new Deferred();\n  resources.filter(resource => getFieldExpr(resource) === field && isDefined(resource.dataSource)).forEach(resource => {\n    var wrappedDataSource = getWrappedDataSource(resource.dataSource);\n    var valueExpr = getValueExpr(resource);\n\n    if (!resourceLoaderMap.has(field)) {\n      resourceLoaderMap.set(field, wrappedDataSource.load());\n    }\n\n    resourceLoaderMap.get(field).done(data => {\n      var getter = compileGetter(valueExpr);\n      var filteredData = data.filter(resource => equalByValue(getter(resource), value));\n      result.resolve(filteredData[0]);\n    }).fail(() => {\n      resourceLoaderMap.delete(field);\n      result.reject();\n    });\n  });\n  return result.promise();\n};\nexport var getDataAccessors = (dataAccessors, fieldName, type) => {\n  var actions = dataAccessors[type];\n  return actions[fieldName];\n};\nexport var groupAppointmentsByResources = function (config, appointments) {\n  var groups = arguments.length > 2 && void 0 !== arguments[2] ? arguments[2] : [];\n  var result = {\n    0: appointments\n  };\n\n  if (groups.length && config.loadedResources.length) {\n    result = groupAppointmentsByResourcesCore(config, appointments, config.loadedResources);\n  }\n\n  var totalResourceCount = 0;\n  config.loadedResources.forEach((resource, index) => {\n    if (!index) {\n      totalResourceCount = resource.items.length;\n    } else {\n      totalResourceCount *= resource.items.length;\n    }\n  });\n\n  for (var index = 0; index < totalResourceCount; index++) {\n    var key = index.toString();\n\n    if (result[key]) {\n      continue;\n    }\n\n    result[key] = [];\n  }\n\n  return result;\n};\nexport var groupAppointmentsByResourcesCore = (config, appointments, resources) => {\n  var tree = createResourcesTree(resources);\n  var result = {};\n  appointments.forEach(appointment => {\n    var treeLeaves = getResourceTreeLeaves((field, action) => getDataAccessors(config.dataAccessors, field, action), tree, appointment);\n\n    for (var i = 0; i < treeLeaves.length; i++) {\n      if (!result[treeLeaves[i]]) {\n        result[treeLeaves[i]] = [];\n      }\n\n      result[treeLeaves[i]].push(deepExtendArraySafe({}, appointment, true));\n    }\n  });\n  return result;\n};\nexport var getResourceTreeLeaves = (getDataAccessors, tree, rawAppointment, result) => {\n  result = result || [];\n\n  for (var i = 0; i < tree.length; i++) {\n    if (!hasGroupItem(getDataAccessors, rawAppointment, tree[i].name, tree[i].value)) {\n      continue;\n    }\n\n    if (isDefined(tree[i].leafIndex)) {\n      result.push(tree[i].leafIndex);\n    }\n\n    if (tree[i].children) {\n      getResourceTreeLeaves(getDataAccessors, tree[i].children, rawAppointment, result);\n    }\n  }\n\n  return result;\n};\n\nvar hasGroupItem = (getDataAccessors, rawAppointment, groupName, itemValue) => {\n  var resourceValue = getDataAccessors(groupName, \"getter\")(rawAppointment);\n  return hasResourceValue(wrapToArray(resourceValue), itemValue);\n};\n\nexport var createReducedResourcesTree = (loadedResources, getDataAccessors, appointments) => {\n  var tree = createResourcesTree(loadedResources);\n  return reduceResourcesTree(getDataAccessors, tree, appointments);\n};\nexport var reduceResourcesTree = (getDataAccessors, tree, existingAppointments, _result) => {\n  _result = _result ? _result.children : [];\n  tree.forEach(function (node, index) {\n    var ok = false;\n    var resourceName = node.name;\n    var resourceValue = node.value;\n    var resourceTitle = node.title;\n    var resourceData = node.data;\n    var resourceGetter = getDataAccessors(resourceName, \"getter\");\n    existingAppointments.forEach(function (appointment) {\n      if (!ok) {\n        var resourceFromAppointment = resourceGetter(appointment);\n\n        if (Array.isArray(resourceFromAppointment)) {\n          if (resourceFromAppointment.indexOf(resourceValue) > -1) {\n            _result.push({\n              name: resourceName,\n              value: resourceValue,\n              title: resourceTitle,\n              data: resourceData,\n              children: []\n            });\n\n            ok = true;\n          }\n        } else if (resourceFromAppointment === resourceValue) {\n          _result.push({\n            name: resourceName,\n            value: resourceValue,\n            title: resourceTitle,\n            data: resourceData,\n            children: []\n          });\n\n          ok = true;\n        }\n      }\n    });\n\n    if (ok && node.children && node.children.length) {\n      reduceResourcesTree(getDataAccessors, node.children, existingAppointments, _result[index]);\n    }\n  });\n  return _result;\n};\nexport var getResourcesDataByGroups = (loadedResources, resources, groups) => {\n  if (!groups || !groups.length) {\n    return loadedResources;\n  }\n\n  var fieldNames = {};\n  var currentResourcesData = [];\n  groups.forEach(group => {\n    each(group, (name, value) => fieldNames[name] = value);\n  });\n  var resourceData = loadedResources.filter(_ref2 => {\n    var {\n      name: name\n    } = _ref2;\n    return isDefined(fieldNames[name]);\n  });\n  resourceData.forEach(data => currentResourcesData.push(extend({}, data)));\n  currentResourcesData.forEach(currentResource => {\n    var {\n      items: items,\n      data: data,\n      name: resourceName\n    } = currentResource;\n    var resource = filterResources(resources, [resourceName])[0] || {};\n    var valueExpr = getValueExpr(resource);\n    var filteredItems = [];\n    var filteredData = [];\n    groups.filter(group => isDefined(group[resourceName])).forEach(group => {\n      each(group, (name, value) => {\n        if (!filteredItems.filter(item => item.id === value && item[valueExpr] === name).length) {\n          var currentItems = items.filter(item => item.id === value);\n          var currentData = data.filter(item => item[valueExpr] === value);\n          filteredItems.push(...currentItems);\n          filteredData.push(...currentData);\n        }\n      });\n    });\n    currentResource.items = filteredItems;\n    currentResource.data = filteredData;\n  });\n  return currentResourcesData;\n};\nexport var setResourceToAppointment = (resources, dataAccessors, appointment, groups) => {\n  var resourcesSetter = dataAccessors.setter;\n\n  for (var name in groups) {\n    var resourceData = groups[name];\n    var value = isResourceMultiple(resources, name) ? wrapToArray(resourceData) : resourceData;\n    resourcesSetter[name](appointment, value);\n  }\n};\nexport var getResourceColor = (resources, resourceLoaderMap, field, value) => {\n  var result = new Deferred();\n  var resource = filterResources(resources, [field])[0] || {};\n  var colorExpr = resource.colorExpr || \"color\";\n  var colorGetter = compileGetter(colorExpr);\n  getOrLoadResourceItem(resources, resourceLoaderMap, field, value).done(resource => result.resolve(colorGetter(resource))).fail(() => result.reject());\n  return result.promise();\n};\nexport var getAppointmentColor = (resourceConfig, appointmentConfig) => {\n  var {\n    resources: resources,\n    dataAccessors: dataAccessors,\n    loadedResources: loadedResources,\n    resourceLoaderMap: resourceLoaderMap\n  } = resourceConfig;\n  var {\n    groupIndex: groupIndex,\n    groups: groups,\n    itemData: itemData\n  } = appointmentConfig;\n  var paintedResources = getPaintedResources(resources || [], groups);\n\n  if (paintedResources) {\n    var field = getFieldExpr(paintedResources);\n    var cellGroups = getCellGroups(groupIndex, loadedResources);\n    var resourcesDataAccessors = getDataAccessors(dataAccessors, field, \"getter\");\n    var resourceValues = wrapToArray(resourcesDataAccessors(itemData));\n    var groupId = resourceValues[0];\n\n    for (var i = 0; i < cellGroups.length; i++) {\n      if (cellGroups[i].name === field) {\n        groupId = cellGroups[i].id;\n        break;\n      }\n    }\n\n    return getResourceColor(resources, resourceLoaderMap, field, groupId);\n  }\n\n  return new Deferred().resolve().promise();\n};\nexport var createExpressions = function () {\n  var resources = arguments.length > 0 && void 0 !== arguments[0] ? arguments[0] : [];\n  var result = {\n    getter: {},\n    setter: {}\n  };\n  resources.forEach(resource => {\n    var field = getFieldExpr(resource);\n    result.getter[field] = compileGetter(field);\n    result.setter[field] = compileSetter(field);\n  });\n  return result;\n};\n\nvar getTransformedResourceData = (resource, data) => {\n  var valueGetter = compileGetter(getValueExpr(resource));\n  var displayGetter = compileGetter(getDisplayExpr(resource));\n  return data.map(item => {\n    var result = {\n      id: valueGetter(item),\n      text: displayGetter(item)\n    };\n\n    if (item.color) {\n      result.color = item.color;\n    }\n\n    return result;\n  });\n};\n\nexport var loadResources = (groups, resources, resourceLoaderMap) => {\n  var result = new Deferred();\n  var deferreds = [];\n  var newGroups = groups || [];\n  var newResources = resources || [];\n  var loadedResources = [];\n  filterResources(newResources, newGroups).forEach(resource => {\n    var deferred = new Deferred();\n    var name = getFieldExpr(resource);\n    deferreds.push(deferred);\n    var dataSourcePromise = getWrappedDataSource(resource.dataSource).load();\n    resourceLoaderMap.set(name, dataSourcePromise);\n    dataSourcePromise.done(data => {\n      var items = getTransformedResourceData(resource, data);\n      deferred.resolve({\n        name: name,\n        items: items,\n        data: data\n      });\n    }).fail(() => deferred.reject());\n  });\n\n  if (!deferreds.length) {\n    return result.resolve(loadedResources);\n  }\n\n  when.apply(null, deferreds).done(function () {\n    for (var _len = arguments.length, resources = new Array(_len), _key = 0; _key < _len; _key++) {\n      resources[_key] = arguments[_key];\n    }\n\n    var hasEmpty = resources.some(r => 0 === r.items.length);\n    loadedResources = hasEmpty ? [] : resources;\n    result.resolve(loadedResources);\n  }).fail(() => result.reject());\n  return result.promise();\n};\nexport var getNormalizedResources = (rawAppointment, dataAccessors, resources) => {\n  var result = {};\n  each(dataAccessors.resources.getter, fieldName => {\n    var value = dataAccessors.resources.getter[fieldName](rawAppointment);\n\n    if (isDefined(value)) {\n      var isMultiple = isResourceMultiple(resources, fieldName);\n      var resourceValue = isMultiple ? wrapToArray(value) : value;\n      result[fieldName] = resourceValue;\n    }\n  });\n  return result;\n};","map":{"version":3,"names":["_extends","normalizeDataSourceOptions","DataSource","when","Deferred","compileGetter","compileSetter","each","extend","isDefined","wrapToArray","deepExtendArraySafe","equalByValue","hasResourceValue","getValueExpr","resource","valueExpr","getDisplayExpr","displayExpr","getFieldExpr","fieldExpr","field","getWrappedDataSource","dataSource","result","store","pageSize","Array","isArray","filter","createResourcesTree","groups","leafIndex","make","group","groupIndex","parent","itemIndex","items","length","_group$data","currentGroupItem","resultItem","name","value","id","title","text","data","children","nextGroupIndex","push","getPathToLeaf","tree","findLeafByIndex","index","i","_leaf","makeBranch","leaf","reverse","getCellGroups","getGroupCount","path","len","getGroupsObjectFromGroupsArray","groupsArray","reduce","currentGroups","_ref","getAllGroups","groupCount","map","_","getResourceByField","fieldName","loadedResources","createResourceEditorModel","resources","dataField","editorOptions","editorType","allowMultiple","label","isResourceMultiple","resourceField","find","filterResources","fields","indexOf","getPaintedResources","newGroups","useColorAsDefault","newResources","getOrLoadResourceItem","resourceLoaderMap","forEach","wrappedDataSource","has","set","load","get","done","getter","filteredData","resolve","fail","delete","reject","promise","getDataAccessors","dataAccessors","type","actions","groupAppointmentsByResources","config","appointments","arguments","groupAppointmentsByResourcesCore","totalResourceCount","key","toString","appointment","treeLeaves","getResourceTreeLeaves","action","rawAppointment","hasGroupItem","groupName","itemValue","resourceValue","createReducedResourcesTree","reduceResourcesTree","existingAppointments","_result","node","ok","resourceName","resourceTitle","resourceData","resourceGetter","resourceFromAppointment","getResourcesDataByGroups","fieldNames","currentResourcesData","_ref2","currentResource","filteredItems","item","currentItems","currentData","setResourceToAppointment","resourcesSetter","setter","getResourceColor","colorExpr","colorGetter","getAppointmentColor","resourceConfig","appointmentConfig","itemData","paintedResources","cellGroups","resourcesDataAccessors","resourceValues","groupId","createExpressions","getTransformedResourceData","valueGetter","displayGetter","color","loadResources","deferreds","deferred","dataSourcePromise","apply","_len","_key","hasEmpty","some","r","getNormalizedResources","isMultiple"],"sources":["E:/MisaProject/W2022_06/misa_emis/node_modules/devextreme/esm/ui/scheduler/resources/utils.js"],"sourcesContent":["/**\r\n * DevExtreme (esm/ui/scheduler/resources/utils.js)\r\n * Version: 22.1.4\r\n * Build date: Fri Jul 22 2022\r\n *\r\n * Copyright (c) 2012 - 2022 Developer Express Inc. ALL RIGHTS RESERVED\r\n * Read about DevExtreme licensing here: https://js.devexpress.com/Licensing/\r\n */\r\nimport _extends from \"@babel/runtime/helpers/esm/extends\";\r\nimport {\r\n    normalizeDataSourceOptions\r\n} from \"../../../data/data_source/utils\";\r\nimport {\r\n    DataSource\r\n} from \"../../../data/data_source/data_source\";\r\nimport {\r\n    when,\r\n    Deferred\r\n} from \"../../../core/utils/deferred\";\r\nimport {\r\n    compileGetter,\r\n    compileSetter\r\n} from \"../../../core/utils/data\";\r\nimport {\r\n    each\r\n} from \"../../../core/utils/iterator\";\r\nimport {\r\n    extend\r\n} from \"../../../core/utils/extend\";\r\nimport {\r\n    isDefined\r\n} from \"../../../core/utils/type\";\r\nimport {\r\n    wrapToArray\r\n} from \"../../../core/utils/array\";\r\nimport {\r\n    deepExtendArraySafe\r\n} from \"../../../core/utils/object\";\r\nimport {\r\n    equalByValue\r\n} from \"../../../core/utils/common\";\r\nimport {\r\n    hasResourceValue\r\n} from \"../../../renovation/ui/scheduler/resources/hasResourceValue\";\r\nexport var getValueExpr = resource => resource.valueExpr || \"id\";\r\nexport var getDisplayExpr = resource => resource.displayExpr || \"text\";\r\nexport var getFieldExpr = resource => resource.fieldExpr || resource.field;\r\nexport var getWrappedDataSource = dataSource => {\r\n    if (dataSource instanceof DataSource) {\r\n        return dataSource\r\n    }\r\n    var result = {\r\n        store: normalizeDataSourceOptions(dataSource).store,\r\n        pageSize: 0\r\n    };\r\n    if (!Array.isArray(dataSource)) {\r\n        result.filter = dataSource.filter\r\n    }\r\n    return new DataSource(result)\r\n};\r\nexport var createResourcesTree = groups => {\r\n    var leafIndex = 0;\r\n    var make = (group, groupIndex, result, parent) => {\r\n        result = result || [];\r\n        for (var itemIndex = 0; itemIndex < group.items.length; itemIndex++) {\r\n            var _group$data;\r\n            var currentGroupItem = group.items[itemIndex];\r\n            var resultItem = {\r\n                name: group.name,\r\n                value: currentGroupItem.id,\r\n                title: currentGroupItem.text,\r\n                data: null === (_group$data = group.data) || void 0 === _group$data ? void 0 : _group$data[itemIndex],\r\n                children: [],\r\n                parent: parent || null\r\n            };\r\n            var nextGroupIndex = groupIndex + 1;\r\n            if (groups[nextGroupIndex]) {\r\n                make(groups[nextGroupIndex], nextGroupIndex, resultItem.children, resultItem)\r\n            }\r\n            if (!resultItem.children.length) {\r\n                resultItem.leafIndex = leafIndex;\r\n                leafIndex++\r\n            }\r\n            result.push(resultItem)\r\n        }\r\n        return result\r\n    };\r\n    return make(groups[0], 0)\r\n};\r\nexport var getPathToLeaf = (leafIndex, groups) => {\r\n    var tree = createResourcesTree(groups);\r\n    var findLeafByIndex = (data, index) => {\r\n        for (var i = 0; i < data.length; i++) {\r\n            if (data[i].leafIndex === index) {\r\n                return data[i]\r\n            } else {\r\n                var _leaf = findLeafByIndex(data[i].children, index);\r\n                if (_leaf) {\r\n                    return _leaf\r\n                }\r\n            }\r\n        }\r\n    };\r\n    var makeBranch = (leaf, result) => {\r\n        result = result || [];\r\n        result.push(leaf.value);\r\n        if (leaf.parent) {\r\n            makeBranch(leaf.parent, result)\r\n        }\r\n        return result\r\n    };\r\n    var leaf = findLeafByIndex(tree, leafIndex);\r\n    return makeBranch(leaf).reverse()\r\n};\r\nexport var getCellGroups = (groupIndex, groups) => {\r\n    var result = [];\r\n    if (getGroupCount(groups)) {\r\n        if (groupIndex < 0) {\r\n            return\r\n        }\r\n        var path = getPathToLeaf(groupIndex, groups);\r\n        for (var i = 0; i < groups.length; i++) {\r\n            result.push({\r\n                name: groups[i].name,\r\n                id: path[i]\r\n            })\r\n        }\r\n    }\r\n    return result\r\n};\r\nexport var getGroupCount = groups => {\r\n    var result = 0;\r\n    for (var i = 0, len = groups.length; i < len; i++) {\r\n        if (!i) {\r\n            result = groups[i].items.length\r\n        } else {\r\n            result *= groups[i].items.length\r\n        }\r\n    }\r\n    return result\r\n};\r\nexport var getGroupsObjectFromGroupsArray = groupsArray => groupsArray.reduce((currentGroups, _ref) => {\r\n    var {\r\n        name: name,\r\n        id: id\r\n    } = _ref;\r\n    return _extends({}, currentGroups, {\r\n        [name]: id\r\n    })\r\n}, {});\r\nexport var getAllGroups = groups => {\r\n    var groupCount = getGroupCount(groups);\r\n    return [...new Array(groupCount)].map((_, groupIndex) => {\r\n        var groupsArray = getCellGroups(groupIndex, groups);\r\n        return getGroupsObjectFromGroupsArray(groupsArray)\r\n    })\r\n};\r\nexport var getResourceByField = (fieldName, loadedResources) => {\r\n    for (var i = 0; i < loadedResources.length; i++) {\r\n        var resource = loadedResources[i];\r\n        if (resource.name === fieldName) {\r\n            return resource.data\r\n        }\r\n    }\r\n    return []\r\n};\r\nexport var createResourceEditorModel = (resources, loadedResources) => resources.map(resource => {\r\n    var dataField = getFieldExpr(resource);\r\n    var dataSource = getResourceByField(dataField, loadedResources);\r\n    return {\r\n        editorOptions: {\r\n            dataSource: dataSource.length ? dataSource : getWrappedDataSource(resource.dataSource),\r\n            displayExpr: getDisplayExpr(resource),\r\n            valueExpr: getValueExpr(resource)\r\n        },\r\n        dataField: dataField,\r\n        editorType: resource.allowMultiple ? \"dxTagBox\" : \"dxSelectBox\",\r\n        label: {\r\n            text: resource.label || dataField\r\n        }\r\n    }\r\n});\r\nexport var isResourceMultiple = (resources, resourceField) => {\r\n    var resource = resources.find(resource => {\r\n        var field = getFieldExpr(resource);\r\n        return field === resourceField\r\n    });\r\n    return !!(null !== resource && void 0 !== resource && resource.allowMultiple)\r\n};\r\nexport var filterResources = (resources, fields) => resources.filter(resource => {\r\n    var field = getFieldExpr(resource);\r\n    return fields.indexOf(field) > -1\r\n});\r\nexport var getPaintedResources = (resources, groups) => {\r\n    var newGroups = groups || [];\r\n    var result = resources.find(resource => resource.useColorAsDefault);\r\n    if (result) {\r\n        return result\r\n    }\r\n    var newResources = newGroups.length ? filterResources(resources, newGroups) : resources;\r\n    return newResources[newResources.length - 1]\r\n};\r\nexport var getOrLoadResourceItem = (resources, resourceLoaderMap, field, value) => {\r\n    var result = new Deferred;\r\n    resources.filter(resource => getFieldExpr(resource) === field && isDefined(resource.dataSource)).forEach(resource => {\r\n        var wrappedDataSource = getWrappedDataSource(resource.dataSource);\r\n        var valueExpr = getValueExpr(resource);\r\n        if (!resourceLoaderMap.has(field)) {\r\n            resourceLoaderMap.set(field, wrappedDataSource.load())\r\n        }\r\n        resourceLoaderMap.get(field).done(data => {\r\n            var getter = compileGetter(valueExpr);\r\n            var filteredData = data.filter(resource => equalByValue(getter(resource), value));\r\n            result.resolve(filteredData[0])\r\n        }).fail(() => {\r\n            resourceLoaderMap.delete(field);\r\n            result.reject()\r\n        })\r\n    });\r\n    return result.promise()\r\n};\r\nexport var getDataAccessors = (dataAccessors, fieldName, type) => {\r\n    var actions = dataAccessors[type];\r\n    return actions[fieldName]\r\n};\r\nexport var groupAppointmentsByResources = function(config, appointments) {\r\n    var groups = arguments.length > 2 && void 0 !== arguments[2] ? arguments[2] : [];\r\n    var result = {\r\n        0: appointments\r\n    };\r\n    if (groups.length && config.loadedResources.length) {\r\n        result = groupAppointmentsByResourcesCore(config, appointments, config.loadedResources)\r\n    }\r\n    var totalResourceCount = 0;\r\n    config.loadedResources.forEach((resource, index) => {\r\n        if (!index) {\r\n            totalResourceCount = resource.items.length\r\n        } else {\r\n            totalResourceCount *= resource.items.length\r\n        }\r\n    });\r\n    for (var index = 0; index < totalResourceCount; index++) {\r\n        var key = index.toString();\r\n        if (result[key]) {\r\n            continue\r\n        }\r\n        result[key] = []\r\n    }\r\n    return result\r\n};\r\nexport var groupAppointmentsByResourcesCore = (config, appointments, resources) => {\r\n    var tree = createResourcesTree(resources);\r\n    var result = {};\r\n    appointments.forEach(appointment => {\r\n        var treeLeaves = getResourceTreeLeaves((field, action) => getDataAccessors(config.dataAccessors, field, action), tree, appointment);\r\n        for (var i = 0; i < treeLeaves.length; i++) {\r\n            if (!result[treeLeaves[i]]) {\r\n                result[treeLeaves[i]] = []\r\n            }\r\n            result[treeLeaves[i]].push(deepExtendArraySafe({}, appointment, true))\r\n        }\r\n    });\r\n    return result\r\n};\r\nexport var getResourceTreeLeaves = (getDataAccessors, tree, rawAppointment, result) => {\r\n    result = result || [];\r\n    for (var i = 0; i < tree.length; i++) {\r\n        if (!hasGroupItem(getDataAccessors, rawAppointment, tree[i].name, tree[i].value)) {\r\n            continue\r\n        }\r\n        if (isDefined(tree[i].leafIndex)) {\r\n            result.push(tree[i].leafIndex)\r\n        }\r\n        if (tree[i].children) {\r\n            getResourceTreeLeaves(getDataAccessors, tree[i].children, rawAppointment, result)\r\n        }\r\n    }\r\n    return result\r\n};\r\nvar hasGroupItem = (getDataAccessors, rawAppointment, groupName, itemValue) => {\r\n    var resourceValue = getDataAccessors(groupName, \"getter\")(rawAppointment);\r\n    return hasResourceValue(wrapToArray(resourceValue), itemValue)\r\n};\r\nexport var createReducedResourcesTree = (loadedResources, getDataAccessors, appointments) => {\r\n    var tree = createResourcesTree(loadedResources);\r\n    return reduceResourcesTree(getDataAccessors, tree, appointments)\r\n};\r\nexport var reduceResourcesTree = (getDataAccessors, tree, existingAppointments, _result) => {\r\n    _result = _result ? _result.children : [];\r\n    tree.forEach((function(node, index) {\r\n        var ok = false;\r\n        var resourceName = node.name;\r\n        var resourceValue = node.value;\r\n        var resourceTitle = node.title;\r\n        var resourceData = node.data;\r\n        var resourceGetter = getDataAccessors(resourceName, \"getter\");\r\n        existingAppointments.forEach((function(appointment) {\r\n            if (!ok) {\r\n                var resourceFromAppointment = resourceGetter(appointment);\r\n                if (Array.isArray(resourceFromAppointment)) {\r\n                    if (resourceFromAppointment.indexOf(resourceValue) > -1) {\r\n                        _result.push({\r\n                            name: resourceName,\r\n                            value: resourceValue,\r\n                            title: resourceTitle,\r\n                            data: resourceData,\r\n                            children: []\r\n                        });\r\n                        ok = true\r\n                    }\r\n                } else if (resourceFromAppointment === resourceValue) {\r\n                    _result.push({\r\n                        name: resourceName,\r\n                        value: resourceValue,\r\n                        title: resourceTitle,\r\n                        data: resourceData,\r\n                        children: []\r\n                    });\r\n                    ok = true\r\n                }\r\n            }\r\n        }));\r\n        if (ok && node.children && node.children.length) {\r\n            reduceResourcesTree(getDataAccessors, node.children, existingAppointments, _result[index])\r\n        }\r\n    }));\r\n    return _result\r\n};\r\nexport var getResourcesDataByGroups = (loadedResources, resources, groups) => {\r\n    if (!groups || !groups.length) {\r\n        return loadedResources\r\n    }\r\n    var fieldNames = {};\r\n    var currentResourcesData = [];\r\n    groups.forEach(group => {\r\n        each(group, (name, value) => fieldNames[name] = value)\r\n    });\r\n    var resourceData = loadedResources.filter(_ref2 => {\r\n        var {\r\n            name: name\r\n        } = _ref2;\r\n        return isDefined(fieldNames[name])\r\n    });\r\n    resourceData.forEach(data => currentResourcesData.push(extend({}, data)));\r\n    currentResourcesData.forEach(currentResource => {\r\n        var {\r\n            items: items,\r\n            data: data,\r\n            name: resourceName\r\n        } = currentResource;\r\n        var resource = filterResources(resources, [resourceName])[0] || {};\r\n        var valueExpr = getValueExpr(resource);\r\n        var filteredItems = [];\r\n        var filteredData = [];\r\n        groups.filter(group => isDefined(group[resourceName])).forEach(group => {\r\n            each(group, (name, value) => {\r\n                if (!filteredItems.filter(item => item.id === value && item[valueExpr] === name).length) {\r\n                    var currentItems = items.filter(item => item.id === value);\r\n                    var currentData = data.filter(item => item[valueExpr] === value);\r\n                    filteredItems.push(...currentItems);\r\n                    filteredData.push(...currentData)\r\n                }\r\n            })\r\n        });\r\n        currentResource.items = filteredItems;\r\n        currentResource.data = filteredData\r\n    });\r\n    return currentResourcesData\r\n};\r\nexport var setResourceToAppointment = (resources, dataAccessors, appointment, groups) => {\r\n    var resourcesSetter = dataAccessors.setter;\r\n    for (var name in groups) {\r\n        var resourceData = groups[name];\r\n        var value = isResourceMultiple(resources, name) ? wrapToArray(resourceData) : resourceData;\r\n        resourcesSetter[name](appointment, value)\r\n    }\r\n};\r\nexport var getResourceColor = (resources, resourceLoaderMap, field, value) => {\r\n    var result = new Deferred;\r\n    var resource = filterResources(resources, [field])[0] || {};\r\n    var colorExpr = resource.colorExpr || \"color\";\r\n    var colorGetter = compileGetter(colorExpr);\r\n    getOrLoadResourceItem(resources, resourceLoaderMap, field, value).done(resource => result.resolve(colorGetter(resource))).fail(() => result.reject());\r\n    return result.promise()\r\n};\r\nexport var getAppointmentColor = (resourceConfig, appointmentConfig) => {\r\n    var {\r\n        resources: resources,\r\n        dataAccessors: dataAccessors,\r\n        loadedResources: loadedResources,\r\n        resourceLoaderMap: resourceLoaderMap\r\n    } = resourceConfig;\r\n    var {\r\n        groupIndex: groupIndex,\r\n        groups: groups,\r\n        itemData: itemData\r\n    } = appointmentConfig;\r\n    var paintedResources = getPaintedResources(resources || [], groups);\r\n    if (paintedResources) {\r\n        var field = getFieldExpr(paintedResources);\r\n        var cellGroups = getCellGroups(groupIndex, loadedResources);\r\n        var resourcesDataAccessors = getDataAccessors(dataAccessors, field, \"getter\");\r\n        var resourceValues = wrapToArray(resourcesDataAccessors(itemData));\r\n        var groupId = resourceValues[0];\r\n        for (var i = 0; i < cellGroups.length; i++) {\r\n            if (cellGroups[i].name === field) {\r\n                groupId = cellGroups[i].id;\r\n                break\r\n            }\r\n        }\r\n        return getResourceColor(resources, resourceLoaderMap, field, groupId)\r\n    }\r\n    return (new Deferred).resolve().promise()\r\n};\r\nexport var createExpressions = function() {\r\n    var resources = arguments.length > 0 && void 0 !== arguments[0] ? arguments[0] : [];\r\n    var result = {\r\n        getter: {},\r\n        setter: {}\r\n    };\r\n    resources.forEach(resource => {\r\n        var field = getFieldExpr(resource);\r\n        result.getter[field] = compileGetter(field);\r\n        result.setter[field] = compileSetter(field)\r\n    });\r\n    return result\r\n};\r\nvar getTransformedResourceData = (resource, data) => {\r\n    var valueGetter = compileGetter(getValueExpr(resource));\r\n    var displayGetter = compileGetter(getDisplayExpr(resource));\r\n    return data.map(item => {\r\n        var result = {\r\n            id: valueGetter(item),\r\n            text: displayGetter(item)\r\n        };\r\n        if (item.color) {\r\n            result.color = item.color\r\n        }\r\n        return result\r\n    })\r\n};\r\nexport var loadResources = (groups, resources, resourceLoaderMap) => {\r\n    var result = new Deferred;\r\n    var deferreds = [];\r\n    var newGroups = groups || [];\r\n    var newResources = resources || [];\r\n    var loadedResources = [];\r\n    filterResources(newResources, newGroups).forEach(resource => {\r\n        var deferred = new Deferred;\r\n        var name = getFieldExpr(resource);\r\n        deferreds.push(deferred);\r\n        var dataSourcePromise = getWrappedDataSource(resource.dataSource).load();\r\n        resourceLoaderMap.set(name, dataSourcePromise);\r\n        dataSourcePromise.done(data => {\r\n            var items = getTransformedResourceData(resource, data);\r\n            deferred.resolve({\r\n                name: name,\r\n                items: items,\r\n                data: data\r\n            })\r\n        }).fail(() => deferred.reject())\r\n    });\r\n    if (!deferreds.length) {\r\n        return result.resolve(loadedResources)\r\n    }\r\n    when.apply(null, deferreds).done((function() {\r\n        for (var _len = arguments.length, resources = new Array(_len), _key = 0; _key < _len; _key++) {\r\n            resources[_key] = arguments[_key]\r\n        }\r\n        var hasEmpty = resources.some(r => 0 === r.items.length);\r\n        loadedResources = hasEmpty ? [] : resources;\r\n        result.resolve(loadedResources)\r\n    })).fail(() => result.reject());\r\n    return result.promise()\r\n};\r\nexport var getNormalizedResources = (rawAppointment, dataAccessors, resources) => {\r\n    var result = {};\r\n    each(dataAccessors.resources.getter, fieldName => {\r\n        var value = dataAccessors.resources.getter[fieldName](rawAppointment);\r\n        if (isDefined(value)) {\r\n            var isMultiple = isResourceMultiple(resources, fieldName);\r\n            var resourceValue = isMultiple ? wrapToArray(value) : value;\r\n            result[fieldName] = resourceValue\r\n        }\r\n    });\r\n    return result\r\n};\r\n"],"mappings":"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"},"metadata":{},"sourceType":"module"}