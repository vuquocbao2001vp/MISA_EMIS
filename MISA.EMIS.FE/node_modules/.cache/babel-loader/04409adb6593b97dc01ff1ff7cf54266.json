{"ast":null,"code":"import dateutil from '../dateutil';\nimport { notEmpty, repeat, range, isPresent } from '../helpers';\nimport { Frequency } from '../types';\nimport { rebuildYear } from './yearinfo';\nimport { rebuildMonth } from './monthinfo';\nimport { easter } from './easter';\nimport { Time } from '../datetime'; // =============================================================================\n// Iterinfo\n// =============================================================================\n\nvar Iterinfo =\n/** @class */\nfunction () {\n  function Iterinfo(options) {\n    this.options = options;\n  }\n\n  Iterinfo.prototype.rebuild = function (year, month) {\n    var options = this.options;\n\n    if (year !== this.lastyear) {\n      this.yearinfo = rebuildYear(year, options);\n    }\n\n    if (notEmpty(options.bynweekday) && (month !== this.lastmonth || year !== this.lastyear)) {\n      var _a = this.yearinfo,\n          yearlen = _a.yearlen,\n          mrange = _a.mrange,\n          wdaymask = _a.wdaymask;\n      this.monthinfo = rebuildMonth(year, month, yearlen, mrange, wdaymask, options);\n    }\n\n    if (isPresent(options.byeaster)) {\n      this.eastermask = easter(year, options.byeaster);\n    }\n  };\n\n  Object.defineProperty(Iterinfo.prototype, \"lastyear\", {\n    get: function () {\n      return this.monthinfo ? this.monthinfo.lastyear : null;\n    },\n    enumerable: true,\n    configurable: true\n  });\n  Object.defineProperty(Iterinfo.prototype, \"lastmonth\", {\n    get: function () {\n      return this.monthinfo ? this.monthinfo.lastmonth : null;\n    },\n    enumerable: true,\n    configurable: true\n  });\n  Object.defineProperty(Iterinfo.prototype, \"yearlen\", {\n    get: function () {\n      return this.yearinfo.yearlen;\n    },\n    enumerable: true,\n    configurable: true\n  });\n  Object.defineProperty(Iterinfo.prototype, \"yearordinal\", {\n    get: function () {\n      return this.yearinfo.yearordinal;\n    },\n    enumerable: true,\n    configurable: true\n  });\n  Object.defineProperty(Iterinfo.prototype, \"mrange\", {\n    get: function () {\n      return this.yearinfo.mrange;\n    },\n    enumerable: true,\n    configurable: true\n  });\n  Object.defineProperty(Iterinfo.prototype, \"wdaymask\", {\n    get: function () {\n      return this.yearinfo.wdaymask;\n    },\n    enumerable: true,\n    configurable: true\n  });\n  Object.defineProperty(Iterinfo.prototype, \"mmask\", {\n    get: function () {\n      return this.yearinfo.mmask;\n    },\n    enumerable: true,\n    configurable: true\n  });\n  Object.defineProperty(Iterinfo.prototype, \"wnomask\", {\n    get: function () {\n      return this.yearinfo.wnomask;\n    },\n    enumerable: true,\n    configurable: true\n  });\n  Object.defineProperty(Iterinfo.prototype, \"nwdaymask\", {\n    get: function () {\n      return this.monthinfo ? this.monthinfo.nwdaymask : [];\n    },\n    enumerable: true,\n    configurable: true\n  });\n  Object.defineProperty(Iterinfo.prototype, \"nextyearlen\", {\n    get: function () {\n      return this.yearinfo.nextyearlen;\n    },\n    enumerable: true,\n    configurable: true\n  });\n  Object.defineProperty(Iterinfo.prototype, \"mdaymask\", {\n    get: function () {\n      return this.yearinfo.mdaymask;\n    },\n    enumerable: true,\n    configurable: true\n  });\n  Object.defineProperty(Iterinfo.prototype, \"nmdaymask\", {\n    get: function () {\n      return this.yearinfo.nmdaymask;\n    },\n    enumerable: true,\n    configurable: true\n  });\n\n  Iterinfo.prototype.ydayset = function () {\n    return [range(this.yearlen), 0, this.yearlen];\n  };\n\n  Iterinfo.prototype.mdayset = function (_, month, __) {\n    var start = this.mrange[month - 1];\n    var end = this.mrange[month];\n    var set = repeat(null, this.yearlen);\n\n    for (var i = start; i < end; i++) set[i] = i;\n\n    return [set, start, end];\n  };\n\n  Iterinfo.prototype.wdayset = function (year, month, day) {\n    // We need to handle cross-year weeks here.\n    var set = repeat(null, this.yearlen + 7);\n    var i = dateutil.toOrdinal(new Date(Date.UTC(year, month - 1, day))) - this.yearordinal;\n    var start = i;\n\n    for (var j = 0; j < 7; j++) {\n      set[i] = i;\n      ++i;\n      if (this.wdaymask[i] === this.options.wkst) break;\n    }\n\n    return [set, start, i];\n  };\n\n  Iterinfo.prototype.ddayset = function (year, month, day) {\n    var set = repeat(null, this.yearlen);\n    var i = dateutil.toOrdinal(new Date(Date.UTC(year, month - 1, day))) - this.yearordinal;\n    set[i] = i;\n    return [set, i, i + 1];\n  };\n\n  Iterinfo.prototype.htimeset = function (hour, _, second, millisecond) {\n    var _this = this;\n\n    var set = [];\n    this.options.byminute.forEach(function (minute) {\n      set = set.concat(_this.mtimeset(hour, minute, second, millisecond));\n    });\n    dateutil.sort(set);\n    return set;\n  };\n\n  Iterinfo.prototype.mtimeset = function (hour, minute, _, millisecond) {\n    var set = this.options.bysecond.map(function (second) {\n      return new Time(hour, minute, second, millisecond);\n    });\n    dateutil.sort(set);\n    return set;\n  };\n\n  Iterinfo.prototype.stimeset = function (hour, minute, second, millisecond) {\n    return [new Time(hour, minute, second, millisecond)];\n  };\n\n  Iterinfo.prototype.getdayset = function (freq) {\n    switch (freq) {\n      case Frequency.YEARLY:\n        return this.ydayset.bind(this);\n\n      case Frequency.MONTHLY:\n        return this.mdayset.bind(this);\n\n      case Frequency.WEEKLY:\n        return this.wdayset.bind(this);\n\n      case Frequency.DAILY:\n        return this.ddayset.bind(this);\n\n      default:\n        return this.ddayset.bind(this);\n    }\n  };\n\n  Iterinfo.prototype.gettimeset = function (freq) {\n    switch (freq) {\n      case Frequency.HOURLY:\n        return this.htimeset.bind(this);\n\n      case Frequency.MINUTELY:\n        return this.mtimeset.bind(this);\n\n      case Frequency.SECONDLY:\n        return this.stimeset.bind(this);\n    }\n  };\n\n  return Iterinfo;\n}();\n\nexport default Iterinfo;","map":{"version":3,"mappings":"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","names":["dateutil","notEmpty","repeat","range","isPresent","Frequency","rebuildYear","rebuildMonth","easter","Time","options","Iterinfo","year","month","lastyear","yearinfo","bynweekday","lastmonth","yearlen","mrange","wdaymask","monthinfo","byeaster","eastermask","Object","yearordinal","mmask","wnomask","nwdaymask","nextyearlen","mdaymask","nmdaymask","_","__","start","end","set","i","day","toOrdinal","Date","UTC","j","wkst","hour","second","millisecond","byminute","forEach","concat","_this","mtimeset","minute","sort","bysecond","map","freq","YEARLY","ydayset","bind","MONTHLY","mdayset","WEEKLY","wdayset","DAILY","ddayset","HOURLY","htimeset","MINUTELY","SECONDLY","stimeset"],"sourceRoot":"","sources":["../../../../src/iterinfo/index.ts"],"sourcesContent":[null]},"metadata":{},"sourceType":"module"}