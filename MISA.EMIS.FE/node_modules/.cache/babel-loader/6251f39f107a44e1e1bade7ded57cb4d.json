{"ast":null,"code":"/**\r\n * DevExtreme (esm/ui/data_grid/ui.data_grid.grouping.collapsed.js)\r\n * Version: 22.1.4\r\n * Build date: Fri Jul 22 2022\r\n *\r\n * Copyright (c) 2012 - 2022 Developer Express Inc. ALL RIGHTS RESERVED\r\n * Read about DevExtreme licensing here: https://js.devexpress.com/Licensing/\r\n */\nimport { extend } from \"../../core/utils/extend\";\nimport { each } from \"../../core/utils/iterator\";\nimport dataGridCore from \"./ui.data_grid.core\";\nimport { GroupingHelper as GroupingHelperCore, createOffsetFilter } from \"./ui.data_grid.grouping.core\";\nimport { createGroupFilter } from \"./ui.data_grid.utils\";\nimport errors from \"../widget/ui.errors\";\nimport { errors as dataErrors } from \"../../data/errors\";\nimport { when, Deferred } from \"../../core/utils/deferred\";\n\nfunction getContinuationGroupCount(groupOffset, pageSize, groupSize, groupIndex) {\n  groupIndex = groupIndex || 0;\n\n  if (pageSize > 1 && groupSize > 0) {\n    var pageOffset = groupOffset - Math.floor(groupOffset / pageSize) * pageSize || pageSize;\n    pageOffset += groupSize - groupIndex - 2;\n\n    if (pageOffset < 0) {\n      pageOffset += pageSize;\n    }\n\n    return Math.floor(pageOffset / (pageSize - groupIndex - 1));\n  }\n\n  return 0;\n}\n\nexport var GroupingHelper = GroupingHelperCore.inherit(function () {\n  var foreachExpandedGroups = function (that, callback, updateGroups) {\n    return that.foreachGroups(function (groupInfo, parents) {\n      if (groupInfo.isExpanded) {\n        return callback(groupInfo, parents);\n      }\n    }, true, false, updateGroups, updateGroups);\n  };\n\n  var processGroupItems = function processGroupItems(that, items, groupsCount, expandedInfo, path, isCustomLoading, isLastGroupExpanded) {\n    var isExpanded;\n    expandedInfo.items = expandedInfo.items || [];\n    expandedInfo.paths = expandedInfo.paths || [];\n    expandedInfo.count = expandedInfo.count || 0;\n    expandedInfo.lastCount = expandedInfo.lastCount || 0;\n\n    if (!groupsCount) {\n      return;\n    }\n\n    for (var i = 0; i < items.length; i++) {\n      var item = items[i];\n\n      if (void 0 !== item.items) {\n        path.push(item.key);\n\n        if (isCustomLoading) {\n          isExpanded = true;\n        } else {\n          var groupInfo = that.findGroupInfo(path);\n          isExpanded = groupInfo && groupInfo.isExpanded;\n        }\n\n        if (!isExpanded) {\n          item.collapsedItems = item.items;\n          item.items = null;\n        } else if (item.items) {\n          processGroupItems(that, item.items, groupsCount - 1, expandedInfo, path, isCustomLoading, isLastGroupExpanded);\n        } else if (1 === groupsCount && item.count && (!isCustomLoading || isLastGroupExpanded)) {\n          expandedInfo.items.push(item);\n          expandedInfo.paths.push(path.slice(0));\n          expandedInfo.count += expandedInfo.lastCount;\n          expandedInfo.lastCount = item.count;\n        }\n\n        path.pop();\n      }\n    }\n  };\n\n  var updateGroupInfoItem = function (that, item, isLastGroupLevel, path, offset) {\n    var groupInfo = that.findGroupInfo(path);\n    var count;\n\n    if (!groupInfo) {\n      if (isLastGroupLevel) {\n        count = item.count > 0 ? item.count : item.items.length;\n      }\n\n      that.addGroupInfo({\n        isExpanded: that._isGroupExpanded(path.length - 1),\n        path: path.slice(0),\n        offset: offset,\n        count: count || 0\n      });\n    } else {\n      if (isLastGroupLevel) {\n        groupInfo.count = item.count > 0 ? item.count : item.items && item.items.length || 0;\n      } else {\n        item.count = groupInfo.count || item.count;\n      }\n\n      groupInfo.offset = offset;\n    }\n  };\n\n  var updateGroupInfos = function updateGroupInfos(that, options, items, loadedGroupCount, groupIndex, path, parentIndex) {\n    var groupCount = options.group ? options.group.length : 0;\n    var isLastGroupLevel = groupCount === loadedGroupCount;\n    var remotePaging = options.remoteOperations.paging;\n    var offset = 0;\n    var totalCount = 0;\n    var count;\n    groupIndex = groupIndex || 0;\n    path = path || [];\n\n    if (remotePaging && !parentIndex) {\n      offset = 0 === groupIndex ? options.skip || 0 : options.skips[groupIndex - 1] || 0;\n    }\n\n    if (groupIndex >= loadedGroupCount) {\n      return items.length;\n    }\n\n    for (var i = 0; i < items.length; i++) {\n      var item = items[i];\n\n      if (item) {\n        path.push(item.key);\n\n        if (!item.count && !item.items || void 0 === item.items) {\n          return -1;\n        }\n\n        updateGroupInfoItem(that, item, isLastGroupLevel, path, offset + i);\n        count = item.items ? updateGroupInfos(that, options, item.items, loadedGroupCount, groupIndex + 1, path, i) : item.count || -1;\n\n        if (count < 0) {\n          return -1;\n        }\n\n        totalCount += count;\n        path.pop();\n      }\n    }\n\n    return totalCount;\n  };\n\n  var isGroupExpanded = function (groups, groupIndex) {\n    return groups && groups.length && groups[groupIndex] && !!groups[groupIndex].isExpanded;\n  };\n\n  var getTotalOffset = function (groupInfos, pageSize, offset) {\n    var groupSize;\n    var totalOffset = offset;\n\n    for (var groupIndex = 0; groupIndex < groupInfos.length; groupIndex++) {\n      groupSize = groupInfos[groupIndex].offset + 1;\n\n      if (groupIndex > 0) {\n        groupSize += groupInfos[groupIndex - 1].childrenTotalCount;\n\n        if (pageSize) {\n          groupSize += getContinuationGroupCount(totalOffset, pageSize, groupSize, groupIndex - 1) * groupIndex;\n        }\n      }\n\n      totalOffset += groupSize;\n    }\n\n    return totalOffset;\n  };\n\n  function applyContinuationToGroupItem(options, expandedInfo, groupLevel, expandedItemIndex) {\n    var item = expandedInfo.items[expandedItemIndex];\n    var skip = options.skips && options.skips[groupLevel];\n    var take = options.takes && options.takes[groupLevel];\n    var isLastExpandedItem = expandedItemIndex === expandedInfo.items.length - 1;\n    var isFirstExpandedItem = 0 === expandedItemIndex;\n    var lastExpandedItemSkip = isFirstExpandedItem && skip || 0;\n    var isItemsTruncatedByTake = item.count > take + lastExpandedItemSkip;\n\n    if (isFirstExpandedItem && void 0 !== skip) {\n      item.isContinuation = true;\n    }\n\n    if (isLastExpandedItem && void 0 !== take && isItemsTruncatedByTake) {\n      item.isContinuationOnNextPage = true;\n    }\n  }\n\n  function isDataDeferred(data) {\n    return !Array.isArray(data);\n  }\n\n  function makeDataDeferred(options) {\n    if (!isDataDeferred(options.data)) {\n      options.data = new Deferred();\n    }\n  }\n\n  function loadGroupItems(that, options, loadedGroupCount, expandedInfo, groupLevel, data) {\n    if (!options.isCustomLoading) {\n      expandedInfo = {};\n      processGroupItems(that, data, loadedGroupCount, expandedInfo, []);\n      !function (options, expandedInfo, currentGroupCount) {\n        var currentGroupIndex = currentGroupCount - 1;\n        var groupCount = options.group ? options.group.length : 0;\n        expandedInfo.skip = options.skips && options.skips[currentGroupIndex];\n\n        if (options.takes && void 0 !== options.takes[currentGroupIndex]) {\n          if (groupCount === currentGroupCount) {\n            expandedInfo.take = expandedInfo.count ? expandedInfo.count - (expandedInfo.skip || 0) : 0;\n          } else {\n            expandedInfo.take = 0;\n          }\n\n          expandedInfo.take += options.takes[currentGroupIndex];\n        }\n      }(options, expandedInfo, loadedGroupCount);\n    }\n\n    var groupCount = options.group ? options.group.length : 0;\n\n    if (expandedInfo.paths.length && groupCount - loadedGroupCount > 0) {\n      makeDataDeferred(options);\n      !function (that, options, expandedInfo, loadedGroupCount, groupLevel, data) {\n        var groups = options.group || [];\n        var currentGroup = groups[groupLevel + 1];\n        var deferreds = [];\n        each(expandedInfo.paths, function (expandedItemIndex) {\n          var loadOptions = {\n            requireTotalCount: false,\n            requireGroupCount: true,\n            group: [currentGroup],\n            groupSummary: options.storeLoadOptions.groupSummary,\n            filter: createGroupFilter(expandedInfo.paths[expandedItemIndex], {\n              filter: options.storeLoadOptions.filter,\n              group: groups\n            }),\n            select: options.storeLoadOptions.select\n          };\n\n          if (0 === expandedItemIndex) {\n            loadOptions.skip = expandedInfo.skip || 0;\n          }\n\n          if (expandedItemIndex === expandedInfo.paths.length - 1) {\n            loadOptions.take = expandedInfo.take;\n          }\n\n          var loadResult = 0 === loadOptions.take ? [] : that._dataSource.loadFromStore(loadOptions);\n          when(loadResult).done(function (data) {\n            var item = expandedInfo.items[expandedItemIndex];\n            applyContinuationToGroupItem(options, expandedInfo, groupLevel, expandedItemIndex);\n            item.items = data;\n          });\n          deferreds.push(loadResult);\n        });\n        when.apply(null, deferreds).done(function () {\n          updateGroupInfos(that, options, data, loadedGroupCount + 1);\n          loadGroupItems(that, options, loadedGroupCount + 1, expandedInfo, groupLevel + 1, data);\n        });\n      }(that, options, expandedInfo, loadedGroupCount, groupLevel, data);\n    } else if (expandedInfo.paths.length && options.storeLoadOptions.group) {\n      makeDataDeferred(options);\n      !function (that, options, expandedInfo, data) {\n        var expandedFilters = [];\n        var groups = options.group || [];\n        each(expandedInfo.paths, function (_, expandedPath) {\n          expandedFilters.push(createGroupFilter(expandedPath, {\n            group: options.isCustomLoading ? options.storeLoadOptions.group : groups\n          }));\n        });\n        var filter = options.storeLoadOptions.filter;\n\n        if (!options.storeLoadOptions.isLoadingAll) {\n          filter = dataGridCore.combineFilters([filter, dataGridCore.combineFilters(expandedFilters, \"or\")]);\n        }\n\n        var loadOptions = extend({}, options.storeLoadOptions, {\n          requireTotalCount: false,\n          requireGroupCount: false,\n          group: null,\n          sort: groups.concat(dataGridCore.normalizeSortingInfo(options.storeLoadOptions.sort || [])),\n          filter: filter\n        });\n\n        var isPagingLocal = that._dataSource.isLastLevelGroupItemsPagingLocal();\n\n        if (!isPagingLocal) {\n          loadOptions.skip = expandedInfo.skip;\n          loadOptions.take = expandedInfo.take;\n        }\n\n        when(0 === expandedInfo.take ? [] : that._dataSource.loadFromStore(loadOptions)).done(function (items, extra) {\n          if (isPagingLocal) {\n            items = that._dataSource.sortLastLevelGroupItems(items, groups, expandedInfo.paths);\n            items = expandedInfo.skip ? items.slice(expandedInfo.skip) : items;\n            items = expandedInfo.take ? items.slice(0, expandedInfo.take) : items;\n          }\n\n          each(expandedInfo.items, function (index, item) {\n            var itemCount = item.count - (0 === index && expandedInfo.skip || 0);\n            var expandedItems = items.splice(0, itemCount);\n            applyContinuationToGroupItem(options, expandedInfo, groups.length - 1, index);\n            item.items = expandedItems;\n          });\n          options.data.resolve(data);\n        }).fail(options.data.reject);\n      }(that, options, expandedInfo, data);\n    } else if (isDataDeferred(options.data)) {\n      options.data.resolve(data);\n    }\n  }\n\n  var loadGroupTotalCount = function (dataSource, options) {\n    var d = new Deferred();\n    var isGrouping = !!(options.group && options.group.length);\n    var loadOptions = extend({\n      skip: 0,\n      take: 1,\n      requireGroupCount: isGrouping,\n      requireTotalCount: !isGrouping\n    }, options, {\n      group: isGrouping ? options.group : null\n    });\n    dataSource.load(loadOptions).done(function (data, extra) {\n      var count = extra && (isGrouping ? extra.groupCount : extra.totalCount);\n\n      if (!isFinite(count)) {\n        d.reject(dataErrors.Error(isGrouping ? \"E4022\" : \"E4021\"));\n        return;\n      }\n\n      d.resolve(count);\n    }).fail(d.reject.bind(d));\n    return d;\n  };\n\n  return {\n    updateTotalItemsCount: function (options) {\n      var totalItemsCount = 0;\n      var totalCount = options.extra && options.extra.totalCount || 0;\n      var groupCount = options.extra && options.extra.groupCount || 0;\n\n      var pageSize = this._dataSource.pageSize();\n\n      var isVirtualPaging = this._isVirtualPaging();\n\n      foreachExpandedGroups(this, function (groupInfo) {\n        groupInfo.childrenTotalCount = 0;\n      });\n      foreachExpandedGroups(this, function (groupInfo, parents) {\n        var totalOffset = getTotalOffset(parents, isVirtualPaging ? 0 : pageSize, totalItemsCount);\n        var count = groupInfo.count + groupInfo.childrenTotalCount;\n\n        if (!isVirtualPaging) {\n          count += getContinuationGroupCount(totalOffset, pageSize, count, parents.length - 1);\n        }\n\n        if (parents[parents.length - 2]) {\n          parents[parents.length - 2].childrenTotalCount += count;\n        } else {\n          totalItemsCount += count;\n        }\n      });\n      this.callBase(totalItemsCount - totalCount + groupCount);\n    },\n    _isGroupExpanded: function (groupIndex) {\n      var groups = this._dataSource.group();\n\n      return isGroupExpanded(groups, groupIndex);\n    },\n    _updatePagingOptions: function (options, callback) {\n      var isVirtualPaging = this._isVirtualPaging();\n\n      var pageSize = this._dataSource.pageSize();\n\n      var skips = [];\n      var takes = [];\n      var skipChildrenTotalCount = 0;\n      var childrenTotalCount = 0;\n\n      if (options.take) {\n        foreachExpandedGroups(this, function (groupInfo) {\n          groupInfo.childrenTotalCount = 0;\n          groupInfo.skipChildrenTotalCount = 0;\n        });\n        foreachExpandedGroups(this, function (groupInfo, parents) {\n          var take;\n          var takeCorrection = 0;\n          var parentTakeCorrection = 0;\n          var totalOffset = getTotalOffset(parents, isVirtualPaging ? 0 : pageSize, childrenTotalCount);\n          var continuationGroupCount = 0;\n          var skipContinuationGroupCount = 0;\n          var groupInfoCount = groupInfo.count + groupInfo.childrenTotalCount;\n          var childrenGroupInfoCount = groupInfoCount;\n          callback && callback(groupInfo, totalOffset);\n          var skip = options.skip - totalOffset;\n\n          if (totalOffset <= options.skip + options.take && groupInfoCount) {\n            take = options.take;\n\n            if (!isVirtualPaging) {\n              continuationGroupCount = getContinuationGroupCount(totalOffset, pageSize, groupInfoCount, parents.length - 1);\n              groupInfoCount += continuationGroupCount * parents.length;\n              childrenGroupInfoCount += continuationGroupCount;\n\n              if (pageSize && skip >= 0) {\n                takeCorrection = parents.length;\n                parentTakeCorrection = parents.length - 1;\n                skipContinuationGroupCount = Math.floor(skip / pageSize);\n              }\n            }\n\n            if (skip >= 0) {\n              if (totalOffset + groupInfoCount > options.skip) {\n                skips.unshift(skip - skipContinuationGroupCount * takeCorrection - groupInfo.skipChildrenTotalCount);\n              }\n\n              if (totalOffset + groupInfoCount >= options.skip + take) {\n                takes.unshift(take - takeCorrection - groupInfo.childrenTotalCount + groupInfo.skipChildrenTotalCount);\n              }\n            } else if (totalOffset + groupInfoCount >= options.skip + take) {\n              takes.unshift(take + skip - groupInfo.childrenTotalCount);\n            }\n          }\n\n          if (totalOffset <= options.skip) {\n            if (parents[parents.length - 2]) {\n              parents[parents.length - 2].skipChildrenTotalCount += Math.min(childrenGroupInfoCount, skip + 1 - skipContinuationGroupCount * parentTakeCorrection);\n            } else {\n              skipChildrenTotalCount += Math.min(childrenGroupInfoCount, skip + 1);\n            }\n          }\n\n          if (totalOffset <= options.skip + take) {\n            groupInfoCount = Math.min(childrenGroupInfoCount, skip + take - (skipContinuationGroupCount + 1) * parentTakeCorrection);\n\n            if (parents[parents.length - 2]) {\n              parents[parents.length - 2].childrenTotalCount += groupInfoCount;\n            } else {\n              childrenTotalCount += groupInfoCount;\n            }\n          }\n        });\n        options.skip -= skipChildrenTotalCount;\n        options.take -= childrenTotalCount - skipChildrenTotalCount;\n      }\n\n      options.skips = skips;\n      options.takes = takes;\n    },\n    changeRowExpand: function (path) {\n      var groupInfo = this.findGroupInfo(path);\n      var dataSource = this._dataSource;\n      var remoteGroupPaging = dataSource.remoteOperations().groupPaging;\n      var groups = dataGridCore.normalizeSortingInfo(dataSource.group());\n\n      if (groupInfo) {\n        groupInfo.isExpanded = !groupInfo.isExpanded;\n\n        if (remoteGroupPaging && groupInfo.isExpanded && path.length < groups.length) {\n          return loadGroupTotalCount(dataSource, {\n            filter: createGroupFilter(path, {\n              filter: dataSource.lastLoadOptions().filter,\n              group: dataSource.group()\n            }),\n            group: [groups[path.length]],\n            select: dataSource.select()\n          }).done(function (groupCount) {\n            groupInfo.count = groupCount;\n          });\n        }\n\n        return new Deferred().resolve();\n      }\n\n      return new Deferred().reject();\n    },\n    handleDataLoading: function (options) {\n      var storeLoadOptions = options.storeLoadOptions;\n      var groups = dataGridCore.normalizeSortingInfo(storeLoadOptions.group || options.loadOptions.group);\n\n      if (options.isCustomLoading || !groups.length) {\n        return;\n      }\n\n      if (options.remoteOperations.grouping) {\n        var remotePaging = this._dataSource.remoteOperations().paging;\n\n        storeLoadOptions.group = dataGridCore.normalizeSortingInfo(storeLoadOptions.group);\n        storeLoadOptions.group.forEach(function (group, index) {\n          var isLastGroup = index === storeLoadOptions.group.length - 1;\n          group.isExpanded = !remotePaging || !isLastGroup;\n        });\n      }\n\n      options.group = options.group || groups;\n\n      if (options.remoteOperations.paging) {\n        options.skip = storeLoadOptions.skip;\n        options.take = storeLoadOptions.take;\n        storeLoadOptions.requireGroupCount = true;\n        storeLoadOptions.group = groups.slice(0, 1);\n\n        this._updatePagingOptions(options);\n\n        storeLoadOptions.skip = options.skip;\n        storeLoadOptions.take = options.take;\n      } else {\n        options.skip = options.loadOptions.skip;\n        options.take = options.loadOptions.take;\n\n        this._updatePagingOptions(options);\n      }\n    },\n    handleDataLoadedCore: function (options, callBase) {\n      var loadedGroupCount = dataGridCore.normalizeSortingInfo(options.storeLoadOptions.group || options.loadOptions.group).length;\n      var groupCount = options.group ? options.group.length : 0;\n      var totalCount;\n      var expandedInfo = {};\n\n      if (options.isCustomLoading) {\n        callBase(options);\n        processGroupItems(this, options.data, loadedGroupCount, expandedInfo, [], options.isCustomLoading, options.storeLoadOptions.isLoadingAll);\n      } else {\n        if (!options.remoteOperations.paging) {\n          this.foreachGroups(function (groupInfo) {\n            groupInfo.count = 0;\n          });\n        }\n\n        totalCount = updateGroupInfos(this, options, options.data, loadedGroupCount);\n\n        if (totalCount < 0) {\n          options.data = new Deferred().reject(errors.Error(\"E1037\"));\n          return;\n        }\n\n        if (!options.remoteOperations.paging) {\n          if (loadedGroupCount && options.extra && options.loadOptions.requireTotalCount) {\n            options.extra.totalCount = totalCount;\n            options.extra.groupCount = options.data.length;\n          }\n        }\n\n        if (groupCount && options.storeLoadOptions.requireGroupCount && !isFinite(options.extra.groupCount)) {\n          options.data = new Deferred().reject(dataErrors.Error(\"E4022\"));\n          return;\n        }\n\n        this.updateTotalItemsCount(options);\n\n        if (!options.remoteOperations.paging) {\n          this._updatePagingOptions(options);\n        }\n\n        callBase(options);\n\n        if (!options.remoteOperations.paging) {\n          this._processPaging(options, loadedGroupCount);\n        }\n      }\n\n      loadGroupItems(this, options, loadedGroupCount, expandedInfo, 0, options.data);\n    },\n    _processSkips: function (items, skips, groupCount) {\n      if (!groupCount) {\n        return;\n      }\n\n      var firstItem = items[0];\n      var skip = skips[0];\n      var children = firstItem && firstItem.items;\n\n      if (void 0 !== skip) {\n        firstItem.isContinuation = true;\n\n        if (children) {\n          firstItem.items = children.slice(skip);\n\n          this._processSkips(firstItem.items, skips.slice(1), groupCount - 1);\n        }\n      }\n    },\n    _processTakes: function (items, skips, takes, groupCount, parents) {\n      if (!groupCount || !items) {\n        return;\n      }\n\n      parents = parents || [];\n      var lastItem = items[items.length - 1];\n      var children = lastItem && lastItem.items;\n      var take = takes[0];\n      var skip = skips[0];\n\n      if (lastItem) {\n        var maxTakeCount = lastItem.count - (lastItem.isContinuation && skip || 0) || children.length;\n\n        if (void 0 !== take && maxTakeCount > take) {\n          lastItem.isContinuationOnNextPage = true;\n          parents.forEach(function (parent) {\n            parent.isContinuationOnNextPage = true;\n          });\n\n          if (children) {\n            children = children.slice(0, take);\n            lastItem.items = children;\n          }\n        }\n\n        parents.push(lastItem);\n\n        this._processTakes(children, skips.slice(1), takes.slice(1), groupCount - 1, parents);\n      }\n    },\n    _processPaging: function (options, groupCount) {\n      this._processSkips(options.data, options.skips, groupCount);\n\n      this._processTakes(options.data, options.skips, options.takes, groupCount);\n    },\n    isLastLevelGroupItemsPagingLocal: function () {\n      return false;\n    },\n    sortLastLevelGroupItems: function (items) {\n      return items;\n    },\n    refresh: function (options, operationTypes) {\n      var that = this;\n      var dataSource = that._dataSource;\n      var storeLoadOptions = options.storeLoadOptions;\n      var group = options.group || options.storeLoadOptions.group;\n      var oldGroups = dataGridCore.normalizeSortingInfo(that._group);\n      var isExpanded;\n      var groupIndex;\n\n      function handleGroup(groupInfo, parents) {\n        if (parents.length === groupIndex + 1) {\n          groupInfo.isExpanded = isExpanded;\n        }\n      }\n\n      for (groupIndex = 0; groupIndex < oldGroups.length; groupIndex++) {\n        isExpanded = isGroupExpanded(group, groupIndex);\n\n        if (isGroupExpanded(that._group, groupIndex) !== isExpanded) {\n          that.foreachGroups(handleGroup);\n        }\n      }\n\n      that.callBase.apply(this, arguments);\n\n      if (group && options.remoteOperations.paging && operationTypes.reload) {\n        return foreachExpandedGroups(that, function (groupInfo) {\n          var groupCountQuery = loadGroupTotalCount(dataSource, {\n            filter: createGroupFilter(groupInfo.path, {\n              filter: storeLoadOptions.filter,\n              group: group\n            }),\n            group: group.slice(groupInfo.path.length),\n            select: storeLoadOptions.select\n          });\n          var groupOffsetQuery = loadGroupTotalCount(dataSource, {\n            filter: createOffsetFilter(groupInfo.path, {\n              filter: storeLoadOptions.filter,\n              group: group\n            }, true),\n            group: group.slice(groupInfo.path.length - 1, groupInfo.path.length),\n            select: storeLoadOptions.select\n          });\n          return when(groupOffsetQuery, groupCountQuery).done(function (offset, count) {\n            offset = parseInt(offset.length ? offset[0] : offset);\n            count = parseInt(count.length ? count[0] : count);\n            groupInfo.offset = offset;\n\n            if (groupInfo.count !== count) {\n              groupInfo.count = count;\n              that.updateTotalItemsCount(options);\n            }\n          });\n        }, true);\n      }\n    }\n  };\n}());","map":{"version":3,"names":["extend","each","dataGridCore","GroupingHelper","GroupingHelperCore","createOffsetFilter","createGroupFilter","errors","dataErrors","when","Deferred","getContinuationGroupCount","groupOffset","pageSize","groupSize","groupIndex","pageOffset","Math","floor","inherit","foreachExpandedGroups","that","callback","updateGroups","foreachGroups","groupInfo","parents","isExpanded","processGroupItems","items","groupsCount","expandedInfo","path","isCustomLoading","isLastGroupExpanded","paths","count","lastCount","i","length","item","push","key","findGroupInfo","collapsedItems","slice","pop","updateGroupInfoItem","isLastGroupLevel","offset","addGroupInfo","_isGroupExpanded","updateGroupInfos","options","loadedGroupCount","parentIndex","groupCount","group","remotePaging","remoteOperations","paging","totalCount","skip","skips","isGroupExpanded","groups","getTotalOffset","groupInfos","totalOffset","childrenTotalCount","applyContinuationToGroupItem","groupLevel","expandedItemIndex","take","takes","isLastExpandedItem","isFirstExpandedItem","lastExpandedItemSkip","isItemsTruncatedByTake","isContinuation","isContinuationOnNextPage","isDataDeferred","data","Array","isArray","makeDataDeferred","loadGroupItems","currentGroupCount","currentGroupIndex","currentGroup","deferreds","loadOptions","requireTotalCount","requireGroupCount","groupSummary","storeLoadOptions","filter","select","loadResult","_dataSource","loadFromStore","done","apply","expandedFilters","_","expandedPath","isLoadingAll","combineFilters","sort","concat","normalizeSortingInfo","isPagingLocal","isLastLevelGroupItemsPagingLocal","extra","sortLastLevelGroupItems","index","itemCount","expandedItems","splice","resolve","fail","reject","loadGroupTotalCount","dataSource","d","isGrouping","load","isFinite","Error","bind","updateTotalItemsCount","totalItemsCount","isVirtualPaging","_isVirtualPaging","callBase","_updatePagingOptions","skipChildrenTotalCount","takeCorrection","parentTakeCorrection","continuationGroupCount","skipContinuationGroupCount","groupInfoCount","childrenGroupInfoCount","unshift","min","changeRowExpand","remoteGroupPaging","groupPaging","lastLoadOptions","handleDataLoading","grouping","forEach","isLastGroup","handleDataLoadedCore","_processPaging","_processSkips","firstItem","children","_processTakes","lastItem","maxTakeCount","parent","refresh","operationTypes","oldGroups","_group","handleGroup","arguments","reload","groupCountQuery","groupOffsetQuery","parseInt"],"sources":["E:/MisaProject/W2022_06/misa_emis/node_modules/devextreme/esm/ui/data_grid/ui.data_grid.grouping.collapsed.js"],"sourcesContent":["/**\r\n * DevExtreme (esm/ui/data_grid/ui.data_grid.grouping.collapsed.js)\r\n * Version: 22.1.4\r\n * Build date: Fri Jul 22 2022\r\n *\r\n * Copyright (c) 2012 - 2022 Developer Express Inc. ALL RIGHTS RESERVED\r\n * Read about DevExtreme licensing here: https://js.devexpress.com/Licensing/\r\n */\r\nimport {\r\n    extend\r\n} from \"../../core/utils/extend\";\r\nimport {\r\n    each\r\n} from \"../../core/utils/iterator\";\r\nimport dataGridCore from \"./ui.data_grid.core\";\r\nimport {\r\n    GroupingHelper as GroupingHelperCore,\r\n    createOffsetFilter\r\n} from \"./ui.data_grid.grouping.core\";\r\nimport {\r\n    createGroupFilter\r\n} from \"./ui.data_grid.utils\";\r\nimport errors from \"../widget/ui.errors\";\r\nimport {\r\n    errors as dataErrors\r\n} from \"../../data/errors\";\r\nimport {\r\n    when,\r\n    Deferred\r\n} from \"../../core/utils/deferred\";\r\n\r\nfunction getContinuationGroupCount(groupOffset, pageSize, groupSize, groupIndex) {\r\n    groupIndex = groupIndex || 0;\r\n    if (pageSize > 1 && groupSize > 0) {\r\n        var pageOffset = groupOffset - Math.floor(groupOffset / pageSize) * pageSize || pageSize;\r\n        pageOffset += groupSize - groupIndex - 2;\r\n        if (pageOffset < 0) {\r\n            pageOffset += pageSize\r\n        }\r\n        return Math.floor(pageOffset / (pageSize - groupIndex - 1))\r\n    }\r\n    return 0\r\n}\r\nexport var GroupingHelper = GroupingHelperCore.inherit(function() {\r\n    var foreachExpandedGroups = function(that, callback, updateGroups) {\r\n        return that.foreachGroups((function(groupInfo, parents) {\r\n            if (groupInfo.isExpanded) {\r\n                return callback(groupInfo, parents)\r\n            }\r\n        }), true, false, updateGroups, updateGroups)\r\n    };\r\n    var processGroupItems = function processGroupItems(that, items, groupsCount, expandedInfo, path, isCustomLoading, isLastGroupExpanded) {\r\n        var isExpanded;\r\n        expandedInfo.items = expandedInfo.items || [];\r\n        expandedInfo.paths = expandedInfo.paths || [];\r\n        expandedInfo.count = expandedInfo.count || 0;\r\n        expandedInfo.lastCount = expandedInfo.lastCount || 0;\r\n        if (!groupsCount) {\r\n            return\r\n        }\r\n        for (var i = 0; i < items.length; i++) {\r\n            var item = items[i];\r\n            if (void 0 !== item.items) {\r\n                path.push(item.key);\r\n                if (isCustomLoading) {\r\n                    isExpanded = true\r\n                } else {\r\n                    var groupInfo = that.findGroupInfo(path);\r\n                    isExpanded = groupInfo && groupInfo.isExpanded\r\n                }\r\n                if (!isExpanded) {\r\n                    item.collapsedItems = item.items;\r\n                    item.items = null\r\n                } else if (item.items) {\r\n                    processGroupItems(that, item.items, groupsCount - 1, expandedInfo, path, isCustomLoading, isLastGroupExpanded)\r\n                } else if (1 === groupsCount && item.count && (!isCustomLoading || isLastGroupExpanded)) {\r\n                    expandedInfo.items.push(item);\r\n                    expandedInfo.paths.push(path.slice(0));\r\n                    expandedInfo.count += expandedInfo.lastCount;\r\n                    expandedInfo.lastCount = item.count\r\n                }\r\n                path.pop()\r\n            }\r\n        }\r\n    };\r\n    var updateGroupInfoItem = function(that, item, isLastGroupLevel, path, offset) {\r\n        var groupInfo = that.findGroupInfo(path);\r\n        var count;\r\n        if (!groupInfo) {\r\n            if (isLastGroupLevel) {\r\n                count = item.count > 0 ? item.count : item.items.length\r\n            }\r\n            that.addGroupInfo({\r\n                isExpanded: that._isGroupExpanded(path.length - 1),\r\n                path: path.slice(0),\r\n                offset: offset,\r\n                count: count || 0\r\n            })\r\n        } else {\r\n            if (isLastGroupLevel) {\r\n                groupInfo.count = item.count > 0 ? item.count : item.items && item.items.length || 0\r\n            } else {\r\n                item.count = groupInfo.count || item.count\r\n            }\r\n            groupInfo.offset = offset\r\n        }\r\n    };\r\n    var updateGroupInfos = function updateGroupInfos(that, options, items, loadedGroupCount, groupIndex, path, parentIndex) {\r\n        var groupCount = options.group ? options.group.length : 0;\r\n        var isLastGroupLevel = groupCount === loadedGroupCount;\r\n        var remotePaging = options.remoteOperations.paging;\r\n        var offset = 0;\r\n        var totalCount = 0;\r\n        var count;\r\n        groupIndex = groupIndex || 0;\r\n        path = path || [];\r\n        if (remotePaging && !parentIndex) {\r\n            offset = 0 === groupIndex ? options.skip || 0 : options.skips[groupIndex - 1] || 0\r\n        }\r\n        if (groupIndex >= loadedGroupCount) {\r\n            return items.length\r\n        }\r\n        for (var i = 0; i < items.length; i++) {\r\n            var item = items[i];\r\n            if (item) {\r\n                path.push(item.key);\r\n                if (!item.count && !item.items || void 0 === item.items) {\r\n                    return -1\r\n                }\r\n                updateGroupInfoItem(that, item, isLastGroupLevel, path, offset + i);\r\n                count = item.items ? updateGroupInfos(that, options, item.items, loadedGroupCount, groupIndex + 1, path, i) : item.count || -1;\r\n                if (count < 0) {\r\n                    return -1\r\n                }\r\n                totalCount += count;\r\n                path.pop()\r\n            }\r\n        }\r\n        return totalCount\r\n    };\r\n    var isGroupExpanded = function(groups, groupIndex) {\r\n        return groups && groups.length && groups[groupIndex] && !!groups[groupIndex].isExpanded\r\n    };\r\n    var getTotalOffset = function(groupInfos, pageSize, offset) {\r\n        var groupSize;\r\n        var totalOffset = offset;\r\n        for (var groupIndex = 0; groupIndex < groupInfos.length; groupIndex++) {\r\n            groupSize = groupInfos[groupIndex].offset + 1;\r\n            if (groupIndex > 0) {\r\n                groupSize += groupInfos[groupIndex - 1].childrenTotalCount;\r\n                if (pageSize) {\r\n                    groupSize += getContinuationGroupCount(totalOffset, pageSize, groupSize, groupIndex - 1) * groupIndex\r\n                }\r\n            }\r\n            totalOffset += groupSize\r\n        }\r\n        return totalOffset\r\n    };\r\n\r\n    function applyContinuationToGroupItem(options, expandedInfo, groupLevel, expandedItemIndex) {\r\n        var item = expandedInfo.items[expandedItemIndex];\r\n        var skip = options.skips && options.skips[groupLevel];\r\n        var take = options.takes && options.takes[groupLevel];\r\n        var isLastExpandedItem = expandedItemIndex === expandedInfo.items.length - 1;\r\n        var isFirstExpandedItem = 0 === expandedItemIndex;\r\n        var lastExpandedItemSkip = isFirstExpandedItem && skip || 0;\r\n        var isItemsTruncatedByTake = item.count > take + lastExpandedItemSkip;\r\n        if (isFirstExpandedItem && void 0 !== skip) {\r\n            item.isContinuation = true\r\n        }\r\n        if (isLastExpandedItem && void 0 !== take && isItemsTruncatedByTake) {\r\n            item.isContinuationOnNextPage = true\r\n        }\r\n    }\r\n\r\n    function isDataDeferred(data) {\r\n        return !Array.isArray(data)\r\n    }\r\n\r\n    function makeDataDeferred(options) {\r\n        if (!isDataDeferred(options.data)) {\r\n            options.data = new Deferred\r\n        }\r\n    }\r\n\r\n    function loadGroupItems(that, options, loadedGroupCount, expandedInfo, groupLevel, data) {\r\n        if (!options.isCustomLoading) {\r\n            expandedInfo = {};\r\n            processGroupItems(that, data, loadedGroupCount, expandedInfo, []);\r\n            ! function(options, expandedInfo, currentGroupCount) {\r\n                var currentGroupIndex = currentGroupCount - 1;\r\n                var groupCount = options.group ? options.group.length : 0;\r\n                expandedInfo.skip = options.skips && options.skips[currentGroupIndex];\r\n                if (options.takes && void 0 !== options.takes[currentGroupIndex]) {\r\n                    if (groupCount === currentGroupCount) {\r\n                        expandedInfo.take = expandedInfo.count ? expandedInfo.count - (expandedInfo.skip || 0) : 0\r\n                    } else {\r\n                        expandedInfo.take = 0\r\n                    }\r\n                    expandedInfo.take += options.takes[currentGroupIndex]\r\n                }\r\n            }(options, expandedInfo, loadedGroupCount)\r\n        }\r\n        var groupCount = options.group ? options.group.length : 0;\r\n        if (expandedInfo.paths.length && groupCount - loadedGroupCount > 0) {\r\n            makeDataDeferred(options);\r\n            ! function(that, options, expandedInfo, loadedGroupCount, groupLevel, data) {\r\n                var groups = options.group || [];\r\n                var currentGroup = groups[groupLevel + 1];\r\n                var deferreds = [];\r\n                each(expandedInfo.paths, (function(expandedItemIndex) {\r\n                    var loadOptions = {\r\n                        requireTotalCount: false,\r\n                        requireGroupCount: true,\r\n                        group: [currentGroup],\r\n                        groupSummary: options.storeLoadOptions.groupSummary,\r\n                        filter: createGroupFilter(expandedInfo.paths[expandedItemIndex], {\r\n                            filter: options.storeLoadOptions.filter,\r\n                            group: groups\r\n                        }),\r\n                        select: options.storeLoadOptions.select\r\n                    };\r\n                    if (0 === expandedItemIndex) {\r\n                        loadOptions.skip = expandedInfo.skip || 0\r\n                    }\r\n                    if (expandedItemIndex === expandedInfo.paths.length - 1) {\r\n                        loadOptions.take = expandedInfo.take\r\n                    }\r\n                    var loadResult = 0 === loadOptions.take ? [] : that._dataSource.loadFromStore(loadOptions);\r\n                    when(loadResult).done((function(data) {\r\n                        var item = expandedInfo.items[expandedItemIndex];\r\n                        applyContinuationToGroupItem(options, expandedInfo, groupLevel, expandedItemIndex);\r\n                        item.items = data\r\n                    }));\r\n                    deferreds.push(loadResult)\r\n                }));\r\n                when.apply(null, deferreds).done((function() {\r\n                    updateGroupInfos(that, options, data, loadedGroupCount + 1);\r\n                    loadGroupItems(that, options, loadedGroupCount + 1, expandedInfo, groupLevel + 1, data)\r\n                }))\r\n            }(that, options, expandedInfo, loadedGroupCount, groupLevel, data)\r\n        } else if (expandedInfo.paths.length && options.storeLoadOptions.group) {\r\n            makeDataDeferred(options);\r\n            ! function(that, options, expandedInfo, data) {\r\n                var expandedFilters = [];\r\n                var groups = options.group || [];\r\n                each(expandedInfo.paths, (function(_, expandedPath) {\r\n                    expandedFilters.push(createGroupFilter(expandedPath, {\r\n                        group: options.isCustomLoading ? options.storeLoadOptions.group : groups\r\n                    }))\r\n                }));\r\n                var filter = options.storeLoadOptions.filter;\r\n                if (!options.storeLoadOptions.isLoadingAll) {\r\n                    filter = dataGridCore.combineFilters([filter, dataGridCore.combineFilters(expandedFilters, \"or\")])\r\n                }\r\n                var loadOptions = extend({}, options.storeLoadOptions, {\r\n                    requireTotalCount: false,\r\n                    requireGroupCount: false,\r\n                    group: null,\r\n                    sort: groups.concat(dataGridCore.normalizeSortingInfo(options.storeLoadOptions.sort || [])),\r\n                    filter: filter\r\n                });\r\n                var isPagingLocal = that._dataSource.isLastLevelGroupItemsPagingLocal();\r\n                if (!isPagingLocal) {\r\n                    loadOptions.skip = expandedInfo.skip;\r\n                    loadOptions.take = expandedInfo.take\r\n                }\r\n                when(0 === expandedInfo.take ? [] : that._dataSource.loadFromStore(loadOptions)).done((function(items, extra) {\r\n                    if (isPagingLocal) {\r\n                        items = that._dataSource.sortLastLevelGroupItems(items, groups, expandedInfo.paths);\r\n                        items = expandedInfo.skip ? items.slice(expandedInfo.skip) : items;\r\n                        items = expandedInfo.take ? items.slice(0, expandedInfo.take) : items\r\n                    }\r\n                    each(expandedInfo.items, (function(index, item) {\r\n                        var itemCount = item.count - (0 === index && expandedInfo.skip || 0);\r\n                        var expandedItems = items.splice(0, itemCount);\r\n                        applyContinuationToGroupItem(options, expandedInfo, groups.length - 1, index);\r\n                        item.items = expandedItems\r\n                    }));\r\n                    options.data.resolve(data)\r\n                })).fail(options.data.reject)\r\n            }(that, options, expandedInfo, data)\r\n        } else if (isDataDeferred(options.data)) {\r\n            options.data.resolve(data)\r\n        }\r\n    }\r\n    var loadGroupTotalCount = function(dataSource, options) {\r\n        var d = new Deferred;\r\n        var isGrouping = !!(options.group && options.group.length);\r\n        var loadOptions = extend({\r\n            skip: 0,\r\n            take: 1,\r\n            requireGroupCount: isGrouping,\r\n            requireTotalCount: !isGrouping\r\n        }, options, {\r\n            group: isGrouping ? options.group : null\r\n        });\r\n        dataSource.load(loadOptions).done((function(data, extra) {\r\n            var count = extra && (isGrouping ? extra.groupCount : extra.totalCount);\r\n            if (!isFinite(count)) {\r\n                d.reject(dataErrors.Error(isGrouping ? \"E4022\" : \"E4021\"));\r\n                return\r\n            }\r\n            d.resolve(count)\r\n        })).fail(d.reject.bind(d));\r\n        return d\r\n    };\r\n    return {\r\n        updateTotalItemsCount: function(options) {\r\n            var totalItemsCount = 0;\r\n            var totalCount = options.extra && options.extra.totalCount || 0;\r\n            var groupCount = options.extra && options.extra.groupCount || 0;\r\n            var pageSize = this._dataSource.pageSize();\r\n            var isVirtualPaging = this._isVirtualPaging();\r\n            foreachExpandedGroups(this, (function(groupInfo) {\r\n                groupInfo.childrenTotalCount = 0\r\n            }));\r\n            foreachExpandedGroups(this, (function(groupInfo, parents) {\r\n                var totalOffset = getTotalOffset(parents, isVirtualPaging ? 0 : pageSize, totalItemsCount);\r\n                var count = groupInfo.count + groupInfo.childrenTotalCount;\r\n                if (!isVirtualPaging) {\r\n                    count += getContinuationGroupCount(totalOffset, pageSize, count, parents.length - 1)\r\n                }\r\n                if (parents[parents.length - 2]) {\r\n                    parents[parents.length - 2].childrenTotalCount += count\r\n                } else {\r\n                    totalItemsCount += count\r\n                }\r\n            }));\r\n            this.callBase(totalItemsCount - totalCount + groupCount)\r\n        },\r\n        _isGroupExpanded: function(groupIndex) {\r\n            var groups = this._dataSource.group();\r\n            return isGroupExpanded(groups, groupIndex)\r\n        },\r\n        _updatePagingOptions: function(options, callback) {\r\n            var isVirtualPaging = this._isVirtualPaging();\r\n            var pageSize = this._dataSource.pageSize();\r\n            var skips = [];\r\n            var takes = [];\r\n            var skipChildrenTotalCount = 0;\r\n            var childrenTotalCount = 0;\r\n            if (options.take) {\r\n                foreachExpandedGroups(this, (function(groupInfo) {\r\n                    groupInfo.childrenTotalCount = 0;\r\n                    groupInfo.skipChildrenTotalCount = 0\r\n                }));\r\n                foreachExpandedGroups(this, (function(groupInfo, parents) {\r\n                    var take;\r\n                    var takeCorrection = 0;\r\n                    var parentTakeCorrection = 0;\r\n                    var totalOffset = getTotalOffset(parents, isVirtualPaging ? 0 : pageSize, childrenTotalCount);\r\n                    var continuationGroupCount = 0;\r\n                    var skipContinuationGroupCount = 0;\r\n                    var groupInfoCount = groupInfo.count + groupInfo.childrenTotalCount;\r\n                    var childrenGroupInfoCount = groupInfoCount;\r\n                    callback && callback(groupInfo, totalOffset);\r\n                    var skip = options.skip - totalOffset;\r\n                    if (totalOffset <= options.skip + options.take && groupInfoCount) {\r\n                        take = options.take;\r\n                        if (!isVirtualPaging) {\r\n                            continuationGroupCount = getContinuationGroupCount(totalOffset, pageSize, groupInfoCount, parents.length - 1);\r\n                            groupInfoCount += continuationGroupCount * parents.length;\r\n                            childrenGroupInfoCount += continuationGroupCount;\r\n                            if (pageSize && skip >= 0) {\r\n                                takeCorrection = parents.length;\r\n                                parentTakeCorrection = parents.length - 1;\r\n                                skipContinuationGroupCount = Math.floor(skip / pageSize)\r\n                            }\r\n                        }\r\n                        if (skip >= 0) {\r\n                            if (totalOffset + groupInfoCount > options.skip) {\r\n                                skips.unshift(skip - skipContinuationGroupCount * takeCorrection - groupInfo.skipChildrenTotalCount)\r\n                            }\r\n                            if (totalOffset + groupInfoCount >= options.skip + take) {\r\n                                takes.unshift(take - takeCorrection - groupInfo.childrenTotalCount + groupInfo.skipChildrenTotalCount)\r\n                            }\r\n                        } else if (totalOffset + groupInfoCount >= options.skip + take) {\r\n                            takes.unshift(take + skip - groupInfo.childrenTotalCount)\r\n                        }\r\n                    }\r\n                    if (totalOffset <= options.skip) {\r\n                        if (parents[parents.length - 2]) {\r\n                            parents[parents.length - 2].skipChildrenTotalCount += Math.min(childrenGroupInfoCount, skip + 1 - skipContinuationGroupCount * parentTakeCorrection)\r\n                        } else {\r\n                            skipChildrenTotalCount += Math.min(childrenGroupInfoCount, skip + 1)\r\n                        }\r\n                    }\r\n                    if (totalOffset <= options.skip + take) {\r\n                        groupInfoCount = Math.min(childrenGroupInfoCount, skip + take - (skipContinuationGroupCount + 1) * parentTakeCorrection);\r\n                        if (parents[parents.length - 2]) {\r\n                            parents[parents.length - 2].childrenTotalCount += groupInfoCount\r\n                        } else {\r\n                            childrenTotalCount += groupInfoCount\r\n                        }\r\n                    }\r\n                }));\r\n                options.skip -= skipChildrenTotalCount;\r\n                options.take -= childrenTotalCount - skipChildrenTotalCount\r\n            }\r\n            options.skips = skips;\r\n            options.takes = takes\r\n        },\r\n        changeRowExpand: function(path) {\r\n            var groupInfo = this.findGroupInfo(path);\r\n            var dataSource = this._dataSource;\r\n            var remoteGroupPaging = dataSource.remoteOperations().groupPaging;\r\n            var groups = dataGridCore.normalizeSortingInfo(dataSource.group());\r\n            if (groupInfo) {\r\n                groupInfo.isExpanded = !groupInfo.isExpanded;\r\n                if (remoteGroupPaging && groupInfo.isExpanded && path.length < groups.length) {\r\n                    return loadGroupTotalCount(dataSource, {\r\n                        filter: createGroupFilter(path, {\r\n                            filter: dataSource.lastLoadOptions().filter,\r\n                            group: dataSource.group()\r\n                        }),\r\n                        group: [groups[path.length]],\r\n                        select: dataSource.select()\r\n                    }).done((function(groupCount) {\r\n                        groupInfo.count = groupCount\r\n                    }))\r\n                }\r\n                return (new Deferred).resolve()\r\n            }\r\n            return (new Deferred).reject()\r\n        },\r\n        handleDataLoading: function(options) {\r\n            var storeLoadOptions = options.storeLoadOptions;\r\n            var groups = dataGridCore.normalizeSortingInfo(storeLoadOptions.group || options.loadOptions.group);\r\n            if (options.isCustomLoading || !groups.length) {\r\n                return\r\n            }\r\n            if (options.remoteOperations.grouping) {\r\n                var remotePaging = this._dataSource.remoteOperations().paging;\r\n                storeLoadOptions.group = dataGridCore.normalizeSortingInfo(storeLoadOptions.group);\r\n                storeLoadOptions.group.forEach((function(group, index) {\r\n                    var isLastGroup = index === storeLoadOptions.group.length - 1;\r\n                    group.isExpanded = !remotePaging || !isLastGroup\r\n                }))\r\n            }\r\n            options.group = options.group || groups;\r\n            if (options.remoteOperations.paging) {\r\n                options.skip = storeLoadOptions.skip;\r\n                options.take = storeLoadOptions.take;\r\n                storeLoadOptions.requireGroupCount = true;\r\n                storeLoadOptions.group = groups.slice(0, 1);\r\n                this._updatePagingOptions(options);\r\n                storeLoadOptions.skip = options.skip;\r\n                storeLoadOptions.take = options.take\r\n            } else {\r\n                options.skip = options.loadOptions.skip;\r\n                options.take = options.loadOptions.take;\r\n                this._updatePagingOptions(options)\r\n            }\r\n        },\r\n        handleDataLoadedCore: function(options, callBase) {\r\n            var loadedGroupCount = dataGridCore.normalizeSortingInfo(options.storeLoadOptions.group || options.loadOptions.group).length;\r\n            var groupCount = options.group ? options.group.length : 0;\r\n            var totalCount;\r\n            var expandedInfo = {};\r\n            if (options.isCustomLoading) {\r\n                callBase(options);\r\n                processGroupItems(this, options.data, loadedGroupCount, expandedInfo, [], options.isCustomLoading, options.storeLoadOptions.isLoadingAll)\r\n            } else {\r\n                if (!options.remoteOperations.paging) {\r\n                    this.foreachGroups((function(groupInfo) {\r\n                        groupInfo.count = 0\r\n                    }))\r\n                }\r\n                totalCount = updateGroupInfos(this, options, options.data, loadedGroupCount);\r\n                if (totalCount < 0) {\r\n                    options.data = (new Deferred).reject(errors.Error(\"E1037\"));\r\n                    return\r\n                }\r\n                if (!options.remoteOperations.paging) {\r\n                    if (loadedGroupCount && options.extra && options.loadOptions.requireTotalCount) {\r\n                        options.extra.totalCount = totalCount;\r\n                        options.extra.groupCount = options.data.length\r\n                    }\r\n                }\r\n                if (groupCount && options.storeLoadOptions.requireGroupCount && !isFinite(options.extra.groupCount)) {\r\n                    options.data = (new Deferred).reject(dataErrors.Error(\"E4022\"));\r\n                    return\r\n                }\r\n                this.updateTotalItemsCount(options);\r\n                if (!options.remoteOperations.paging) {\r\n                    this._updatePagingOptions(options)\r\n                }\r\n                callBase(options);\r\n                if (!options.remoteOperations.paging) {\r\n                    this._processPaging(options, loadedGroupCount)\r\n                }\r\n            }\r\n            loadGroupItems(this, options, loadedGroupCount, expandedInfo, 0, options.data)\r\n        },\r\n        _processSkips: function(items, skips, groupCount) {\r\n            if (!groupCount) {\r\n                return\r\n            }\r\n            var firstItem = items[0];\r\n            var skip = skips[0];\r\n            var children = firstItem && firstItem.items;\r\n            if (void 0 !== skip) {\r\n                firstItem.isContinuation = true;\r\n                if (children) {\r\n                    firstItem.items = children.slice(skip);\r\n                    this._processSkips(firstItem.items, skips.slice(1), groupCount - 1)\r\n                }\r\n            }\r\n        },\r\n        _processTakes: function(items, skips, takes, groupCount, parents) {\r\n            if (!groupCount || !items) {\r\n                return\r\n            }\r\n            parents = parents || [];\r\n            var lastItem = items[items.length - 1];\r\n            var children = lastItem && lastItem.items;\r\n            var take = takes[0];\r\n            var skip = skips[0];\r\n            if (lastItem) {\r\n                var maxTakeCount = lastItem.count - (lastItem.isContinuation && skip || 0) || children.length;\r\n                if (void 0 !== take && maxTakeCount > take) {\r\n                    lastItem.isContinuationOnNextPage = true;\r\n                    parents.forEach((function(parent) {\r\n                        parent.isContinuationOnNextPage = true\r\n                    }));\r\n                    if (children) {\r\n                        children = children.slice(0, take);\r\n                        lastItem.items = children\r\n                    }\r\n                }\r\n                parents.push(lastItem);\r\n                this._processTakes(children, skips.slice(1), takes.slice(1), groupCount - 1, parents)\r\n            }\r\n        },\r\n        _processPaging: function(options, groupCount) {\r\n            this._processSkips(options.data, options.skips, groupCount);\r\n            this._processTakes(options.data, options.skips, options.takes, groupCount)\r\n        },\r\n        isLastLevelGroupItemsPagingLocal: function() {\r\n            return false\r\n        },\r\n        sortLastLevelGroupItems: function(items) {\r\n            return items\r\n        },\r\n        refresh: function(options, operationTypes) {\r\n            var that = this;\r\n            var dataSource = that._dataSource;\r\n            var storeLoadOptions = options.storeLoadOptions;\r\n            var group = options.group || options.storeLoadOptions.group;\r\n            var oldGroups = dataGridCore.normalizeSortingInfo(that._group);\r\n            var isExpanded;\r\n            var groupIndex;\r\n\r\n            function handleGroup(groupInfo, parents) {\r\n                if (parents.length === groupIndex + 1) {\r\n                    groupInfo.isExpanded = isExpanded\r\n                }\r\n            }\r\n            for (groupIndex = 0; groupIndex < oldGroups.length; groupIndex++) {\r\n                isExpanded = isGroupExpanded(group, groupIndex);\r\n                if (isGroupExpanded(that._group, groupIndex) !== isExpanded) {\r\n                    that.foreachGroups(handleGroup)\r\n                }\r\n            }\r\n            that.callBase.apply(this, arguments);\r\n            if (group && options.remoteOperations.paging && operationTypes.reload) {\r\n                return foreachExpandedGroups(that, (function(groupInfo) {\r\n                    var groupCountQuery = loadGroupTotalCount(dataSource, {\r\n                        filter: createGroupFilter(groupInfo.path, {\r\n                            filter: storeLoadOptions.filter,\r\n                            group: group\r\n                        }),\r\n                        group: group.slice(groupInfo.path.length),\r\n                        select: storeLoadOptions.select\r\n                    });\r\n                    var groupOffsetQuery = loadGroupTotalCount(dataSource, {\r\n                        filter: createOffsetFilter(groupInfo.path, {\r\n                            filter: storeLoadOptions.filter,\r\n                            group: group\r\n                        }, true),\r\n                        group: group.slice(groupInfo.path.length - 1, groupInfo.path.length),\r\n                        select: storeLoadOptions.select\r\n                    });\r\n                    return when(groupOffsetQuery, groupCountQuery).done((function(offset, count) {\r\n                        offset = parseInt(offset.length ? offset[0] : offset);\r\n                        count = parseInt(count.length ? count[0] : count);\r\n                        groupInfo.offset = offset;\r\n                        if (groupInfo.count !== count) {\r\n                            groupInfo.count = count;\r\n                            that.updateTotalItemsCount(options)\r\n                        }\r\n                    }))\r\n                }), true)\r\n            }\r\n        }\r\n    }\r\n}());\r\n"],"mappings":"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"},"metadata":{},"sourceType":"module"}