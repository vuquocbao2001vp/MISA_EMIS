{"ast":null,"code":"import \"core-js/modules/es.error.cause.js\";\nimport { __assign } from \"tslib\";\nimport { Frequency } from './types';\nimport { Weekday } from './weekday';\nimport dateutil from './dateutil';\nimport { Days } from './rrule';\nexport function parseString(rfcString) {\n  var options = rfcString.split('\\n').map(parseLine).filter(function (x) {\n    return x !== null;\n  });\n  return __assign(__assign({}, options[0]), options[1]);\n}\nexport function parseDtstart(line) {\n  var options = {};\n  var dtstartWithZone = /DTSTART(?:;TZID=([^:=]+?))?(?::|=)([^;\\s]+)/i.exec(line);\n\n  if (!dtstartWithZone) {\n    return options;\n  }\n\n  var _ = dtstartWithZone[0],\n      tzid = dtstartWithZone[1],\n      dtstart = dtstartWithZone[2];\n\n  if (tzid) {\n    options.tzid = tzid;\n  }\n\n  options.dtstart = dateutil.untilStringToDate(dtstart);\n  return options;\n}\n\nfunction parseLine(rfcString) {\n  rfcString = rfcString.replace(/^\\s+|\\s+$/, '');\n  if (!rfcString.length) return null;\n  var header = /^([A-Z]+?)[:;]/.exec(rfcString.toUpperCase());\n\n  if (!header) {\n    return parseRrule(rfcString);\n  }\n\n  var _ = header[0],\n      key = header[1];\n\n  switch (key.toUpperCase()) {\n    case 'RRULE':\n    case 'EXRULE':\n      return parseRrule(rfcString);\n\n    case 'DTSTART':\n      return parseDtstart(rfcString);\n\n    default:\n      throw new Error(\"Unsupported RFC prop \" + key + \" in \" + rfcString);\n  }\n}\n\nfunction parseRrule(line) {\n  var strippedLine = line.replace(/^RRULE:/i, '');\n  var options = parseDtstart(strippedLine);\n  var attrs = line.replace(/^(?:RRULE|EXRULE):/i, '').split(';');\n  attrs.forEach(function (attr) {\n    var _a = attr.split('='),\n        key = _a[0],\n        value = _a[1];\n\n    switch (key.toUpperCase()) {\n      case 'FREQ':\n        options.freq = Frequency[value.toUpperCase()];\n        break;\n\n      case 'WKST':\n        options.wkst = Days[value.toUpperCase()];\n        break;\n\n      case 'COUNT':\n      case 'INTERVAL':\n      case 'BYSETPOS':\n      case 'BYMONTH':\n      case 'BYMONTHDAY':\n      case 'BYYEARDAY':\n      case 'BYWEEKNO':\n      case 'BYHOUR':\n      case 'BYMINUTE':\n      case 'BYSECOND':\n        var num = parseNumber(value);\n        var optionKey = key.toLowerCase(); // @ts-ignore\n\n        options[optionKey] = num;\n        break;\n\n      case 'BYWEEKDAY':\n      case 'BYDAY':\n        options.byweekday = parseWeekday(value);\n        break;\n\n      case 'DTSTART':\n      case 'TZID':\n        // for backwards compatibility\n        var dtstart = parseDtstart(line);\n        options.tzid = dtstart.tzid;\n        options.dtstart = dtstart.dtstart;\n        break;\n\n      case 'UNTIL':\n        options.until = dateutil.untilStringToDate(value);\n        break;\n\n      case 'BYEASTER':\n        options.byeaster = Number(value);\n        break;\n\n      default:\n        throw new Error(\"Unknown RRULE property '\" + key + \"'\");\n    }\n  });\n  return options;\n}\n\nfunction parseNumber(value) {\n  if (value.indexOf(',') !== -1) {\n    var values = value.split(',');\n    return values.map(parseIndividualNumber);\n  }\n\n  return parseIndividualNumber(value);\n}\n\nfunction parseIndividualNumber(value) {\n  if (/^[+-]?\\d+$/.test(value)) {\n    return Number(value);\n  }\n\n  return value;\n}\n\nfunction parseWeekday(value) {\n  var days = value.split(',');\n  return days.map(function (day) {\n    if (day.length === 2) {\n      // MO, TU, ...\n      return Days[day]; // wday instanceof Weekday\n    } // -1MO, +3FR, 1SO, 13TU ...\n\n\n    var parts = day.match(/^([+-]?\\d{1,2})([A-Z]{2})$/);\n    var n = Number(parts[1]);\n    var wdaypart = parts[2];\n    var wday = Days[wdaypart].weekday;\n    return new Weekday(wday, n);\n  });\n}","map":{"version":3,"mappings":"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","names":["Frequency","Weekday","dateutil","Days","parseString","rfcString","options","split","map","parseLine","filter","parseDtstart","line","dtstartWithZone","exec","tzid","dtstart","untilStringToDate","replace","length","header","toUpperCase","parseRrule","key","Error","strippedLine","attrs","forEach","value","freq","wkst","num","parseNumber","optionKey","toLowerCase","byweekday","parseWeekday","until","byeaster","Number","indexOf","values","parseIndividualNumber","test","days","day","parts","match","n","wdaypart","wday","weekday"],"sourceRoot":"","sources":["../../../src/parsestring.ts"],"sourcesContent":[null]},"metadata":{},"sourceType":"module"}