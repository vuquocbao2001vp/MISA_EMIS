{"ast":null,"code":"/**\r\n * DevExtreme (esm/ui/tree_list/ui.tree_list.focus.js)\r\n * Version: 22.1.4\r\n * Build date: Fri Jul 22 2022\r\n *\r\n * Copyright (c) 2012 - 2022 Developer Express Inc. ALL RIGHTS RESERVED\r\n * Read about DevExtreme licensing here: https://js.devexpress.com/Licensing/\r\n */\nimport core from \"./ui.tree_list.core\";\nimport { extend } from \"../../core/utils/extend\";\nimport { Deferred } from \"../../core/utils/deferred\";\nimport { focusModule } from \"../grid_core/ui.grid_core.focus\";\n\nfunction findIndex(items, callback) {\n  var result = -1;\n  items.forEach(function (node, index) {\n    if (callback(node)) {\n      result = index;\n    }\n  });\n  return result;\n}\n\ncore.registerModule(\"focus\", extend(true, {}, focusModule, {\n  extenders: {\n    controllers: {\n      data: {\n        changeRowExpand: function (key) {\n          if (this.option(\"focusedRowEnabled\") && this.isRowExpanded(key)) {\n            if (this._isFocusedRowInside(key)) {\n              this.option(\"focusedRowKey\", key);\n            }\n          }\n\n          return this.callBase.apply(this, arguments);\n        },\n        _isFocusedRowInside: function (parentKey) {\n          var focusedRowKey = this.option(\"focusedRowKey\");\n          var rowIndex = this.getRowIndexByKey(focusedRowKey);\n          var focusedRow = rowIndex >= 0 && this.getVisibleRows()[rowIndex];\n          var parent = focusedRow && focusedRow.node.parent;\n\n          while (parent) {\n            if (parent.key === parentKey) {\n              return true;\n            }\n\n            parent = parent.parent;\n          }\n\n          return false;\n        },\n        getParentKey: function (key) {\n          var dataSource = this._dataSource;\n          var node = this.getNodeByKey(key);\n          var d = new Deferred();\n\n          if (node) {\n            d.resolve(node.parent ? node.parent.key : void 0);\n          } else {\n            dataSource.load({\n              filter: [dataSource.getKeyExpr(), \"=\", key]\n            }).done(function (items) {\n              var parentData = items[0];\n\n              if (parentData) {\n                d.resolve(dataSource.parentKeyOf(parentData));\n              } else {\n                d.reject();\n              }\n            }).fail(d.reject);\n          }\n\n          return d.promise();\n        },\n        expandAscendants: function (key) {\n          var that = this;\n          var dataSource = that._dataSource;\n          var d = new Deferred();\n          that.getParentKey(key).done(function (parentKey) {\n            if (dataSource && void 0 !== parentKey && parentKey !== that.option(\"rootValue\")) {\n              dataSource._isNodesInitializing = true;\n              that.expandRow(parentKey);\n              dataSource._isNodesInitializing = false;\n              that.expandAscendants(parentKey).done(d.resolve).fail(d.reject);\n            } else {\n              d.resolve();\n            }\n          }).fail(d.reject);\n          return d.promise();\n        },\n        getPageIndexByKey: function (key) {\n          var that = this;\n          var dataSource = that._dataSource;\n          var d = new Deferred();\n          that.expandAscendants(key).done(function () {\n            dataSource.load({\n              parentIds: []\n            }).done(function (nodes) {\n              var offset = findIndex(nodes, function (node) {\n                return that.keyOf(node.data) === key;\n              });\n              var pageIndex = -1;\n\n              if (offset >= 0) {\n                pageIndex = Math.floor(offset / that.pageSize());\n              }\n\n              d.resolve(pageIndex);\n            }).fail(d.reject);\n          }).fail(d.reject);\n          return d.promise();\n        }\n      }\n    }\n  }\n}));","map":{"version":3,"names":["core","extend","Deferred","focusModule","findIndex","items","callback","result","forEach","node","index","registerModule","extenders","controllers","data","changeRowExpand","key","option","isRowExpanded","_isFocusedRowInside","callBase","apply","arguments","parentKey","focusedRowKey","rowIndex","getRowIndexByKey","focusedRow","getVisibleRows","parent","getParentKey","dataSource","_dataSource","getNodeByKey","d","resolve","load","filter","getKeyExpr","done","parentData","parentKeyOf","reject","fail","promise","expandAscendants","that","_isNodesInitializing","expandRow","getPageIndexByKey","parentIds","nodes","offset","keyOf","pageIndex","Math","floor","pageSize"],"sources":["E:/MisaProject/W2022_06/misa_emis/node_modules/devextreme/esm/ui/tree_list/ui.tree_list.focus.js"],"sourcesContent":["/**\r\n * DevExtreme (esm/ui/tree_list/ui.tree_list.focus.js)\r\n * Version: 22.1.4\r\n * Build date: Fri Jul 22 2022\r\n *\r\n * Copyright (c) 2012 - 2022 Developer Express Inc. ALL RIGHTS RESERVED\r\n * Read about DevExtreme licensing here: https://js.devexpress.com/Licensing/\r\n */\r\nimport core from \"./ui.tree_list.core\";\r\nimport {\r\n    extend\r\n} from \"../../core/utils/extend\";\r\nimport {\r\n    Deferred\r\n} from \"../../core/utils/deferred\";\r\nimport {\r\n    focusModule\r\n} from \"../grid_core/ui.grid_core.focus\";\r\n\r\nfunction findIndex(items, callback) {\r\n    var result = -1;\r\n    items.forEach((function(node, index) {\r\n        if (callback(node)) {\r\n            result = index\r\n        }\r\n    }));\r\n    return result\r\n}\r\ncore.registerModule(\"focus\", extend(true, {}, focusModule, {\r\n    extenders: {\r\n        controllers: {\r\n            data: {\r\n                changeRowExpand: function(key) {\r\n                    if (this.option(\"focusedRowEnabled\") && this.isRowExpanded(key)) {\r\n                        if (this._isFocusedRowInside(key)) {\r\n                            this.option(\"focusedRowKey\", key)\r\n                        }\r\n                    }\r\n                    return this.callBase.apply(this, arguments)\r\n                },\r\n                _isFocusedRowInside: function(parentKey) {\r\n                    var focusedRowKey = this.option(\"focusedRowKey\");\r\n                    var rowIndex = this.getRowIndexByKey(focusedRowKey);\r\n                    var focusedRow = rowIndex >= 0 && this.getVisibleRows()[rowIndex];\r\n                    var parent = focusedRow && focusedRow.node.parent;\r\n                    while (parent) {\r\n                        if (parent.key === parentKey) {\r\n                            return true\r\n                        }\r\n                        parent = parent.parent\r\n                    }\r\n                    return false\r\n                },\r\n                getParentKey: function(key) {\r\n                    var dataSource = this._dataSource;\r\n                    var node = this.getNodeByKey(key);\r\n                    var d = new Deferred;\r\n                    if (node) {\r\n                        d.resolve(node.parent ? node.parent.key : void 0)\r\n                    } else {\r\n                        dataSource.load({\r\n                            filter: [dataSource.getKeyExpr(), \"=\", key]\r\n                        }).done((function(items) {\r\n                            var parentData = items[0];\r\n                            if (parentData) {\r\n                                d.resolve(dataSource.parentKeyOf(parentData))\r\n                            } else {\r\n                                d.reject()\r\n                            }\r\n                        })).fail(d.reject)\r\n                    }\r\n                    return d.promise()\r\n                },\r\n                expandAscendants: function(key) {\r\n                    var that = this;\r\n                    var dataSource = that._dataSource;\r\n                    var d = new Deferred;\r\n                    that.getParentKey(key).done((function(parentKey) {\r\n                        if (dataSource && void 0 !== parentKey && parentKey !== that.option(\"rootValue\")) {\r\n                            dataSource._isNodesInitializing = true;\r\n                            that.expandRow(parentKey);\r\n                            dataSource._isNodesInitializing = false;\r\n                            that.expandAscendants(parentKey).done(d.resolve).fail(d.reject)\r\n                        } else {\r\n                            d.resolve()\r\n                        }\r\n                    })).fail(d.reject);\r\n                    return d.promise()\r\n                },\r\n                getPageIndexByKey: function(key) {\r\n                    var that = this;\r\n                    var dataSource = that._dataSource;\r\n                    var d = new Deferred;\r\n                    that.expandAscendants(key).done((function() {\r\n                        dataSource.load({\r\n                            parentIds: []\r\n                        }).done((function(nodes) {\r\n                            var offset = findIndex(nodes, (function(node) {\r\n                                return that.keyOf(node.data) === key\r\n                            }));\r\n                            var pageIndex = -1;\r\n                            if (offset >= 0) {\r\n                                pageIndex = Math.floor(offset / that.pageSize())\r\n                            }\r\n                            d.resolve(pageIndex)\r\n                        })).fail(d.reject)\r\n                    })).fail(d.reject);\r\n                    return d.promise()\r\n                }\r\n            }\r\n        }\r\n    }\r\n}));\r\n"],"mappings":"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"},"metadata":{},"sourceType":"module"}