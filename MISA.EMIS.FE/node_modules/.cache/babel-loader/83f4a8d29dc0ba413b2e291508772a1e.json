{"ast":null,"code":"/**\r\n * DevExtreme (esm/ui/scheduler/appointments/dataProvider/appointmentDataSource.js)\r\n * Version: 22.1.4\r\n * Build date: Fri Jul 22 2022\r\n *\r\n * Copyright (c) 2012 - 2022 Developer Express Inc. ALL RIGHTS RESERVED\r\n * Read about DevExtreme licensing here: https://js.devexpress.com/Licensing/\r\n */\nimport { Deferred } from \"../../../../core/utils/deferred\";\nexport class AppointmentDataSource {\n  constructor(dataSource) {\n    this.setDataSource(dataSource);\n    this._updatedAppointmentKeys = [];\n  }\n\n  get keyName() {\n    var store = this._dataSource.store();\n\n    return store.key();\n  }\n\n  _getStoreKey(target) {\n    var store = this._dataSource.store();\n\n    return store.keyOf(target);\n  }\n\n  setDataSource(dataSource) {\n    this._dataSource = dataSource;\n    this.cleanState();\n\n    this._initStoreChangeHandlers();\n  }\n\n  _initStoreChangeHandlers() {\n    var dataSource = this._dataSource;\n    var store = null === dataSource || void 0 === dataSource ? void 0 : dataSource.store();\n\n    if (store) {\n      store.on(\"updating\", key => {\n        var keyName = store.key();\n\n        if (keyName) {\n          this._updatedAppointmentKeys.push({\n            key: keyName,\n            value: key\n          });\n        } else {\n          this._updatedAppointment = key;\n        }\n      });\n      store.on(\"push\", pushItems => {\n        var items = dataSource.items();\n        var keyName = store.key();\n        pushItems.forEach(pushItem => {\n          var itemExists = 0 !== items.filter(item => item[keyName] === pushItem.key).length;\n\n          if (itemExists) {\n            this._updatedAppointmentKeys.push({\n              key: keyName,\n              value: pushItem.key\n            });\n          } else {\n            var {\n              data: data\n            } = pushItem;\n            data && items.push(data);\n          }\n        });\n        dataSource.load();\n      });\n    }\n  }\n\n  getUpdatedAppointment() {\n    return this._updatedAppointment;\n  }\n\n  getUpdatedAppointmentKeys() {\n    return this._updatedAppointmentKeys;\n  }\n\n  cleanState() {\n    this._updatedAppointment = null;\n    this._updatedAppointmentKeys = [];\n  }\n\n  add(rawAppointment) {\n    return this._dataSource.store().insert(rawAppointment).done(() => this._dataSource.load());\n  }\n\n  update(target, data) {\n    var key = this._getStoreKey(target);\n\n    var d = new Deferred();\n\n    this._dataSource.store().update(key, data).done(result => this._dataSource.load().done(() => d.resolve(result)).fail(d.reject)).fail(d.reject);\n\n    return d.promise();\n  }\n\n  remove(rawAppointment) {\n    var key = this._getStoreKey(rawAppointment);\n\n    return this._dataSource.store().remove(key).done(() => this._dataSource.load());\n  }\n\n}","map":{"version":3,"names":["Deferred","AppointmentDataSource","constructor","dataSource","setDataSource","_updatedAppointmentKeys","keyName","store","_dataSource","key","_getStoreKey","target","keyOf","cleanState","_initStoreChangeHandlers","on","push","value","_updatedAppointment","pushItems","items","forEach","pushItem","itemExists","filter","item","length","data","load","getUpdatedAppointment","getUpdatedAppointmentKeys","add","rawAppointment","insert","done","update","d","result","resolve","fail","reject","promise","remove"],"sources":["E:/MisaProject/W2022_06/misa_emis/node_modules/devextreme/esm/ui/scheduler/appointments/dataProvider/appointmentDataSource.js"],"sourcesContent":["/**\r\n * DevExtreme (esm/ui/scheduler/appointments/dataProvider/appointmentDataSource.js)\r\n * Version: 22.1.4\r\n * Build date: Fri Jul 22 2022\r\n *\r\n * Copyright (c) 2012 - 2022 Developer Express Inc. ALL RIGHTS RESERVED\r\n * Read about DevExtreme licensing here: https://js.devexpress.com/Licensing/\r\n */\r\nimport {\r\n    Deferred\r\n} from \"../../../../core/utils/deferred\";\r\nexport class AppointmentDataSource {\r\n    constructor(dataSource) {\r\n        this.setDataSource(dataSource);\r\n        this._updatedAppointmentKeys = []\r\n    }\r\n    get keyName() {\r\n        var store = this._dataSource.store();\r\n        return store.key()\r\n    }\r\n    _getStoreKey(target) {\r\n        var store = this._dataSource.store();\r\n        return store.keyOf(target)\r\n    }\r\n    setDataSource(dataSource) {\r\n        this._dataSource = dataSource;\r\n        this.cleanState();\r\n        this._initStoreChangeHandlers()\r\n    }\r\n    _initStoreChangeHandlers() {\r\n        var dataSource = this._dataSource;\r\n        var store = null === dataSource || void 0 === dataSource ? void 0 : dataSource.store();\r\n        if (store) {\r\n            store.on(\"updating\", key => {\r\n                var keyName = store.key();\r\n                if (keyName) {\r\n                    this._updatedAppointmentKeys.push({\r\n                        key: keyName,\r\n                        value: key\r\n                    })\r\n                } else {\r\n                    this._updatedAppointment = key\r\n                }\r\n            });\r\n            store.on(\"push\", pushItems => {\r\n                var items = dataSource.items();\r\n                var keyName = store.key();\r\n                pushItems.forEach(pushItem => {\r\n                    var itemExists = 0 !== items.filter(item => item[keyName] === pushItem.key).length;\r\n                    if (itemExists) {\r\n                        this._updatedAppointmentKeys.push({\r\n                            key: keyName,\r\n                            value: pushItem.key\r\n                        })\r\n                    } else {\r\n                        var {\r\n                            data: data\r\n                        } = pushItem;\r\n                        data && items.push(data)\r\n                    }\r\n                });\r\n                dataSource.load()\r\n            })\r\n        }\r\n    }\r\n    getUpdatedAppointment() {\r\n        return this._updatedAppointment\r\n    }\r\n    getUpdatedAppointmentKeys() {\r\n        return this._updatedAppointmentKeys\r\n    }\r\n    cleanState() {\r\n        this._updatedAppointment = null;\r\n        this._updatedAppointmentKeys = []\r\n    }\r\n    add(rawAppointment) {\r\n        return this._dataSource.store().insert(rawAppointment).done(() => this._dataSource.load())\r\n    }\r\n    update(target, data) {\r\n        var key = this._getStoreKey(target);\r\n        var d = new Deferred;\r\n        this._dataSource.store().update(key, data).done(result => this._dataSource.load().done(() => d.resolve(result)).fail(d.reject)).fail(d.reject);\r\n        return d.promise()\r\n    }\r\n    remove(rawAppointment) {\r\n        var key = this._getStoreKey(rawAppointment);\r\n        return this._dataSource.store().remove(key).done(() => this._dataSource.load())\r\n    }\r\n}\r\n"],"mappings":"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"},"metadata":{},"sourceType":"module"}