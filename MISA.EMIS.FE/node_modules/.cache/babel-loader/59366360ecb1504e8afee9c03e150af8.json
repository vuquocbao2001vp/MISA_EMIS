{"ast":null,"code":"/**\r\n * DevExtreme (esm/ui/data_grid/ui.data_grid.summary.js)\r\n * Version: 22.1.4\r\n * Build date: Fri Jul 22 2022\r\n *\r\n * Copyright (c) 2012 - 2022 Developer Express Inc. ALL RIGHTS RESERVED\r\n * Read about DevExtreme licensing here: https://js.devexpress.com/Licensing/\r\n */\nimport $ from \"../../core/renderer\";\nimport { noop } from \"../../core/utils/common\";\nimport { isDefined, isPlainObject, isEmptyObject, isString, isFunction } from \"../../core/utils/type\";\nimport { each, map } from \"../../core/utils/iterator\";\nimport { extend } from \"../../core/utils/extend\";\nimport { compileGetter } from \"../../core/utils/data\";\nimport errors from \"../widget/ui.errors\";\nimport gridCore from \"./ui.data_grid.core\";\nimport messageLocalization from \"../../localization/message\";\nimport dataSourceAdapter from \"./ui.data_grid.data_source_adapter\";\nimport { ColumnsView } from \"../grid_core/ui.grid_core.columns_view\";\nimport AggregateCalculator from \"./aggregate_calculator\";\nimport dataQuery from \"../../data/query\";\nimport storeHelper from \"../../data/store_helper\";\nimport { normalizeSortingInfo } from \"../../data/utils\";\nvar DATAGRID_TOTAL_FOOTER_CLASS = \"dx-datagrid-total-footer\";\nvar DATAGRID_SUMMARY_ITEM_CLASS = \"dx-datagrid-summary-item\";\nvar DATAGRID_TEXT_CONTENT_CLASS = \"dx-datagrid-text-content\";\nvar DATAGRID_GROUP_FOOTER_CLASS = \"dx-datagrid-group-footer\";\nvar DATAGRID_GROUP_TEXT_CONTENT_CLASS = \"dx-datagrid-group-text-content\";\nvar DATAGRID_NOWRAP_CLASS = \"dx-datagrid-nowrap\";\nvar DATAGRID_FOOTER_ROW_CLASS = \"dx-footer-row\";\nvar DATAGRID_GROUP_FOOTER_ROW_TYPE = \"groupFooter\";\nvar DATAGRID_TOTAL_FOOTER_ROW_TYPE = \"totalFooter\";\nexport var renderSummaryCell = function (cell, options) {\n  var $cell = $(cell);\n  var column = options.column;\n  var summaryItems = options.summaryItems;\n  var $summaryItems = [];\n\n  if (!column.command && summaryItems) {\n    for (var i = 0; i < summaryItems.length; i++) {\n      var summaryItem = summaryItems[i];\n      $summaryItems.push($(\"<div>\").css(\"textAlign\", summaryItem.alignment || column.alignment).addClass(DATAGRID_SUMMARY_ITEM_CLASS).addClass(DATAGRID_TEXT_CONTENT_CLASS).addClass(summaryItem.cssClass).toggleClass(DATAGRID_GROUP_TEXT_CONTENT_CLASS, \"group\" === options.rowType).text(gridCore.getSummaryText(summaryItem, options.summaryTexts)));\n    }\n\n    $cell.append($summaryItems);\n  }\n};\n\nvar getSummaryCellOptions = function (that, options) {\n  var summaryTexts = that.option(\"summary.texts\") || {};\n  return {\n    totalItem: options.row,\n    summaryItems: options.row.summaryCells[options.columnIndex],\n    summaryTexts: summaryTexts\n  };\n};\n\nvar getGroupAggregates = function (data) {\n  return data.summary || data.aggregates || [];\n};\n\nvar recalculateWhileEditing = function (that) {\n  return that.option(\"summary.recalculateWhileEditing\");\n};\n\nexport var FooterView = ColumnsView.inherit({\n  _getRows: function () {\n    return this._dataController.footerItems();\n  },\n  _getCellOptions: function (options) {\n    return extend(this.callBase(options), getSummaryCellOptions(this, options));\n  },\n  _renderCellContent: function ($cell, options) {\n    renderSummaryCell($cell, options);\n    this.callBase($cell, options);\n  },\n  _renderCore: function (change) {\n    var needUpdateScrollLeft = false;\n\n    var totalItem = this._dataController.footerItems()[0];\n\n    if (!change || !change.columnIndices) {\n      this.element().empty().addClass(DATAGRID_TOTAL_FOOTER_CLASS).toggleClass(DATAGRID_NOWRAP_CLASS, !this.option(\"wordWrapEnabled\"));\n      needUpdateScrollLeft = true;\n    }\n\n    if (totalItem && totalItem.summaryCells && totalItem.summaryCells.length) {\n      this._updateContent(this._renderTable({\n        change: change\n      }), change);\n\n      needUpdateScrollLeft && this._updateScrollLeftPosition();\n    }\n  },\n  _updateContent: function ($newTable, change) {\n    if (change && \"update\" === change.changeType && change.columnIndices) {\n      var $row = this.getTableElement().find(\".dx-row\");\n      var $newRow = $newTable.find(\".dx-row\");\n\n      this._updateCells($row, $newRow, change.columnIndices[0]);\n    } else {\n      return this.callBase.apply(this, arguments);\n    }\n  },\n  _rowClick: function (e) {\n    var item = this._dataController.footerItems()[e.rowIndex] || {};\n    this.executeAction(\"onRowClick\", extend({}, e, item));\n  },\n  _columnOptionChanged: function (e) {\n    var optionNames = e.optionNames;\n\n    if (e.changeTypes.grouping) {\n      return;\n    }\n\n    if (optionNames.width || optionNames.visibleWidth) {\n      this.callBase(e);\n    }\n  },\n  _handleDataChanged: function (e) {\n    var changeType = e.changeType;\n\n    if (\"update\" === e.changeType && e.repaintChangesOnly) {\n      if (!e.totalColumnIndices) {\n        this.render();\n      } else if (e.totalColumnIndices.length) {\n        this.render(null, {\n          changeType: \"update\",\n          columnIndices: [e.totalColumnIndices]\n        });\n      }\n    } else if (\"refresh\" === changeType || \"append\" === changeType || \"prepend\" === changeType) {\n      this.render();\n    }\n  },\n  _createRow: function (row) {\n    var $row = this.callBase.apply(this, arguments);\n\n    if (row.rowType === DATAGRID_TOTAL_FOOTER_ROW_TYPE) {\n      $row.addClass(DATAGRID_FOOTER_ROW_CLASS);\n    }\n\n    return $row;\n  },\n  getHeight: function () {\n    return this.getElementHeight();\n  },\n  isVisible: function () {\n    return !!this._dataController.footerItems().length;\n  }\n});\nvar SummaryDataSourceAdapterExtender = {\n  init: function () {\n    this.callBase.apply(this, arguments);\n    this._totalAggregates = [];\n    this._summaryGetter = noop;\n  },\n  summaryGetter: function (_summaryGetter) {\n    if (!arguments.length) {\n      return this._summaryGetter;\n    }\n\n    if (isFunction(_summaryGetter)) {\n      this._summaryGetter = _summaryGetter;\n    }\n  },\n  summary: function (_summary) {\n    if (!arguments.length) {\n      return this._summaryGetter();\n    }\n\n    this._summaryGetter = function () {\n      return _summary;\n    };\n  },\n  totalAggregates: function () {\n    return this._totalAggregates;\n  },\n  isLastLevelGroupItemsPagingLocal: function () {\n    var summary = this.summary();\n    var sortByGroupsInfo = summary && summary.sortByGroups();\n    return sortByGroupsInfo && sortByGroupsInfo.length;\n  },\n  sortLastLevelGroupItems: function (items, groups, paths) {\n    var groupedItems = storeHelper.multiLevelGroup(dataQuery(items), groups).toArray();\n    var result = [];\n    paths.forEach(function (path) {\n      !function forEachGroup(groups, groupCount, callback, path) {\n        path = path || [];\n\n        for (var i = 0; i < groups.length; i++) {\n          path.push(groups[i].key);\n\n          if (1 === groupCount) {\n            callback(path, groups[i].items);\n          } else {\n            forEachGroup(groups[i].items, groupCount - 1, callback, path);\n          }\n\n          path.pop();\n        }\n      }(groupedItems, groups.length, function (itemsPath, items) {\n        if (path.toString() === itemsPath.toString()) {\n          result = result.concat(items);\n        }\n      });\n    });\n    return result;\n  }\n};\n\nvar SummaryDataSourceAdapterClientExtender = function () {\n  var calculateAggregates = function (that, summary, data, groupLevel) {\n    var calculator;\n\n    if (recalculateWhileEditing(that)) {\n      var editingController = that.getController(\"editing\");\n\n      if (editingController) {\n        var insertedData = editingController.getInsertedData();\n\n        if (insertedData.length) {\n          data = function applyAddedData(data, insertedData, groupLevel) {\n            if (groupLevel) {\n              return applyAddedData(data, insertedData.map(item => ({\n                items: [item]\n              }), groupLevel - 1));\n            }\n\n            return data.concat(insertedData);\n          }(data, insertedData, groupLevel);\n        }\n\n        var removedData = editingController.getRemovedData();\n\n        if (removedData.length) {\n          data = function applyRemovedData(data, removedData, groupLevel) {\n            if (groupLevel) {\n              return data.map(data => {\n                var updatedData = {};\n                var updatedItems = applyRemovedData(data.items || [], removedData, groupLevel - 1);\n                Object.defineProperty(updatedData, \"aggregates\", {\n                  get: () => data.aggregates,\n                  set: value => {\n                    data.aggregates = value;\n                  }\n                });\n                return extend(updatedData, data, {\n                  items: updatedItems\n                });\n              });\n            }\n\n            return data.filter(data => removedData.indexOf(data) < 0);\n          }(data, removedData, groupLevel);\n        }\n      }\n    }\n\n    if (summary) {\n      calculator = new AggregateCalculator({\n        totalAggregates: summary.totalAggregates,\n        groupAggregates: summary.groupAggregates,\n        data: data,\n        groupLevel: groupLevel\n      });\n      calculator.calculate();\n    }\n\n    return calculator ? calculator.totalAggregates() : [];\n  };\n\n  var sortGroupsBySummary = function (data, group, summary) {\n    var sortByGroups = summary && summary.sortByGroups && summary.sortByGroups();\n\n    if (sortByGroups && sortByGroups.length) {\n      return function sortGroupsBySummaryCore(items, groups, sortByGroups) {\n        if (!items || !groups.length) {\n          return items;\n        }\n\n        var group = groups[0];\n        var sorts = sortByGroups[0];\n        var query;\n\n        if (group && sorts && sorts.length) {\n          query = dataQuery(items);\n          each(sorts, function (index) {\n            if (0 === index) {\n              query = query.sortBy(this.selector, this.desc);\n            } else {\n              query = query.thenBy(this.selector, this.desc);\n            }\n          });\n          query.enumerate().done(function (sortedItems) {\n            items = sortedItems;\n          });\n        }\n\n        groups = groups.slice(1);\n        sortByGroups = sortByGroups.slice(1);\n\n        if (groups.length && sortByGroups.length) {\n          each(items, function () {\n            this.items = sortGroupsBySummaryCore(this.items, groups, sortByGroups);\n          });\n        }\n\n        return items;\n      }(data, group, sortByGroups);\n    }\n\n    return data;\n  };\n\n  return {\n    _customizeRemoteOperations: function (options) {\n      var summary = this.summary();\n\n      if (summary) {\n        if (options.remoteOperations.summary) {\n          if (!options.isCustomLoading || options.storeLoadOptions.isLoadingAll) {\n            if (options.storeLoadOptions.group) {\n              if (options.remoteOperations.grouping) {\n                options.storeLoadOptions.groupSummary = summary.groupAggregates;\n              } else if (summary.groupAggregates.length) {\n                options.remoteOperations.paging = false;\n              }\n            }\n\n            options.storeLoadOptions.totalSummary = summary.totalAggregates;\n          }\n        } else if (summary.totalAggregates.length || summary.groupAggregates.length && options.storeLoadOptions.group) {\n          options.remoteOperations.paging = false;\n        }\n      }\n\n      this.callBase.apply(this, arguments);\n      var cachedExtra = options.cachedData.extra;\n\n      if (cachedExtra && cachedExtra.summary && !options.isCustomLoading) {\n        options.storeLoadOptions.totalSummary = void 0;\n      }\n    },\n    _handleDataLoadedCore: function (options) {\n      var groups = normalizeSortingInfo(options.storeLoadOptions.group || options.loadOptions.group || []);\n      var remoteOperations = options.remoteOperations || {};\n      var summary = this.summaryGetter()(remoteOperations);\n\n      if (!options.isCustomLoading || options.storeLoadOptions.isLoadingAll) {\n        if (remoteOperations.summary) {\n          if (!remoteOperations.paging && groups.length && summary) {\n            if (!remoteOperations.grouping) {\n              calculateAggregates(this, {\n                groupAggregates: summary.groupAggregates\n              }, options.data, groups.length);\n            }\n\n            options.data = sortGroupsBySummary(options.data, groups, summary);\n          }\n        } else if (!remoteOperations.paging && summary) {\n          var _options$cachedData, _options$cachedData$e;\n\n          var operationTypes = options.operationTypes || {};\n          var hasOperations = Object.keys(operationTypes).some(type => operationTypes[type]);\n\n          if (!hasOperations || !(null !== (_options$cachedData = options.cachedData) && void 0 !== _options$cachedData && null !== (_options$cachedData$e = _options$cachedData.extra) && void 0 !== _options$cachedData$e && _options$cachedData$e.summary) || groups.length && summary.groupAggregates.length) {\n            var totalAggregates = calculateAggregates(this, summary, options.data, groups.length);\n            options.extra = isPlainObject(options.extra) ? options.extra : {};\n            options.extra.summary = totalAggregates;\n\n            if (options.cachedData) {\n              options.cachedData.extra = options.extra;\n            }\n          }\n\n          options.data = sortGroupsBySummary(options.data, groups, summary);\n        }\n      }\n\n      if (!options.isCustomLoading) {\n        this._totalAggregates = options.extra && options.extra.summary || this._totalAggregates;\n      }\n\n      this.callBase(options);\n    }\n  };\n}();\n\ndataSourceAdapter.extend(SummaryDataSourceAdapterExtender);\ndataSourceAdapter.extend(SummaryDataSourceAdapterClientExtender);\ngridCore.registerModule(\"summary\", {\n  defaultOptions: function () {\n    return {\n      summary: {\n        groupItems: void 0,\n        totalItems: void 0,\n        calculateCustomSummary: void 0,\n        skipEmptyValues: true,\n        recalculateWhileEditing: false,\n        texts: {\n          sum: messageLocalization.format(\"dxDataGrid-summarySum\"),\n          sumOtherColumn: messageLocalization.format(\"dxDataGrid-summarySumOtherColumn\"),\n          min: messageLocalization.format(\"dxDataGrid-summaryMin\"),\n          minOtherColumn: messageLocalization.format(\"dxDataGrid-summaryMinOtherColumn\"),\n          max: messageLocalization.format(\"dxDataGrid-summaryMax\"),\n          maxOtherColumn: messageLocalization.format(\"dxDataGrid-summaryMaxOtherColumn\"),\n          avg: messageLocalization.format(\"dxDataGrid-summaryAvg\"),\n          avgOtherColumn: messageLocalization.format(\"dxDataGrid-summaryAvgOtherColumn\"),\n          count: messageLocalization.format(\"dxDataGrid-summaryCount\")\n        }\n      },\n      sortByGroupSummaryInfo: void 0\n    };\n  },\n  views: {\n    footerView: FooterView\n  },\n  extenders: {\n    controllers: {\n      data: {\n        _isDataColumn: function (column) {\n          return column && (!isDefined(column.groupIndex) || column.showWhenGrouped);\n        },\n        _isGroupFooterVisible: function () {\n          var groupItems = this.option(\"summary.groupItems\") || [];\n\n          for (var i = 0; i < groupItems.length; i++) {\n            var groupItem = groupItems[i];\n\n            var column = this._columnsController.columnOption(groupItem.showInColumn || groupItem.column);\n\n            if (groupItem.showInGroupFooter && this._isDataColumn(column)) {\n              return true;\n            }\n          }\n\n          return false;\n        },\n        _processGroupItems: function (items, groupCount, options) {\n          var data = options && options.data;\n          var result = this.callBase.apply(this, arguments);\n\n          if (options) {\n            if (void 0 === options.isGroupFooterVisible) {\n              options.isGroupFooterVisible = this._isGroupFooterVisible();\n            }\n\n            if (data && data.items && options.isGroupFooterVisible && (options.collectContinuationItems || !data.isContinuationOnNextPage)) {\n              result.push({\n                rowType: DATAGRID_GROUP_FOOTER_ROW_TYPE,\n                key: options.path.slice(),\n                data: data,\n                groupIndex: options.path.length - 1,\n                values: []\n              });\n            }\n          }\n\n          return result;\n        },\n        _processGroupItem: function (groupItem, options) {\n          var that = this;\n\n          if (!options.summaryGroupItems) {\n            options.summaryGroupItems = that.option(\"summary.groupItems\") || [];\n          }\n\n          if (\"group\" === groupItem.rowType) {\n            var groupColumnIndex = -1;\n            var afterGroupColumnIndex = -1;\n            each(options.visibleColumns, function (visibleIndex) {\n              var prevColumn = options.visibleColumns[visibleIndex - 1];\n\n              if (groupItem.groupIndex === this.groupIndex) {\n                groupColumnIndex = this.index;\n              }\n\n              if (visibleIndex > 0 && \"expand\" === prevColumn.command && \"expand\" !== this.command) {\n                afterGroupColumnIndex = this.index;\n              }\n            });\n            groupItem.summaryCells = this._calculateSummaryCells(options.summaryGroupItems, getGroupAggregates(groupItem.data), options.visibleColumns, function (summaryItem, column) {\n              if (summaryItem.showInGroupFooter) {\n                return -1;\n              }\n\n              if (summaryItem.alignByColumn && column && !isDefined(column.groupIndex) && column.index !== afterGroupColumnIndex) {\n                return column.index;\n              } else {\n                return groupColumnIndex;\n              }\n            }, true);\n          }\n\n          if (groupItem.rowType === DATAGRID_GROUP_FOOTER_ROW_TYPE) {\n            groupItem.summaryCells = this._calculateSummaryCells(options.summaryGroupItems, getGroupAggregates(groupItem.data), options.visibleColumns, function (summaryItem, column) {\n              return summaryItem.showInGroupFooter && that._isDataColumn(column) ? column.index : -1;\n            });\n          }\n\n          return groupItem;\n        },\n        _calculateSummaryCells: function (summaryItems, aggregates, visibleColumns, calculateTargetColumnIndex, isGroupRow) {\n          var that = this;\n          var summaryCells = [];\n          var summaryCellsByColumns = {};\n          each(summaryItems, function (summaryIndex, summaryItem) {\n            var column = that._columnsController.columnOption(summaryItem.column);\n\n            var showInColumn = summaryItem.showInColumn && that._columnsController.columnOption(summaryItem.showInColumn) || column;\n            var columnIndex = calculateTargetColumnIndex(summaryItem, showInColumn);\n\n            if (columnIndex >= 0) {\n              if (!summaryCellsByColumns[columnIndex]) {\n                summaryCellsByColumns[columnIndex] = [];\n              }\n\n              var aggregate = aggregates[summaryIndex];\n\n              if (aggregate === aggregate) {\n                var valueFormat;\n\n                if (isDefined(summaryItem.valueFormat)) {\n                  valueFormat = summaryItem.valueFormat;\n                } else if (\"count\" !== summaryItem.summaryType) {\n                  valueFormat = gridCore.getFormatByDataType(column && column.dataType);\n                }\n\n                summaryCellsByColumns[columnIndex].push(extend({}, summaryItem, {\n                  value: isString(aggregate) && column && column.deserializeValue ? column.deserializeValue(aggregate) : aggregate,\n                  valueFormat: valueFormat,\n                  columnCaption: column && column.index !== columnIndex ? column.caption : void 0\n                }));\n              }\n            }\n          });\n\n          if (!isEmptyObject(summaryCellsByColumns)) {\n            visibleColumns.forEach((column, visibleIndex) => {\n              var prevColumn = visibleColumns[visibleIndex - 1];\n              var columnIndex = isGroupRow && (\"expand\" === (null === prevColumn || void 0 === prevColumn ? void 0 : prevColumn.command) || \"expand\" === column.command) ? null === prevColumn || void 0 === prevColumn ? void 0 : prevColumn.index : column.index;\n              summaryCells.push(summaryCellsByColumns[columnIndex] || []);\n            });\n          }\n\n          return summaryCells;\n        },\n        _getSummaryCells: function (summaryTotalItems, totalAggregates) {\n          var that = this;\n          var columnsController = that._columnsController;\n          return that._calculateSummaryCells(summaryTotalItems, totalAggregates, columnsController.getVisibleColumns(), function (summaryItem, column) {\n            return that._isDataColumn(column) ? column.index : -1;\n          });\n        },\n        _updateItemsCore: function (change) {\n          var summaryCells;\n          var dataSource = this._dataSource;\n          var footerItems = this._footerItems;\n          var oldSummaryCells = footerItems && footerItems[0] && footerItems[0].summaryCells;\n          var summaryTotalItems = this.option(\"summary.totalItems\");\n          this._footerItems = [];\n\n          if (dataSource && summaryTotalItems && summaryTotalItems.length) {\n            var totalAggregates = dataSource.totalAggregates();\n            summaryCells = this._getSummaryCells(summaryTotalItems, totalAggregates);\n\n            if (change && change.repaintChangesOnly && oldSummaryCells) {\n              change.totalColumnIndices = summaryCells.map(function (summaryCell, index) {\n                if (JSON.stringify(summaryCell) !== JSON.stringify(oldSummaryCells[index])) {\n                  return index;\n                }\n\n                return -1;\n              }).filter(index => index >= 0);\n            }\n\n            if (summaryCells.length) {\n              this._footerItems.push({\n                rowType: DATAGRID_TOTAL_FOOTER_ROW_TYPE,\n                summaryCells: summaryCells\n              });\n            }\n          }\n\n          this.callBase(change);\n        },\n        _prepareUnsavedDataSelector: function (selector) {\n          if (recalculateWhileEditing(this)) {\n            var editingController = this.getController(\"editing\");\n\n            if (editingController) {\n              return function (data) {\n                data = editingController.getUpdatedData(data);\n                return selector(data);\n              };\n            }\n          }\n\n          return selector;\n        },\n        _prepareAggregateSelector: function (selector, aggregator) {\n          selector = this._prepareUnsavedDataSelector(selector);\n\n          if (\"avg\" === aggregator || \"sum\" === aggregator) {\n            return function (data) {\n              var value = selector(data);\n              return isDefined(value) ? Number(value) : value;\n            };\n          }\n\n          return selector;\n        },\n        _getAggregates: function (summaryItems, remoteOperations) {\n          var that = this;\n          var columnsController = that.getController(\"columns\");\n          var calculateCustomSummary = that.option(\"summary.calculateCustomSummary\");\n          var commonSkipEmptyValues = that.option(\"summary.skipEmptyValues\");\n          return map(summaryItems || [], function (summaryItem) {\n            var column = columnsController.columnOption(summaryItem.column);\n            var calculateCellValue = column && column.calculateCellValue ? column.calculateCellValue.bind(column) : compileGetter(column ? column.dataField : summaryItem.column);\n            var aggregator = summaryItem.summaryType || \"count\";\n            var selector = summaryItem.column;\n            var skipEmptyValues = isDefined(summaryItem.skipEmptyValues) ? summaryItem.skipEmptyValues : commonSkipEmptyValues;\n\n            if (remoteOperations) {\n              return {\n                selector: summaryItem.column,\n                summaryType: aggregator\n              };\n            } else {\n              selector = that._prepareAggregateSelector(calculateCellValue, aggregator);\n\n              if (\"custom\" === aggregator) {\n                if (!calculateCustomSummary) {\n                  errors.log(\"E1026\");\n\n                  calculateCustomSummary = function () {};\n                }\n\n                var options = {\n                  component: that.component,\n                  name: summaryItem.name\n                };\n                calculateCustomSummary(options);\n                options.summaryProcess = \"calculate\";\n                aggregator = {\n                  seed: function (groupIndex) {\n                    options.summaryProcess = \"start\";\n                    options.totalValue = void 0;\n                    options.groupIndex = groupIndex;\n                    delete options.value;\n                    calculateCustomSummary(options);\n                    return options.totalValue;\n                  },\n                  step: function (totalValue, value) {\n                    options.summaryProcess = \"calculate\";\n                    options.totalValue = totalValue;\n                    options.value = value;\n                    calculateCustomSummary(options);\n                    return options.totalValue;\n                  },\n                  finalize: function (totalValue) {\n                    options.summaryProcess = \"finalize\";\n                    options.totalValue = totalValue;\n                    delete options.value;\n                    calculateCustomSummary(options);\n                    return options.totalValue;\n                  }\n                };\n              }\n\n              return {\n                selector: selector,\n                aggregator: aggregator,\n                skipEmptyValues: skipEmptyValues\n              };\n            }\n          });\n        },\n        _addSortInfo: function (sortByGroups, groupColumn, selector, sortOrder) {\n          if (groupColumn) {\n            var groupIndex = groupColumn.groupIndex;\n            sortOrder = sortOrder || groupColumn.sortOrder;\n\n            if (isDefined(groupIndex)) {\n              sortByGroups[groupIndex] = sortByGroups[groupIndex] || [];\n              sortByGroups[groupIndex].push({\n                selector: selector,\n                desc: \"desc\" === sortOrder\n              });\n            }\n          }\n        },\n        _findSummaryItem: function (summaryItems, name) {\n          var summaryItemIndex = -1;\n\n          if (isDefined(name)) {\n            each(summaryItems || [], function (index) {\n              if (this.name === name || index === name || this.summaryType === name || this.column === name || (summaryItem = this, summaryType = summaryItem.summaryType, column = summaryItem.column, summaryType && column && summaryType + \"_\" + column) === name) {\n                summaryItemIndex = index;\n                return false;\n              }\n\n              var summaryItem, summaryType, column;\n            });\n          }\n\n          return summaryItemIndex;\n        },\n        _getSummarySortByGroups: function (sortByGroupSummaryInfo, groupSummaryItems) {\n          var that = this;\n          var columnsController = that._columnsController;\n          var groupColumns = columnsController.getGroupColumns();\n          var sortByGroups = [];\n\n          if (!groupSummaryItems || !groupSummaryItems.length) {\n            return;\n          }\n\n          each(sortByGroupSummaryInfo || [], function () {\n            var sortOrder = this.sortOrder;\n            var groupColumn = this.groupColumn;\n\n            var summaryItemIndex = that._findSummaryItem(groupSummaryItems, this.summaryItem);\n\n            if (summaryItemIndex < 0) {\n              return;\n            }\n\n            var selector = function (data) {\n              return getGroupAggregates(data)[summaryItemIndex];\n            };\n\n            if (isDefined(groupColumn)) {\n              groupColumn = columnsController.columnOption(groupColumn);\n\n              that._addSortInfo(sortByGroups, groupColumn, selector, sortOrder);\n            } else {\n              each(groupColumns, function (groupIndex, groupColumn) {\n                that._addSortInfo(sortByGroups, groupColumn, selector, sortOrder);\n              });\n            }\n          });\n          return sortByGroups;\n        },\n        _createDataSourceAdapterCore: function (dataSource, remoteOperations) {\n          var that = this;\n          var dataSourceAdapter = this.callBase(dataSource, remoteOperations);\n          dataSourceAdapter.summaryGetter(function (currentRemoteOperations) {\n            return that._getSummaryOptions(currentRemoteOperations || remoteOperations);\n          });\n          return dataSourceAdapter;\n        },\n        _getSummaryOptions: function (remoteOperations) {\n          var that = this;\n          var groupSummaryItems = that.option(\"summary.groupItems\");\n          var totalSummaryItems = that.option(\"summary.totalItems\");\n          var sortByGroupSummaryInfo = that.option(\"sortByGroupSummaryInfo\");\n\n          var groupAggregates = that._getAggregates(groupSummaryItems, remoteOperations && remoteOperations.grouping && remoteOperations.summary);\n\n          var totalAggregates = that._getAggregates(totalSummaryItems, remoteOperations && remoteOperations.summary);\n\n          if (groupAggregates.length || totalAggregates.length) {\n            return {\n              groupAggregates: groupAggregates,\n              totalAggregates: totalAggregates,\n              sortByGroups: function () {\n                return that._getSummarySortByGroups(sortByGroupSummaryInfo, groupSummaryItems);\n              }\n            };\n          }\n        },\n        publicMethods: function () {\n          var methods = this.callBase();\n          methods.push(\"getTotalSummaryValue\");\n          return methods;\n        },\n        getTotalSummaryValue: function (summaryItemName) {\n          var summaryItemIndex = this._findSummaryItem(this.option(\"summary.totalItems\"), summaryItemName);\n\n          var aggregates = this._dataSource.totalAggregates();\n\n          if (aggregates.length && summaryItemIndex > -1) {\n            return aggregates[summaryItemIndex];\n          }\n        },\n        optionChanged: function (args) {\n          if (\"summary\" === args.name || \"sortByGroupSummaryInfo\" === args.name) {\n            args.name = \"dataSource\";\n          }\n\n          this.callBase(args);\n        },\n        init: function () {\n          this._footerItems = [];\n          this.callBase();\n        },\n        footerItems: function () {\n          return this._footerItems;\n        }\n      },\n      editing: {\n        _refreshSummary: function () {\n          if (recalculateWhileEditing(this) && !this.isSaving()) {\n            this._dataController.refresh({\n              load: true,\n              changesOnly: true\n            });\n          }\n        },\n        _addChange: function (params) {\n          var result = this.callBase.apply(this, arguments);\n\n          if (params.type) {\n            this._refreshSummary();\n          }\n\n          return result;\n        },\n        _removeChange: function () {\n          var result = this.callBase.apply(this, arguments);\n\n          this._refreshSummary();\n\n          return result;\n        },\n        cancelEditData: function () {\n          var result = this.callBase.apply(this, arguments);\n\n          this._refreshSummary();\n\n          return result;\n        }\n      }\n    },\n    views: {\n      rowsView: {\n        _createRow: function (row) {\n          var $row = this.callBase.apply(this, arguments);\n          row && $row.addClass(row.rowType === DATAGRID_GROUP_FOOTER_ROW_TYPE ? DATAGRID_GROUP_FOOTER_CLASS : \"\");\n          return $row;\n        },\n        _renderCells: function ($row, options) {\n          this.callBase.apply(this, arguments);\n\n          if (\"group\" === options.row.rowType && options.row.summaryCells && options.row.summaryCells.length) {\n            this._renderGroupSummaryCells($row, options);\n          }\n        },\n        _hasAlignByColumnSummaryItems: function (columnIndex, options) {\n          return !isDefined(options.columns[columnIndex].groupIndex) && options.row.summaryCells[columnIndex].length;\n        },\n        _getAlignByColumnCellCount: function (groupCellColSpan, options) {\n          var alignByColumnCellCount = 0;\n\n          for (var i = 1; i < groupCellColSpan; i++) {\n            var columnIndex = options.row.summaryCells.length - i;\n            alignByColumnCellCount = this._hasAlignByColumnSummaryItems(columnIndex, options) ? i : alignByColumnCellCount;\n          }\n\n          return alignByColumnCellCount;\n        },\n        _renderGroupSummaryCells: function ($row, options) {\n          var $groupCell = $row.children().last();\n          var groupCellColSpan = Number($groupCell.attr(\"colSpan\")) || 1;\n\n          var alignByColumnCellCount = this._getAlignByColumnCellCount(groupCellColSpan, options);\n\n          this._renderGroupSummaryCellsCore($groupCell, options, groupCellColSpan, alignByColumnCellCount);\n        },\n        _renderGroupSummaryCellsCore: function ($groupCell, options, groupCellColSpan, alignByColumnCellCount) {\n          if (alignByColumnCellCount > 0) {\n            $groupCell.attr(\"colSpan\", groupCellColSpan - alignByColumnCellCount);\n\n            for (var i = 0; i < alignByColumnCellCount; i++) {\n              var columnIndex = options.columns.length - alignByColumnCellCount + i;\n\n              this._renderCell($groupCell.parent(), extend({\n                column: options.columns[columnIndex],\n                columnIndex: this._getSummaryCellIndex(columnIndex, options.columns)\n              }, options));\n            }\n          }\n        },\n        _getSummaryCellIndex: function (columnIndex) {\n          return columnIndex;\n        },\n        _getCellTemplate: function (options) {\n          if (!options.column.command && !isDefined(options.column.groupIndex) && options.summaryItems && options.summaryItems.length) {\n            return renderSummaryCell;\n          } else {\n            return this.callBase(options);\n          }\n        },\n        _getCellOptions: function (options) {\n          var parameters = this.callBase(options);\n\n          if (options.row.summaryCells) {\n            return extend(parameters, getSummaryCellOptions(this, options));\n          } else {\n            return parameters;\n          }\n        }\n      }\n    }\n  }\n});","map":{"version":3,"names":["$","noop","isDefined","isPlainObject","isEmptyObject","isString","isFunction","each","map","extend","compileGetter","errors","gridCore","messageLocalization","dataSourceAdapter","ColumnsView","AggregateCalculator","dataQuery","storeHelper","normalizeSortingInfo","DATAGRID_TOTAL_FOOTER_CLASS","DATAGRID_SUMMARY_ITEM_CLASS","DATAGRID_TEXT_CONTENT_CLASS","DATAGRID_GROUP_FOOTER_CLASS","DATAGRID_GROUP_TEXT_CONTENT_CLASS","DATAGRID_NOWRAP_CLASS","DATAGRID_FOOTER_ROW_CLASS","DATAGRID_GROUP_FOOTER_ROW_TYPE","DATAGRID_TOTAL_FOOTER_ROW_TYPE","renderSummaryCell","cell","options","$cell","column","summaryItems","$summaryItems","command","i","length","summaryItem","push","css","alignment","addClass","cssClass","toggleClass","rowType","text","getSummaryText","summaryTexts","append","getSummaryCellOptions","that","option","totalItem","row","summaryCells","columnIndex","getGroupAggregates","data","summary","aggregates","recalculateWhileEditing","FooterView","inherit","_getRows","_dataController","footerItems","_getCellOptions","callBase","_renderCellContent","_renderCore","change","needUpdateScrollLeft","columnIndices","element","empty","_updateContent","_renderTable","_updateScrollLeftPosition","$newTable","changeType","$row","getTableElement","find","$newRow","_updateCells","apply","arguments","_rowClick","e","item","rowIndex","executeAction","_columnOptionChanged","optionNames","changeTypes","grouping","width","visibleWidth","_handleDataChanged","repaintChangesOnly","totalColumnIndices","render","_createRow","getHeight","getElementHeight","isVisible","SummaryDataSourceAdapterExtender","init","_totalAggregates","_summaryGetter","summaryGetter","_summary","totalAggregates","isLastLevelGroupItemsPagingLocal","sortByGroupsInfo","sortByGroups","sortLastLevelGroupItems","items","groups","paths","groupedItems","multiLevelGroup","toArray","result","forEach","path","forEachGroup","groupCount","callback","key","pop","itemsPath","toString","concat","SummaryDataSourceAdapterClientExtender","calculateAggregates","groupLevel","calculator","editingController","getController","insertedData","getInsertedData","applyAddedData","removedData","getRemovedData","applyRemovedData","updatedData","updatedItems","Object","defineProperty","get","set","value","filter","indexOf","groupAggregates","calculate","sortGroupsBySummary","group","sortGroupsBySummaryCore","sorts","query","index","sortBy","selector","desc","thenBy","enumerate","done","sortedItems","slice","_customizeRemoteOperations","remoteOperations","isCustomLoading","storeLoadOptions","isLoadingAll","groupSummary","paging","totalSummary","cachedExtra","cachedData","extra","_handleDataLoadedCore","loadOptions","_options$cachedData","_options$cachedData$e","operationTypes","hasOperations","keys","some","type","registerModule","defaultOptions","groupItems","totalItems","calculateCustomSummary","skipEmptyValues","texts","sum","format","sumOtherColumn","min","minOtherColumn","max","maxOtherColumn","avg","avgOtherColumn","count","sortByGroupSummaryInfo","views","footerView","extenders","controllers","_isDataColumn","groupIndex","showWhenGrouped","_isGroupFooterVisible","groupItem","_columnsController","columnOption","showInColumn","showInGroupFooter","_processGroupItems","isGroupFooterVisible","collectContinuationItems","isContinuationOnNextPage","values","_processGroupItem","summaryGroupItems","groupColumnIndex","afterGroupColumnIndex","visibleColumns","visibleIndex","prevColumn","_calculateSummaryCells","alignByColumn","calculateTargetColumnIndex","isGroupRow","summaryCellsByColumns","summaryIndex","aggregate","valueFormat","summaryType","getFormatByDataType","dataType","deserializeValue","columnCaption","caption","_getSummaryCells","summaryTotalItems","columnsController","getVisibleColumns","_updateItemsCore","dataSource","_dataSource","_footerItems","oldSummaryCells","summaryCell","JSON","stringify","_prepareUnsavedDataSelector","getUpdatedData","_prepareAggregateSelector","aggregator","Number","_getAggregates","commonSkipEmptyValues","calculateCellValue","bind","dataField","log","component","name","summaryProcess","seed","totalValue","step","finalize","_addSortInfo","groupColumn","sortOrder","_findSummaryItem","summaryItemIndex","_getSummarySortByGroups","groupSummaryItems","groupColumns","getGroupColumns","_createDataSourceAdapterCore","currentRemoteOperations","_getSummaryOptions","totalSummaryItems","publicMethods","methods","getTotalSummaryValue","summaryItemName","optionChanged","args","editing","_refreshSummary","isSaving","refresh","load","changesOnly","_addChange","params","_removeChange","cancelEditData","rowsView","_renderCells","_renderGroupSummaryCells","_hasAlignByColumnSummaryItems","columns","_getAlignByColumnCellCount","groupCellColSpan","alignByColumnCellCount","$groupCell","children","last","attr","_renderGroupSummaryCellsCore","_renderCell","parent","_getSummaryCellIndex","_getCellTemplate","parameters"],"sources":["E:/MisaProject/W2022_06/misa_emis/node_modules/devextreme/esm/ui/data_grid/ui.data_grid.summary.js"],"sourcesContent":["/**\r\n * DevExtreme (esm/ui/data_grid/ui.data_grid.summary.js)\r\n * Version: 22.1.4\r\n * Build date: Fri Jul 22 2022\r\n *\r\n * Copyright (c) 2012 - 2022 Developer Express Inc. ALL RIGHTS RESERVED\r\n * Read about DevExtreme licensing here: https://js.devexpress.com/Licensing/\r\n */\r\nimport $ from \"../../core/renderer\";\r\nimport {\r\n    noop\r\n} from \"../../core/utils/common\";\r\nimport {\r\n    isDefined,\r\n    isPlainObject,\r\n    isEmptyObject,\r\n    isString,\r\n    isFunction\r\n} from \"../../core/utils/type\";\r\nimport {\r\n    each,\r\n    map\r\n} from \"../../core/utils/iterator\";\r\nimport {\r\n    extend\r\n} from \"../../core/utils/extend\";\r\nimport {\r\n    compileGetter\r\n} from \"../../core/utils/data\";\r\nimport errors from \"../widget/ui.errors\";\r\nimport gridCore from \"./ui.data_grid.core\";\r\nimport messageLocalization from \"../../localization/message\";\r\nimport dataSourceAdapter from \"./ui.data_grid.data_source_adapter\";\r\nimport {\r\n    ColumnsView\r\n} from \"../grid_core/ui.grid_core.columns_view\";\r\nimport AggregateCalculator from \"./aggregate_calculator\";\r\nimport dataQuery from \"../../data/query\";\r\nimport storeHelper from \"../../data/store_helper\";\r\nimport {\r\n    normalizeSortingInfo\r\n} from \"../../data/utils\";\r\nvar DATAGRID_TOTAL_FOOTER_CLASS = \"dx-datagrid-total-footer\";\r\nvar DATAGRID_SUMMARY_ITEM_CLASS = \"dx-datagrid-summary-item\";\r\nvar DATAGRID_TEXT_CONTENT_CLASS = \"dx-datagrid-text-content\";\r\nvar DATAGRID_GROUP_FOOTER_CLASS = \"dx-datagrid-group-footer\";\r\nvar DATAGRID_GROUP_TEXT_CONTENT_CLASS = \"dx-datagrid-group-text-content\";\r\nvar DATAGRID_NOWRAP_CLASS = \"dx-datagrid-nowrap\";\r\nvar DATAGRID_FOOTER_ROW_CLASS = \"dx-footer-row\";\r\nvar DATAGRID_GROUP_FOOTER_ROW_TYPE = \"groupFooter\";\r\nvar DATAGRID_TOTAL_FOOTER_ROW_TYPE = \"totalFooter\";\r\nexport var renderSummaryCell = function(cell, options) {\r\n    var $cell = $(cell);\r\n    var column = options.column;\r\n    var summaryItems = options.summaryItems;\r\n    var $summaryItems = [];\r\n    if (!column.command && summaryItems) {\r\n        for (var i = 0; i < summaryItems.length; i++) {\r\n            var summaryItem = summaryItems[i];\r\n            $summaryItems.push($(\"<div>\").css(\"textAlign\", summaryItem.alignment || column.alignment).addClass(DATAGRID_SUMMARY_ITEM_CLASS).addClass(DATAGRID_TEXT_CONTENT_CLASS).addClass(summaryItem.cssClass).toggleClass(DATAGRID_GROUP_TEXT_CONTENT_CLASS, \"group\" === options.rowType).text(gridCore.getSummaryText(summaryItem, options.summaryTexts)))\r\n        }\r\n        $cell.append($summaryItems)\r\n    }\r\n};\r\nvar getSummaryCellOptions = function(that, options) {\r\n    var summaryTexts = that.option(\"summary.texts\") || {};\r\n    return {\r\n        totalItem: options.row,\r\n        summaryItems: options.row.summaryCells[options.columnIndex],\r\n        summaryTexts: summaryTexts\r\n    }\r\n};\r\nvar getGroupAggregates = function(data) {\r\n    return data.summary || data.aggregates || []\r\n};\r\nvar recalculateWhileEditing = function(that) {\r\n    return that.option(\"summary.recalculateWhileEditing\")\r\n};\r\nexport var FooterView = ColumnsView.inherit({\r\n    _getRows: function() {\r\n        return this._dataController.footerItems()\r\n    },\r\n    _getCellOptions: function(options) {\r\n        return extend(this.callBase(options), getSummaryCellOptions(this, options))\r\n    },\r\n    _renderCellContent: function($cell, options) {\r\n        renderSummaryCell($cell, options);\r\n        this.callBase($cell, options)\r\n    },\r\n    _renderCore: function(change) {\r\n        var needUpdateScrollLeft = false;\r\n        var totalItem = this._dataController.footerItems()[0];\r\n        if (!change || !change.columnIndices) {\r\n            this.element().empty().addClass(DATAGRID_TOTAL_FOOTER_CLASS).toggleClass(DATAGRID_NOWRAP_CLASS, !this.option(\"wordWrapEnabled\"));\r\n            needUpdateScrollLeft = true\r\n        }\r\n        if (totalItem && totalItem.summaryCells && totalItem.summaryCells.length) {\r\n            this._updateContent(this._renderTable({\r\n                change: change\r\n            }), change);\r\n            needUpdateScrollLeft && this._updateScrollLeftPosition()\r\n        }\r\n    },\r\n    _updateContent: function($newTable, change) {\r\n        if (change && \"update\" === change.changeType && change.columnIndices) {\r\n            var $row = this.getTableElement().find(\".dx-row\");\r\n            var $newRow = $newTable.find(\".dx-row\");\r\n            this._updateCells($row, $newRow, change.columnIndices[0])\r\n        } else {\r\n            return this.callBase.apply(this, arguments)\r\n        }\r\n    },\r\n    _rowClick: function(e) {\r\n        var item = this._dataController.footerItems()[e.rowIndex] || {};\r\n        this.executeAction(\"onRowClick\", extend({}, e, item))\r\n    },\r\n    _columnOptionChanged: function(e) {\r\n        var optionNames = e.optionNames;\r\n        if (e.changeTypes.grouping) {\r\n            return\r\n        }\r\n        if (optionNames.width || optionNames.visibleWidth) {\r\n            this.callBase(e)\r\n        }\r\n    },\r\n    _handleDataChanged: function(e) {\r\n        var changeType = e.changeType;\r\n        if (\"update\" === e.changeType && e.repaintChangesOnly) {\r\n            if (!e.totalColumnIndices) {\r\n                this.render()\r\n            } else if (e.totalColumnIndices.length) {\r\n                this.render(null, {\r\n                    changeType: \"update\",\r\n                    columnIndices: [e.totalColumnIndices]\r\n                })\r\n            }\r\n        } else if (\"refresh\" === changeType || \"append\" === changeType || \"prepend\" === changeType) {\r\n            this.render()\r\n        }\r\n    },\r\n    _createRow: function(row) {\r\n        var $row = this.callBase.apply(this, arguments);\r\n        if (row.rowType === DATAGRID_TOTAL_FOOTER_ROW_TYPE) {\r\n            $row.addClass(DATAGRID_FOOTER_ROW_CLASS)\r\n        }\r\n        return $row\r\n    },\r\n    getHeight: function() {\r\n        return this.getElementHeight()\r\n    },\r\n    isVisible: function() {\r\n        return !!this._dataController.footerItems().length\r\n    }\r\n});\r\nvar SummaryDataSourceAdapterExtender = {\r\n    init: function() {\r\n        this.callBase.apply(this, arguments);\r\n        this._totalAggregates = [];\r\n        this._summaryGetter = noop\r\n    },\r\n    summaryGetter: function(_summaryGetter) {\r\n        if (!arguments.length) {\r\n            return this._summaryGetter\r\n        }\r\n        if (isFunction(_summaryGetter)) {\r\n            this._summaryGetter = _summaryGetter\r\n        }\r\n    },\r\n    summary: function(_summary) {\r\n        if (!arguments.length) {\r\n            return this._summaryGetter()\r\n        }\r\n        this._summaryGetter = function() {\r\n            return _summary\r\n        }\r\n    },\r\n    totalAggregates: function() {\r\n        return this._totalAggregates\r\n    },\r\n    isLastLevelGroupItemsPagingLocal: function() {\r\n        var summary = this.summary();\r\n        var sortByGroupsInfo = summary && summary.sortByGroups();\r\n        return sortByGroupsInfo && sortByGroupsInfo.length\r\n    },\r\n    sortLastLevelGroupItems: function(items, groups, paths) {\r\n        var groupedItems = storeHelper.multiLevelGroup(dataQuery(items), groups).toArray();\r\n        var result = [];\r\n        paths.forEach((function(path) {\r\n            ! function forEachGroup(groups, groupCount, callback, path) {\r\n                path = path || [];\r\n                for (var i = 0; i < groups.length; i++) {\r\n                    path.push(groups[i].key);\r\n                    if (1 === groupCount) {\r\n                        callback(path, groups[i].items)\r\n                    } else {\r\n                        forEachGroup(groups[i].items, groupCount - 1, callback, path)\r\n                    }\r\n                    path.pop()\r\n                }\r\n            }(groupedItems, groups.length, (function(itemsPath, items) {\r\n                if (path.toString() === itemsPath.toString()) {\r\n                    result = result.concat(items)\r\n                }\r\n            }))\r\n        }));\r\n        return result\r\n    }\r\n};\r\nvar SummaryDataSourceAdapterClientExtender = function() {\r\n    var calculateAggregates = function(that, summary, data, groupLevel) {\r\n        var calculator;\r\n        if (recalculateWhileEditing(that)) {\r\n            var editingController = that.getController(\"editing\");\r\n            if (editingController) {\r\n                var insertedData = editingController.getInsertedData();\r\n                if (insertedData.length) {\r\n                    data = function applyAddedData(data, insertedData, groupLevel) {\r\n                        if (groupLevel) {\r\n                            return applyAddedData(data, insertedData.map(item => ({\r\n                                items: [item]\r\n                            }), groupLevel - 1))\r\n                        }\r\n                        return data.concat(insertedData)\r\n                    }(data, insertedData, groupLevel)\r\n                }\r\n                var removedData = editingController.getRemovedData();\r\n                if (removedData.length) {\r\n                    data = function applyRemovedData(data, removedData, groupLevel) {\r\n                        if (groupLevel) {\r\n                            return data.map(data => {\r\n                                var updatedData = {};\r\n                                var updatedItems = applyRemovedData(data.items || [], removedData, groupLevel - 1);\r\n                                Object.defineProperty(updatedData, \"aggregates\", {\r\n                                    get: () => data.aggregates,\r\n                                    set: value => {\r\n                                        data.aggregates = value\r\n                                    }\r\n                                });\r\n                                return extend(updatedData, data, {\r\n                                    items: updatedItems\r\n                                })\r\n                            })\r\n                        }\r\n                        return data.filter(data => removedData.indexOf(data) < 0)\r\n                    }(data, removedData, groupLevel)\r\n                }\r\n            }\r\n        }\r\n        if (summary) {\r\n            calculator = new AggregateCalculator({\r\n                totalAggregates: summary.totalAggregates,\r\n                groupAggregates: summary.groupAggregates,\r\n                data: data,\r\n                groupLevel: groupLevel\r\n            });\r\n            calculator.calculate()\r\n        }\r\n        return calculator ? calculator.totalAggregates() : []\r\n    };\r\n    var sortGroupsBySummary = function(data, group, summary) {\r\n        var sortByGroups = summary && summary.sortByGroups && summary.sortByGroups();\r\n        if (sortByGroups && sortByGroups.length) {\r\n            return function sortGroupsBySummaryCore(items, groups, sortByGroups) {\r\n                if (!items || !groups.length) {\r\n                    return items\r\n                }\r\n                var group = groups[0];\r\n                var sorts = sortByGroups[0];\r\n                var query;\r\n                if (group && sorts && sorts.length) {\r\n                    query = dataQuery(items);\r\n                    each(sorts, (function(index) {\r\n                        if (0 === index) {\r\n                            query = query.sortBy(this.selector, this.desc)\r\n                        } else {\r\n                            query = query.thenBy(this.selector, this.desc)\r\n                        }\r\n                    }));\r\n                    query.enumerate().done((function(sortedItems) {\r\n                        items = sortedItems\r\n                    }))\r\n                }\r\n                groups = groups.slice(1);\r\n                sortByGroups = sortByGroups.slice(1);\r\n                if (groups.length && sortByGroups.length) {\r\n                    each(items, (function() {\r\n                        this.items = sortGroupsBySummaryCore(this.items, groups, sortByGroups)\r\n                    }))\r\n                }\r\n                return items\r\n            }(data, group, sortByGroups)\r\n        }\r\n        return data\r\n    };\r\n    return {\r\n        _customizeRemoteOperations: function(options) {\r\n            var summary = this.summary();\r\n            if (summary) {\r\n                if (options.remoteOperations.summary) {\r\n                    if (!options.isCustomLoading || options.storeLoadOptions.isLoadingAll) {\r\n                        if (options.storeLoadOptions.group) {\r\n                            if (options.remoteOperations.grouping) {\r\n                                options.storeLoadOptions.groupSummary = summary.groupAggregates\r\n                            } else if (summary.groupAggregates.length) {\r\n                                options.remoteOperations.paging = false\r\n                            }\r\n                        }\r\n                        options.storeLoadOptions.totalSummary = summary.totalAggregates\r\n                    }\r\n                } else if (summary.totalAggregates.length || summary.groupAggregates.length && options.storeLoadOptions.group) {\r\n                    options.remoteOperations.paging = false\r\n                }\r\n            }\r\n            this.callBase.apply(this, arguments);\r\n            var cachedExtra = options.cachedData.extra;\r\n            if (cachedExtra && cachedExtra.summary && !options.isCustomLoading) {\r\n                options.storeLoadOptions.totalSummary = void 0\r\n            }\r\n        },\r\n        _handleDataLoadedCore: function(options) {\r\n            var groups = normalizeSortingInfo(options.storeLoadOptions.group || options.loadOptions.group || []);\r\n            var remoteOperations = options.remoteOperations || {};\r\n            var summary = this.summaryGetter()(remoteOperations);\r\n            if (!options.isCustomLoading || options.storeLoadOptions.isLoadingAll) {\r\n                if (remoteOperations.summary) {\r\n                    if (!remoteOperations.paging && groups.length && summary) {\r\n                        if (!remoteOperations.grouping) {\r\n                            calculateAggregates(this, {\r\n                                groupAggregates: summary.groupAggregates\r\n                            }, options.data, groups.length)\r\n                        }\r\n                        options.data = sortGroupsBySummary(options.data, groups, summary)\r\n                    }\r\n                } else if (!remoteOperations.paging && summary) {\r\n                    var _options$cachedData, _options$cachedData$e;\r\n                    var operationTypes = options.operationTypes || {};\r\n                    var hasOperations = Object.keys(operationTypes).some(type => operationTypes[type]);\r\n                    if (!hasOperations || !(null !== (_options$cachedData = options.cachedData) && void 0 !== _options$cachedData && null !== (_options$cachedData$e = _options$cachedData.extra) && void 0 !== _options$cachedData$e && _options$cachedData$e.summary) || groups.length && summary.groupAggregates.length) {\r\n                        var totalAggregates = calculateAggregates(this, summary, options.data, groups.length);\r\n                        options.extra = isPlainObject(options.extra) ? options.extra : {};\r\n                        options.extra.summary = totalAggregates;\r\n                        if (options.cachedData) {\r\n                            options.cachedData.extra = options.extra\r\n                        }\r\n                    }\r\n                    options.data = sortGroupsBySummary(options.data, groups, summary)\r\n                }\r\n            }\r\n            if (!options.isCustomLoading) {\r\n                this._totalAggregates = options.extra && options.extra.summary || this._totalAggregates\r\n            }\r\n            this.callBase(options)\r\n        }\r\n    }\r\n}();\r\ndataSourceAdapter.extend(SummaryDataSourceAdapterExtender);\r\ndataSourceAdapter.extend(SummaryDataSourceAdapterClientExtender);\r\ngridCore.registerModule(\"summary\", {\r\n    defaultOptions: function() {\r\n        return {\r\n            summary: {\r\n                groupItems: void 0,\r\n                totalItems: void 0,\r\n                calculateCustomSummary: void 0,\r\n                skipEmptyValues: true,\r\n                recalculateWhileEditing: false,\r\n                texts: {\r\n                    sum: messageLocalization.format(\"dxDataGrid-summarySum\"),\r\n                    sumOtherColumn: messageLocalization.format(\"dxDataGrid-summarySumOtherColumn\"),\r\n                    min: messageLocalization.format(\"dxDataGrid-summaryMin\"),\r\n                    minOtherColumn: messageLocalization.format(\"dxDataGrid-summaryMinOtherColumn\"),\r\n                    max: messageLocalization.format(\"dxDataGrid-summaryMax\"),\r\n                    maxOtherColumn: messageLocalization.format(\"dxDataGrid-summaryMaxOtherColumn\"),\r\n                    avg: messageLocalization.format(\"dxDataGrid-summaryAvg\"),\r\n                    avgOtherColumn: messageLocalization.format(\"dxDataGrid-summaryAvgOtherColumn\"),\r\n                    count: messageLocalization.format(\"dxDataGrid-summaryCount\")\r\n                }\r\n            },\r\n            sortByGroupSummaryInfo: void 0\r\n        }\r\n    },\r\n    views: {\r\n        footerView: FooterView\r\n    },\r\n    extenders: {\r\n        controllers: {\r\n            data: {\r\n                _isDataColumn: function(column) {\r\n                    return column && (!isDefined(column.groupIndex) || column.showWhenGrouped)\r\n                },\r\n                _isGroupFooterVisible: function() {\r\n                    var groupItems = this.option(\"summary.groupItems\") || [];\r\n                    for (var i = 0; i < groupItems.length; i++) {\r\n                        var groupItem = groupItems[i];\r\n                        var column = this._columnsController.columnOption(groupItem.showInColumn || groupItem.column);\r\n                        if (groupItem.showInGroupFooter && this._isDataColumn(column)) {\r\n                            return true\r\n                        }\r\n                    }\r\n                    return false\r\n                },\r\n                _processGroupItems: function(items, groupCount, options) {\r\n                    var data = options && options.data;\r\n                    var result = this.callBase.apply(this, arguments);\r\n                    if (options) {\r\n                        if (void 0 === options.isGroupFooterVisible) {\r\n                            options.isGroupFooterVisible = this._isGroupFooterVisible()\r\n                        }\r\n                        if (data && data.items && options.isGroupFooterVisible && (options.collectContinuationItems || !data.isContinuationOnNextPage)) {\r\n                            result.push({\r\n                                rowType: DATAGRID_GROUP_FOOTER_ROW_TYPE,\r\n                                key: options.path.slice(),\r\n                                data: data,\r\n                                groupIndex: options.path.length - 1,\r\n                                values: []\r\n                            })\r\n                        }\r\n                    }\r\n                    return result\r\n                },\r\n                _processGroupItem: function(groupItem, options) {\r\n                    var that = this;\r\n                    if (!options.summaryGroupItems) {\r\n                        options.summaryGroupItems = that.option(\"summary.groupItems\") || []\r\n                    }\r\n                    if (\"group\" === groupItem.rowType) {\r\n                        var groupColumnIndex = -1;\r\n                        var afterGroupColumnIndex = -1;\r\n                        each(options.visibleColumns, (function(visibleIndex) {\r\n                            var prevColumn = options.visibleColumns[visibleIndex - 1];\r\n                            if (groupItem.groupIndex === this.groupIndex) {\r\n                                groupColumnIndex = this.index\r\n                            }\r\n                            if (visibleIndex > 0 && \"expand\" === prevColumn.command && \"expand\" !== this.command) {\r\n                                afterGroupColumnIndex = this.index\r\n                            }\r\n                        }));\r\n                        groupItem.summaryCells = this._calculateSummaryCells(options.summaryGroupItems, getGroupAggregates(groupItem.data), options.visibleColumns, (function(summaryItem, column) {\r\n                            if (summaryItem.showInGroupFooter) {\r\n                                return -1\r\n                            }\r\n                            if (summaryItem.alignByColumn && column && !isDefined(column.groupIndex) && column.index !== afterGroupColumnIndex) {\r\n                                return column.index\r\n                            } else {\r\n                                return groupColumnIndex\r\n                            }\r\n                        }), true)\r\n                    }\r\n                    if (groupItem.rowType === DATAGRID_GROUP_FOOTER_ROW_TYPE) {\r\n                        groupItem.summaryCells = this._calculateSummaryCells(options.summaryGroupItems, getGroupAggregates(groupItem.data), options.visibleColumns, (function(summaryItem, column) {\r\n                            return summaryItem.showInGroupFooter && that._isDataColumn(column) ? column.index : -1\r\n                        }))\r\n                    }\r\n                    return groupItem\r\n                },\r\n                _calculateSummaryCells: function(summaryItems, aggregates, visibleColumns, calculateTargetColumnIndex, isGroupRow) {\r\n                    var that = this;\r\n                    var summaryCells = [];\r\n                    var summaryCellsByColumns = {};\r\n                    each(summaryItems, (function(summaryIndex, summaryItem) {\r\n                        var column = that._columnsController.columnOption(summaryItem.column);\r\n                        var showInColumn = summaryItem.showInColumn && that._columnsController.columnOption(summaryItem.showInColumn) || column;\r\n                        var columnIndex = calculateTargetColumnIndex(summaryItem, showInColumn);\r\n                        if (columnIndex >= 0) {\r\n                            if (!summaryCellsByColumns[columnIndex]) {\r\n                                summaryCellsByColumns[columnIndex] = []\r\n                            }\r\n                            var aggregate = aggregates[summaryIndex];\r\n                            if (aggregate === aggregate) {\r\n                                var valueFormat;\r\n                                if (isDefined(summaryItem.valueFormat)) {\r\n                                    valueFormat = summaryItem.valueFormat\r\n                                } else if (\"count\" !== summaryItem.summaryType) {\r\n                                    valueFormat = gridCore.getFormatByDataType(column && column.dataType)\r\n                                }\r\n                                summaryCellsByColumns[columnIndex].push(extend({}, summaryItem, {\r\n                                    value: isString(aggregate) && column && column.deserializeValue ? column.deserializeValue(aggregate) : aggregate,\r\n                                    valueFormat: valueFormat,\r\n                                    columnCaption: column && column.index !== columnIndex ? column.caption : void 0\r\n                                }))\r\n                            }\r\n                        }\r\n                    }));\r\n                    if (!isEmptyObject(summaryCellsByColumns)) {\r\n                        visibleColumns.forEach((column, visibleIndex) => {\r\n                            var prevColumn = visibleColumns[visibleIndex - 1];\r\n                            var columnIndex = isGroupRow && (\"expand\" === (null === prevColumn || void 0 === prevColumn ? void 0 : prevColumn.command) || \"expand\" === column.command) ? null === prevColumn || void 0 === prevColumn ? void 0 : prevColumn.index : column.index;\r\n                            summaryCells.push(summaryCellsByColumns[columnIndex] || [])\r\n                        })\r\n                    }\r\n                    return summaryCells\r\n                },\r\n                _getSummaryCells: function(summaryTotalItems, totalAggregates) {\r\n                    var that = this;\r\n                    var columnsController = that._columnsController;\r\n                    return that._calculateSummaryCells(summaryTotalItems, totalAggregates, columnsController.getVisibleColumns(), (function(summaryItem, column) {\r\n                        return that._isDataColumn(column) ? column.index : -1\r\n                    }))\r\n                },\r\n                _updateItemsCore: function(change) {\r\n                    var summaryCells;\r\n                    var dataSource = this._dataSource;\r\n                    var footerItems = this._footerItems;\r\n                    var oldSummaryCells = footerItems && footerItems[0] && footerItems[0].summaryCells;\r\n                    var summaryTotalItems = this.option(\"summary.totalItems\");\r\n                    this._footerItems = [];\r\n                    if (dataSource && summaryTotalItems && summaryTotalItems.length) {\r\n                        var totalAggregates = dataSource.totalAggregates();\r\n                        summaryCells = this._getSummaryCells(summaryTotalItems, totalAggregates);\r\n                        if (change && change.repaintChangesOnly && oldSummaryCells) {\r\n                            change.totalColumnIndices = summaryCells.map((function(summaryCell, index) {\r\n                                if (JSON.stringify(summaryCell) !== JSON.stringify(oldSummaryCells[index])) {\r\n                                    return index\r\n                                }\r\n                                return -1\r\n                            })).filter(index => index >= 0)\r\n                        }\r\n                        if (summaryCells.length) {\r\n                            this._footerItems.push({\r\n                                rowType: DATAGRID_TOTAL_FOOTER_ROW_TYPE,\r\n                                summaryCells: summaryCells\r\n                            })\r\n                        }\r\n                    }\r\n                    this.callBase(change)\r\n                },\r\n                _prepareUnsavedDataSelector: function(selector) {\r\n                    if (recalculateWhileEditing(this)) {\r\n                        var editingController = this.getController(\"editing\");\r\n                        if (editingController) {\r\n                            return function(data) {\r\n                                data = editingController.getUpdatedData(data);\r\n                                return selector(data)\r\n                            }\r\n                        }\r\n                    }\r\n                    return selector\r\n                },\r\n                _prepareAggregateSelector: function(selector, aggregator) {\r\n                    selector = this._prepareUnsavedDataSelector(selector);\r\n                    if (\"avg\" === aggregator || \"sum\" === aggregator) {\r\n                        return function(data) {\r\n                            var value = selector(data);\r\n                            return isDefined(value) ? Number(value) : value\r\n                        }\r\n                    }\r\n                    return selector\r\n                },\r\n                _getAggregates: function(summaryItems, remoteOperations) {\r\n                    var that = this;\r\n                    var columnsController = that.getController(\"columns\");\r\n                    var calculateCustomSummary = that.option(\"summary.calculateCustomSummary\");\r\n                    var commonSkipEmptyValues = that.option(\"summary.skipEmptyValues\");\r\n                    return map(summaryItems || [], (function(summaryItem) {\r\n                        var column = columnsController.columnOption(summaryItem.column);\r\n                        var calculateCellValue = column && column.calculateCellValue ? column.calculateCellValue.bind(column) : compileGetter(column ? column.dataField : summaryItem.column);\r\n                        var aggregator = summaryItem.summaryType || \"count\";\r\n                        var selector = summaryItem.column;\r\n                        var skipEmptyValues = isDefined(summaryItem.skipEmptyValues) ? summaryItem.skipEmptyValues : commonSkipEmptyValues;\r\n                        if (remoteOperations) {\r\n                            return {\r\n                                selector: summaryItem.column,\r\n                                summaryType: aggregator\r\n                            }\r\n                        } else {\r\n                            selector = that._prepareAggregateSelector(calculateCellValue, aggregator);\r\n                            if (\"custom\" === aggregator) {\r\n                                if (!calculateCustomSummary) {\r\n                                    errors.log(\"E1026\");\r\n                                    calculateCustomSummary = function() {}\r\n                                }\r\n                                var options = {\r\n                                    component: that.component,\r\n                                    name: summaryItem.name\r\n                                };\r\n                                calculateCustomSummary(options);\r\n                                options.summaryProcess = \"calculate\";\r\n                                aggregator = {\r\n                                    seed: function(groupIndex) {\r\n                                        options.summaryProcess = \"start\";\r\n                                        options.totalValue = void 0;\r\n                                        options.groupIndex = groupIndex;\r\n                                        delete options.value;\r\n                                        calculateCustomSummary(options);\r\n                                        return options.totalValue\r\n                                    },\r\n                                    step: function(totalValue, value) {\r\n                                        options.summaryProcess = \"calculate\";\r\n                                        options.totalValue = totalValue;\r\n                                        options.value = value;\r\n                                        calculateCustomSummary(options);\r\n                                        return options.totalValue\r\n                                    },\r\n                                    finalize: function(totalValue) {\r\n                                        options.summaryProcess = \"finalize\";\r\n                                        options.totalValue = totalValue;\r\n                                        delete options.value;\r\n                                        calculateCustomSummary(options);\r\n                                        return options.totalValue\r\n                                    }\r\n                                }\r\n                            }\r\n                            return {\r\n                                selector: selector,\r\n                                aggregator: aggregator,\r\n                                skipEmptyValues: skipEmptyValues\r\n                            }\r\n                        }\r\n                    }))\r\n                },\r\n                _addSortInfo: function(sortByGroups, groupColumn, selector, sortOrder) {\r\n                    if (groupColumn) {\r\n                        var groupIndex = groupColumn.groupIndex;\r\n                        sortOrder = sortOrder || groupColumn.sortOrder;\r\n                        if (isDefined(groupIndex)) {\r\n                            sortByGroups[groupIndex] = sortByGroups[groupIndex] || [];\r\n                            sortByGroups[groupIndex].push({\r\n                                selector: selector,\r\n                                desc: \"desc\" === sortOrder\r\n                            })\r\n                        }\r\n                    }\r\n                },\r\n                _findSummaryItem: function(summaryItems, name) {\r\n                    var summaryItemIndex = -1;\r\n                    if (isDefined(name)) {\r\n                        each(summaryItems || [], (function(index) {\r\n                            if (this.name === name || index === name || this.summaryType === name || this.column === name || (summaryItem = this, summaryType = summaryItem.summaryType, column = summaryItem.column, summaryType && column && summaryType + \"_\" + column) === name) {\r\n                                summaryItemIndex = index;\r\n                                return false\r\n                            }\r\n                            var summaryItem, summaryType, column\r\n                        }))\r\n                    }\r\n                    return summaryItemIndex\r\n                },\r\n                _getSummarySortByGroups: function(sortByGroupSummaryInfo, groupSummaryItems) {\r\n                    var that = this;\r\n                    var columnsController = that._columnsController;\r\n                    var groupColumns = columnsController.getGroupColumns();\r\n                    var sortByGroups = [];\r\n                    if (!groupSummaryItems || !groupSummaryItems.length) {\r\n                        return\r\n                    }\r\n                    each(sortByGroupSummaryInfo || [], (function() {\r\n                        var sortOrder = this.sortOrder;\r\n                        var groupColumn = this.groupColumn;\r\n                        var summaryItemIndex = that._findSummaryItem(groupSummaryItems, this.summaryItem);\r\n                        if (summaryItemIndex < 0) {\r\n                            return\r\n                        }\r\n                        var selector = function(data) {\r\n                            return getGroupAggregates(data)[summaryItemIndex]\r\n                        };\r\n                        if (isDefined(groupColumn)) {\r\n                            groupColumn = columnsController.columnOption(groupColumn);\r\n                            that._addSortInfo(sortByGroups, groupColumn, selector, sortOrder)\r\n                        } else {\r\n                            each(groupColumns, (function(groupIndex, groupColumn) {\r\n                                that._addSortInfo(sortByGroups, groupColumn, selector, sortOrder)\r\n                            }))\r\n                        }\r\n                    }));\r\n                    return sortByGroups\r\n                },\r\n                _createDataSourceAdapterCore: function(dataSource, remoteOperations) {\r\n                    var that = this;\r\n                    var dataSourceAdapter = this.callBase(dataSource, remoteOperations);\r\n                    dataSourceAdapter.summaryGetter((function(currentRemoteOperations) {\r\n                        return that._getSummaryOptions(currentRemoteOperations || remoteOperations)\r\n                    }));\r\n                    return dataSourceAdapter\r\n                },\r\n                _getSummaryOptions: function(remoteOperations) {\r\n                    var that = this;\r\n                    var groupSummaryItems = that.option(\"summary.groupItems\");\r\n                    var totalSummaryItems = that.option(\"summary.totalItems\");\r\n                    var sortByGroupSummaryInfo = that.option(\"sortByGroupSummaryInfo\");\r\n                    var groupAggregates = that._getAggregates(groupSummaryItems, remoteOperations && remoteOperations.grouping && remoteOperations.summary);\r\n                    var totalAggregates = that._getAggregates(totalSummaryItems, remoteOperations && remoteOperations.summary);\r\n                    if (groupAggregates.length || totalAggregates.length) {\r\n                        return {\r\n                            groupAggregates: groupAggregates,\r\n                            totalAggregates: totalAggregates,\r\n                            sortByGroups: function() {\r\n                                return that._getSummarySortByGroups(sortByGroupSummaryInfo, groupSummaryItems)\r\n                            }\r\n                        }\r\n                    }\r\n                },\r\n                publicMethods: function() {\r\n                    var methods = this.callBase();\r\n                    methods.push(\"getTotalSummaryValue\");\r\n                    return methods\r\n                },\r\n                getTotalSummaryValue: function(summaryItemName) {\r\n                    var summaryItemIndex = this._findSummaryItem(this.option(\"summary.totalItems\"), summaryItemName);\r\n                    var aggregates = this._dataSource.totalAggregates();\r\n                    if (aggregates.length && summaryItemIndex > -1) {\r\n                        return aggregates[summaryItemIndex]\r\n                    }\r\n                },\r\n                optionChanged: function(args) {\r\n                    if (\"summary\" === args.name || \"sortByGroupSummaryInfo\" === args.name) {\r\n                        args.name = \"dataSource\"\r\n                    }\r\n                    this.callBase(args)\r\n                },\r\n                init: function() {\r\n                    this._footerItems = [];\r\n                    this.callBase()\r\n                },\r\n                footerItems: function() {\r\n                    return this._footerItems\r\n                }\r\n            },\r\n            editing: {\r\n                _refreshSummary: function() {\r\n                    if (recalculateWhileEditing(this) && !this.isSaving()) {\r\n                        this._dataController.refresh({\r\n                            load: true,\r\n                            changesOnly: true\r\n                        })\r\n                    }\r\n                },\r\n                _addChange: function(params) {\r\n                    var result = this.callBase.apply(this, arguments);\r\n                    if (params.type) {\r\n                        this._refreshSummary()\r\n                    }\r\n                    return result\r\n                },\r\n                _removeChange: function() {\r\n                    var result = this.callBase.apply(this, arguments);\r\n                    this._refreshSummary();\r\n                    return result\r\n                },\r\n                cancelEditData: function() {\r\n                    var result = this.callBase.apply(this, arguments);\r\n                    this._refreshSummary();\r\n                    return result\r\n                }\r\n            }\r\n        },\r\n        views: {\r\n            rowsView: {\r\n                _createRow: function(row) {\r\n                    var $row = this.callBase.apply(this, arguments);\r\n                    row && $row.addClass(row.rowType === DATAGRID_GROUP_FOOTER_ROW_TYPE ? DATAGRID_GROUP_FOOTER_CLASS : \"\");\r\n                    return $row\r\n                },\r\n                _renderCells: function($row, options) {\r\n                    this.callBase.apply(this, arguments);\r\n                    if (\"group\" === options.row.rowType && options.row.summaryCells && options.row.summaryCells.length) {\r\n                        this._renderGroupSummaryCells($row, options)\r\n                    }\r\n                },\r\n                _hasAlignByColumnSummaryItems: function(columnIndex, options) {\r\n                    return !isDefined(options.columns[columnIndex].groupIndex) && options.row.summaryCells[columnIndex].length\r\n                },\r\n                _getAlignByColumnCellCount: function(groupCellColSpan, options) {\r\n                    var alignByColumnCellCount = 0;\r\n                    for (var i = 1; i < groupCellColSpan; i++) {\r\n                        var columnIndex = options.row.summaryCells.length - i;\r\n                        alignByColumnCellCount = this._hasAlignByColumnSummaryItems(columnIndex, options) ? i : alignByColumnCellCount\r\n                    }\r\n                    return alignByColumnCellCount\r\n                },\r\n                _renderGroupSummaryCells: function($row, options) {\r\n                    var $groupCell = $row.children().last();\r\n                    var groupCellColSpan = Number($groupCell.attr(\"colSpan\")) || 1;\r\n                    var alignByColumnCellCount = this._getAlignByColumnCellCount(groupCellColSpan, options);\r\n                    this._renderGroupSummaryCellsCore($groupCell, options, groupCellColSpan, alignByColumnCellCount)\r\n                },\r\n                _renderGroupSummaryCellsCore: function($groupCell, options, groupCellColSpan, alignByColumnCellCount) {\r\n                    if (alignByColumnCellCount > 0) {\r\n                        $groupCell.attr(\"colSpan\", groupCellColSpan - alignByColumnCellCount);\r\n                        for (var i = 0; i < alignByColumnCellCount; i++) {\r\n                            var columnIndex = options.columns.length - alignByColumnCellCount + i;\r\n                            this._renderCell($groupCell.parent(), extend({\r\n                                column: options.columns[columnIndex],\r\n                                columnIndex: this._getSummaryCellIndex(columnIndex, options.columns)\r\n                            }, options))\r\n                        }\r\n                    }\r\n                },\r\n                _getSummaryCellIndex: function(columnIndex) {\r\n                    return columnIndex\r\n                },\r\n                _getCellTemplate: function(options) {\r\n                    if (!options.column.command && !isDefined(options.column.groupIndex) && options.summaryItems && options.summaryItems.length) {\r\n                        return renderSummaryCell\r\n                    } else {\r\n                        return this.callBase(options)\r\n                    }\r\n                },\r\n                _getCellOptions: function(options) {\r\n                    var parameters = this.callBase(options);\r\n                    if (options.row.summaryCells) {\r\n                        return extend(parameters, getSummaryCellOptions(this, options))\r\n                    } else {\r\n                        return parameters\r\n                    }\r\n                }\r\n            }\r\n        }\r\n    }\r\n});\r\n"],"mappings":"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"},"metadata":{},"sourceType":"module"}