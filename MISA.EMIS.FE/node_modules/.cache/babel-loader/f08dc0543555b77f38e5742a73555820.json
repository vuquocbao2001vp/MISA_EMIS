{"ast":null,"code":"/**\r\n * DevExtreme (esm/ui/html_editor/modules/variables.js)\r\n * Version: 22.1.4\r\n * Build date: Fri Jul 22 2022\r\n *\r\n * Copyright (c) 2012 - 2022 Developer Express Inc. ALL RIGHTS RESERVED\r\n * Read about DevExtreme licensing here: https://js.devexpress.com/Licensing/\r\n */\nimport Quill from \"devextreme-quill\";\nimport $ from \"../../../core/renderer\";\nimport { getBoundingRect } from \"../../../core/utils/position\";\nimport PopupModule from \"./popup\";\nimport BaseModule from \"./base\";\nimport Variable from \"../formats/variable\";\nimport { extend } from \"../../../core/utils/extend\";\nvar VariableModule = BaseModule;\n\nif (Quill) {\n  var VARIABLE_FORMAT_CLASS = \"dx-variable-format\";\n  var ACTIVE_FORMAT_CLASS = \"dx-format-active\";\n  Quill.register({\n    \"formats/variable\": Variable\n  }, true);\n  VariableModule = class extends PopupModule {\n    _getDefaultOptions() {\n      var baseConfig = super._getDefaultOptions();\n\n      return extend(baseConfig, {\n        escapeChar: \"\"\n      });\n    }\n\n    constructor(quill, options) {\n      super(quill, options);\n      var toolbar = quill.getModule(\"toolbar\");\n\n      if (toolbar) {\n        toolbar.addClickHandler(\"variable\", this.showPopup.bind(this));\n      }\n\n      quill.keyboard.addBinding({\n        key: \"P\",\n        altKey: true\n      }, this.showPopup.bind(this));\n\n      this._popup.on(\"shown\", e => {\n        var $ofElement = $(e.component.option(\"position\").of);\n\n        if ($ofElement.hasClass(VARIABLE_FORMAT_CLASS)) {\n          $ofElement.addClass(ACTIVE_FORMAT_CLASS);\n        }\n      });\n    }\n\n    showPopup(event) {\n      var selection = this.quill.getSelection(true);\n      var position = selection ? selection.index : this.quill.getLength();\n      this.savePosition(position);\n\n      this._resetPopupPosition(event, position);\n\n      super.showPopup();\n    }\n\n    _resetPopupPosition(event, position) {\n      if (event && event.element) {\n        this._popup.option(\"position\", {\n          of: event.element,\n          offset: {\n            h: 0,\n            v: 0\n          },\n          my: \"top center\",\n          at: \"bottom center\",\n          collision: \"fit\"\n        });\n      } else {\n        var mentionBounds = this.quill.getBounds(position);\n        var rootRect = getBoundingRect(this.quill.root);\n\n        this._popup.option(\"position\", {\n          of: this.quill.root,\n          offset: {\n            h: mentionBounds.left,\n            v: mentionBounds.bottom - rootRect.height\n          },\n          my: \"top center\",\n          at: \"bottom left\",\n          collision: \"fit flip\"\n        });\n      }\n    }\n\n    insertEmbedContent(selectionChangedEvent) {\n      var caretPosition = this.getPosition();\n      var selectedItem = selectionChangedEvent.component.option(\"selectedItem\");\n      var variableData = extend({}, {\n        value: selectedItem,\n        escapeChar: this.options.escapeChar\n      });\n      setTimeout(function () {\n        this.quill.insertEmbed(caretPosition, \"variable\", variableData);\n        this.quill.setSelection(caretPosition + 1);\n      }.bind(this));\n    }\n\n  };\n}\n\nexport default VariableModule;","map":{"version":3,"names":["Quill","$","getBoundingRect","PopupModule","BaseModule","Variable","extend","VariableModule","VARIABLE_FORMAT_CLASS","ACTIVE_FORMAT_CLASS","register","_getDefaultOptions","baseConfig","escapeChar","constructor","quill","options","toolbar","getModule","addClickHandler","showPopup","bind","keyboard","addBinding","key","altKey","_popup","on","e","$ofElement","component","option","of","hasClass","addClass","event","selection","getSelection","position","index","getLength","savePosition","_resetPopupPosition","element","offset","h","v","my","at","collision","mentionBounds","getBounds","rootRect","root","left","bottom","height","insertEmbedContent","selectionChangedEvent","caretPosition","getPosition","selectedItem","variableData","value","setTimeout","insertEmbed","setSelection"],"sources":["E:/MisaProject/W2022_06/misa_emis/node_modules/devextreme/esm/ui/html_editor/modules/variables.js"],"sourcesContent":["/**\r\n * DevExtreme (esm/ui/html_editor/modules/variables.js)\r\n * Version: 22.1.4\r\n * Build date: Fri Jul 22 2022\r\n *\r\n * Copyright (c) 2012 - 2022 Developer Express Inc. ALL RIGHTS RESERVED\r\n * Read about DevExtreme licensing here: https://js.devexpress.com/Licensing/\r\n */\r\nimport Quill from \"devextreme-quill\";\r\nimport $ from \"../../../core/renderer\";\r\nimport {\r\n    getBoundingRect\r\n} from \"../../../core/utils/position\";\r\nimport PopupModule from \"./popup\";\r\nimport BaseModule from \"./base\";\r\nimport Variable from \"../formats/variable\";\r\nimport {\r\n    extend\r\n} from \"../../../core/utils/extend\";\r\nvar VariableModule = BaseModule;\r\nif (Quill) {\r\n    var VARIABLE_FORMAT_CLASS = \"dx-variable-format\";\r\n    var ACTIVE_FORMAT_CLASS = \"dx-format-active\";\r\n    Quill.register({\r\n        \"formats/variable\": Variable\r\n    }, true);\r\n    VariableModule = class extends PopupModule {\r\n        _getDefaultOptions() {\r\n            var baseConfig = super._getDefaultOptions();\r\n            return extend(baseConfig, {\r\n                escapeChar: \"\"\r\n            })\r\n        }\r\n        constructor(quill, options) {\r\n            super(quill, options);\r\n            var toolbar = quill.getModule(\"toolbar\");\r\n            if (toolbar) {\r\n                toolbar.addClickHandler(\"variable\", this.showPopup.bind(this))\r\n            }\r\n            quill.keyboard.addBinding({\r\n                key: \"P\",\r\n                altKey: true\r\n            }, this.showPopup.bind(this));\r\n            this._popup.on(\"shown\", e => {\r\n                var $ofElement = $(e.component.option(\"position\").of);\r\n                if ($ofElement.hasClass(VARIABLE_FORMAT_CLASS)) {\r\n                    $ofElement.addClass(ACTIVE_FORMAT_CLASS)\r\n                }\r\n            })\r\n        }\r\n        showPopup(event) {\r\n            var selection = this.quill.getSelection(true);\r\n            var position = selection ? selection.index : this.quill.getLength();\r\n            this.savePosition(position);\r\n            this._resetPopupPosition(event, position);\r\n            super.showPopup()\r\n        }\r\n        _resetPopupPosition(event, position) {\r\n            if (event && event.element) {\r\n                this._popup.option(\"position\", {\r\n                    of: event.element,\r\n                    offset: {\r\n                        h: 0,\r\n                        v: 0\r\n                    },\r\n                    my: \"top center\",\r\n                    at: \"bottom center\",\r\n                    collision: \"fit\"\r\n                })\r\n            } else {\r\n                var mentionBounds = this.quill.getBounds(position);\r\n                var rootRect = getBoundingRect(this.quill.root);\r\n                this._popup.option(\"position\", {\r\n                    of: this.quill.root,\r\n                    offset: {\r\n                        h: mentionBounds.left,\r\n                        v: mentionBounds.bottom - rootRect.height\r\n                    },\r\n                    my: \"top center\",\r\n                    at: \"bottom left\",\r\n                    collision: \"fit flip\"\r\n                })\r\n            }\r\n        }\r\n        insertEmbedContent(selectionChangedEvent) {\r\n            var caretPosition = this.getPosition();\r\n            var selectedItem = selectionChangedEvent.component.option(\"selectedItem\");\r\n            var variableData = extend({}, {\r\n                value: selectedItem,\r\n                escapeChar: this.options.escapeChar\r\n            });\r\n            setTimeout(function() {\r\n                this.quill.insertEmbed(caretPosition, \"variable\", variableData);\r\n                this.quill.setSelection(caretPosition + 1)\r\n            }.bind(this))\r\n        }\r\n    }\r\n}\r\nexport default VariableModule;\r\n"],"mappings":"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"},"metadata":{},"sourceType":"module"}