{"ast":null,"code":"/**\r\n * DevExtreme (esm/ui/scheduler/resources/agendaResourceProcessor.js)\r\n * Version: 22.1.4\r\n * Build date: Fri Jul 22 2022\r\n *\r\n * Copyright (c) 2012 - 2022 Developer Express Inc. ALL RIGHTS RESERVED\r\n * Read about DevExtreme licensing here: https://js.devexpress.com/Licensing/\r\n */\nimport { wrapToArray } from \"../../../core/utils/array\";\nimport { when, Deferred } from \"../../../core/utils/deferred\";\nimport { getFieldExpr, getDisplayExpr, getValueExpr, getWrappedDataSource } from \"./utils\";\n\nclass PromiseItem {\n  constructor(rawAppointment, promise) {\n    this.rawAppointment = rawAppointment;\n    this.promise = promise;\n  }\n\n}\n\nexport class AgendaResourceProcessor {\n  get resourceDeclarations() {\n    return this._resourceDeclarations;\n  }\n\n  set resourceDeclarations(value) {\n    this._resourceDeclarations = value;\n    this.isLoaded = false;\n    this.isLoading = false;\n    this.resourceMap.clear();\n    this.appointmentPromiseQueue = [];\n  }\n\n  constructor() {\n    var resourceDeclarations = arguments.length > 0 && void 0 !== arguments[0] ? arguments[0] : [];\n    this._resourceDeclarations = resourceDeclarations;\n    this.isLoaded = false;\n    this.isLoading = false;\n    this.resourceMap = new Map();\n    this.appointmentPromiseQueue = [];\n  }\n\n  _pushAllResources() {\n    this.appointmentPromiseQueue.forEach(_ref => {\n      var {\n        promise: promise,\n        rawAppointment: rawAppointment\n      } = _ref;\n      var result = [];\n      this.resourceMap.forEach((resource, fieldName) => {\n        var item = {\n          label: resource.label,\n          values: []\n        };\n\n        if (fieldName in rawAppointment) {\n          wrapToArray(rawAppointment[fieldName]).forEach(value => item.values.push(resource.map.get(value)));\n        }\n\n        if (item.values.length) {\n          result.push(item);\n        }\n      });\n      promise.resolve(result);\n    });\n    this.appointmentPromiseQueue = [];\n  }\n\n  _onPullResource(fieldName, valueName, displayName, label, items) {\n    var map = new Map();\n    items.forEach(item => map.set(item[valueName], item[displayName]));\n    this.resourceMap.set(fieldName, {\n      label: label,\n      map: map\n    });\n  }\n\n  _hasResourceDeclarations(resources) {\n    if (0 === resources.length) {\n      this.appointmentPromiseQueue.forEach(_ref2 => {\n        var {\n          promise: promise\n        } = _ref2;\n        return promise.resolve([]);\n      });\n      this.appointmentPromiseQueue = [];\n      return false;\n    }\n\n    return true;\n  }\n\n  _tryPullResources(resources, resultAsync) {\n    if (!this.isLoading) {\n      this.isLoading = true;\n      var promises = [];\n      resources.forEach(resource => {\n        var promise = new Deferred().done(items => this._onPullResource(getFieldExpr(resource), getValueExpr(resource), getDisplayExpr(resource), resource.label, items));\n        promises.push(promise);\n        var dataSource = getWrappedDataSource(resource.dataSource);\n\n        if (dataSource.isLoaded()) {\n          promise.resolve(dataSource.items());\n        } else {\n          dataSource.load().done(list => promise.resolve(list)).fail(() => promise.reject());\n        }\n      });\n      when.apply(null, promises).done(() => {\n        this.isLoaded = true;\n        this.isLoading = false;\n\n        this._pushAllResources();\n      }).fail(() => resultAsync.reject());\n    }\n  }\n\n  initializeState() {\n    var resourceDeclarations = arguments.length > 0 && void 0 !== arguments[0] ? arguments[0] : [];\n    this.resourceDeclarations = resourceDeclarations;\n  }\n\n  createListAsync(rawAppointment) {\n    var resultAsync = new Deferred();\n    this.appointmentPromiseQueue.push(new PromiseItem(rawAppointment, resultAsync));\n\n    if (this._hasResourceDeclarations(this.resourceDeclarations)) {\n      if (this.isLoaded) {\n        this._pushAllResources();\n      } else {\n        this._tryPullResources(this.resourceDeclarations, resultAsync);\n      }\n    }\n\n    return resultAsync.promise();\n  }\n\n}","map":{"version":3,"names":["wrapToArray","when","Deferred","getFieldExpr","getDisplayExpr","getValueExpr","getWrappedDataSource","PromiseItem","constructor","rawAppointment","promise","AgendaResourceProcessor","resourceDeclarations","_resourceDeclarations","value","isLoaded","isLoading","resourceMap","clear","appointmentPromiseQueue","arguments","length","Map","_pushAllResources","forEach","_ref","result","resource","fieldName","item","label","values","push","map","get","resolve","_onPullResource","valueName","displayName","items","set","_hasResourceDeclarations","resources","_ref2","_tryPullResources","resultAsync","promises","done","dataSource","load","list","fail","reject","apply","initializeState","createListAsync"],"sources":["E:/MisaProject/W2022_06/misa_emis/node_modules/devextreme/esm/ui/scheduler/resources/agendaResourceProcessor.js"],"sourcesContent":["/**\r\n * DevExtreme (esm/ui/scheduler/resources/agendaResourceProcessor.js)\r\n * Version: 22.1.4\r\n * Build date: Fri Jul 22 2022\r\n *\r\n * Copyright (c) 2012 - 2022 Developer Express Inc. ALL RIGHTS RESERVED\r\n * Read about DevExtreme licensing here: https://js.devexpress.com/Licensing/\r\n */\r\nimport {\r\n    wrapToArray\r\n} from \"../../../core/utils/array\";\r\nimport {\r\n    when,\r\n    Deferred\r\n} from \"../../../core/utils/deferred\";\r\nimport {\r\n    getFieldExpr,\r\n    getDisplayExpr,\r\n    getValueExpr,\r\n    getWrappedDataSource\r\n} from \"./utils\";\r\nclass PromiseItem {\r\n    constructor(rawAppointment, promise) {\r\n        this.rawAppointment = rawAppointment;\r\n        this.promise = promise\r\n    }\r\n}\r\nexport class AgendaResourceProcessor {\r\n    get resourceDeclarations() {\r\n        return this._resourceDeclarations\r\n    }\r\n    set resourceDeclarations(value) {\r\n        this._resourceDeclarations = value;\r\n        this.isLoaded = false;\r\n        this.isLoading = false;\r\n        this.resourceMap.clear();\r\n        this.appointmentPromiseQueue = []\r\n    }\r\n    constructor() {\r\n        var resourceDeclarations = arguments.length > 0 && void 0 !== arguments[0] ? arguments[0] : [];\r\n        this._resourceDeclarations = resourceDeclarations;\r\n        this.isLoaded = false;\r\n        this.isLoading = false;\r\n        this.resourceMap = new Map;\r\n        this.appointmentPromiseQueue = []\r\n    }\r\n    _pushAllResources() {\r\n        this.appointmentPromiseQueue.forEach(_ref => {\r\n            var {\r\n                promise: promise,\r\n                rawAppointment: rawAppointment\r\n            } = _ref;\r\n            var result = [];\r\n            this.resourceMap.forEach((resource, fieldName) => {\r\n                var item = {\r\n                    label: resource.label,\r\n                    values: []\r\n                };\r\n                if (fieldName in rawAppointment) {\r\n                    wrapToArray(rawAppointment[fieldName]).forEach(value => item.values.push(resource.map.get(value)))\r\n                }\r\n                if (item.values.length) {\r\n                    result.push(item)\r\n                }\r\n            });\r\n            promise.resolve(result)\r\n        });\r\n        this.appointmentPromiseQueue = []\r\n    }\r\n    _onPullResource(fieldName, valueName, displayName, label, items) {\r\n        var map = new Map;\r\n        items.forEach(item => map.set(item[valueName], item[displayName]));\r\n        this.resourceMap.set(fieldName, {\r\n            label: label,\r\n            map: map\r\n        })\r\n    }\r\n    _hasResourceDeclarations(resources) {\r\n        if (0 === resources.length) {\r\n            this.appointmentPromiseQueue.forEach(_ref2 => {\r\n                var {\r\n                    promise: promise\r\n                } = _ref2;\r\n                return promise.resolve([])\r\n            });\r\n            this.appointmentPromiseQueue = [];\r\n            return false\r\n        }\r\n        return true\r\n    }\r\n    _tryPullResources(resources, resultAsync) {\r\n        if (!this.isLoading) {\r\n            this.isLoading = true;\r\n            var promises = [];\r\n            resources.forEach(resource => {\r\n                var promise = (new Deferred).done(items => this._onPullResource(getFieldExpr(resource), getValueExpr(resource), getDisplayExpr(resource), resource.label, items));\r\n                promises.push(promise);\r\n                var dataSource = getWrappedDataSource(resource.dataSource);\r\n                if (dataSource.isLoaded()) {\r\n                    promise.resolve(dataSource.items())\r\n                } else {\r\n                    dataSource.load().done(list => promise.resolve(list)).fail(() => promise.reject())\r\n                }\r\n            });\r\n            when.apply(null, promises).done(() => {\r\n                this.isLoaded = true;\r\n                this.isLoading = false;\r\n                this._pushAllResources()\r\n            }).fail(() => resultAsync.reject())\r\n        }\r\n    }\r\n    initializeState() {\r\n        var resourceDeclarations = arguments.length > 0 && void 0 !== arguments[0] ? arguments[0] : [];\r\n        this.resourceDeclarations = resourceDeclarations\r\n    }\r\n    createListAsync(rawAppointment) {\r\n        var resultAsync = new Deferred;\r\n        this.appointmentPromiseQueue.push(new PromiseItem(rawAppointment, resultAsync));\r\n        if (this._hasResourceDeclarations(this.resourceDeclarations)) {\r\n            if (this.isLoaded) {\r\n                this._pushAllResources()\r\n            } else {\r\n                this._tryPullResources(this.resourceDeclarations, resultAsync)\r\n            }\r\n        }\r\n        return resultAsync.promise()\r\n    }\r\n}\r\n"],"mappings":"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"},"metadata":{},"sourceType":"module"}