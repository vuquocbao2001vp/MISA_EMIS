{"ast":null,"code":"import RRule from '../rrule';\nimport { empty, repeat, pymod } from '../helpers';\nexport function rebuildMonth(year, month, yearlen, mrange, wdaymask, options) {\n  var result = {\n    lastyear: year,\n    lastmonth: month,\n    nwdaymask: []\n  };\n  var ranges = [];\n\n  if (options.freq === RRule.YEARLY) {\n    if (empty(options.bymonth)) {\n      ranges = [[0, yearlen]];\n    } else {\n      for (var j = 0; j < options.bymonth.length; j++) {\n        month = options.bymonth[j];\n        ranges.push(mrange.slice(month - 1, month + 1));\n      }\n    }\n  } else if (options.freq === RRule.MONTHLY) {\n    ranges = [mrange.slice(month - 1, month + 1)];\n  }\n\n  if (empty(ranges)) {\n    return result;\n  } // Weekly frequency won't get here, so we may not\n  // care about cross-year weekly periods.\n\n\n  result.nwdaymask = repeat(0, yearlen);\n\n  for (var j = 0; j < ranges.length; j++) {\n    var rang = ranges[j];\n    var first = rang[0];\n    var last = rang[1] - 1;\n\n    for (var k = 0; k < options.bynweekday.length; k++) {\n      var i = void 0;\n      var _a = options.bynweekday[k],\n          wday = _a[0],\n          n = _a[1];\n\n      if (n < 0) {\n        i = last + (n + 1) * 7;\n        i -= pymod(wdaymask[i] - wday, 7);\n      } else {\n        i = first + (n - 1) * 7;\n        i += pymod(7 - wdaymask[i] + wday, 7);\n      }\n\n      if (first <= i && i <= last) result.nwdaymask[i] = 1;\n    }\n  }\n\n  return result;\n}","map":{"version":3,"mappings":"AACA,OAAOA,KAAP,MAAkB,UAAlB;AACA,SAASC,KAAT,EAAgBC,MAAhB,EAAwBC,KAAxB,QAAqC,YAArC;AAQA,OAAM,SAAUC,YAAV,CACJC,IADI,EAEJC,KAFI,EAGJC,OAHI,EAIJC,MAJI,EAKJC,QALI,EAMJC,OANI,EAMkB;EAEtB,IAAMC,MAAM,GAAc;IACxBC,QAAQ,EAAEP,IADc;IAExBQ,SAAS,EAAEP,KAFa;IAGxBQ,SAAS,EAAE;EAHa,CAA1B;EAMA,IAAIC,MAAM,GAAe,EAAzB;;EACA,IAAIL,OAAO,CAACM,IAAR,KAAiBhB,KAAK,CAACiB,MAA3B,EAAmC;IACjC,IAAIhB,KAAK,CAACS,OAAO,CAACQ,OAAT,CAAT,EAA4B;MAC1BH,MAAM,GAAG,CAAC,CAAC,CAAD,EAAIR,OAAJ,CAAD,CAAT;IACD,CAFD,MAEO;MACL,KAAK,IAAIY,CAAC,GAAG,CAAb,EAAgBA,CAAC,GAAGT,OAAO,CAACQ,OAAR,CAAgBE,MAApC,EAA4CD,CAAC,EAA7C,EAAiD;QAC/Cb,KAAK,GAAGI,OAAO,CAACQ,OAAR,CAAgBC,CAAhB,CAAR;QACAJ,MAAM,CAACM,IAAP,CAAYb,MAAM,CAACc,KAAP,CAAahB,KAAK,GAAG,CAArB,EAAwBA,KAAK,GAAG,CAAhC,CAAZ;MACD;IACF;EACF,CATD,MASO,IAAII,OAAO,CAACM,IAAR,KAAiBhB,KAAK,CAACuB,OAA3B,EAAoC;IACzCR,MAAM,GAAG,CAACP,MAAM,CAACc,KAAP,CAAahB,KAAK,GAAG,CAArB,EAAwBA,KAAK,GAAG,CAAhC,CAAD,CAAT;EACD;;EAED,IAAIL,KAAK,CAACc,MAAD,CAAT,EAAmB;IACjB,OAAOJ,MAAP;EACD,CAxBqB,CA0BtB;EACA;;;EACAA,MAAM,CAACG,SAAP,GAAmBZ,MAAM,CAAC,CAAD,EAAIK,OAAJ,CAAzB;;EAEA,KAAK,IAAIY,CAAC,GAAG,CAAb,EAAgBA,CAAC,GAAGJ,MAAM,CAACK,MAA3B,EAAmCD,CAAC,EAApC,EAAwC;IACtC,IAAMK,IAAI,GAAGT,MAAM,CAACI,CAAD,CAAnB;IACA,IAAMM,KAAK,GAAGD,IAAI,CAAC,CAAD,CAAlB;IACA,IAAME,IAAI,GAAGF,IAAI,CAAC,CAAD,CAAJ,GAAU,CAAvB;;IAEA,KAAK,IAAIG,CAAC,GAAG,CAAb,EAAgBA,CAAC,GAAGjB,OAAO,CAACkB,UAAR,CAAoBR,MAAxC,EAAgDO,CAAC,EAAjD,EAAqD;MACnD,IAAIE,CAAC,SAAL;MACM;MAAA,IAAEC,YAAF;MAAA,IAAQC,SAAR;;MACN,IAAIA,CAAC,GAAG,CAAR,EAAW;QACTF,CAAC,GAAGH,IAAI,GAAG,CAACK,CAAC,GAAG,CAAL,IAAU,CAArB;QACAF,CAAC,IAAI1B,KAAK,CAACM,QAAQ,CAACoB,CAAD,CAAR,GAAcC,IAAf,EAAqB,CAArB,CAAV;MACD,CAHD,MAGO;QACLD,CAAC,GAAGJ,KAAK,GAAG,CAACM,CAAC,GAAG,CAAL,IAAU,CAAtB;QACAF,CAAC,IAAI1B,KAAK,CAAC,IAAIM,QAAQ,CAACoB,CAAD,CAAZ,GAAkBC,IAAnB,EAAyB,CAAzB,CAAV;MACD;;MACD,IAAIL,KAAK,IAAII,CAAT,IAAcA,CAAC,IAAIH,IAAvB,EAA6Bf,MAAM,CAACG,SAAP,CAAiBe,CAAjB,IAAsB,CAAtB;IAC9B;EACF;;EAED,OAAOlB,MAAP;AACD","names":["RRule","empty","repeat","pymod","rebuildMonth","year","month","yearlen","mrange","wdaymask","options","result","lastyear","lastmonth","nwdaymask","ranges","freq","YEARLY","bymonth","j","length","push","slice","MONTHLY","rang","first","last","k","bynweekday","i","wday","n"],"sourceRoot":"","sources":["../../../../src/iterinfo/monthinfo.ts"],"sourcesContent":[null]},"metadata":{},"sourceType":"module"}