{"ast":null,"code":"/**\r\n * DevExtreme (esm/ui/html_editor/modules/imageUpload.js)\r\n * Version: 22.1.4\r\n * Build date: Fri Jul 22 2022\r\n *\r\n * Copyright (c) 2012 - 2022 Developer Express Inc. ALL RIGHTS RESERVED\r\n * Read about DevExtreme licensing here: https://js.devexpress.com/Licensing/\r\n */\nimport Quill from \"devextreme-quill\";\nimport BaseModule from \"./base\";\nimport eventsEngine from \"../../../events/core/events_engine\";\nimport $ from \"../../../core/renderer\";\nimport { isDefined } from \"../../../core/utils/type\";\nimport { extend } from \"../../../core/utils/extend\";\nimport { urlUpload, getFileUploaderBaseOptions, correctSlashesInUrl } from \"../utils/image_uploader_helper\";\nimport { addNamespace } from \"../../../events/utils/index\";\nimport FileUploader from \"../../file_uploader\";\nvar MODULE_NAMESPACE = \"dxHtmlEditorImageUpload\";\nvar HIDDEN_FILE_UPLOADER_CLASS = \"dx-htmleditor-hidden-content\";\nvar ImageUploadModule = BaseModule;\n\nif (Quill) {\n  ImageUploadModule = class extends BaseModule {\n    constructor(quill, options) {\n      super(quill, options);\n      this.options = options;\n      this._quillContainer = this.editorInstance._getQuillContainer();\n      this.addCleanCallback(this.prepareCleanCallback());\n\n      this._handleServerUpload();\n    }\n\n    _handleServerUpload() {\n      var useServerUpload = isDefined(this.options.fileUploadMode) && \"base64\" !== this.options.fileUploadMode;\n      useServerUpload ? this._enableDragAndDropUploading() : this._disableDragAndDropUploading();\n    }\n\n    _getUploaderModule() {\n      if (!this._uploaderModule) {\n        this._uploaderModule = this.quill.getModule(\"uploader\");\n      }\n\n      return this._uploaderModule;\n    }\n\n    _disableDragAndDropUploading() {\n      var _this$_fileUploader;\n\n      this._getUploaderModule().preventImageUploading(false);\n\n      this._detachEvents();\n\n      null === (_this$_fileUploader = this._fileUploader) || void 0 === _this$_fileUploader ? void 0 : _this$_fileUploader.dispose();\n    }\n\n    _enableDragAndDropUploading() {\n      this._initFileUploader();\n\n      this._getUploaderModule().preventImageUploading(true);\n\n      this._attachEvents();\n    }\n\n    _initFileUploader() {\n      var $container = $(\"<div>\").addClass(HIDDEN_FILE_UPLOADER_CLASS).appendTo(this._quillContainer);\n      var fileUploaderOptions = extend({}, getFileUploaderBaseOptions(), {\n        uploadUrl: this.options.uploadUrl,\n        onUploaded: this._onUploaded.bind(this)\n      }, this.options.fileUploaderOptions);\n      this._fileUploader = this.editorInstance._createComponent($container, FileUploader, fileUploaderOptions);\n      return $container;\n    }\n\n    _onUploaded(data) {\n      var _this$quill$getSelect;\n\n      var {\n        index: pasteIndex\n      } = null !== (_this$quill$getSelect = this.quill.getSelection()) && void 0 !== _this$quill$getSelect ? _this$quill$getSelect : {\n        index: this.quill.getLength()\n      };\n      var imageUrl = correctSlashesInUrl(this.options.uploadDirectory) + data.file.name;\n      urlUpload(this.quill, pasteIndex, {\n        src: imageUrl\n      });\n      this.quill.setSelection(pasteIndex + 1, 0);\n    }\n\n    _attachEvents() {\n      eventsEngine.on(this.quill.root, addNamespace(\"drop\", MODULE_NAMESPACE), this._dropHandler.bind(this));\n      eventsEngine.on(this.quill.root, addNamespace(\"paste\", MODULE_NAMESPACE), this._pasteHandler.bind(this));\n    }\n\n    _detachEvents() {\n      eventsEngine.off(this.quill.root, MODULE_NAMESPACE);\n    }\n\n    _dropHandler(e) {\n      this._handleInsertImages(e, \"dataTransfer\");\n    }\n\n    _pasteHandler(e) {\n      this._handleInsertImages(e, \"clipboardData\");\n    }\n\n    _handleInsertImages(e, filesField) {\n      this.saveValueChangeEvent(e);\n      var files = Array.from(e.originalEvent[filesField].files || []);\n      var uploads = files;\n\n      if (uploads.length) {\n        e.preventDefault();\n        e.stopPropagation();\n\n        this._fileUploader.option(\"value\", uploads);\n\n        this._fileUploader.upload();\n      }\n    }\n\n    clean() {\n      this._disableDragAndDropUploading();\n    }\n\n    prepareCleanCallback() {\n      return () => {\n        this.clean();\n      };\n    }\n\n    option(option, value) {\n      switch (option) {\n        case \"imageUpload\":\n          this.handleOptionChangeValue(value);\n          break;\n\n        case \"fileUploadMode\":\n          this.options.fileUploadMode = value;\n\n          this._handleServerUpload();\n\n          break;\n\n        case \"fileUploaderOptions\":\n          this._fileUploader.option(value);\n\n      }\n    }\n\n  };\n}\n\nexport default ImageUploadModule;","map":{"version":3,"names":["Quill","BaseModule","eventsEngine","$","isDefined","extend","urlUpload","getFileUploaderBaseOptions","correctSlashesInUrl","addNamespace","FileUploader","MODULE_NAMESPACE","HIDDEN_FILE_UPLOADER_CLASS","ImageUploadModule","constructor","quill","options","_quillContainer","editorInstance","_getQuillContainer","addCleanCallback","prepareCleanCallback","_handleServerUpload","useServerUpload","fileUploadMode","_enableDragAndDropUploading","_disableDragAndDropUploading","_getUploaderModule","_uploaderModule","getModule","_this$_fileUploader","preventImageUploading","_detachEvents","_fileUploader","dispose","_initFileUploader","_attachEvents","$container","addClass","appendTo","fileUploaderOptions","uploadUrl","onUploaded","_onUploaded","bind","_createComponent","data","_this$quill$getSelect","index","pasteIndex","getSelection","getLength","imageUrl","uploadDirectory","file","name","src","setSelection","on","root","_dropHandler","_pasteHandler","off","e","_handleInsertImages","filesField","saveValueChangeEvent","files","Array","from","originalEvent","uploads","length","preventDefault","stopPropagation","option","upload","clean","value","handleOptionChangeValue"],"sources":["E:/MisaProject/W2022_06/misa_emis/node_modules/devextreme/esm/ui/html_editor/modules/imageUpload.js"],"sourcesContent":["/**\r\n * DevExtreme (esm/ui/html_editor/modules/imageUpload.js)\r\n * Version: 22.1.4\r\n * Build date: Fri Jul 22 2022\r\n *\r\n * Copyright (c) 2012 - 2022 Developer Express Inc. ALL RIGHTS RESERVED\r\n * Read about DevExtreme licensing here: https://js.devexpress.com/Licensing/\r\n */\r\nimport Quill from \"devextreme-quill\";\r\nimport BaseModule from \"./base\";\r\nimport eventsEngine from \"../../../events/core/events_engine\";\r\nimport $ from \"../../../core/renderer\";\r\nimport {\r\n    isDefined\r\n} from \"../../../core/utils/type\";\r\nimport {\r\n    extend\r\n} from \"../../../core/utils/extend\";\r\nimport {\r\n    urlUpload,\r\n    getFileUploaderBaseOptions,\r\n    correctSlashesInUrl\r\n} from \"../utils/image_uploader_helper\";\r\nimport {\r\n    addNamespace\r\n} from \"../../../events/utils/index\";\r\nimport FileUploader from \"../../file_uploader\";\r\nvar MODULE_NAMESPACE = \"dxHtmlEditorImageUpload\";\r\nvar HIDDEN_FILE_UPLOADER_CLASS = \"dx-htmleditor-hidden-content\";\r\nvar ImageUploadModule = BaseModule;\r\nif (Quill) {\r\n    ImageUploadModule = class extends BaseModule {\r\n        constructor(quill, options) {\r\n            super(quill, options);\r\n            this.options = options;\r\n            this._quillContainer = this.editorInstance._getQuillContainer();\r\n            this.addCleanCallback(this.prepareCleanCallback());\r\n            this._handleServerUpload()\r\n        }\r\n        _handleServerUpload() {\r\n            var useServerUpload = isDefined(this.options.fileUploadMode) && \"base64\" !== this.options.fileUploadMode;\r\n            useServerUpload ? this._enableDragAndDropUploading() : this._disableDragAndDropUploading()\r\n        }\r\n        _getUploaderModule() {\r\n            if (!this._uploaderModule) {\r\n                this._uploaderModule = this.quill.getModule(\"uploader\")\r\n            }\r\n            return this._uploaderModule\r\n        }\r\n        _disableDragAndDropUploading() {\r\n            var _this$_fileUploader;\r\n            this._getUploaderModule().preventImageUploading(false);\r\n            this._detachEvents();\r\n            null === (_this$_fileUploader = this._fileUploader) || void 0 === _this$_fileUploader ? void 0 : _this$_fileUploader.dispose()\r\n        }\r\n        _enableDragAndDropUploading() {\r\n            this._initFileUploader();\r\n            this._getUploaderModule().preventImageUploading(true);\r\n            this._attachEvents()\r\n        }\r\n        _initFileUploader() {\r\n            var $container = $(\"<div>\").addClass(HIDDEN_FILE_UPLOADER_CLASS).appendTo(this._quillContainer);\r\n            var fileUploaderOptions = extend({}, getFileUploaderBaseOptions(), {\r\n                uploadUrl: this.options.uploadUrl,\r\n                onUploaded: this._onUploaded.bind(this)\r\n            }, this.options.fileUploaderOptions);\r\n            this._fileUploader = this.editorInstance._createComponent($container, FileUploader, fileUploaderOptions);\r\n            return $container\r\n        }\r\n        _onUploaded(data) {\r\n            var _this$quill$getSelect;\r\n            var {\r\n                index: pasteIndex\r\n            } = null !== (_this$quill$getSelect = this.quill.getSelection()) && void 0 !== _this$quill$getSelect ? _this$quill$getSelect : {\r\n                index: this.quill.getLength()\r\n            };\r\n            var imageUrl = correctSlashesInUrl(this.options.uploadDirectory) + data.file.name;\r\n            urlUpload(this.quill, pasteIndex, {\r\n                src: imageUrl\r\n            });\r\n            this.quill.setSelection(pasteIndex + 1, 0)\r\n        }\r\n        _attachEvents() {\r\n            eventsEngine.on(this.quill.root, addNamespace(\"drop\", MODULE_NAMESPACE), this._dropHandler.bind(this));\r\n            eventsEngine.on(this.quill.root, addNamespace(\"paste\", MODULE_NAMESPACE), this._pasteHandler.bind(this))\r\n        }\r\n        _detachEvents() {\r\n            eventsEngine.off(this.quill.root, MODULE_NAMESPACE)\r\n        }\r\n        _dropHandler(e) {\r\n            this._handleInsertImages(e, \"dataTransfer\")\r\n        }\r\n        _pasteHandler(e) {\r\n            this._handleInsertImages(e, \"clipboardData\")\r\n        }\r\n        _handleInsertImages(e, filesField) {\r\n            this.saveValueChangeEvent(e);\r\n            var files = Array.from(e.originalEvent[filesField].files || []);\r\n            var uploads = files;\r\n            if (uploads.length) {\r\n                e.preventDefault();\r\n                e.stopPropagation();\r\n                this._fileUploader.option(\"value\", uploads);\r\n                this._fileUploader.upload()\r\n            }\r\n        }\r\n        clean() {\r\n            this._disableDragAndDropUploading()\r\n        }\r\n        prepareCleanCallback() {\r\n            return () => {\r\n                this.clean()\r\n            }\r\n        }\r\n        option(option, value) {\r\n            switch (option) {\r\n                case \"imageUpload\":\r\n                    this.handleOptionChangeValue(value);\r\n                    break;\r\n                case \"fileUploadMode\":\r\n                    this.options.fileUploadMode = value;\r\n                    this._handleServerUpload();\r\n                    break;\r\n                case \"fileUploaderOptions\":\r\n                    this._fileUploader.option(value)\r\n            }\r\n        }\r\n    }\r\n}\r\nexport default ImageUploadModule;\r\n"],"mappings":"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"},"metadata":{},"sourceType":"module"}