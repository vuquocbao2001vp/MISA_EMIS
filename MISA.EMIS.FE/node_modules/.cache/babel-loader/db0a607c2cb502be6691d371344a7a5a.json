{"ast":null,"code":"/**\r\n * DevExtreme (esm/ui/gantt/ui.gantt.custom_fields.js)\r\n * Version: 22.1.4\r\n * Build date: Fri Jul 22 2022\r\n *\r\n * Copyright (c) 2012 - 2022 Developer Express Inc. ALL RIGHTS RESERVED\r\n * Read about DevExtreme licensing here: https://js.devexpress.com/Licensing/\r\n */\nimport { compileGetter } from \"../../core/utils/data\";\nimport { GanttDataCache } from \"./ui.gantt.cache\";\nimport { GanttHelper } from \"./ui.gantt.helper\";\nvar GANTT_TASKS = \"tasks\";\nexport class GanttCustomFieldsManager {\n  constructor(gantt) {\n    this._gantt = gantt;\n    this._mappingHelper = gantt._mappingHelper;\n    this.cache = new GanttDataCache();\n  }\n\n  _getTaskCustomFields() {\n    var columns = this._gantt.option(\"columns\");\n\n    var columnFields = columns && columns.map(c => c.dataField);\n\n    var mappedFields = this._mappingHelper.getTaskMappedFieldNames();\n\n    return columnFields ? columnFields.filter(f => mappedFields.indexOf(f) < 0) : [];\n  }\n\n  _getCustomFieldsData(data) {\n    return this._getTaskCustomFields().reduce((previous, field) => {\n      if (data && void 0 !== data[field]) {\n        previous[field] = data[field];\n      }\n\n      return previous;\n    }, {});\n  }\n\n  addCustomFieldsData(key, data) {\n    if (data) {\n      var modelData = this._gantt._tasksOption && this._gantt._tasksOption._getItems();\n\n      var keyGetter = compileGetter(this._gantt.option(\"\".concat(GANTT_TASKS, \".keyExpr\")));\n      var modelItem = modelData && modelData.filter(obj => keyGetter(obj) === key)[0];\n\n      var customFields = this._getTaskCustomFields();\n\n      if (modelItem) {\n        for (var i = 0; i < customFields.length; i++) {\n          var field = customFields[i];\n\n          if (Object.prototype.hasOwnProperty.call(modelItem, field)) {\n            data[field] = modelItem[field];\n          }\n        }\n      }\n    }\n  }\n\n  appendCustomFields(data) {\n    var modelData = this._gantt._tasksOption && this._gantt._tasksOption._getItems();\n\n    var keyGetter = this._gantt._getTaskKeyGetter();\n\n    var invertedData = GanttHelper.getInvertedData(modelData, keyGetter);\n    return data.reduce((previous, item) => {\n      var key = keyGetter(item);\n      var modelItem = invertedData[key];\n\n      if (!modelItem) {\n        previous.push(item);\n      } else {\n        var updatedItem = {};\n\n        for (var field in modelItem) {\n          updatedItem[field] = Object.prototype.hasOwnProperty.call(item, field) ? item[field] : modelItem[field];\n        }\n\n        previous.push(updatedItem);\n      }\n\n      return previous;\n    }, []);\n  }\n\n  addCustomFieldsDataFromCache(key, data) {\n    this.cache.pullDataFromCache(key, data);\n  }\n\n  saveCustomFieldsDataToCache(key, data) {\n    var forceUpdateOnKeyExpire = arguments.length > 2 && void 0 !== arguments[2] ? arguments[2] : false;\n    var isCustomFieldsUpdateOnly = arguments.length > 3 && void 0 !== arguments[3] ? arguments[3] : false;\n\n    var customFieldsData = this._getCustomFieldsData(data);\n\n    if (Object.keys(customFieldsData).length > 0) {\n      this.cache.saveData(key, customFieldsData, forceUpdateOnKeyExpire ? (key, data) => {\n        var dataOption = this._gantt[\"_\".concat(GANTT_TASKS, \"Option\")];\n\n        if (dataOption && data) {\n          dataOption.update(key, data, (data, key) => {\n            var updatedCustomFields = {};\n            this.addCustomFieldsData(key, updatedCustomFields);\n\n            dataOption._reloadDataSource().done(data => {\n              this._gantt._ganttTreeList.updateDataSource(null !== data && void 0 !== data ? data : dataOption._dataSource, false, isCustomFieldsUpdateOnly);\n            });\n\n            var selectedRowKey = this._gantt.option(\"selectedRowKey\");\n\n            this._gantt._ganttView._selectTask(selectedRowKey);\n\n            this._gantt._actionsManager.raiseUpdatedAction(GANTT_TASKS, updatedCustomFields, key);\n          });\n        }\n      } : null);\n    }\n  }\n\n  resetCustomFieldsDataCache(key) {\n    this.cache.resetCache(key);\n  }\n\n}","map":{"version":3,"names":["compileGetter","GanttDataCache","GanttHelper","GANTT_TASKS","GanttCustomFieldsManager","constructor","gantt","_gantt","_mappingHelper","cache","_getTaskCustomFields","columns","option","columnFields","map","c","dataField","mappedFields","getTaskMappedFieldNames","filter","f","indexOf","_getCustomFieldsData","data","reduce","previous","field","addCustomFieldsData","key","modelData","_tasksOption","_getItems","keyGetter","concat","modelItem","obj","customFields","i","length","Object","prototype","hasOwnProperty","call","appendCustomFields","_getTaskKeyGetter","invertedData","getInvertedData","item","push","updatedItem","addCustomFieldsDataFromCache","pullDataFromCache","saveCustomFieldsDataToCache","forceUpdateOnKeyExpire","arguments","isCustomFieldsUpdateOnly","customFieldsData","keys","saveData","dataOption","update","updatedCustomFields","_reloadDataSource","done","_ganttTreeList","updateDataSource","_dataSource","selectedRowKey","_ganttView","_selectTask","_actionsManager","raiseUpdatedAction","resetCustomFieldsDataCache","resetCache"],"sources":["E:/MisaProject/W2022_06/misa_emis/node_modules/devextreme/esm/ui/gantt/ui.gantt.custom_fields.js"],"sourcesContent":["/**\r\n * DevExtreme (esm/ui/gantt/ui.gantt.custom_fields.js)\r\n * Version: 22.1.4\r\n * Build date: Fri Jul 22 2022\r\n *\r\n * Copyright (c) 2012 - 2022 Developer Express Inc. ALL RIGHTS RESERVED\r\n * Read about DevExtreme licensing here: https://js.devexpress.com/Licensing/\r\n */\r\nimport {\r\n    compileGetter\r\n} from \"../../core/utils/data\";\r\nimport {\r\n    GanttDataCache\r\n} from \"./ui.gantt.cache\";\r\nimport {\r\n    GanttHelper\r\n} from \"./ui.gantt.helper\";\r\nvar GANTT_TASKS = \"tasks\";\r\nexport class GanttCustomFieldsManager {\r\n    constructor(gantt) {\r\n        this._gantt = gantt;\r\n        this._mappingHelper = gantt._mappingHelper;\r\n        this.cache = new GanttDataCache\r\n    }\r\n    _getTaskCustomFields() {\r\n        var columns = this._gantt.option(\"columns\");\r\n        var columnFields = columns && columns.map(c => c.dataField);\r\n        var mappedFields = this._mappingHelper.getTaskMappedFieldNames();\r\n        return columnFields ? columnFields.filter(f => mappedFields.indexOf(f) < 0) : []\r\n    }\r\n    _getCustomFieldsData(data) {\r\n        return this._getTaskCustomFields().reduce((previous, field) => {\r\n            if (data && void 0 !== data[field]) {\r\n                previous[field] = data[field]\r\n            }\r\n            return previous\r\n        }, {})\r\n    }\r\n    addCustomFieldsData(key, data) {\r\n        if (data) {\r\n            var modelData = this._gantt._tasksOption && this._gantt._tasksOption._getItems();\r\n            var keyGetter = compileGetter(this._gantt.option(\"\".concat(GANTT_TASKS, \".keyExpr\")));\r\n            var modelItem = modelData && modelData.filter(obj => keyGetter(obj) === key)[0];\r\n            var customFields = this._getTaskCustomFields();\r\n            if (modelItem) {\r\n                for (var i = 0; i < customFields.length; i++) {\r\n                    var field = customFields[i];\r\n                    if (Object.prototype.hasOwnProperty.call(modelItem, field)) {\r\n                        data[field] = modelItem[field]\r\n                    }\r\n                }\r\n            }\r\n        }\r\n    }\r\n    appendCustomFields(data) {\r\n        var modelData = this._gantt._tasksOption && this._gantt._tasksOption._getItems();\r\n        var keyGetter = this._gantt._getTaskKeyGetter();\r\n        var invertedData = GanttHelper.getInvertedData(modelData, keyGetter);\r\n        return data.reduce((previous, item) => {\r\n            var key = keyGetter(item);\r\n            var modelItem = invertedData[key];\r\n            if (!modelItem) {\r\n                previous.push(item)\r\n            } else {\r\n                var updatedItem = {};\r\n                for (var field in modelItem) {\r\n                    updatedItem[field] = Object.prototype.hasOwnProperty.call(item, field) ? item[field] : modelItem[field]\r\n                }\r\n                previous.push(updatedItem)\r\n            }\r\n            return previous\r\n        }, [])\r\n    }\r\n    addCustomFieldsDataFromCache(key, data) {\r\n        this.cache.pullDataFromCache(key, data)\r\n    }\r\n    saveCustomFieldsDataToCache(key, data) {\r\n        var forceUpdateOnKeyExpire = arguments.length > 2 && void 0 !== arguments[2] ? arguments[2] : false;\r\n        var isCustomFieldsUpdateOnly = arguments.length > 3 && void 0 !== arguments[3] ? arguments[3] : false;\r\n        var customFieldsData = this._getCustomFieldsData(data);\r\n        if (Object.keys(customFieldsData).length > 0) {\r\n            this.cache.saveData(key, customFieldsData, forceUpdateOnKeyExpire ? (key, data) => {\r\n                var dataOption = this._gantt[\"_\".concat(GANTT_TASKS, \"Option\")];\r\n                if (dataOption && data) {\r\n                    dataOption.update(key, data, (data, key) => {\r\n                        var updatedCustomFields = {};\r\n                        this.addCustomFieldsData(key, updatedCustomFields);\r\n                        dataOption._reloadDataSource().done(data => {\r\n                            this._gantt._ganttTreeList.updateDataSource(null !== data && void 0 !== data ? data : dataOption._dataSource, false, isCustomFieldsUpdateOnly)\r\n                        });\r\n                        var selectedRowKey = this._gantt.option(\"selectedRowKey\");\r\n                        this._gantt._ganttView._selectTask(selectedRowKey);\r\n                        this._gantt._actionsManager.raiseUpdatedAction(GANTT_TASKS, updatedCustomFields, key)\r\n                    })\r\n                }\r\n            } : null)\r\n        }\r\n    }\r\n    resetCustomFieldsDataCache(key) {\r\n        this.cache.resetCache(key)\r\n    }\r\n}\r\n"],"mappings":"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"},"metadata":{},"sourceType":"module"}