{"ast":null,"code":"import \"core-js/modules/es.error.cause.js\";\nimport { __extends } from \"tslib\";\nimport RRule from './rrule';\nimport dateutil from './dateutil';\nimport { includes } from './helpers';\nimport { iterSet } from './iterset';\nimport { rrulestr } from './rrulestr';\nimport { optionsToString } from './optionstostring';\n\nfunction createGetterSetter(fieldName) {\n  var _this = this;\n\n  return function (field) {\n    if (field !== undefined) {\n      _this[\"_\" + fieldName] = field;\n    }\n\n    if (_this[\"_\" + fieldName] !== undefined) {\n      return _this[\"_\" + fieldName];\n    }\n\n    for (var i = 0; i < _this._rrule.length; i++) {\n      var field_1 = _this._rrule[i].origOptions[fieldName];\n\n      if (field_1) {\n        return field_1;\n      }\n    }\n  };\n}\n\nvar RRuleSet =\n/** @class */\nfunction (_super) {\n  __extends(RRuleSet, _super);\n  /**\n   *\n   * @param {Boolean?} noCache\n   *  The same stratagy as RRule on cache, default to false\n   * @constructor\n   */\n\n\n  function RRuleSet(noCache) {\n    if (noCache === void 0) {\n      noCache = false;\n    }\n\n    var _this = _super.call(this, {}, noCache) || this;\n\n    _this.dtstart = createGetterSetter.apply(_this, ['dtstart']);\n    _this.tzid = createGetterSetter.apply(_this, ['tzid']);\n    _this._rrule = [];\n    _this._rdate = [];\n    _this._exrule = [];\n    _this._exdate = [];\n    return _this;\n  }\n\n  RRuleSet.prototype._iter = function (iterResult) {\n    return iterSet(iterResult, this._rrule, this._exrule, this._rdate, this._exdate, this.tzid());\n  };\n  /**\n   * Adds an RRule to the set\n   *\n   * @param {RRule}\n   */\n\n\n  RRuleSet.prototype.rrule = function (rrule) {\n    _addRule(rrule, this._rrule);\n  };\n  /**\n   * Adds an EXRULE to the set\n   *\n   * @param {RRule}\n   */\n\n\n  RRuleSet.prototype.exrule = function (rrule) {\n    _addRule(rrule, this._exrule);\n  };\n  /**\n   * Adds an RDate to the set\n   *\n   * @param {Date}\n   */\n\n\n  RRuleSet.prototype.rdate = function (date) {\n    _addDate(date, this._rdate);\n  };\n  /**\n   * Adds an EXDATE to the set\n   *\n   * @param {Date}\n   */\n\n\n  RRuleSet.prototype.exdate = function (date) {\n    _addDate(date, this._exdate);\n  };\n  /**\n   * Get list of included rrules in this recurrence set.\n   *\n   * @return List of rrules\n   */\n\n\n  RRuleSet.prototype.rrules = function () {\n    return this._rrule.map(function (e) {\n      return rrulestr(e.toString());\n    });\n  };\n  /**\n   * Get list of excluded rrules in this recurrence set.\n   *\n   * @return List of exrules\n   */\n\n\n  RRuleSet.prototype.exrules = function () {\n    return this._exrule.map(function (e) {\n      return rrulestr(e.toString());\n    });\n  };\n  /**\n   * Get list of included datetimes in this recurrence set.\n   *\n   * @return List of rdates\n   */\n\n\n  RRuleSet.prototype.rdates = function () {\n    return this._rdate.map(function (e) {\n      return new Date(e.getTime());\n    });\n  };\n  /**\n   * Get list of included datetimes in this recurrence set.\n   *\n   * @return List of exdates\n   */\n\n\n  RRuleSet.prototype.exdates = function () {\n    return this._exdate.map(function (e) {\n      return new Date(e.getTime());\n    });\n  };\n\n  RRuleSet.prototype.valueOf = function () {\n    var result = [];\n\n    if (!this._rrule.length && this._dtstart) {\n      result = result.concat(optionsToString({\n        dtstart: this._dtstart\n      }));\n    }\n\n    this._rrule.forEach(function (rrule) {\n      result = result.concat(rrule.toString().split('\\n'));\n    });\n\n    this._exrule.forEach(function (exrule) {\n      result = result.concat(exrule.toString().split('\\n').map(function (line) {\n        return line.replace(/^RRULE:/, 'EXRULE:');\n      }).filter(function (line) {\n        return !/^DTSTART/.test(line);\n      }));\n    });\n\n    if (this._rdate.length) {\n      result.push(rdatesToString('RDATE', this._rdate, this.tzid()));\n    }\n\n    if (this._exdate.length) {\n      result.push(rdatesToString('EXDATE', this._exdate, this.tzid()));\n    }\n\n    return result;\n  };\n  /**\n   * to generate recurrence field such as:\n   *   DTSTART:19970902T010000Z\n   *   RRULE:FREQ=YEARLY;COUNT=2;BYDAY=TU\n   *   RRULE:FREQ=YEARLY;COUNT=1;BYDAY=TH\n   */\n\n\n  RRuleSet.prototype.toString = function () {\n    return this.valueOf().join('\\n');\n  };\n  /**\n   * Create a new RRuleSet Object completely base on current instance\n   */\n\n\n  RRuleSet.prototype.clone = function () {\n    var rrs = new RRuleSet(!!this._cache);\n\n    this._rrule.forEach(function (rule) {\n      return rrs.rrule(rule.clone());\n    });\n\n    this._exrule.forEach(function (rule) {\n      return rrs.exrule(rule.clone());\n    });\n\n    this._rdate.forEach(function (date) {\n      return rrs.rdate(new Date(date.getTime()));\n    });\n\n    this._exdate.forEach(function (date) {\n      return rrs.exdate(new Date(date.getTime()));\n    });\n\n    return rrs;\n  };\n\n  return RRuleSet;\n}(RRule);\n\nexport default RRuleSet;\n\nfunction _addRule(rrule, collection) {\n  if (!(rrule instanceof RRule)) {\n    throw new TypeError(String(rrule) + ' is not RRule instance');\n  }\n\n  if (!includes(collection.map(String), String(rrule))) {\n    collection.push(rrule);\n  }\n}\n\nfunction _addDate(date, collection) {\n  if (!(date instanceof Date)) {\n    throw new TypeError(String(date) + ' is not Date instance');\n  }\n\n  if (!includes(collection.map(Number), Number(date))) {\n    collection.push(date);\n    dateutil.sort(collection);\n  }\n}\n\nfunction rdatesToString(param, rdates, tzid) {\n  var isUTC = !tzid || tzid.toUpperCase() === 'UTC';\n  var header = isUTC ? param + \":\" : param + \";TZID=\" + tzid + \":\";\n  var dateString = rdates.map(function (rdate) {\n    return dateutil.timeToUntilString(rdate.valueOf(), isUTC);\n  }).join(',');\n  return \"\" + header + dateString;\n}","map":{"version":3,"mappings":"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","names":["RRule","dateutil","includes","iterSet","rrulestr","optionsToString","createGetterSetter","fieldName","field","undefined","_this","i","_rrule","length","field_1","origOptions","__extends","noCache","_super","apply","_rdate","_exrule","_exdate","RRuleSet","iterResult","tzid","rrule","_addRule","date","_addDate","map","e","toString","Date","getTime","result","_dtstart","concat","dtstart","forEach","split","exrule","replace","filter","test","line","push","rdatesToString","valueOf","join","rrs","_cache","rule","clone","rdate","exdate","collection","TypeError","String","Number","sort","param","rdates","isUTC","toUpperCase","header","dateString","timeToUntilString"],"sourceRoot":"","sources":["../../../src/rruleset.ts"],"sourcesContent":[null]},"metadata":{},"sourceType":"module"}