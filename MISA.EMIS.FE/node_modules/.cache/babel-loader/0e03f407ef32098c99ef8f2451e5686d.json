{"ast":null,"code":"/**\r\n * DevExtreme (esm/viz/vector_map/map_layer.js)\r\n * Version: 22.1.4\r\n * Build date: Fri Jul 22 2022\r\n *\r\n * Copyright (c) 2012 - 2022 Developer Express Inc. ALL RIGHTS RESERVED\r\n * Read about DevExtreme licensing here: https://js.devexpress.com/Licensing/\r\n */\nimport { noop } from \"../../core/utils/common\";\nimport { extend } from \"../../core/utils/extend\";\nimport { each } from \"../../core/utils/iterator\";\nimport DataHelperMixin from \"../../data_helper\";\nimport { isFunction as _isFunction, isDefined as _isDefined } from \"../../core/utils/type\";\nimport { Deferred, when } from \"../../core/utils/deferred\";\nimport { parseScalar as _parseScalar, patchFontOptions as _patchFontOptions, normalizeEnum as _normalizeEnum } from \"../core/utils\";\nvar _noop = noop;\nvar _extend = extend;\nvar _each = each;\nvar _concat = Array.prototype.concat;\nvar TYPE_AREA = \"area\";\nvar TYPE_LINE = \"line\";\nvar TYPE_MARKER = \"marker\";\nvar STATE_DEFAULT = 0;\nvar STATE_HOVERED = 1;\nvar STATE_SELECTED = 2;\nvar STATE_TO_INDEX = [0, 1, 2, 2];\nvar TOLERANCE = 1;\nvar SELECTIONS = {\n  none: null,\n  single: -1,\n  multiple: NaN\n};\nvar _isArray = Array.isArray;\nvar _Number = Number;\nvar _String = String;\nvar _abs = Math.abs;\nvar _round = Math.round;\nvar _min = Math.min;\nvar _max = Math.max;\nvar _sqrt = Math.sqrt;\nexport function getMaxBound(arr) {\n  return arr.reduce((a, c) => c ? [_min(a[0], c[0]), _min(a[1], c[1]), _max(a[2], c[2]), _max(a[3], c[3])] : a, arr[0]);\n}\n\nfunction getSelection(selectionMode) {\n  var selection = _normalizeEnum(selectionMode);\n\n  selection = selection in SELECTIONS ? SELECTIONS[selection] : SELECTIONS.single;\n\n  if (null !== selection) {\n    selection = {\n      state: {},\n      single: selection\n    };\n  }\n\n  return selection;\n}\n\nfunction getName(opt, index) {\n  return (opt[index] || {}).name;\n}\n\nfunction EmptySource() {}\n\nEmptySource.prototype.count = function () {\n  return 0;\n};\n\nfunction ArraySource(raw) {\n  this.raw = raw;\n}\n\nArraySource.prototype = {\n  constructor: ArraySource,\n  count: function () {\n    return this.raw.length;\n  },\n  item: function (index) {\n    return this.raw[index];\n  },\n  geometry: function (item) {\n    return {\n      coordinates: item.coordinates\n    };\n  },\n  attributes: function (item) {\n    return item.attributes;\n  },\n  getBBox: function (index) {\n    return 0 === arguments.length ? void 0 : this.raw[index].bbox;\n  }\n};\n\nfunction GeoJsonSource(raw) {\n  this.raw = raw;\n}\n\nGeoJsonSource.prototype = {\n  constructor: GeoJsonSource,\n  count: function () {\n    return this.raw.features.length;\n  },\n  item: function (index) {\n    return this.raw.features[index];\n  },\n  geometry: function (item) {\n    return item.geometry;\n  },\n  attributes: function (item) {\n    return item.properties;\n  },\n  getBBox: function (index) {\n    return 0 === arguments.length ? this.raw.bbox : this.raw.features[index].bbox;\n  }\n};\n\nfunction isGeoJsonObject(obj) {\n  return _isArray(obj.features);\n}\n\nfunction unwrapFromDataSource(source) {\n  var sourceType;\n\n  if (source) {\n    if (isGeoJsonObject(source)) {\n      sourceType = GeoJsonSource;\n    } else if (1 === source.length && source[0] && isGeoJsonObject(source[0])) {\n      sourceType = GeoJsonSource;\n      source = source[0];\n    } else if (_isArray(source)) {\n      sourceType = ArraySource;\n    }\n  }\n\n  sourceType = sourceType || EmptySource;\n  return new sourceType(source);\n}\n\nfunction wrapToDataSource(option) {\n  return option ? isGeoJsonObject(option) ? [option] : option : [];\n}\n\nfunction customizeHandles(proxies, callback, widget) {\n  callback.call(widget, proxies);\n}\n\nfunction setAreaLabelVisibility(label) {\n  label.text.attr({\n    visibility: label.size[0] / label.spaceSize[0] < TOLERANCE && label.size[1] / label.spaceSize[1] < TOLERANCE ? null : \"hidden\"\n  });\n}\n\nfunction setLineLabelVisibility(label) {\n  label.text.attr({\n    visibility: label.size[0] / label.spaceSize[0] < TOLERANCE || label.size[1] / label.spaceSize[1] < TOLERANCE ? null : \"hidden\"\n  });\n}\n\nfunction getDataValue(proxy, dataField) {\n  return proxy.attribute(dataField);\n}\n\nvar TYPE_TO_TYPE_MAP = {\n  Point: TYPE_MARKER,\n  MultiPoint: TYPE_LINE,\n  LineString: TYPE_LINE,\n  MultiLineString: TYPE_LINE,\n  Polygon: TYPE_AREA,\n  MultiPolygon: TYPE_AREA\n};\n\nfunction pick(a, b) {\n  return void 0 !== a ? a : b;\n}\n\nfunction guessTypeByData(sample) {\n  var type = TYPE_TO_TYPE_MAP[sample.type];\n  var coordinates = sample.coordinates;\n\n  if (!type) {\n    if (\"number\" === typeof coordinates[0]) {\n      type = TYPE_MARKER;\n    } else if (\"number\" === typeof coordinates[0][0]) {\n      type = TYPE_LINE;\n    } else {\n      type = TYPE_AREA;\n    }\n  }\n\n  return type;\n}\n\nvar emptyStrategy = {\n  setup: _noop,\n  reset: _noop,\n  arrange: _noop,\n  updateGrouping: _noop,\n  getDefaultColor: _noop\n};\nvar strategiesByType = {};\nvar strategiesByGeometry = {};\nvar strategiesByElementType = {};\nvar groupByColor;\nvar groupBySize;\n\nvar selectStrategy = function (options, data) {\n  var type = _normalizeEnum(options.type);\n\n  var elementType = _normalizeEnum(options.elementType);\n\n  var sample;\n\n  var strategy = _extend({}, emptyStrategy);\n\n  if (data.count() > 0) {\n    sample = data.geometry(data.item(0));\n    type = strategiesByType[type] ? type : guessTypeByData(sample);\n\n    _extend(strategy, strategiesByType[type]);\n\n    strategy.fullType = strategy.type = type;\n\n    if (strategiesByGeometry[type]) {\n      _extend(strategy, strategiesByGeometry[type](sample));\n    }\n\n    if (strategiesByElementType[type]) {\n      elementType = strategiesByElementType[type][elementType] ? elementType : strategiesByElementType[type]._default;\n\n      _extend(strategy, strategiesByElementType[type][elementType]);\n\n      strategy.elementType = elementType;\n      strategy.fullType += \":\" + elementType;\n    }\n  }\n\n  return strategy;\n};\n\nfunction applyElementState(figure, styles, state, field) {\n  figure[field].attr(styles[field][state]);\n}\n\nstrategiesByType[TYPE_AREA] = {\n  projectLabel: projectAreaLabel,\n  transform: transformPointList,\n  transformLabel: transformAreaLabel,\n  draw: function (context, figure, data) {\n    figure.root = context.renderer.path([], \"area\").data(context.dataKey, data);\n  },\n  refresh: _noop,\n  getLabelOffset: function (label) {\n    setAreaLabelVisibility(label);\n    return [0, 0];\n  },\n  getStyles: function (settings) {\n    var color = settings.color || null;\n    var borderColor = settings.borderColor || null;\n    var borderWidth = pick(settings.borderWidth, null);\n    var opacity = pick(settings.opacity, null);\n    return {\n      root: [{\n        class: \"dxm-area\",\n        stroke: borderColor,\n        \"stroke-width\": borderWidth,\n        fill: color,\n        opacity: opacity\n      }, {\n        class: \"dxm-area dxm-area-hovered\",\n        stroke: settings.hoveredBorderColor || borderColor,\n        \"stroke-width\": pick(settings.hoveredBorderWidth, borderWidth),\n        fill: settings.hoveredColor || color,\n        opacity: pick(settings.hoveredOpacity, opacity)\n      }, {\n        class: \"dxm-area dxm-area-selected\",\n        stroke: settings.selectedBorderColor || borderColor,\n        \"stroke-width\": pick(settings.selectedBorderWidth, borderWidth),\n        fill: settings.selectedColor || color,\n        opacity: pick(settings.selectedOpacity, opacity)\n      }]\n    };\n  },\n  setState: function (figure, styles, state) {\n    applyElementState(figure, styles, state, \"root\");\n  },\n  hasLabelsGroup: true,\n  updateGrouping: function (context) {\n    groupByColor(context);\n  },\n  getDefaultColor: _noop\n};\nstrategiesByType[TYPE_LINE] = {\n  projectLabel: projectLineLabel,\n  transform: transformPointList,\n  transformLabel: transformLineLabel,\n  draw: function (context, figure, data) {\n    figure.root = context.renderer.path([], \"line\").data(context.dataKey, data);\n  },\n  refresh: _noop,\n  getLabelOffset: function (label) {\n    setLineLabelVisibility(label);\n    return [0, 0];\n  },\n  getStyles: function (settings) {\n    var color = settings.color || settings.borderColor || null;\n    var width = pick(settings.borderWidth, null);\n    var opacity = pick(settings.opacity, null);\n    return {\n      root: [{\n        class: \"dxm-line\",\n        stroke: color,\n        \"stroke-width\": width,\n        opacity: opacity\n      }, {\n        class: \"dxm-line dxm-line-hovered\",\n        stroke: settings.hoveredColor || settings.hoveredBorderColor || color,\n        \"stroke-width\": pick(settings.hoveredBorderWidth, width),\n        opacity: pick(settings.hoveredOpacity, opacity)\n      }, {\n        class: \"dxm-line dxm-line-selected\",\n        stroke: settings.selectedColor || settings.selectedBorderColor || color,\n        \"stroke-width\": pick(settings.selectedBorderWidth, width),\n        opacity: pick(settings.selectedOpacity, opacity)\n      }]\n    };\n  },\n  setState: function (figure, styles, state) {\n    applyElementState(figure, styles, state, \"root\");\n  },\n  hasLabelsGroup: true,\n  updateGrouping: function (context) {\n    groupByColor(context);\n  },\n  getDefaultColor: _noop\n};\nstrategiesByType[TYPE_MARKER] = {\n  project: projectPoint,\n  transform: transformPoint,\n  draw: function (context, figure, data) {\n    figure.root = context.renderer.g();\n\n    this._draw(context, figure, data);\n  },\n  refresh: _noop,\n  hasLabelsGroup: false,\n  getLabelOffset: function (label, settings) {\n    return [_round((label.size[0] + _max(settings.size || 0, 0)) / 2) + 2, 0];\n  },\n  getStyles: function (settings) {\n    var styles = {\n      root: [{\n        class: \"dxm-marker\"\n      }, {\n        class: \"dxm-marker dxm-marker-hovered\"\n      }, {\n        class: \"dxm-marker dxm-marker-selected\"\n      }]\n    };\n\n    this._getStyles(styles, settings);\n\n    return styles;\n  },\n  setState: function (figure, styles, state) {\n    applyElementState(figure, styles, state, \"root\");\n\n    this._setState(figure, styles, state);\n  },\n  updateGrouping: function (context) {\n    groupByColor(context);\n    groupBySize(context);\n  },\n  getDefaultColor: function (ctx, palette) {\n    return ctx.params.themeManager.getAccentColor(palette);\n  }\n};\n\nstrategiesByGeometry[TYPE_AREA] = function (sample) {\n  return {\n    project: (projection, coordinates) => coordinates[0] && coordinates[0][0] && coordinates[0][0][0] && \"number\" === typeof coordinates[0][0][0][0] ? projectMultiPolygon(projection, coordinates) : projectPolygon(projection, coordinates)\n  };\n};\n\nstrategiesByGeometry[TYPE_LINE] = function (sample) {\n  var coordinates = sample.coordinates;\n  return {\n    project: coordinates[0] && coordinates[0][0] && \"number\" === typeof coordinates[0][0][0] ? projectPolygon : projectLineString\n  };\n};\n\nstrategiesByElementType[TYPE_MARKER] = {\n  _default: \"dot\",\n  dot: {\n    setup: function (context) {\n      context.filter = context.renderer.shadowFilter(\"-40%\", \"-40%\", \"180%\", \"200%\", 0, 1, 1, \"#000000\", .2);\n    },\n    reset: function (context) {\n      context.filter.dispose();\n      context.filter = null;\n    },\n    _draw: function (ctx, figure, data) {\n      figure.back = ctx.renderer.circle().sharp().data(ctx.dataKey, data).append(figure.root);\n      figure.dot = ctx.renderer.circle().sharp().data(ctx.dataKey, data).append(figure.root);\n    },\n    refresh: function (ctx, figure, data, proxy, settings) {\n      figure.dot.attr({\n        filter: settings.shadow ? ctx.filter.id : null\n      });\n    },\n    _getStyles: function (styles, style) {\n      var size = style.size > 0 ? _Number(style.size) : 0;\n      var hoveredSize = size;\n      var selectedSize = size + (style.selectedStep > 0 ? _Number(style.selectedStep) : 0);\n      var hoveredBackSize = hoveredSize + (style.backStep > 0 ? _Number(style.backStep) : 0);\n      var selectedBackSize = selectedSize + (style.backStep > 0 ? _Number(style.backStep) : 0);\n      var color = style.color || null;\n      var borderColor = style.borderColor || null;\n      var borderWidth = pick(style.borderWidth, null);\n      var opacity = pick(style.opacity, null);\n      var backColor = style.backColor || null;\n      var backOpacity = pick(style.backOpacity, null);\n      styles.dot = [{\n        r: size / 2,\n        stroke: borderColor,\n        \"stroke-width\": borderWidth,\n        fill: color,\n        opacity: opacity\n      }, {\n        r: hoveredSize / 2,\n        stroke: style.hoveredBorderColor || borderColor,\n        \"stroke-width\": pick(style.hoveredBorderWidth, borderWidth),\n        fill: style.hoveredColor || color,\n        opacity: pick(style.hoveredOpacity, opacity)\n      }, {\n        r: selectedSize / 2,\n        stroke: style.selectedBorderColor || borderColor,\n        \"stroke-width\": pick(style.selectedBorderWidth, borderWidth),\n        fill: style.selectedColor || color,\n        opacity: pick(style.selectedOpacity, opacity)\n      }];\n      styles.back = [{\n        r: size / 2,\n        stroke: \"none\",\n        \"stroke-width\": 0,\n        fill: backColor,\n        opacity: backOpacity\n      }, {\n        r: hoveredBackSize / 2,\n        stroke: \"none\",\n        \"stroke-width\": 0,\n        fill: backColor,\n        opacity: backOpacity\n      }, {\n        r: selectedBackSize / 2,\n        stroke: \"none\",\n        \"stroke-width\": 0,\n        fill: backColor,\n        opacity: backOpacity\n      }];\n    },\n    _setState: function (figure, styles, state) {\n      applyElementState(figure, styles, state, \"dot\");\n      applyElementState(figure, styles, state, \"back\");\n    }\n  },\n  bubble: {\n    _draw: function (ctx, figure, data) {\n      figure.bubble = ctx.renderer.circle().sharp().data(ctx.dataKey, data).append(figure.root);\n    },\n    refresh: function (ctx, figure, data, proxy, settings) {\n      figure.bubble.attr({\n        r: settings.size / 2\n      });\n    },\n    _getStyles: function (styles, style) {\n      var color = style.color || null;\n      var borderColor = style.borderColor || null;\n      var borderWidth = pick(style.borderWidth, null);\n      var opacity = pick(style.opacity, null);\n      styles.bubble = [{\n        stroke: borderColor,\n        \"stroke-width\": borderWidth,\n        fill: color,\n        opacity: opacity\n      }, {\n        stroke: style.hoveredBorderColor || borderColor,\n        \"stroke-width\": pick(style.hoveredBorderWidth, borderWidth),\n        fill: style.hoveredColor || style.color,\n        opacity: pick(style.hoveredOpacity, opacity)\n      }, {\n        stroke: style.selectedBorderColor || borderColor,\n        \"stroke-width\": pick(style.selectedBorderWidth, borderWidth),\n        fill: style.selectedColor || style.color,\n        opacity: pick(style.selectedOpacity, opacity)\n      }];\n    },\n    _setState: function (figure, styles, state) {\n      applyElementState(figure, styles, state, \"bubble\");\n    },\n    arrange: function (context, handles) {\n      var values = [];\n      var i;\n      var ii = values.length = handles.length;\n      var settings = context.settings;\n      var dataField = settings.dataField;\n      var minSize = settings.minSize > 0 ? _Number(settings.minSize) : 0;\n      var maxSize = settings.maxSize > minSize ? _Number(settings.maxSize) : minSize;\n\n      if (settings.sizeGroups) {\n        return;\n      }\n\n      for (i = 0; i < ii; ++i) {\n        values[i] = _max(getDataValue(handles[i].proxy, dataField) || 0, 0);\n      }\n\n      var minValue = _min.apply(null, values);\n\n      var maxValue = _max.apply(null, values);\n\n      var deltaValue = maxValue - minValue || 1;\n      var deltaSize = maxSize - minSize;\n\n      for (i = 0; i < ii; ++i) {\n        handles[i]._settings.size = minSize + deltaSize * (values[i] - minValue) / deltaValue;\n      }\n    },\n    updateGrouping: function (context) {\n      var dataField = context.settings.dataField;\n      strategiesByType[TYPE_MARKER].updateGrouping(context);\n      groupBySize(context, function (proxy) {\n        return getDataValue(proxy, dataField);\n      });\n    }\n  },\n  pie: {\n    _draw: function (ctx, figure, data) {\n      figure.pie = ctx.renderer.g().append(figure.root);\n      figure.border = ctx.renderer.circle().sharp().data(ctx.dataKey, data).append(figure.root);\n    },\n    refresh: function (ctx, figure, data, proxy, settings) {\n      var values = getDataValue(proxy, ctx.settings.dataField) || [];\n      var colors = settings._colors;\n      var sum = 0;\n      var pie = figure.pie;\n      var renderer = ctx.renderer;\n      var dataKey = ctx.dataKey;\n      var r = (settings.size > 0 ? _Number(settings.size) : 0) / 2;\n      var start = 90;\n      var end = start;\n      var zeroSum = false;\n      sum = values.reduce(function (total, item) {\n        return total + (item || 0);\n      }, 0);\n\n      if (0 === sum) {\n        zeroSum = true;\n        sum = 360 / values.length;\n      }\n\n      values.forEach(function (item, i) {\n        start = end;\n        end += zeroSum ? sum : (item || 0) / sum * 360;\n        renderer.arc(0, 0, 0, r, start, end).attr({\n          \"stroke-linejoin\": \"round\",\n          fill: colors[i]\n        }).data(dataKey, data).append(pie);\n      });\n      figure.border.attr({\n        r: r\n      });\n    },\n    _getStyles: function (styles, style) {\n      var opacity = pick(style.opacity, null);\n      var borderColor = style.borderColor || null;\n      var borderWidth = pick(style.borderWidth, null);\n      styles.pie = [{\n        opacity: opacity\n      }, {\n        opacity: pick(style.hoveredOpacity, opacity)\n      }, {\n        opacity: pick(style.selectedOpacity, opacity)\n      }];\n      styles.border = [{\n        stroke: borderColor,\n        \"stroke-width\": borderWidth\n      }, {\n        stroke: style.hoveredBorderColor || borderColor,\n        \"stroke-width\": pick(style.hoveredBorderWidth, borderWidth)\n      }, {\n        stroke: style.selectedBorderColor || borderColor,\n        \"stroke-width\": pick(style.selectedBorderWidth, borderWidth)\n      }];\n    },\n    _setState: function (figure, styles, state) {\n      applyElementState(figure, styles, state, \"pie\");\n      applyElementState(figure, styles, state, \"border\");\n    },\n    arrange: function (context, handles) {\n      var i;\n      var ii = handles.length;\n      var dataField = context.settings.dataField;\n      var values;\n      var count = 0;\n      var palette;\n\n      for (i = 0; i < ii; ++i) {\n        values = getDataValue(handles[i].proxy, dataField);\n\n        if (values && values.length > count) {\n          count = values.length;\n        }\n      }\n\n      if (count > 0) {\n        palette = context.params.themeManager.createPalette(context.settings.palette, {\n          useHighlight: true,\n          extensionMode: \"alternate\"\n        });\n        values = palette.generateColors(count);\n        context.settings._colors = values;\n        context.grouping.color = {\n          callback: _noop,\n          field: \"\",\n          partition: [],\n          values: []\n        };\n        context.params.dataExchanger.set(context.name, \"color\", {\n          partition: [],\n          values: values\n        });\n      }\n    }\n  },\n  image: {\n    _draw: function (ctx, figure, data) {\n      figure.image = ctx.renderer.image(null, null, null, null, null, \"center\").attr({\n        \"pointer-events\": \"visible\"\n      }).data(ctx.dataKey, data).append(figure.root);\n    },\n    refresh: function (ctx, figure, data, proxy) {\n      figure.image.attr({\n        href: getDataValue(proxy, ctx.settings.dataField)\n      });\n    },\n    _getStyles: function (styles, style) {\n      var size = style.size > 0 ? _Number(style.size) : 0;\n      var hoveredSize = size + (style.hoveredStep > 0 ? _Number(style.hoveredStep) : 0);\n      var selectedSize = size + (style.selectedStep > 0 ? _Number(style.selectedStep) : 0);\n      var opacity = pick(style.opacity, null);\n      styles.image = [{\n        x: -size / 2,\n        y: -size / 2,\n        width: size,\n        height: size,\n        opacity: opacity\n      }, {\n        x: -hoveredSize / 2,\n        y: -hoveredSize / 2,\n        width: hoveredSize,\n        height: hoveredSize,\n        opacity: pick(style.hoveredOpacity, opacity)\n      }, {\n        x: -selectedSize / 2,\n        y: -selectedSize / 2,\n        width: selectedSize,\n        height: selectedSize,\n        opacity: pick(style.selectedOpacity, opacity)\n      }];\n    },\n    _setState: function (figure, styles, state) {\n      applyElementState(figure, styles, state, \"image\");\n    }\n  }\n};\n\nfunction projectPoint(projection, coordinates) {\n  return projection.project(coordinates);\n}\n\nfunction projectPointList(projection, coordinates) {\n  var output = [];\n  var i;\n  var ii = output.length = coordinates.length;\n\n  for (i = 0; i < ii; ++i) {\n    output[i] = projection.project(coordinates[i]);\n  }\n\n  return output;\n}\n\nfunction projectLineString(projection, coordinates) {\n  return [projectPointList(projection, coordinates)];\n}\n\nfunction projectPolygon(projection, coordinates) {\n  var output = [];\n  var i;\n  var ii = output.length = coordinates.length;\n\n  for (i = 0; i < ii; ++i) {\n    output[i] = projectPointList(projection, coordinates[i]);\n  }\n\n  return output;\n}\n\nfunction projectMultiPolygon(projection, coordinates) {\n  var output = [];\n  var i;\n  var ii = output.length = coordinates.length;\n\n  for (i = 0; i < ii; ++i) {\n    output[i] = projectPolygon(projection, coordinates[i]);\n  }\n\n  return _concat.apply([], output);\n}\n\nfunction transformPoint(content, projection, coordinates) {\n  var data = projection.transform(coordinates);\n  content.root.attr({\n    translateX: data[0],\n    translateY: data[1]\n  });\n}\n\nfunction transformList(projection, coordinates) {\n  var output = [];\n  var i;\n  var ii = coordinates.length;\n  var item;\n  var k = 0;\n  output.length = 2 * ii;\n\n  for (i = 0; i < ii; ++i) {\n    item = projection.transform(coordinates[i]);\n    output[k++] = item[0];\n    output[k++] = item[1];\n  }\n\n  return output;\n}\n\nfunction transformPointList(content, projection, coordinates) {\n  var output = [];\n  var i;\n  var ii = output.length = coordinates.length;\n\n  for (i = 0; i < ii; ++i) {\n    output[i] = transformList(projection, coordinates[i]);\n  }\n\n  content.root.attr({\n    points: output\n  });\n}\n\nfunction transformAreaLabel(label, projection, coordinates) {\n  var data = projection.transform(coordinates[0]);\n  label.spaceSize = projection.getSquareSize(coordinates[1]);\n  label.text.attr({\n    translateX: data[0],\n    translateY: data[1]\n  });\n  setAreaLabelVisibility(label);\n}\n\nfunction transformLineLabel(label, projection, coordinates) {\n  var data = projection.transform(coordinates[0]);\n  label.spaceSize = projection.getSquareSize(coordinates[1]);\n  label.text.attr({\n    translateX: data[0],\n    translateY: data[1]\n  });\n  setLineLabelVisibility(label);\n}\n\nfunction getItemSettings(context, proxy, settings) {\n  var result = combineSettings(context.settings, settings);\n  applyGrouping(context.grouping, proxy, result);\n\n  if (void 0 === settings.color && settings.paletteIndex >= 0) {\n    result.color = result._colors[settings.paletteIndex];\n  }\n\n  return result;\n}\n\nfunction applyGrouping(grouping, proxy, settings) {\n  _each(grouping, function (name, data) {\n    var index = findGroupingIndex(data.callback(proxy, data.field), data.partition);\n\n    if (index >= 0) {\n      settings[name] = data.values[index];\n    }\n  });\n}\n\nfunction findGroupingIndex(value, partition) {\n  var start = 0;\n  var end = partition.length - 1;\n  var index = -1;\n  var middle;\n\n  if (partition[start] <= value && value <= partition[end]) {\n    if (value === partition[end]) {\n      index = end - 1;\n    } else {\n      while (end - start > 1) {\n        middle = start + end >> 1;\n\n        if (value < partition[middle]) {\n          end = middle;\n        } else {\n          start = middle;\n        }\n      }\n\n      index = start;\n    }\n  }\n\n  return index;\n}\n\nfunction raiseChanged(context, handle, state, name) {\n  context.params.eventTrigger(name, {\n    target: handle.proxy,\n    state: state\n  });\n}\n\nfunction combineSettings(common, partial) {\n  var obj = _extend({}, common, partial);\n\n  obj.label = _extend({}, common.label, obj.label);\n  obj.label.font = _extend({}, common.label.font, obj.label.font);\n  return obj;\n}\n\nfunction processCommonSettings(context, options) {\n  var themeManager = context.params.themeManager;\n  var strategy = context.str;\n  var settings = combineSettings(_extend({\n    label: {},\n    color: strategy.getDefaultColor(context, options.palette)\n  }, themeManager.theme(\"layer:\" + strategy.fullType)), options);\n  var colors;\n  var i;\n  var palette;\n\n  if (settings.paletteSize > 0) {\n    palette = themeManager.createDiscretePalette(settings.palette, settings.paletteSize);\n\n    for (i = 0, colors = []; i < settings.paletteSize; ++i) {\n      colors.push(palette.getColor(i));\n    }\n\n    settings._colors = colors;\n  }\n\n  return settings;\n}\n\nfunction valueCallback(proxy, dataField) {\n  return proxy.attribute(dataField);\n}\n\nvar performGrouping = function (context, partition, settingField, dataField, valuesCallback) {\n  var values;\n\n  if (dataField && partition && partition.length > 1) {\n    values = valuesCallback(partition.length - 1);\n    context.grouping[settingField] = {\n      callback: _isFunction(dataField) ? dataField : valueCallback,\n      field: dataField,\n      partition: partition,\n      values: values\n    };\n    context.params.dataExchanger.set(context.name, settingField, {\n      partition: partition,\n      values: values,\n      defaultColor: context.settings.color\n    });\n  }\n};\n\nfunction dropGrouping(context) {\n  var name = context.name;\n  var dataExchanger = context.params.dataExchanger;\n\n  _each(context.grouping, function (field) {\n    dataExchanger.set(name, field, null);\n  });\n\n  context.grouping = {};\n}\n\ngroupByColor = function (context) {\n  performGrouping(context, context.settings.colorGroups, \"color\", context.settings.colorGroupingField, function (count) {\n    var _palette = context.params.themeManager.createDiscretePalette(context.settings.palette, count);\n\n    var i;\n    var list = [];\n\n    for (i = 0; i < count; ++i) {\n      list.push(_palette.getColor(i));\n    }\n\n    return list;\n  });\n};\n\ngroupBySize = function (context, valueCallback) {\n  var settings = context.settings;\n  performGrouping(context, settings.sizeGroups, \"size\", valueCallback || settings.sizeGroupingField, function (count) {\n    var minSize = settings.minSize > 0 ? _Number(settings.minSize) : 0;\n    var maxSize = settings.maxSize >= minSize ? _Number(settings.maxSize) : 0;\n    var i = 0;\n    var sizes = [];\n\n    if (count > 1) {\n      for (i = 0; i < count; ++i) {\n        sizes.push((minSize * (count - i - 1) + maxSize * i) / (count - 1));\n      }\n    } else if (1 === count) {\n      sizes.push((minSize + maxSize) / 2);\n    }\n\n    return sizes;\n  });\n};\n\nfunction setFlag(flags, flag, state) {\n  if (state) {\n    flags |= flag;\n  } else {\n    flags &= ~flag;\n  }\n\n  return flags;\n}\n\nfunction hasFlag(flags, flag) {\n  return !!(flags & flag);\n}\n\nfunction createLayerProxy(layer, name, index) {\n  var proxy = {\n    index: index,\n    name: name,\n    getElements: function () {\n      return layer.getProxies();\n    },\n    clearSelection: function (_noEvent) {\n      layer.clearSelection(_noEvent);\n      return proxy;\n    },\n    getDataSource: function () {\n      return layer.getDataSource();\n    },\n    getBounds: () => layer.getBounds()\n  };\n  return proxy;\n}\n\nvar MapLayerElement;\n\nvar MapLayer = function (params, container, name, index) {\n  this._params = params;\n\n  this._onProjection();\n\n  this.proxy = createLayerProxy(this, name, index);\n  this._context = {\n    name: name,\n    layer: this.proxy,\n    renderer: params.renderer,\n    projection: params.projection,\n    params: params,\n    dataKey: params.dataKey,\n    str: emptyStrategy,\n    hover: false,\n    selection: null,\n    grouping: {},\n    root: params.renderer.g().attr({\n      class: \"dxm-layer\"\n    }).linkOn(container, name).linkAppend()\n  };\n  this._container = container;\n  this._options = {};\n  this._handles = [];\n  this._data = new EmptySource();\n  this._dataSourceLoaded = null;\n};\n\nMapLayer.prototype = _extend({\n  constructor: MapLayer,\n\n  getDataReadyCallback() {\n    return this._dataSourceLoaded;\n  },\n\n  _onProjection: function () {\n    var that = this;\n    that._removeHandlers = that._params.projection.on({\n      engine: function () {\n        that._project();\n      },\n      screen: function () {\n        that._transform();\n      },\n      center: function () {\n        that._transformCore();\n      },\n      zoom: function () {\n        that._transform();\n      }\n    });\n  },\n\n  getData() {\n    return this._data;\n  },\n\n  _dataSourceLoadErrorHandler: function () {\n    this._dataSourceChangedHandler();\n  },\n  _dataSourceChangedHandler: function () {\n    this._data = unwrapFromDataSource(this._dataSource && this._dataSource.items());\n\n    this._update(true);\n  },\n  _dataSourceOptions: function () {\n    return {\n      paginate: false\n    };\n  },\n  _getSpecificDataSourceOption: function () {\n    return this._specificDataSourceOption;\n  },\n  _normalizeDataSource: function (dataSource) {\n    var store = dataSource.store();\n\n    if (\"raw\" === store._loadMode) {\n      store._loadMode = void 0;\n    }\n\n    return dataSource;\n  },\n  _offProjection: function () {\n    this._removeHandlers();\n\n    this._removeHandlers = null;\n  },\n  dispose: function () {\n    this._disposeDataSource();\n\n    this._destroyHandles();\n\n    dropGrouping(this._context);\n\n    this._context.root.linkRemove().linkOff();\n\n    this._context.labelRoot && this._context.labelRoot.linkRemove().linkOff();\n\n    this._context.str.reset(this._context);\n\n    this._offProjection();\n\n    this._params = this._container = this._context = this.proxy = null;\n    return this;\n  },\n  setOptions: function (options) {\n    options = this._options = options || {};\n    this._dataSourceLoaded = new Deferred();\n\n    if (\"dataSource\" in options && options.dataSource !== this._options_dataSource) {\n      this._options_dataSource = options.dataSource;\n\n      this._params.notifyDirty();\n\n      this._specificDataSourceOption = wrapToDataSource(options.dataSource);\n\n      this._refreshDataSource();\n    } else if (this._data.count() > 0) {\n      this._params.notifyDirty();\n\n      this._update(void 0 !== options.type && options.type !== this._context.str.type || void 0 !== options.elementType && options.elementType !== this._context.str.elementType);\n    }\n\n    this._transformCore();\n  },\n  _update: function (isContextChanged) {\n    var context = this._context;\n\n    if (isContextChanged) {\n      context.str.reset(context);\n      context.root.clear();\n      context.labelRoot && context.labelRoot.clear();\n\n      this._params.tracker.reset();\n\n      this._destroyHandles();\n\n      context.str = selectStrategy(this._options, this._data);\n      context.str.setup(context);\n      this.proxy.type = context.str.type;\n      this.proxy.elementType = context.str.elementType;\n    }\n\n    context.settings = processCommonSettings(context, this._options);\n    context.hasSeparateLabel = !!(context.settings.label.enabled && context.str.hasLabelsGroup);\n    context.hover = !!_parseScalar(context.settings.hoverEnabled, true);\n\n    if (context.selection) {\n      _each(context.selection.state, function (_, handle) {\n        handle && handle.resetSelected();\n      });\n    }\n\n    context.selection = getSelection(context.settings.selectionMode);\n\n    if (context.hasSeparateLabel) {\n      if (!context.labelRoot) {\n        context.labelRoot = context.renderer.g().attr({\n          class: \"dxm-layer-labels\"\n        }).linkOn(this._container, {\n          name: context.name + \"-labels\",\n          after: context.name\n        }).linkAppend();\n\n        this._transformCore();\n      }\n    } else if (context.labelRoot) {\n      context.labelRoot.linkRemove().linkOff();\n      context.labelRoot = null;\n    }\n\n    if (isContextChanged) {\n      this._createHandles();\n    }\n\n    dropGrouping(context);\n    context.str.arrange(context, this._handles);\n    context.str.updateGrouping(context);\n\n    this._updateHandles();\n\n    this._params.notifyReady();\n\n    if (this._dataSourceLoaded) {\n      this._dataSourceLoaded.resolve();\n\n      this._dataSourceLoaded = null;\n    } else {\n      this._params.dataReady();\n    }\n  },\n\n  getBounds() {\n    return getMaxBound(this._handles.map(_ref => {\n      var {\n        proxy: proxy\n      } = _ref;\n      return proxy.coordinates().map(coords => {\n        if (!_isArray(coords)) {\n          return;\n        }\n\n        var coordsToBoundsSearch = _isArray(coords[0][0]) ? coords.reduce((ac, val) => ac.concat(val), []) : coords;\n        var initValue = coordsToBoundsSearch[0];\n        return coordsToBoundsSearch.reduce((min, c) => [_min(min[0], c[0]), _min(min[1], c[1]), _max(min[2], c[0]), _max(min[3], c[1])], [initValue[0], initValue[1], initValue[0], initValue[1]]);\n      });\n    }).map(getMaxBound));\n  },\n\n  _destroyHandles() {\n    this._handles.forEach(h => h.dispose());\n\n    if (this._context.selection) {\n      this._context.selection.state = {};\n    }\n\n    this._handles = [];\n  },\n\n  _createHandles: function () {\n    var handles = this._handles = [];\n    var data = this._data;\n    var i;\n    var ii = handles.length = data.count();\n    var context = this._context;\n    var geometry = data.geometry;\n    var attributes = data.attributes;\n    var handle;\n    var dataItem;\n\n    for (i = 0; i < ii; ++i) {\n      dataItem = data.item(i);\n      handles[i] = new MapLayerElement(context, i, geometry(dataItem), attributes(dataItem));\n    }\n\n    _isFunction(this._options.customize) && customizeHandles(this.getProxies(), this._options.customize, this._params.widget);\n\n    for (i = 0; i < ii; ++i) {\n      handle = handles[i];\n      handle.project();\n      handle.draw();\n      handle.transform();\n    }\n\n    if (context.selection) {\n      _each(context.selection.state, function (_, handle) {\n        handle && handle.restoreSelected();\n      });\n    }\n  },\n  _updateHandles: function () {\n    var handles = this._handles;\n    var i;\n    var ii = handles.length;\n\n    for (i = 0; i < ii; ++i) {\n      handles[i].refresh();\n    }\n\n    if (this._context.settings.label.enabled) {\n      for (i = 0; i < ii; ++i) {\n        handles[i].measureLabel();\n      }\n\n      for (i = 0; i < ii; ++i) {\n        handles[i].adjustLabel();\n      }\n    }\n  },\n  _transformCore: function () {\n    var transform = this._params.projection.getTransform();\n\n    this._context.root.attr(transform);\n\n    this._context.labelRoot && this._context.labelRoot.attr(transform);\n  },\n  _project: function () {\n    var handles = this._handles;\n    var i;\n    var ii = handles.length;\n\n    for (i = 0; i < ii; ++i) {\n      handles[i].project();\n    }\n  },\n  _transform: function () {\n    var handles = this._handles;\n    var i;\n    var ii = handles.length;\n\n    this._transformCore();\n\n    for (i = 0; i < ii; ++i) {\n      handles[i].transform();\n    }\n  },\n\n  getProxies() {\n    return this._handles.map(p => p.proxy);\n  },\n\n  getProxy: function (index) {\n    return this._handles[index].proxy;\n  },\n  raiseClick: function (i, dxEvent) {\n    this._params.eventTrigger(\"click\", {\n      target: this._handles[i].proxy,\n      event: dxEvent\n    });\n  },\n  hoverItem: function (i, state) {\n    this._handles[i].setHovered(state);\n  },\n  selectItem: function (i, state, _noEvent) {\n    this._handles[i].setSelected(state, _noEvent);\n  },\n  clearSelection: function () {\n    var selection = this._context.selection;\n\n    if (selection) {\n      _each(selection.state, function (_, handle) {\n        handle && handle.setSelected(false);\n      });\n\n      selection.state = {};\n    }\n  }\n}, DataHelperMixin);\n\nfunction createProxy(handle, coords, attrs) {\n  var proxy = {\n    coordinates: function () {\n      return coords;\n    },\n    attribute: function (name, value) {\n      if (arguments.length > 1) {\n        attrs[name] = value;\n        return proxy;\n      } else {\n        return arguments.length > 0 ? attrs[name] : attrs;\n      }\n    },\n    selected: function (state, _noEvent) {\n      if (arguments.length > 0) {\n        handle.setSelected(state, _noEvent);\n        return proxy;\n      } else {\n        return handle.isSelected();\n      }\n    },\n    applySettings: function (settings) {\n      handle.update(settings);\n      return proxy;\n    }\n  };\n  return proxy;\n}\n\nMapLayerElement = function (context, index, geometry, attributes) {\n  var proxy = this.proxy = createProxy(this, geometry.coordinates, _extend({}, attributes));\n  this._ctx = context;\n  this._index = index;\n  this._fig = this._label = null;\n  this._state = STATE_DEFAULT;\n  this._coordinates = geometry.coordinates;\n  this._settings = {\n    label: {}\n  };\n  proxy.index = index;\n  proxy.layer = context.layer;\n  this._data = {\n    name: context.name,\n    index: index\n  };\n};\n\nMapLayerElement.prototype = {\n  constructor: MapLayerElement,\n  dispose: function () {\n    this._ctx = this.proxy = this._settings = this._fig = this._label = this.data = null;\n    return this;\n  },\n  project: function () {\n    var context = this._ctx;\n    this._projection = context.str.project(context.projection, this._coordinates);\n\n    if (context.hasSeparateLabel && this._label) {\n      this._projectLabel();\n    }\n  },\n  _projectLabel: function () {\n    this._labelProjection = this._ctx.str.projectLabel(this._projection);\n  },\n  draw: function () {\n    var context = this._ctx;\n    context.str.draw(context, this._fig = {}, this._data);\n\n    this._fig.root.append(context.root);\n  },\n  transform: function () {\n    var context = this._ctx;\n    context.str.transform(this._fig, context.projection, this._projection);\n\n    if (context.hasSeparateLabel && this._label) {\n      this._transformLabel();\n    }\n  },\n  _transformLabel: function () {\n    this._ctx.str.transformLabel(this._label, this._ctx.projection, this._labelProjection);\n  },\n  refresh: function () {\n    var strategy = this._ctx.str;\n    var settings = getItemSettings(this._ctx, this.proxy, this._settings);\n    this._styles = strategy.getStyles(settings);\n    strategy.refresh(this._ctx, this._fig, this._data, this.proxy, settings);\n\n    this._refreshLabel(settings);\n\n    this._setState();\n  },\n  _refreshLabel: function (settings) {\n    var context = this._ctx;\n    var labelSettings = settings.label;\n    var label = this._label;\n\n    if (context.settings.label.enabled) {\n      if (!label) {\n        label = this._label = {\n          root: context.labelRoot || this._fig.root,\n          text: context.renderer.text().attr({\n            class: \"dxm-label\"\n          }),\n          size: [0, 0]\n        };\n\n        if (context.hasSeparateLabel) {\n          this._projectLabel();\n\n          this._transformLabel();\n        }\n      }\n\n      label.value = _String(this.proxy.text || this.proxy.attribute(labelSettings.dataField) || \"\");\n\n      if (label.value) {\n        label.text.attr({\n          text: label.value,\n          x: 0,\n          y: 0\n        }).css(_patchFontOptions(labelSettings.font)).attr({\n          align: \"center\",\n          stroke: labelSettings.stroke,\n          \"stroke-width\": labelSettings[\"stroke-width\"],\n          \"stroke-opacity\": labelSettings[\"stroke-opacity\"]\n        }).data(context.dataKey, this._data).append(label.root);\n        label.settings = settings;\n      }\n    } else if (label) {\n      label.text.remove();\n      this._label = null;\n    }\n  },\n  measureLabel: function () {\n    var label = this._label;\n    var bBox;\n\n    if (label.value) {\n      bBox = label.text.getBBox();\n      label.size = [bBox.width, bBox.height, -bBox.y - bBox.height / 2];\n    }\n  },\n  adjustLabel: function () {\n    var label = this._label;\n    var offset;\n\n    if (label.value) {\n      offset = this._ctx.str.getLabelOffset(label, label.settings);\n      label.settings = null;\n      label.text.attr({\n        x: offset[0],\n        y: offset[1] + label.size[2]\n      });\n    }\n  },\n  update: function (settings) {\n    this._settings = combineSettings(this._settings, settings);\n\n    if (this._fig) {\n      this.refresh();\n\n      if (this._label && this._label.value) {\n        this.measureLabel();\n        this.adjustLabel();\n      }\n    }\n  },\n  _setState: function () {\n    this._ctx.str.setState(this._fig, this._styles, STATE_TO_INDEX[this._state]);\n  },\n  _setForeground: function () {\n    var root = this._fig.root;\n    this._state ? root.toForeground() : root.toBackground();\n  },\n  setHovered: function (state) {\n    var currentState = hasFlag(this._state, STATE_HOVERED);\n    var newState = !!state;\n\n    if (this._ctx.hover && currentState !== newState) {\n      this._state = setFlag(this._state, STATE_HOVERED, newState);\n\n      this._setState();\n\n      this._setForeground();\n\n      raiseChanged(this._ctx, this, newState, \"hoverChanged\");\n    }\n\n    return this;\n  },\n  setSelected: function (state, _noEvent) {\n    var currentState = hasFlag(this._state, STATE_SELECTED);\n    var newState = !!state;\n    var selection = this._ctx.selection;\n    var tmp;\n\n    if (selection && currentState !== newState) {\n      this._state = setFlag(this._state, STATE_SELECTED, newState);\n      tmp = selection.state[selection.single];\n      selection.state[selection.single] = null;\n\n      if (tmp) {\n        tmp.setSelected(false);\n      }\n\n      selection.state[selection.single || this._index] = state ? this : null;\n\n      if (this._fig) {\n        this._setState();\n\n        this._setForeground();\n\n        if (!_noEvent) {\n          raiseChanged(this._ctx, this, newState, \"selectionChanged\");\n        }\n      }\n    }\n  },\n  isSelected: function () {\n    return hasFlag(this._state, STATE_SELECTED);\n  },\n  resetSelected: function () {\n    this._state = setFlag(this._state, STATE_SELECTED, false);\n  },\n  restoreSelected: function () {\n    this._fig.root.toForeground();\n  }\n};\n\nfunction calculatePolygonCentroid(coordinates) {\n  var i;\n  var length = coordinates.length;\n  var v1;\n  var v2 = coordinates[length - 1];\n  var cross;\n  var cx = 0;\n  var cy = 0;\n  var area = 0;\n  var minX = 1 / 0;\n  var maxX = -1 / 0;\n  var minY = 1 / 0;\n  var maxY = -1 / 0;\n\n  for (i = 0; i < length; ++i) {\n    v1 = v2;\n    v2 = coordinates[i];\n    cross = v1[0] * v2[1] - v2[0] * v1[1];\n    area += cross;\n    cx += (v1[0] + v2[0]) * cross;\n    cy += (v1[1] + v2[1]) * cross;\n    minX = _min(minX, v2[0]);\n    maxX = _max(maxX, v2[0]);\n    minY = _min(minY, v2[1]);\n    maxY = _max(maxY, v2[1]);\n  }\n\n  return {\n    area: _abs(area) / 2,\n    center: [2 * cx / 3 / area - (minX + maxX) / 2, 2 * cy / 3 / area - (minY + maxY) / 2]\n  };\n}\n\nfunction calculateLineStringData(coordinates) {\n  var i;\n  var ii = coordinates.length;\n  var v1;\n  var v2 = coordinates[0] || [];\n  var totalLength = 0;\n  var items = [0];\n  var min0 = v2[0];\n  var max0 = v2[0];\n  var min1 = v2[1];\n  var max1 = v2[1];\n\n  for (i = 1; i < ii; ++i) {\n    v1 = v2;\n    v2 = coordinates[i];\n    totalLength += _sqrt((v1[0] - v2[0]) * (v1[0] - v2[0]) + (v1[1] - v2[1]) * (v1[1] - v2[1]));\n    items[i] = totalLength;\n    min0 = _min(min0, v2[0]);\n    max0 = _max(max0, v2[0]);\n    min1 = _min(min1, v2[1]);\n    max1 = _max(max1, v2[1]);\n  }\n\n  i = findGroupingIndex(totalLength / 2, items);\n  v1 = coordinates[i];\n  v2 = coordinates[i + 1];\n  var t = (totalLength / 2 - items[i]) / (items[i + 1] - items[i]);\n  return ii ? [[v1[0] * (1 - t) + v2[0] * t, v1[1] * (1 - t) + v2[1] * t], [max0 - min0, max1 - min1], totalLength] : [];\n}\n\nfunction projectAreaLabel(coordinates) {\n  var i;\n  var ii = coordinates.length;\n  var centroid;\n  var resultCentroid;\n  var maxArea = 0;\n\n  for (i = 0; i < ii; ++i) {\n    centroid = calculatePolygonCentroid(coordinates[i]);\n\n    if (centroid.area > maxArea) {\n      maxArea = centroid.area;\n      resultCentroid = centroid;\n    }\n  }\n\n  return resultCentroid ? [resultCentroid.center, [_sqrt(resultCentroid.area), _sqrt(resultCentroid.area)]] : [[], []];\n}\n\nfunction projectLineLabel(coordinates) {\n  var i;\n  var ii = coordinates.length;\n  var maxLength = 0;\n  var data;\n  var resultData;\n\n  for (i = 0; i < ii; ++i) {\n    data = calculateLineStringData(coordinates[i]);\n\n    if (data[2] > maxLength) {\n      maxLength = data[2];\n      resultData = data;\n    }\n  }\n\n  return resultData || [[], []];\n}\n\nexport function MapLayerCollection(params) {\n  var renderer = params.renderer;\n  this._params = params;\n  this._layers = [];\n  this._layerByName = {};\n  this._rect = [0, 0, 0, 0];\n  this._clip = renderer.clipRect();\n  this._background = renderer.rect().attr({\n    class: \"dxm-background\"\n  }).data(params.dataKey, {\n    name: \"background\"\n  }).append(renderer.root);\n  this._container = renderer.g().attr({\n    class: \"dxm-layers\",\n    \"clip-path\": this._clip.id\n  }).append(renderer.root).enableLinks();\n\n  this._subscribeToTracker(params.tracker, renderer, params.eventTrigger);\n\n  this._dataReady = params.dataReady;\n}\nMapLayerCollection.prototype = {\n  constructor: MapLayerCollection,\n  dispose: function () {\n    this._clip.dispose();\n\n    this._layers.forEach(l => l.dispose());\n\n    this._offTracker();\n\n    this._params = this._offTracker = this._layers = this._layerByName = this._clip = this._background = this._container = null;\n  },\n  _subscribeToTracker: function (tracker, renderer, eventTrigger) {\n    var that = this;\n    that._offTracker = tracker.on({\n      click: function (arg) {\n        var offset = renderer.getRootOffset();\n        var layer = that.byName(arg.data.name);\n        arg.$event.x = arg.x - offset.left;\n        arg.$event.y = arg.y - offset.top;\n\n        if (layer) {\n          layer.raiseClick(arg.data.index, arg.$event);\n        } else if (\"background\" === arg.data.name) {\n          eventTrigger(\"click\", {\n            event: arg.$event\n          });\n        }\n      },\n      \"hover-on\": function (arg) {\n        var layer = that.byName(arg.data.name);\n\n        if (layer) {\n          layer.hoverItem(arg.data.index, true);\n        }\n      },\n      \"hover-off\": function (arg) {\n        var layer = that.byName(arg.data.name);\n\n        if (layer) {\n          layer.hoverItem(arg.data.index, false);\n        }\n      }\n    });\n  },\n\n  setOptions(options) {\n    var optionList = options ? _isArray(options) ? options : [options] : [];\n    var layers = this._layers;\n    var readyCallbacks;\n    var needToCreateLayers = optionList.length !== layers.length || layers.some((l, i) => {\n      var name = getName(optionList, i);\n      return _isDefined(name) && name !== l.proxy.name;\n    });\n\n    if (needToCreateLayers) {\n      this._params.tracker.reset();\n\n      this._layers.forEach(l => l.dispose());\n\n      var layerByName = this._layerByName = {};\n      this._layers = layers = [];\n\n      for (var i = 0, ii = optionList.length; i < ii; ++i) {\n        var name = getName(optionList, i) || \"map-layer-\" + i;\n        var layer = layers[i] = new MapLayer(this._params, this._container, name, i);\n        layerByName[name] = layer;\n      }\n    }\n\n    layers.forEach((l, i) => {\n      l.setOptions(optionList[i]);\n    });\n    readyCallbacks = layers.map(l => l.getDataReadyCallback());\n    readyCallbacks.length && when.apply(void 0, readyCallbacks).done(this._dataReady);\n  },\n\n  _updateClip: function () {\n    var rect = this._rect;\n    var bw = this._borderWidth;\n\n    this._clip.attr({\n      x: rect[0] + bw,\n      y: rect[1] + bw,\n      width: _max(rect[2] - 2 * bw, 0),\n      height: _max(rect[3] - 2 * bw, 0)\n    });\n  },\n  setBackgroundOptions: function (options) {\n    this._background.attr({\n      stroke: options.borderColor,\n      \"stroke-width\": options.borderWidth,\n      fill: options.color\n    });\n\n    this._borderWidth = _max(options.borderWidth, 0);\n\n    this._updateClip();\n  },\n  setRect: function (rect) {\n    this._rect = rect;\n\n    this._background.attr({\n      x: rect[0],\n      y: rect[1],\n      width: rect[2],\n      height: rect[3]\n    });\n\n    this._updateClip();\n  },\n  byIndex: function (index) {\n    return this._layers[index];\n  },\n  byName: function (name) {\n    return this._layerByName[name];\n  },\n  items: function () {\n    return this._layers;\n  }\n};","map":{"version":3,"names":["noop","extend","each","DataHelperMixin","isFunction","_isFunction","isDefined","_isDefined","Deferred","when","parseScalar","_parseScalar","patchFontOptions","_patchFontOptions","normalizeEnum","_normalizeEnum","_noop","_extend","_each","_concat","Array","prototype","concat","TYPE_AREA","TYPE_LINE","TYPE_MARKER","STATE_DEFAULT","STATE_HOVERED","STATE_SELECTED","STATE_TO_INDEX","TOLERANCE","SELECTIONS","none","single","multiple","NaN","_isArray","isArray","_Number","Number","_String","String","_abs","Math","abs","_round","round","_min","min","_max","max","_sqrt","sqrt","getMaxBound","arr","reduce","a","c","getSelection","selectionMode","selection","state","getName","opt","index","name","EmptySource","count","ArraySource","raw","constructor","length","item","geometry","coordinates","attributes","getBBox","arguments","bbox","GeoJsonSource","features","properties","isGeoJsonObject","obj","unwrapFromDataSource","source","sourceType","wrapToDataSource","option","customizeHandles","proxies","callback","widget","call","setAreaLabelVisibility","label","text","attr","visibility","size","spaceSize","setLineLabelVisibility","getDataValue","proxy","dataField","attribute","TYPE_TO_TYPE_MAP","Point","MultiPoint","LineString","MultiLineString","Polygon","MultiPolygon","pick","b","guessTypeByData","sample","type","emptyStrategy","setup","reset","arrange","updateGrouping","getDefaultColor","strategiesByType","strategiesByGeometry","strategiesByElementType","groupByColor","groupBySize","selectStrategy","options","data","elementType","strategy","fullType","_default","applyElementState","figure","styles","field","projectLabel","projectAreaLabel","transform","transformPointList","transformLabel","transformAreaLabel","draw","context","root","renderer","path","dataKey","refresh","getLabelOffset","getStyles","settings","color","borderColor","borderWidth","opacity","class","stroke","fill","hoveredBorderColor","hoveredBorderWidth","hoveredColor","hoveredOpacity","selectedBorderColor","selectedBorderWidth","selectedColor","selectedOpacity","setState","hasLabelsGroup","projectLineLabel","transformLineLabel","width","project","projectPoint","transformPoint","g","_draw","_getStyles","_setState","ctx","palette","params","themeManager","getAccentColor","projection","projectMultiPolygon","projectPolygon","projectLineString","dot","filter","shadowFilter","dispose","back","circle","sharp","append","shadow","id","style","hoveredSize","selectedSize","selectedStep","hoveredBackSize","backStep","selectedBackSize","backColor","backOpacity","r","bubble","handles","values","i","ii","minSize","maxSize","sizeGroups","minValue","apply","maxValue","deltaValue","deltaSize","_settings","pie","border","colors","_colors","sum","start","end","zeroSum","total","forEach","arc","createPalette","useHighlight","extensionMode","generateColors","grouping","partition","dataExchanger","set","image","href","hoveredStep","x","y","height","projectPointList","output","content","translateX","translateY","transformList","k","points","getSquareSize","getItemSettings","result","combineSettings","applyGrouping","paletteIndex","findGroupingIndex","value","middle","raiseChanged","handle","eventTrigger","target","common","partial","font","processCommonSettings","str","theme","paletteSize","createDiscretePalette","push","getColor","valueCallback","performGrouping","settingField","valuesCallback","defaultColor","dropGrouping","colorGroups","colorGroupingField","_palette","list","sizeGroupingField","sizes","setFlag","flags","flag","hasFlag","createLayerProxy","layer","getElements","getProxies","clearSelection","_noEvent","getDataSource","getBounds","MapLayerElement","MapLayer","container","_params","_onProjection","_context","hover","linkOn","linkAppend","_container","_options","_handles","_data","_dataSourceLoaded","getDataReadyCallback","that","_removeHandlers","on","engine","_project","screen","_transform","center","_transformCore","zoom","getData","_dataSourceLoadErrorHandler","_dataSourceChangedHandler","_dataSource","items","_update","_dataSourceOptions","paginate","_getSpecificDataSourceOption","_specificDataSourceOption","_normalizeDataSource","dataSource","store","_loadMode","_offProjection","_disposeDataSource","_destroyHandles","linkRemove","linkOff","labelRoot","setOptions","_options_dataSource","notifyDirty","_refreshDataSource","isContextChanged","clear","tracker","hasSeparateLabel","enabled","hoverEnabled","_","resetSelected","after","_createHandles","_updateHandles","notifyReady","resolve","dataReady","map","_ref","coords","coordsToBoundsSearch","ac","val","initValue","h","dataItem","customize","restoreSelected","measureLabel","adjustLabel","getTransform","p","getProxy","raiseClick","dxEvent","event","hoverItem","setHovered","selectItem","setSelected","createProxy","attrs","selected","isSelected","applySettings","update","_ctx","_index","_fig","_label","_state","_coordinates","_projection","_projectLabel","_labelProjection","_transformLabel","_styles","_refreshLabel","labelSettings","css","align","remove","bBox","offset","_setForeground","toForeground","toBackground","currentState","newState","tmp","calculatePolygonCentroid","v1","v2","cross","cx","cy","area","minX","maxX","minY","maxY","calculateLineStringData","totalLength","min0","max0","min1","max1","t","centroid","resultCentroid","maxArea","maxLength","resultData","MapLayerCollection","_layers","_layerByName","_rect","_clip","clipRect","_background","rect","enableLinks","_subscribeToTracker","_dataReady","l","_offTracker","click","arg","getRootOffset","byName","$event","left","top","optionList","layers","readyCallbacks","needToCreateLayers","some","layerByName","done","_updateClip","bw","_borderWidth","setBackgroundOptions","setRect","byIndex"],"sources":["E:/MisaProject/W2022_06/misa_emis/node_modules/devextreme/esm/viz/vector_map/map_layer.js"],"sourcesContent":["/**\r\n * DevExtreme (esm/viz/vector_map/map_layer.js)\r\n * Version: 22.1.4\r\n * Build date: Fri Jul 22 2022\r\n *\r\n * Copyright (c) 2012 - 2022 Developer Express Inc. ALL RIGHTS RESERVED\r\n * Read about DevExtreme licensing here: https://js.devexpress.com/Licensing/\r\n */\r\nimport {\r\n    noop\r\n} from \"../../core/utils/common\";\r\nimport {\r\n    extend\r\n} from \"../../core/utils/extend\";\r\nimport {\r\n    each\r\n} from \"../../core/utils/iterator\";\r\nimport DataHelperMixin from \"../../data_helper\";\r\nimport {\r\n    isFunction as _isFunction,\r\n    isDefined as _isDefined\r\n} from \"../../core/utils/type\";\r\nimport {\r\n    Deferred,\r\n    when\r\n} from \"../../core/utils/deferred\";\r\nimport {\r\n    parseScalar as _parseScalar,\r\n    patchFontOptions as _patchFontOptions,\r\n    normalizeEnum as _normalizeEnum\r\n} from \"../core/utils\";\r\nvar _noop = noop;\r\nvar _extend = extend;\r\nvar _each = each;\r\nvar _concat = Array.prototype.concat;\r\nvar TYPE_AREA = \"area\";\r\nvar TYPE_LINE = \"line\";\r\nvar TYPE_MARKER = \"marker\";\r\nvar STATE_DEFAULT = 0;\r\nvar STATE_HOVERED = 1;\r\nvar STATE_SELECTED = 2;\r\nvar STATE_TO_INDEX = [0, 1, 2, 2];\r\nvar TOLERANCE = 1;\r\nvar SELECTIONS = {\r\n    none: null,\r\n    single: -1,\r\n    multiple: NaN\r\n};\r\nvar _isArray = Array.isArray;\r\nvar _Number = Number;\r\nvar _String = String;\r\nvar _abs = Math.abs;\r\nvar _round = Math.round;\r\nvar _min = Math.min;\r\nvar _max = Math.max;\r\nvar _sqrt = Math.sqrt;\r\nexport function getMaxBound(arr) {\r\n    return arr.reduce((a, c) => c ? [_min(a[0], c[0]), _min(a[1], c[1]), _max(a[2], c[2]), _max(a[3], c[3])] : a, arr[0])\r\n}\r\n\r\nfunction getSelection(selectionMode) {\r\n    var selection = _normalizeEnum(selectionMode);\r\n    selection = selection in SELECTIONS ? SELECTIONS[selection] : SELECTIONS.single;\r\n    if (null !== selection) {\r\n        selection = {\r\n            state: {},\r\n            single: selection\r\n        }\r\n    }\r\n    return selection\r\n}\r\n\r\nfunction getName(opt, index) {\r\n    return (opt[index] || {}).name\r\n}\r\n\r\nfunction EmptySource() {}\r\nEmptySource.prototype.count = function() {\r\n    return 0\r\n};\r\n\r\nfunction ArraySource(raw) {\r\n    this.raw = raw\r\n}\r\nArraySource.prototype = {\r\n    constructor: ArraySource,\r\n    count: function() {\r\n        return this.raw.length\r\n    },\r\n    item: function(index) {\r\n        return this.raw[index]\r\n    },\r\n    geometry: function(item) {\r\n        return {\r\n            coordinates: item.coordinates\r\n        }\r\n    },\r\n    attributes: function(item) {\r\n        return item.attributes\r\n    },\r\n    getBBox: function(index) {\r\n        return 0 === arguments.length ? void 0 : this.raw[index].bbox\r\n    }\r\n};\r\n\r\nfunction GeoJsonSource(raw) {\r\n    this.raw = raw\r\n}\r\nGeoJsonSource.prototype = {\r\n    constructor: GeoJsonSource,\r\n    count: function() {\r\n        return this.raw.features.length\r\n    },\r\n    item: function(index) {\r\n        return this.raw.features[index]\r\n    },\r\n    geometry: function(item) {\r\n        return item.geometry\r\n    },\r\n    attributes: function(item) {\r\n        return item.properties\r\n    },\r\n    getBBox: function(index) {\r\n        return 0 === arguments.length ? this.raw.bbox : this.raw.features[index].bbox\r\n    }\r\n};\r\n\r\nfunction isGeoJsonObject(obj) {\r\n    return _isArray(obj.features)\r\n}\r\n\r\nfunction unwrapFromDataSource(source) {\r\n    var sourceType;\r\n    if (source) {\r\n        if (isGeoJsonObject(source)) {\r\n            sourceType = GeoJsonSource\r\n        } else if (1 === source.length && source[0] && isGeoJsonObject(source[0])) {\r\n            sourceType = GeoJsonSource;\r\n            source = source[0]\r\n        } else if (_isArray(source)) {\r\n            sourceType = ArraySource\r\n        }\r\n    }\r\n    sourceType = sourceType || EmptySource;\r\n    return new sourceType(source)\r\n}\r\n\r\nfunction wrapToDataSource(option) {\r\n    return option ? isGeoJsonObject(option) ? [option] : option : []\r\n}\r\n\r\nfunction customizeHandles(proxies, callback, widget) {\r\n    callback.call(widget, proxies)\r\n}\r\n\r\nfunction setAreaLabelVisibility(label) {\r\n    label.text.attr({\r\n        visibility: label.size[0] / label.spaceSize[0] < TOLERANCE && label.size[1] / label.spaceSize[1] < TOLERANCE ? null : \"hidden\"\r\n    })\r\n}\r\n\r\nfunction setLineLabelVisibility(label) {\r\n    label.text.attr({\r\n        visibility: label.size[0] / label.spaceSize[0] < TOLERANCE || label.size[1] / label.spaceSize[1] < TOLERANCE ? null : \"hidden\"\r\n    })\r\n}\r\n\r\nfunction getDataValue(proxy, dataField) {\r\n    return proxy.attribute(dataField)\r\n}\r\nvar TYPE_TO_TYPE_MAP = {\r\n    Point: TYPE_MARKER,\r\n    MultiPoint: TYPE_LINE,\r\n    LineString: TYPE_LINE,\r\n    MultiLineString: TYPE_LINE,\r\n    Polygon: TYPE_AREA,\r\n    MultiPolygon: TYPE_AREA\r\n};\r\n\r\nfunction pick(a, b) {\r\n    return void 0 !== a ? a : b\r\n}\r\n\r\nfunction guessTypeByData(sample) {\r\n    var type = TYPE_TO_TYPE_MAP[sample.type];\r\n    var coordinates = sample.coordinates;\r\n    if (!type) {\r\n        if (\"number\" === typeof coordinates[0]) {\r\n            type = TYPE_MARKER\r\n        } else if (\"number\" === typeof coordinates[0][0]) {\r\n            type = TYPE_LINE\r\n        } else {\r\n            type = TYPE_AREA\r\n        }\r\n    }\r\n    return type\r\n}\r\nvar emptyStrategy = {\r\n    setup: _noop,\r\n    reset: _noop,\r\n    arrange: _noop,\r\n    updateGrouping: _noop,\r\n    getDefaultColor: _noop\r\n};\r\nvar strategiesByType = {};\r\nvar strategiesByGeometry = {};\r\nvar strategiesByElementType = {};\r\nvar groupByColor;\r\nvar groupBySize;\r\nvar selectStrategy = function(options, data) {\r\n    var type = _normalizeEnum(options.type);\r\n    var elementType = _normalizeEnum(options.elementType);\r\n    var sample;\r\n    var strategy = _extend({}, emptyStrategy);\r\n    if (data.count() > 0) {\r\n        sample = data.geometry(data.item(0));\r\n        type = strategiesByType[type] ? type : guessTypeByData(sample);\r\n        _extend(strategy, strategiesByType[type]);\r\n        strategy.fullType = strategy.type = type;\r\n        if (strategiesByGeometry[type]) {\r\n            _extend(strategy, strategiesByGeometry[type](sample))\r\n        }\r\n        if (strategiesByElementType[type]) {\r\n            elementType = strategiesByElementType[type][elementType] ? elementType : strategiesByElementType[type]._default;\r\n            _extend(strategy, strategiesByElementType[type][elementType]);\r\n            strategy.elementType = elementType;\r\n            strategy.fullType += \":\" + elementType\r\n        }\r\n    }\r\n    return strategy\r\n};\r\n\r\nfunction applyElementState(figure, styles, state, field) {\r\n    figure[field].attr(styles[field][state])\r\n}\r\nstrategiesByType[TYPE_AREA] = {\r\n    projectLabel: projectAreaLabel,\r\n    transform: transformPointList,\r\n    transformLabel: transformAreaLabel,\r\n    draw: function(context, figure, data) {\r\n        figure.root = context.renderer.path([], \"area\").data(context.dataKey, data)\r\n    },\r\n    refresh: _noop,\r\n    getLabelOffset: function(label) {\r\n        setAreaLabelVisibility(label);\r\n        return [0, 0]\r\n    },\r\n    getStyles: function(settings) {\r\n        var color = settings.color || null;\r\n        var borderColor = settings.borderColor || null;\r\n        var borderWidth = pick(settings.borderWidth, null);\r\n        var opacity = pick(settings.opacity, null);\r\n        return {\r\n            root: [{\r\n                class: \"dxm-area\",\r\n                stroke: borderColor,\r\n                \"stroke-width\": borderWidth,\r\n                fill: color,\r\n                opacity: opacity\r\n            }, {\r\n                class: \"dxm-area dxm-area-hovered\",\r\n                stroke: settings.hoveredBorderColor || borderColor,\r\n                \"stroke-width\": pick(settings.hoveredBorderWidth, borderWidth),\r\n                fill: settings.hoveredColor || color,\r\n                opacity: pick(settings.hoveredOpacity, opacity)\r\n            }, {\r\n                class: \"dxm-area dxm-area-selected\",\r\n                stroke: settings.selectedBorderColor || borderColor,\r\n                \"stroke-width\": pick(settings.selectedBorderWidth, borderWidth),\r\n                fill: settings.selectedColor || color,\r\n                opacity: pick(settings.selectedOpacity, opacity)\r\n            }]\r\n        }\r\n    },\r\n    setState: function(figure, styles, state) {\r\n        applyElementState(figure, styles, state, \"root\")\r\n    },\r\n    hasLabelsGroup: true,\r\n    updateGrouping: function(context) {\r\n        groupByColor(context)\r\n    },\r\n    getDefaultColor: _noop\r\n};\r\nstrategiesByType[TYPE_LINE] = {\r\n    projectLabel: projectLineLabel,\r\n    transform: transformPointList,\r\n    transformLabel: transformLineLabel,\r\n    draw: function(context, figure, data) {\r\n        figure.root = context.renderer.path([], \"line\").data(context.dataKey, data)\r\n    },\r\n    refresh: _noop,\r\n    getLabelOffset: function(label) {\r\n        setLineLabelVisibility(label);\r\n        return [0, 0]\r\n    },\r\n    getStyles: function(settings) {\r\n        var color = settings.color || settings.borderColor || null;\r\n        var width = pick(settings.borderWidth, null);\r\n        var opacity = pick(settings.opacity, null);\r\n        return {\r\n            root: [{\r\n                class: \"dxm-line\",\r\n                stroke: color,\r\n                \"stroke-width\": width,\r\n                opacity: opacity\r\n            }, {\r\n                class: \"dxm-line dxm-line-hovered\",\r\n                stroke: settings.hoveredColor || settings.hoveredBorderColor || color,\r\n                \"stroke-width\": pick(settings.hoveredBorderWidth, width),\r\n                opacity: pick(settings.hoveredOpacity, opacity)\r\n            }, {\r\n                class: \"dxm-line dxm-line-selected\",\r\n                stroke: settings.selectedColor || settings.selectedBorderColor || color,\r\n                \"stroke-width\": pick(settings.selectedBorderWidth, width),\r\n                opacity: pick(settings.selectedOpacity, opacity)\r\n            }]\r\n        }\r\n    },\r\n    setState: function(figure, styles, state) {\r\n        applyElementState(figure, styles, state, \"root\")\r\n    },\r\n    hasLabelsGroup: true,\r\n    updateGrouping: function(context) {\r\n        groupByColor(context)\r\n    },\r\n    getDefaultColor: _noop\r\n};\r\nstrategiesByType[TYPE_MARKER] = {\r\n    project: projectPoint,\r\n    transform: transformPoint,\r\n    draw: function(context, figure, data) {\r\n        figure.root = context.renderer.g();\r\n        this._draw(context, figure, data)\r\n    },\r\n    refresh: _noop,\r\n    hasLabelsGroup: false,\r\n    getLabelOffset: function(label, settings) {\r\n        return [_round((label.size[0] + _max(settings.size || 0, 0)) / 2) + 2, 0]\r\n    },\r\n    getStyles: function(settings) {\r\n        var styles = {\r\n            root: [{\r\n                class: \"dxm-marker\"\r\n            }, {\r\n                class: \"dxm-marker dxm-marker-hovered\"\r\n            }, {\r\n                class: \"dxm-marker dxm-marker-selected\"\r\n            }]\r\n        };\r\n        this._getStyles(styles, settings);\r\n        return styles\r\n    },\r\n    setState: function(figure, styles, state) {\r\n        applyElementState(figure, styles, state, \"root\");\r\n        this._setState(figure, styles, state)\r\n    },\r\n    updateGrouping: function(context) {\r\n        groupByColor(context);\r\n        groupBySize(context)\r\n    },\r\n    getDefaultColor: function(ctx, palette) {\r\n        return ctx.params.themeManager.getAccentColor(palette)\r\n    }\r\n};\r\nstrategiesByGeometry[TYPE_AREA] = function(sample) {\r\n    return {\r\n        project: (projection, coordinates) => coordinates[0] && coordinates[0][0] && coordinates[0][0][0] && \"number\" === typeof coordinates[0][0][0][0] ? projectMultiPolygon(projection, coordinates) : projectPolygon(projection, coordinates)\r\n    }\r\n};\r\nstrategiesByGeometry[TYPE_LINE] = function(sample) {\r\n    var coordinates = sample.coordinates;\r\n    return {\r\n        project: coordinates[0] && coordinates[0][0] && \"number\" === typeof coordinates[0][0][0] ? projectPolygon : projectLineString\r\n    }\r\n};\r\nstrategiesByElementType[TYPE_MARKER] = {\r\n    _default: \"dot\",\r\n    dot: {\r\n        setup: function(context) {\r\n            context.filter = context.renderer.shadowFilter(\"-40%\", \"-40%\", \"180%\", \"200%\", 0, 1, 1, \"#000000\", .2)\r\n        },\r\n        reset: function(context) {\r\n            context.filter.dispose();\r\n            context.filter = null\r\n        },\r\n        _draw: function(ctx, figure, data) {\r\n            figure.back = ctx.renderer.circle().sharp().data(ctx.dataKey, data).append(figure.root);\r\n            figure.dot = ctx.renderer.circle().sharp().data(ctx.dataKey, data).append(figure.root)\r\n        },\r\n        refresh: function(ctx, figure, data, proxy, settings) {\r\n            figure.dot.attr({\r\n                filter: settings.shadow ? ctx.filter.id : null\r\n            })\r\n        },\r\n        _getStyles: function(styles, style) {\r\n            var size = style.size > 0 ? _Number(style.size) : 0;\r\n            var hoveredSize = size;\r\n            var selectedSize = size + (style.selectedStep > 0 ? _Number(style.selectedStep) : 0);\r\n            var hoveredBackSize = hoveredSize + (style.backStep > 0 ? _Number(style.backStep) : 0);\r\n            var selectedBackSize = selectedSize + (style.backStep > 0 ? _Number(style.backStep) : 0);\r\n            var color = style.color || null;\r\n            var borderColor = style.borderColor || null;\r\n            var borderWidth = pick(style.borderWidth, null);\r\n            var opacity = pick(style.opacity, null);\r\n            var backColor = style.backColor || null;\r\n            var backOpacity = pick(style.backOpacity, null);\r\n            styles.dot = [{\r\n                r: size / 2,\r\n                stroke: borderColor,\r\n                \"stroke-width\": borderWidth,\r\n                fill: color,\r\n                opacity: opacity\r\n            }, {\r\n                r: hoveredSize / 2,\r\n                stroke: style.hoveredBorderColor || borderColor,\r\n                \"stroke-width\": pick(style.hoveredBorderWidth, borderWidth),\r\n                fill: style.hoveredColor || color,\r\n                opacity: pick(style.hoveredOpacity, opacity)\r\n            }, {\r\n                r: selectedSize / 2,\r\n                stroke: style.selectedBorderColor || borderColor,\r\n                \"stroke-width\": pick(style.selectedBorderWidth, borderWidth),\r\n                fill: style.selectedColor || color,\r\n                opacity: pick(style.selectedOpacity, opacity)\r\n            }];\r\n            styles.back = [{\r\n                r: size / 2,\r\n                stroke: \"none\",\r\n                \"stroke-width\": 0,\r\n                fill: backColor,\r\n                opacity: backOpacity\r\n            }, {\r\n                r: hoveredBackSize / 2,\r\n                stroke: \"none\",\r\n                \"stroke-width\": 0,\r\n                fill: backColor,\r\n                opacity: backOpacity\r\n            }, {\r\n                r: selectedBackSize / 2,\r\n                stroke: \"none\",\r\n                \"stroke-width\": 0,\r\n                fill: backColor,\r\n                opacity: backOpacity\r\n            }]\r\n        },\r\n        _setState: function(figure, styles, state) {\r\n            applyElementState(figure, styles, state, \"dot\");\r\n            applyElementState(figure, styles, state, \"back\")\r\n        }\r\n    },\r\n    bubble: {\r\n        _draw: function(ctx, figure, data) {\r\n            figure.bubble = ctx.renderer.circle().sharp().data(ctx.dataKey, data).append(figure.root)\r\n        },\r\n        refresh: function(ctx, figure, data, proxy, settings) {\r\n            figure.bubble.attr({\r\n                r: settings.size / 2\r\n            })\r\n        },\r\n        _getStyles: function(styles, style) {\r\n            var color = style.color || null;\r\n            var borderColor = style.borderColor || null;\r\n            var borderWidth = pick(style.borderWidth, null);\r\n            var opacity = pick(style.opacity, null);\r\n            styles.bubble = [{\r\n                stroke: borderColor,\r\n                \"stroke-width\": borderWidth,\r\n                fill: color,\r\n                opacity: opacity\r\n            }, {\r\n                stroke: style.hoveredBorderColor || borderColor,\r\n                \"stroke-width\": pick(style.hoveredBorderWidth, borderWidth),\r\n                fill: style.hoveredColor || style.color,\r\n                opacity: pick(style.hoveredOpacity, opacity)\r\n            }, {\r\n                stroke: style.selectedBorderColor || borderColor,\r\n                \"stroke-width\": pick(style.selectedBorderWidth, borderWidth),\r\n                fill: style.selectedColor || style.color,\r\n                opacity: pick(style.selectedOpacity, opacity)\r\n            }]\r\n        },\r\n        _setState: function(figure, styles, state) {\r\n            applyElementState(figure, styles, state, \"bubble\")\r\n        },\r\n        arrange: function(context, handles) {\r\n            var values = [];\r\n            var i;\r\n            var ii = values.length = handles.length;\r\n            var settings = context.settings;\r\n            var dataField = settings.dataField;\r\n            var minSize = settings.minSize > 0 ? _Number(settings.minSize) : 0;\r\n            var maxSize = settings.maxSize > minSize ? _Number(settings.maxSize) : minSize;\r\n            if (settings.sizeGroups) {\r\n                return\r\n            }\r\n            for (i = 0; i < ii; ++i) {\r\n                values[i] = _max(getDataValue(handles[i].proxy, dataField) || 0, 0)\r\n            }\r\n            var minValue = _min.apply(null, values);\r\n            var maxValue = _max.apply(null, values);\r\n            var deltaValue = maxValue - minValue || 1;\r\n            var deltaSize = maxSize - minSize;\r\n            for (i = 0; i < ii; ++i) {\r\n                handles[i]._settings.size = minSize + deltaSize * (values[i] - minValue) / deltaValue\r\n            }\r\n        },\r\n        updateGrouping: function(context) {\r\n            var dataField = context.settings.dataField;\r\n            strategiesByType[TYPE_MARKER].updateGrouping(context);\r\n            groupBySize(context, (function(proxy) {\r\n                return getDataValue(proxy, dataField)\r\n            }))\r\n        }\r\n    },\r\n    pie: {\r\n        _draw: function(ctx, figure, data) {\r\n            figure.pie = ctx.renderer.g().append(figure.root);\r\n            figure.border = ctx.renderer.circle().sharp().data(ctx.dataKey, data).append(figure.root)\r\n        },\r\n        refresh: function(ctx, figure, data, proxy, settings) {\r\n            var values = getDataValue(proxy, ctx.settings.dataField) || [];\r\n            var colors = settings._colors;\r\n            var sum = 0;\r\n            var pie = figure.pie;\r\n            var renderer = ctx.renderer;\r\n            var dataKey = ctx.dataKey;\r\n            var r = (settings.size > 0 ? _Number(settings.size) : 0) / 2;\r\n            var start = 90;\r\n            var end = start;\r\n            var zeroSum = false;\r\n            sum = values.reduce((function(total, item) {\r\n                return total + (item || 0)\r\n            }), 0);\r\n            if (0 === sum) {\r\n                zeroSum = true;\r\n                sum = 360 / values.length\r\n            }\r\n            values.forEach((function(item, i) {\r\n                start = end;\r\n                end += zeroSum ? sum : (item || 0) / sum * 360;\r\n                renderer.arc(0, 0, 0, r, start, end).attr({\r\n                    \"stroke-linejoin\": \"round\",\r\n                    fill: colors[i]\r\n                }).data(dataKey, data).append(pie)\r\n            }));\r\n            figure.border.attr({\r\n                r: r\r\n            })\r\n        },\r\n        _getStyles: function(styles, style) {\r\n            var opacity = pick(style.opacity, null);\r\n            var borderColor = style.borderColor || null;\r\n            var borderWidth = pick(style.borderWidth, null);\r\n            styles.pie = [{\r\n                opacity: opacity\r\n            }, {\r\n                opacity: pick(style.hoveredOpacity, opacity)\r\n            }, {\r\n                opacity: pick(style.selectedOpacity, opacity)\r\n            }];\r\n            styles.border = [{\r\n                stroke: borderColor,\r\n                \"stroke-width\": borderWidth\r\n            }, {\r\n                stroke: style.hoveredBorderColor || borderColor,\r\n                \"stroke-width\": pick(style.hoveredBorderWidth, borderWidth)\r\n            }, {\r\n                stroke: style.selectedBorderColor || borderColor,\r\n                \"stroke-width\": pick(style.selectedBorderWidth, borderWidth)\r\n            }]\r\n        },\r\n        _setState: function(figure, styles, state) {\r\n            applyElementState(figure, styles, state, \"pie\");\r\n            applyElementState(figure, styles, state, \"border\")\r\n        },\r\n        arrange: function(context, handles) {\r\n            var i;\r\n            var ii = handles.length;\r\n            var dataField = context.settings.dataField;\r\n            var values;\r\n            var count = 0;\r\n            var palette;\r\n            for (i = 0; i < ii; ++i) {\r\n                values = getDataValue(handles[i].proxy, dataField);\r\n                if (values && values.length > count) {\r\n                    count = values.length\r\n                }\r\n            }\r\n            if (count > 0) {\r\n                palette = context.params.themeManager.createPalette(context.settings.palette, {\r\n                    useHighlight: true,\r\n                    extensionMode: \"alternate\"\r\n                });\r\n                values = palette.generateColors(count);\r\n                context.settings._colors = values;\r\n                context.grouping.color = {\r\n                    callback: _noop,\r\n                    field: \"\",\r\n                    partition: [],\r\n                    values: []\r\n                };\r\n                context.params.dataExchanger.set(context.name, \"color\", {\r\n                    partition: [],\r\n                    values: values\r\n                })\r\n            }\r\n        }\r\n    },\r\n    image: {\r\n        _draw: function(ctx, figure, data) {\r\n            figure.image = ctx.renderer.image(null, null, null, null, null, \"center\").attr({\r\n                \"pointer-events\": \"visible\"\r\n            }).data(ctx.dataKey, data).append(figure.root)\r\n        },\r\n        refresh: function(ctx, figure, data, proxy) {\r\n            figure.image.attr({\r\n                href: getDataValue(proxy, ctx.settings.dataField)\r\n            })\r\n        },\r\n        _getStyles: function(styles, style) {\r\n            var size = style.size > 0 ? _Number(style.size) : 0;\r\n            var hoveredSize = size + (style.hoveredStep > 0 ? _Number(style.hoveredStep) : 0);\r\n            var selectedSize = size + (style.selectedStep > 0 ? _Number(style.selectedStep) : 0);\r\n            var opacity = pick(style.opacity, null);\r\n            styles.image = [{\r\n                x: -size / 2,\r\n                y: -size / 2,\r\n                width: size,\r\n                height: size,\r\n                opacity: opacity\r\n            }, {\r\n                x: -hoveredSize / 2,\r\n                y: -hoveredSize / 2,\r\n                width: hoveredSize,\r\n                height: hoveredSize,\r\n                opacity: pick(style.hoveredOpacity, opacity)\r\n            }, {\r\n                x: -selectedSize / 2,\r\n                y: -selectedSize / 2,\r\n                width: selectedSize,\r\n                height: selectedSize,\r\n                opacity: pick(style.selectedOpacity, opacity)\r\n            }]\r\n        },\r\n        _setState: function(figure, styles, state) {\r\n            applyElementState(figure, styles, state, \"image\")\r\n        }\r\n    }\r\n};\r\n\r\nfunction projectPoint(projection, coordinates) {\r\n    return projection.project(coordinates)\r\n}\r\n\r\nfunction projectPointList(projection, coordinates) {\r\n    var output = [];\r\n    var i;\r\n    var ii = output.length = coordinates.length;\r\n    for (i = 0; i < ii; ++i) {\r\n        output[i] = projection.project(coordinates[i])\r\n    }\r\n    return output\r\n}\r\n\r\nfunction projectLineString(projection, coordinates) {\r\n    return [projectPointList(projection, coordinates)]\r\n}\r\n\r\nfunction projectPolygon(projection, coordinates) {\r\n    var output = [];\r\n    var i;\r\n    var ii = output.length = coordinates.length;\r\n    for (i = 0; i < ii; ++i) {\r\n        output[i] = projectPointList(projection, coordinates[i])\r\n    }\r\n    return output\r\n}\r\n\r\nfunction projectMultiPolygon(projection, coordinates) {\r\n    var output = [];\r\n    var i;\r\n    var ii = output.length = coordinates.length;\r\n    for (i = 0; i < ii; ++i) {\r\n        output[i] = projectPolygon(projection, coordinates[i])\r\n    }\r\n    return _concat.apply([], output)\r\n}\r\n\r\nfunction transformPoint(content, projection, coordinates) {\r\n    var data = projection.transform(coordinates);\r\n    content.root.attr({\r\n        translateX: data[0],\r\n        translateY: data[1]\r\n    })\r\n}\r\n\r\nfunction transformList(projection, coordinates) {\r\n    var output = [];\r\n    var i;\r\n    var ii = coordinates.length;\r\n    var item;\r\n    var k = 0;\r\n    output.length = 2 * ii;\r\n    for (i = 0; i < ii; ++i) {\r\n        item = projection.transform(coordinates[i]);\r\n        output[k++] = item[0];\r\n        output[k++] = item[1]\r\n    }\r\n    return output\r\n}\r\n\r\nfunction transformPointList(content, projection, coordinates) {\r\n    var output = [];\r\n    var i;\r\n    var ii = output.length = coordinates.length;\r\n    for (i = 0; i < ii; ++i) {\r\n        output[i] = transformList(projection, coordinates[i])\r\n    }\r\n    content.root.attr({\r\n        points: output\r\n    })\r\n}\r\n\r\nfunction transformAreaLabel(label, projection, coordinates) {\r\n    var data = projection.transform(coordinates[0]);\r\n    label.spaceSize = projection.getSquareSize(coordinates[1]);\r\n    label.text.attr({\r\n        translateX: data[0],\r\n        translateY: data[1]\r\n    });\r\n    setAreaLabelVisibility(label)\r\n}\r\n\r\nfunction transformLineLabel(label, projection, coordinates) {\r\n    var data = projection.transform(coordinates[0]);\r\n    label.spaceSize = projection.getSquareSize(coordinates[1]);\r\n    label.text.attr({\r\n        translateX: data[0],\r\n        translateY: data[1]\r\n    });\r\n    setLineLabelVisibility(label)\r\n}\r\n\r\nfunction getItemSettings(context, proxy, settings) {\r\n    var result = combineSettings(context.settings, settings);\r\n    applyGrouping(context.grouping, proxy, result);\r\n    if (void 0 === settings.color && settings.paletteIndex >= 0) {\r\n        result.color = result._colors[settings.paletteIndex]\r\n    }\r\n    return result\r\n}\r\n\r\nfunction applyGrouping(grouping, proxy, settings) {\r\n    _each(grouping, (function(name, data) {\r\n        var index = findGroupingIndex(data.callback(proxy, data.field), data.partition);\r\n        if (index >= 0) {\r\n            settings[name] = data.values[index]\r\n        }\r\n    }))\r\n}\r\n\r\nfunction findGroupingIndex(value, partition) {\r\n    var start = 0;\r\n    var end = partition.length - 1;\r\n    var index = -1;\r\n    var middle;\r\n    if (partition[start] <= value && value <= partition[end]) {\r\n        if (value === partition[end]) {\r\n            index = end - 1\r\n        } else {\r\n            while (end - start > 1) {\r\n                middle = start + end >> 1;\r\n                if (value < partition[middle]) {\r\n                    end = middle\r\n                } else {\r\n                    start = middle\r\n                }\r\n            }\r\n            index = start\r\n        }\r\n    }\r\n    return index\r\n}\r\n\r\nfunction raiseChanged(context, handle, state, name) {\r\n    context.params.eventTrigger(name, {\r\n        target: handle.proxy,\r\n        state: state\r\n    })\r\n}\r\n\r\nfunction combineSettings(common, partial) {\r\n    var obj = _extend({}, common, partial);\r\n    obj.label = _extend({}, common.label, obj.label);\r\n    obj.label.font = _extend({}, common.label.font, obj.label.font);\r\n    return obj\r\n}\r\n\r\nfunction processCommonSettings(context, options) {\r\n    var themeManager = context.params.themeManager;\r\n    var strategy = context.str;\r\n    var settings = combineSettings(_extend({\r\n        label: {},\r\n        color: strategy.getDefaultColor(context, options.palette)\r\n    }, themeManager.theme(\"layer:\" + strategy.fullType)), options);\r\n    var colors;\r\n    var i;\r\n    var palette;\r\n    if (settings.paletteSize > 0) {\r\n        palette = themeManager.createDiscretePalette(settings.palette, settings.paletteSize);\r\n        for (i = 0, colors = []; i < settings.paletteSize; ++i) {\r\n            colors.push(palette.getColor(i))\r\n        }\r\n        settings._colors = colors\r\n    }\r\n    return settings\r\n}\r\n\r\nfunction valueCallback(proxy, dataField) {\r\n    return proxy.attribute(dataField)\r\n}\r\nvar performGrouping = function(context, partition, settingField, dataField, valuesCallback) {\r\n    var values;\r\n    if (dataField && partition && partition.length > 1) {\r\n        values = valuesCallback(partition.length - 1);\r\n        context.grouping[settingField] = {\r\n            callback: _isFunction(dataField) ? dataField : valueCallback,\r\n            field: dataField,\r\n            partition: partition,\r\n            values: values\r\n        };\r\n        context.params.dataExchanger.set(context.name, settingField, {\r\n            partition: partition,\r\n            values: values,\r\n            defaultColor: context.settings.color\r\n        })\r\n    }\r\n};\r\n\r\nfunction dropGrouping(context) {\r\n    var name = context.name;\r\n    var dataExchanger = context.params.dataExchanger;\r\n    _each(context.grouping, (function(field) {\r\n        dataExchanger.set(name, field, null)\r\n    }));\r\n    context.grouping = {}\r\n}\r\ngroupByColor = function(context) {\r\n    performGrouping(context, context.settings.colorGroups, \"color\", context.settings.colorGroupingField, (function(count) {\r\n        var _palette = context.params.themeManager.createDiscretePalette(context.settings.palette, count);\r\n        var i;\r\n        var list = [];\r\n        for (i = 0; i < count; ++i) {\r\n            list.push(_palette.getColor(i))\r\n        }\r\n        return list\r\n    }))\r\n};\r\ngroupBySize = function(context, valueCallback) {\r\n    var settings = context.settings;\r\n    performGrouping(context, settings.sizeGroups, \"size\", valueCallback || settings.sizeGroupingField, (function(count) {\r\n        var minSize = settings.minSize > 0 ? _Number(settings.minSize) : 0;\r\n        var maxSize = settings.maxSize >= minSize ? _Number(settings.maxSize) : 0;\r\n        var i = 0;\r\n        var sizes = [];\r\n        if (count > 1) {\r\n            for (i = 0; i < count; ++i) {\r\n                sizes.push((minSize * (count - i - 1) + maxSize * i) / (count - 1))\r\n            }\r\n        } else if (1 === count) {\r\n            sizes.push((minSize + maxSize) / 2)\r\n        }\r\n        return sizes\r\n    }))\r\n};\r\n\r\nfunction setFlag(flags, flag, state) {\r\n    if (state) {\r\n        flags |= flag\r\n    } else {\r\n        flags &= ~flag\r\n    }\r\n    return flags\r\n}\r\n\r\nfunction hasFlag(flags, flag) {\r\n    return !!(flags & flag)\r\n}\r\n\r\nfunction createLayerProxy(layer, name, index) {\r\n    var proxy = {\r\n        index: index,\r\n        name: name,\r\n        getElements: function() {\r\n            return layer.getProxies()\r\n        },\r\n        clearSelection: function(_noEvent) {\r\n            layer.clearSelection(_noEvent);\r\n            return proxy\r\n        },\r\n        getDataSource: function() {\r\n            return layer.getDataSource()\r\n        },\r\n        getBounds: () => layer.getBounds()\r\n    };\r\n    return proxy\r\n}\r\nvar MapLayerElement;\r\nvar MapLayer = function(params, container, name, index) {\r\n    this._params = params;\r\n    this._onProjection();\r\n    this.proxy = createLayerProxy(this, name, index);\r\n    this._context = {\r\n        name: name,\r\n        layer: this.proxy,\r\n        renderer: params.renderer,\r\n        projection: params.projection,\r\n        params: params,\r\n        dataKey: params.dataKey,\r\n        str: emptyStrategy,\r\n        hover: false,\r\n        selection: null,\r\n        grouping: {},\r\n        root: params.renderer.g().attr({\r\n            class: \"dxm-layer\"\r\n        }).linkOn(container, name).linkAppend()\r\n    };\r\n    this._container = container;\r\n    this._options = {};\r\n    this._handles = [];\r\n    this._data = new EmptySource;\r\n    this._dataSourceLoaded = null\r\n};\r\nMapLayer.prototype = _extend({\r\n    constructor: MapLayer,\r\n    getDataReadyCallback() {\r\n        return this._dataSourceLoaded\r\n    },\r\n    _onProjection: function() {\r\n        var that = this;\r\n        that._removeHandlers = that._params.projection.on({\r\n            engine: function() {\r\n                that._project()\r\n            },\r\n            screen: function() {\r\n                that._transform()\r\n            },\r\n            center: function() {\r\n                that._transformCore()\r\n            },\r\n            zoom: function() {\r\n                that._transform()\r\n            }\r\n        })\r\n    },\r\n    getData() {\r\n        return this._data\r\n    },\r\n    _dataSourceLoadErrorHandler: function() {\r\n        this._dataSourceChangedHandler()\r\n    },\r\n    _dataSourceChangedHandler: function() {\r\n        this._data = unwrapFromDataSource(this._dataSource && this._dataSource.items());\r\n        this._update(true)\r\n    },\r\n    _dataSourceOptions: function() {\r\n        return {\r\n            paginate: false\r\n        }\r\n    },\r\n    _getSpecificDataSourceOption: function() {\r\n        return this._specificDataSourceOption\r\n    },\r\n    _normalizeDataSource: function(dataSource) {\r\n        var store = dataSource.store();\r\n        if (\"raw\" === store._loadMode) {\r\n            store._loadMode = void 0\r\n        }\r\n        return dataSource\r\n    },\r\n    _offProjection: function() {\r\n        this._removeHandlers();\r\n        this._removeHandlers = null\r\n    },\r\n    dispose: function() {\r\n        this._disposeDataSource();\r\n        this._destroyHandles();\r\n        dropGrouping(this._context);\r\n        this._context.root.linkRemove().linkOff();\r\n        this._context.labelRoot && this._context.labelRoot.linkRemove().linkOff();\r\n        this._context.str.reset(this._context);\r\n        this._offProjection();\r\n        this._params = this._container = this._context = this.proxy = null;\r\n        return this\r\n    },\r\n    setOptions: function(options) {\r\n        options = this._options = options || {};\r\n        this._dataSourceLoaded = new Deferred;\r\n        if (\"dataSource\" in options && options.dataSource !== this._options_dataSource) {\r\n            this._options_dataSource = options.dataSource;\r\n            this._params.notifyDirty();\r\n            this._specificDataSourceOption = wrapToDataSource(options.dataSource);\r\n            this._refreshDataSource()\r\n        } else if (this._data.count() > 0) {\r\n            this._params.notifyDirty();\r\n            this._update(void 0 !== options.type && options.type !== this._context.str.type || void 0 !== options.elementType && options.elementType !== this._context.str.elementType)\r\n        }\r\n        this._transformCore()\r\n    },\r\n    _update: function(isContextChanged) {\r\n        var context = this._context;\r\n        if (isContextChanged) {\r\n            context.str.reset(context);\r\n            context.root.clear();\r\n            context.labelRoot && context.labelRoot.clear();\r\n            this._params.tracker.reset();\r\n            this._destroyHandles();\r\n            context.str = selectStrategy(this._options, this._data);\r\n            context.str.setup(context);\r\n            this.proxy.type = context.str.type;\r\n            this.proxy.elementType = context.str.elementType\r\n        }\r\n        context.settings = processCommonSettings(context, this._options);\r\n        context.hasSeparateLabel = !!(context.settings.label.enabled && context.str.hasLabelsGroup);\r\n        context.hover = !!_parseScalar(context.settings.hoverEnabled, true);\r\n        if (context.selection) {\r\n            _each(context.selection.state, (function(_, handle) {\r\n                handle && handle.resetSelected()\r\n            }))\r\n        }\r\n        context.selection = getSelection(context.settings.selectionMode);\r\n        if (context.hasSeparateLabel) {\r\n            if (!context.labelRoot) {\r\n                context.labelRoot = context.renderer.g().attr({\r\n                    class: \"dxm-layer-labels\"\r\n                }).linkOn(this._container, {\r\n                    name: context.name + \"-labels\",\r\n                    after: context.name\r\n                }).linkAppend();\r\n                this._transformCore()\r\n            }\r\n        } else if (context.labelRoot) {\r\n            context.labelRoot.linkRemove().linkOff();\r\n            context.labelRoot = null\r\n        }\r\n        if (isContextChanged) {\r\n            this._createHandles()\r\n        }\r\n        dropGrouping(context);\r\n        context.str.arrange(context, this._handles);\r\n        context.str.updateGrouping(context);\r\n        this._updateHandles();\r\n        this._params.notifyReady();\r\n        if (this._dataSourceLoaded) {\r\n            this._dataSourceLoaded.resolve();\r\n            this._dataSourceLoaded = null\r\n        } else {\r\n            this._params.dataReady()\r\n        }\r\n    },\r\n    getBounds() {\r\n        return getMaxBound(this._handles.map(_ref => {\r\n            var {\r\n                proxy: proxy\r\n            } = _ref;\r\n            return proxy.coordinates().map(coords => {\r\n                if (!_isArray(coords)) {\r\n                    return\r\n                }\r\n                var coordsToBoundsSearch = _isArray(coords[0][0]) ? coords.reduce((ac, val) => ac.concat(val), []) : coords;\r\n                var initValue = coordsToBoundsSearch[0];\r\n                return coordsToBoundsSearch.reduce((min, c) => [_min(min[0], c[0]), _min(min[1], c[1]), _max(min[2], c[0]), _max(min[3], c[1])], [initValue[0], initValue[1], initValue[0], initValue[1]])\r\n            })\r\n        }).map(getMaxBound))\r\n    },\r\n    _destroyHandles() {\r\n        this._handles.forEach(h => h.dispose());\r\n        if (this._context.selection) {\r\n            this._context.selection.state = {}\r\n        }\r\n        this._handles = []\r\n    },\r\n    _createHandles: function() {\r\n        var handles = this._handles = [];\r\n        var data = this._data;\r\n        var i;\r\n        var ii = handles.length = data.count();\r\n        var context = this._context;\r\n        var geometry = data.geometry;\r\n        var attributes = data.attributes;\r\n        var handle;\r\n        var dataItem;\r\n        for (i = 0; i < ii; ++i) {\r\n            dataItem = data.item(i);\r\n            handles[i] = new MapLayerElement(context, i, geometry(dataItem), attributes(dataItem))\r\n        }\r\n        _isFunction(this._options.customize) && customizeHandles(this.getProxies(), this._options.customize, this._params.widget);\r\n        for (i = 0; i < ii; ++i) {\r\n            handle = handles[i];\r\n            handle.project();\r\n            handle.draw();\r\n            handle.transform()\r\n        }\r\n        if (context.selection) {\r\n            _each(context.selection.state, (function(_, handle) {\r\n                handle && handle.restoreSelected()\r\n            }))\r\n        }\r\n    },\r\n    _updateHandles: function() {\r\n        var handles = this._handles;\r\n        var i;\r\n        var ii = handles.length;\r\n        for (i = 0; i < ii; ++i) {\r\n            handles[i].refresh()\r\n        }\r\n        if (this._context.settings.label.enabled) {\r\n            for (i = 0; i < ii; ++i) {\r\n                handles[i].measureLabel()\r\n            }\r\n            for (i = 0; i < ii; ++i) {\r\n                handles[i].adjustLabel()\r\n            }\r\n        }\r\n    },\r\n    _transformCore: function() {\r\n        var transform = this._params.projection.getTransform();\r\n        this._context.root.attr(transform);\r\n        this._context.labelRoot && this._context.labelRoot.attr(transform)\r\n    },\r\n    _project: function() {\r\n        var handles = this._handles;\r\n        var i;\r\n        var ii = handles.length;\r\n        for (i = 0; i < ii; ++i) {\r\n            handles[i].project()\r\n        }\r\n    },\r\n    _transform: function() {\r\n        var handles = this._handles;\r\n        var i;\r\n        var ii = handles.length;\r\n        this._transformCore();\r\n        for (i = 0; i < ii; ++i) {\r\n            handles[i].transform()\r\n        }\r\n    },\r\n    getProxies() {\r\n        return this._handles.map(p => p.proxy)\r\n    },\r\n    getProxy: function(index) {\r\n        return this._handles[index].proxy\r\n    },\r\n    raiseClick: function(i, dxEvent) {\r\n        this._params.eventTrigger(\"click\", {\r\n            target: this._handles[i].proxy,\r\n            event: dxEvent\r\n        })\r\n    },\r\n    hoverItem: function(i, state) {\r\n        this._handles[i].setHovered(state)\r\n    },\r\n    selectItem: function(i, state, _noEvent) {\r\n        this._handles[i].setSelected(state, _noEvent)\r\n    },\r\n    clearSelection: function() {\r\n        var selection = this._context.selection;\r\n        if (selection) {\r\n            _each(selection.state, (function(_, handle) {\r\n                handle && handle.setSelected(false)\r\n            }));\r\n            selection.state = {}\r\n        }\r\n    }\r\n}, DataHelperMixin);\r\n\r\nfunction createProxy(handle, coords, attrs) {\r\n    var proxy = {\r\n        coordinates: function() {\r\n            return coords\r\n        },\r\n        attribute: function(name, value) {\r\n            if (arguments.length > 1) {\r\n                attrs[name] = value;\r\n                return proxy\r\n            } else {\r\n                return arguments.length > 0 ? attrs[name] : attrs\r\n            }\r\n        },\r\n        selected: function(state, _noEvent) {\r\n            if (arguments.length > 0) {\r\n                handle.setSelected(state, _noEvent);\r\n                return proxy\r\n            } else {\r\n                return handle.isSelected()\r\n            }\r\n        },\r\n        applySettings: function(settings) {\r\n            handle.update(settings);\r\n            return proxy\r\n        }\r\n    };\r\n    return proxy\r\n}\r\nMapLayerElement = function(context, index, geometry, attributes) {\r\n    var proxy = this.proxy = createProxy(this, geometry.coordinates, _extend({}, attributes));\r\n    this._ctx = context;\r\n    this._index = index;\r\n    this._fig = this._label = null;\r\n    this._state = STATE_DEFAULT;\r\n    this._coordinates = geometry.coordinates;\r\n    this._settings = {\r\n        label: {}\r\n    };\r\n    proxy.index = index;\r\n    proxy.layer = context.layer;\r\n    this._data = {\r\n        name: context.name,\r\n        index: index\r\n    }\r\n};\r\nMapLayerElement.prototype = {\r\n    constructor: MapLayerElement,\r\n    dispose: function() {\r\n        this._ctx = this.proxy = this._settings = this._fig = this._label = this.data = null;\r\n        return this\r\n    },\r\n    project: function() {\r\n        var context = this._ctx;\r\n        this._projection = context.str.project(context.projection, this._coordinates);\r\n        if (context.hasSeparateLabel && this._label) {\r\n            this._projectLabel()\r\n        }\r\n    },\r\n    _projectLabel: function() {\r\n        this._labelProjection = this._ctx.str.projectLabel(this._projection)\r\n    },\r\n    draw: function() {\r\n        var context = this._ctx;\r\n        context.str.draw(context, this._fig = {}, this._data);\r\n        this._fig.root.append(context.root)\r\n    },\r\n    transform: function() {\r\n        var context = this._ctx;\r\n        context.str.transform(this._fig, context.projection, this._projection);\r\n        if (context.hasSeparateLabel && this._label) {\r\n            this._transformLabel()\r\n        }\r\n    },\r\n    _transformLabel: function() {\r\n        this._ctx.str.transformLabel(this._label, this._ctx.projection, this._labelProjection)\r\n    },\r\n    refresh: function() {\r\n        var strategy = this._ctx.str;\r\n        var settings = getItemSettings(this._ctx, this.proxy, this._settings);\r\n        this._styles = strategy.getStyles(settings);\r\n        strategy.refresh(this._ctx, this._fig, this._data, this.proxy, settings);\r\n        this._refreshLabel(settings);\r\n        this._setState()\r\n    },\r\n    _refreshLabel: function(settings) {\r\n        var context = this._ctx;\r\n        var labelSettings = settings.label;\r\n        var label = this._label;\r\n        if (context.settings.label.enabled) {\r\n            if (!label) {\r\n                label = this._label = {\r\n                    root: context.labelRoot || this._fig.root,\r\n                    text: context.renderer.text().attr({\r\n                        class: \"dxm-label\"\r\n                    }),\r\n                    size: [0, 0]\r\n                };\r\n                if (context.hasSeparateLabel) {\r\n                    this._projectLabel();\r\n                    this._transformLabel()\r\n                }\r\n            }\r\n            label.value = _String(this.proxy.text || this.proxy.attribute(labelSettings.dataField) || \"\");\r\n            if (label.value) {\r\n                label.text.attr({\r\n                    text: label.value,\r\n                    x: 0,\r\n                    y: 0\r\n                }).css(_patchFontOptions(labelSettings.font)).attr({\r\n                    align: \"center\",\r\n                    stroke: labelSettings.stroke,\r\n                    \"stroke-width\": labelSettings[\"stroke-width\"],\r\n                    \"stroke-opacity\": labelSettings[\"stroke-opacity\"]\r\n                }).data(context.dataKey, this._data).append(label.root);\r\n                label.settings = settings\r\n            }\r\n        } else if (label) {\r\n            label.text.remove();\r\n            this._label = null\r\n        }\r\n    },\r\n    measureLabel: function() {\r\n        var label = this._label;\r\n        var bBox;\r\n        if (label.value) {\r\n            bBox = label.text.getBBox();\r\n            label.size = [bBox.width, bBox.height, -bBox.y - bBox.height / 2]\r\n        }\r\n    },\r\n    adjustLabel: function() {\r\n        var label = this._label;\r\n        var offset;\r\n        if (label.value) {\r\n            offset = this._ctx.str.getLabelOffset(label, label.settings);\r\n            label.settings = null;\r\n            label.text.attr({\r\n                x: offset[0],\r\n                y: offset[1] + label.size[2]\r\n            })\r\n        }\r\n    },\r\n    update: function(settings) {\r\n        this._settings = combineSettings(this._settings, settings);\r\n        if (this._fig) {\r\n            this.refresh();\r\n            if (this._label && this._label.value) {\r\n                this.measureLabel();\r\n                this.adjustLabel()\r\n            }\r\n        }\r\n    },\r\n    _setState: function() {\r\n        this._ctx.str.setState(this._fig, this._styles, STATE_TO_INDEX[this._state])\r\n    },\r\n    _setForeground: function() {\r\n        var root = this._fig.root;\r\n        this._state ? root.toForeground() : root.toBackground()\r\n    },\r\n    setHovered: function(state) {\r\n        var currentState = hasFlag(this._state, STATE_HOVERED);\r\n        var newState = !!state;\r\n        if (this._ctx.hover && currentState !== newState) {\r\n            this._state = setFlag(this._state, STATE_HOVERED, newState);\r\n            this._setState();\r\n            this._setForeground();\r\n            raiseChanged(this._ctx, this, newState, \"hoverChanged\")\r\n        }\r\n        return this\r\n    },\r\n    setSelected: function(state, _noEvent) {\r\n        var currentState = hasFlag(this._state, STATE_SELECTED);\r\n        var newState = !!state;\r\n        var selection = this._ctx.selection;\r\n        var tmp;\r\n        if (selection && currentState !== newState) {\r\n            this._state = setFlag(this._state, STATE_SELECTED, newState);\r\n            tmp = selection.state[selection.single];\r\n            selection.state[selection.single] = null;\r\n            if (tmp) {\r\n                tmp.setSelected(false)\r\n            }\r\n            selection.state[selection.single || this._index] = state ? this : null;\r\n            if (this._fig) {\r\n                this._setState();\r\n                this._setForeground();\r\n                if (!_noEvent) {\r\n                    raiseChanged(this._ctx, this, newState, \"selectionChanged\")\r\n                }\r\n            }\r\n        }\r\n    },\r\n    isSelected: function() {\r\n        return hasFlag(this._state, STATE_SELECTED)\r\n    },\r\n    resetSelected: function() {\r\n        this._state = setFlag(this._state, STATE_SELECTED, false)\r\n    },\r\n    restoreSelected: function() {\r\n        this._fig.root.toForeground()\r\n    }\r\n};\r\n\r\nfunction calculatePolygonCentroid(coordinates) {\r\n    var i;\r\n    var length = coordinates.length;\r\n    var v1;\r\n    var v2 = coordinates[length - 1];\r\n    var cross;\r\n    var cx = 0;\r\n    var cy = 0;\r\n    var area = 0;\r\n    var minX = 1 / 0;\r\n    var maxX = -1 / 0;\r\n    var minY = 1 / 0;\r\n    var maxY = -1 / 0;\r\n    for (i = 0; i < length; ++i) {\r\n        v1 = v2;\r\n        v2 = coordinates[i];\r\n        cross = v1[0] * v2[1] - v2[0] * v1[1];\r\n        area += cross;\r\n        cx += (v1[0] + v2[0]) * cross;\r\n        cy += (v1[1] + v2[1]) * cross;\r\n        minX = _min(minX, v2[0]);\r\n        maxX = _max(maxX, v2[0]);\r\n        minY = _min(minY, v2[1]);\r\n        maxY = _max(maxY, v2[1])\r\n    }\r\n    return {\r\n        area: _abs(area) / 2,\r\n        center: [2 * cx / 3 / area - (minX + maxX) / 2, 2 * cy / 3 / area - (minY + maxY) / 2]\r\n    }\r\n}\r\n\r\nfunction calculateLineStringData(coordinates) {\r\n    var i;\r\n    var ii = coordinates.length;\r\n    var v1;\r\n    var v2 = coordinates[0] || [];\r\n    var totalLength = 0;\r\n    var items = [0];\r\n    var min0 = v2[0];\r\n    var max0 = v2[0];\r\n    var min1 = v2[1];\r\n    var max1 = v2[1];\r\n    for (i = 1; i < ii; ++i) {\r\n        v1 = v2;\r\n        v2 = coordinates[i];\r\n        totalLength += _sqrt((v1[0] - v2[0]) * (v1[0] - v2[0]) + (v1[1] - v2[1]) * (v1[1] - v2[1]));\r\n        items[i] = totalLength;\r\n        min0 = _min(min0, v2[0]);\r\n        max0 = _max(max0, v2[0]);\r\n        min1 = _min(min1, v2[1]);\r\n        max1 = _max(max1, v2[1])\r\n    }\r\n    i = findGroupingIndex(totalLength / 2, items);\r\n    v1 = coordinates[i];\r\n    v2 = coordinates[i + 1];\r\n    var t = (totalLength / 2 - items[i]) / (items[i + 1] - items[i]);\r\n    return ii ? [\r\n        [v1[0] * (1 - t) + v2[0] * t, v1[1] * (1 - t) + v2[1] * t],\r\n        [max0 - min0, max1 - min1], totalLength\r\n    ] : []\r\n}\r\n\r\nfunction projectAreaLabel(coordinates) {\r\n    var i;\r\n    var ii = coordinates.length;\r\n    var centroid;\r\n    var resultCentroid;\r\n    var maxArea = 0;\r\n    for (i = 0; i < ii; ++i) {\r\n        centroid = calculatePolygonCentroid(coordinates[i]);\r\n        if (centroid.area > maxArea) {\r\n            maxArea = centroid.area;\r\n            resultCentroid = centroid\r\n        }\r\n    }\r\n    return resultCentroid ? [resultCentroid.center, [_sqrt(resultCentroid.area), _sqrt(resultCentroid.area)]] : [\r\n        [],\r\n        []\r\n    ]\r\n}\r\n\r\nfunction projectLineLabel(coordinates) {\r\n    var i;\r\n    var ii = coordinates.length;\r\n    var maxLength = 0;\r\n    var data;\r\n    var resultData;\r\n    for (i = 0; i < ii; ++i) {\r\n        data = calculateLineStringData(coordinates[i]);\r\n        if (data[2] > maxLength) {\r\n            maxLength = data[2];\r\n            resultData = data\r\n        }\r\n    }\r\n    return resultData || [\r\n        [],\r\n        []\r\n    ]\r\n}\r\nexport function MapLayerCollection(params) {\r\n    var renderer = params.renderer;\r\n    this._params = params;\r\n    this._layers = [];\r\n    this._layerByName = {};\r\n    this._rect = [0, 0, 0, 0];\r\n    this._clip = renderer.clipRect();\r\n    this._background = renderer.rect().attr({\r\n        class: \"dxm-background\"\r\n    }).data(params.dataKey, {\r\n        name: \"background\"\r\n    }).append(renderer.root);\r\n    this._container = renderer.g().attr({\r\n        class: \"dxm-layers\",\r\n        \"clip-path\": this._clip.id\r\n    }).append(renderer.root).enableLinks();\r\n    this._subscribeToTracker(params.tracker, renderer, params.eventTrigger);\r\n    this._dataReady = params.dataReady\r\n}\r\nMapLayerCollection.prototype = {\r\n    constructor: MapLayerCollection,\r\n    dispose: function() {\r\n        this._clip.dispose();\r\n        this._layers.forEach(l => l.dispose());\r\n        this._offTracker();\r\n        this._params = this._offTracker = this._layers = this._layerByName = this._clip = this._background = this._container = null\r\n    },\r\n    _subscribeToTracker: function(tracker, renderer, eventTrigger) {\r\n        var that = this;\r\n        that._offTracker = tracker.on({\r\n            click: function(arg) {\r\n                var offset = renderer.getRootOffset();\r\n                var layer = that.byName(arg.data.name);\r\n                arg.$event.x = arg.x - offset.left;\r\n                arg.$event.y = arg.y - offset.top;\r\n                if (layer) {\r\n                    layer.raiseClick(arg.data.index, arg.$event)\r\n                } else if (\"background\" === arg.data.name) {\r\n                    eventTrigger(\"click\", {\r\n                        event: arg.$event\r\n                    })\r\n                }\r\n            },\r\n            \"hover-on\": function(arg) {\r\n                var layer = that.byName(arg.data.name);\r\n                if (layer) {\r\n                    layer.hoverItem(arg.data.index, true)\r\n                }\r\n            },\r\n            \"hover-off\": function(arg) {\r\n                var layer = that.byName(arg.data.name);\r\n                if (layer) {\r\n                    layer.hoverItem(arg.data.index, false)\r\n                }\r\n            }\r\n        })\r\n    },\r\n    setOptions(options) {\r\n        var optionList = options ? _isArray(options) ? options : [options] : [];\r\n        var layers = this._layers;\r\n        var readyCallbacks;\r\n        var needToCreateLayers = optionList.length !== layers.length || layers.some((l, i) => {\r\n            var name = getName(optionList, i);\r\n            return _isDefined(name) && name !== l.proxy.name\r\n        });\r\n        if (needToCreateLayers) {\r\n            this._params.tracker.reset();\r\n            this._layers.forEach(l => l.dispose());\r\n            var layerByName = this._layerByName = {};\r\n            this._layers = layers = [];\r\n            for (var i = 0, ii = optionList.length; i < ii; ++i) {\r\n                var name = getName(optionList, i) || \"map-layer-\" + i;\r\n                var layer = layers[i] = new MapLayer(this._params, this._container, name, i);\r\n                layerByName[name] = layer\r\n            }\r\n        }\r\n        layers.forEach((l, i) => {\r\n            l.setOptions(optionList[i])\r\n        });\r\n        readyCallbacks = layers.map(l => l.getDataReadyCallback());\r\n        readyCallbacks.length && when.apply(void 0, readyCallbacks).done(this._dataReady)\r\n    },\r\n    _updateClip: function() {\r\n        var rect = this._rect;\r\n        var bw = this._borderWidth;\r\n        this._clip.attr({\r\n            x: rect[0] + bw,\r\n            y: rect[1] + bw,\r\n            width: _max(rect[2] - 2 * bw, 0),\r\n            height: _max(rect[3] - 2 * bw, 0)\r\n        })\r\n    },\r\n    setBackgroundOptions: function(options) {\r\n        this._background.attr({\r\n            stroke: options.borderColor,\r\n            \"stroke-width\": options.borderWidth,\r\n            fill: options.color\r\n        });\r\n        this._borderWidth = _max(options.borderWidth, 0);\r\n        this._updateClip()\r\n    },\r\n    setRect: function(rect) {\r\n        this._rect = rect;\r\n        this._background.attr({\r\n            x: rect[0],\r\n            y: rect[1],\r\n            width: rect[2],\r\n            height: rect[3]\r\n        });\r\n        this._updateClip()\r\n    },\r\n    byIndex: function(index) {\r\n        return this._layers[index]\r\n    },\r\n    byName: function(name) {\r\n        return this._layerByName[name]\r\n    },\r\n    items: function() {\r\n        return this._layers\r\n    }\r\n};\r\n"],"mappings":"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"},"metadata":{},"sourceType":"module"}