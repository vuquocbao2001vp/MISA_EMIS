{"ast":null,"code":"import { __assign } from \"tslib\";\nimport dateutil from '../dateutil';\nimport { empty, repeat, pymod, includes } from '../helpers';\nimport { M365MASK, MDAY365MASK, NMDAY365MASK, WDAYMASK, M365RANGE, M366MASK, MDAY366MASK, NMDAY366MASK, M366RANGE } from '../masks';\nexport function rebuildYear(year, options) {\n  var firstyday = new Date(Date.UTC(year, 0, 1));\n  var yearlen = dateutil.isLeapYear(year) ? 366 : 365;\n  var nextyearlen = dateutil.isLeapYear(year + 1) ? 366 : 365;\n  var yearordinal = dateutil.toOrdinal(firstyday);\n  var yearweekday = dateutil.getWeekday(firstyday);\n\n  var result = __assign(__assign({\n    yearlen: yearlen,\n    nextyearlen: nextyearlen,\n    yearordinal: yearordinal,\n    yearweekday: yearweekday\n  }, baseYearMasks(year)), {\n    wnomask: null\n  });\n\n  if (empty(options.byweekno)) {\n    return result;\n  }\n\n  result.wnomask = repeat(0, yearlen + 7);\n  var firstwkst;\n  var wyearlen;\n  var no1wkst = firstwkst = pymod(7 - yearweekday + options.wkst, 7);\n\n  if (no1wkst >= 4) {\n    no1wkst = 0; // Number of days in the year, plus the days we got\n    // from last year.\n\n    wyearlen = result.yearlen + pymod(yearweekday - options.wkst, 7);\n  } else {\n    // Number of days in the year, minus the days we\n    // left in last year.\n    wyearlen = yearlen - no1wkst;\n  }\n\n  var div = Math.floor(wyearlen / 7);\n  var mod = pymod(wyearlen, 7);\n  var numweeks = Math.floor(div + mod / 4);\n\n  for (var j = 0; j < options.byweekno.length; j++) {\n    var n = options.byweekno[j];\n\n    if (n < 0) {\n      n += numweeks + 1;\n    }\n\n    if (!(n > 0 && n <= numweeks)) {\n      continue;\n    }\n\n    var i = void 0;\n\n    if (n > 1) {\n      i = no1wkst + (n - 1) * 7;\n\n      if (no1wkst !== firstwkst) {\n        i -= 7 - firstwkst;\n      }\n    } else {\n      i = no1wkst;\n    }\n\n    for (var k = 0; k < 7; k++) {\n      result.wnomask[i] = 1;\n      i++;\n      if (result.wdaymask[i] === options.wkst) break;\n    }\n  }\n\n  if (includes(options.byweekno, 1)) {\n    // Check week number 1 of next year as well\n    // orig-TODO : Check -numweeks for next year.\n    var i = no1wkst + numweeks * 7;\n    if (no1wkst !== firstwkst) i -= 7 - firstwkst;\n\n    if (i < yearlen) {\n      // If week starts in next year, we\n      // don't care about it.\n      for (var j = 0; j < 7; j++) {\n        result.wnomask[i] = 1;\n        i += 1;\n        if (result.wdaymask[i] === options.wkst) break;\n      }\n    }\n  }\n\n  if (no1wkst) {\n    // Check last week number of last year as\n    // well. If no1wkst is 0, either the year\n    // started on week start, or week number 1\n    // got days from last year, so there are no\n    // days from last year's last week number in\n    // this year.\n    var lnumweeks = void 0;\n\n    if (!includes(options.byweekno, -1)) {\n      var lyearweekday = dateutil.getWeekday(new Date(Date.UTC(year - 1, 0, 1)));\n      var lno1wkst = pymod(7 - lyearweekday.valueOf() + options.wkst, 7);\n      var lyearlen = dateutil.isLeapYear(year - 1) ? 366 : 365;\n      var weekst = void 0;\n\n      if (lno1wkst >= 4) {\n        lno1wkst = 0;\n        weekst = lyearlen + pymod(lyearweekday - options.wkst, 7);\n      } else {\n        weekst = yearlen - no1wkst;\n      }\n\n      lnumweeks = Math.floor(52 + pymod(weekst, 7) / 4);\n    } else {\n      lnumweeks = -1;\n    }\n\n    if (includes(options.byweekno, lnumweeks)) {\n      for (var i = 0; i < no1wkst; i++) result.wnomask[i] = 1;\n    }\n  }\n\n  return result;\n}\n\nfunction baseYearMasks(year) {\n  var yearlen = dateutil.isLeapYear(year) ? 366 : 365;\n  var firstyday = new Date(Date.UTC(year, 0, 1));\n  var wday = dateutil.getWeekday(firstyday);\n\n  if (yearlen === 365) {\n    return {\n      mmask: M365MASK,\n      mdaymask: MDAY365MASK,\n      nmdaymask: NMDAY365MASK,\n      wdaymask: WDAYMASK.slice(wday),\n      mrange: M365RANGE\n    };\n  }\n\n  return {\n    mmask: M366MASK,\n    mdaymask: MDAY366MASK,\n    nmdaymask: NMDAY366MASK,\n    wdaymask: WDAYMASK.slice(wday),\n    mrange: M366RANGE\n  };\n}","map":{"version":3,"mappings":"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","names":["dateutil","empty","repeat","pymod","includes","M365MASK","MDAY365MASK","NMDAY365MASK","WDAYMASK","M365RANGE","M366MASK","MDAY366MASK","NMDAY366MASK","M366RANGE","rebuildYear","year","options","firstyday","Date","UTC","yearlen","isLeapYear","nextyearlen","yearordinal","toOrdinal","yearweekday","getWeekday","result","baseYearMasks","wnomask","byweekno","firstwkst","wyearlen","no1wkst","wkst","div","Math","floor","mod","numweeks","j","length","n","i","k","wdaymask","lnumweeks","lyearweekday","lno1wkst","valueOf","lyearlen","weekst","wday","mmask","mdaymask","nmdaymask","slice","mrange"],"sourceRoot":"","sources":["../../../../src/iterinfo/yearinfo.ts"],"sourcesContent":[null]},"metadata":{},"sourceType":"module"}