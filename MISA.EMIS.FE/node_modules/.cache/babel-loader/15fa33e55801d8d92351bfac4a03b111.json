{"ast":null,"code":"/**\r\n * DevExtreme (esm/ui/collection/ui.collection_widget.edit.js)\r\n * Version: 22.1.4\r\n * Build date: Fri Jul 22 2022\r\n *\r\n * Copyright (c) 2012 - 2022 Developer Express Inc. ALL RIGHTS RESERVED\r\n * Read about DevExtreme licensing here: https://js.devexpress.com/Licensing/\r\n */\nimport $ from \"../../core/renderer\";\nimport eventsEngine from \"../../events/core/events_engine\";\nimport BaseCollectionWidget from \"./ui.collection_widget.base\";\nimport errors from \"../widget/ui.errors\";\nimport { extend } from \"../../core/utils/extend\";\nimport { each } from \"../../core/utils/iterator\";\nimport { noop } from \"../../core/utils/common\";\nimport { isDefined } from \"../../core/utils/type\";\nimport PlainEditStrategy from \"./ui.collection_widget.edit.strategy.plain\";\nimport { compileGetter } from \"../../core/utils/data\";\nimport { DataSource } from \"../../data/data_source/data_source\";\nimport { normalizeLoadResult } from \"../../data/data_source/utils\";\nimport Selection from \"../selection/selection\";\nimport { when, Deferred, fromPromise } from \"../../core/utils/deferred\";\nvar ITEM_DELETING_DATA_KEY = \"dxItemDeleting\";\nvar NOT_EXISTING_INDEX = -1;\n\nvar indexExists = function (index) {\n  return index !== NOT_EXISTING_INDEX;\n};\n\nvar CollectionWidget = BaseCollectionWidget.inherit({\n  _setOptionsByReference: function () {\n    this.callBase();\n    extend(this._optionsByReference, {\n      selectedItem: true\n    });\n  },\n  _getDefaultOptions: function () {\n    return extend(this.callBase(), {\n      selectionMode: \"none\",\n      selectionRequired: false,\n      selectionByClick: true,\n      selectedItems: [],\n      selectedItemKeys: [],\n      maxFilterLengthInRequest: 1500,\n      keyExpr: null,\n      selectedIndex: NOT_EXISTING_INDEX,\n      selectedItem: null,\n      onSelectionChanged: null,\n      onItemReordered: null,\n      onItemDeleting: null,\n      onItemDeleted: null\n    });\n  },\n  ctor: function (element, options) {\n    this._userOptions = options || {};\n    this.callBase(element, options);\n  },\n  _init: function () {\n    this._initEditStrategy();\n\n    this.callBase();\n\n    this._initKeyGetter();\n\n    this._initSelectionModule();\n  },\n  _initKeyGetter: function () {\n    this._keyGetter = compileGetter(this.option(\"keyExpr\"));\n  },\n  _getKeysByItems: function (selectedItems) {\n    return this._editStrategy.getKeysByItems(selectedItems);\n  },\n  _getItemsByKeys: function (selectedItemKeys, selectedItems) {\n    return this._editStrategy.getItemsByKeys(selectedItemKeys, selectedItems);\n  },\n  _getKeyByIndex: function (index) {\n    return this._editStrategy.getKeyByIndex(index);\n  },\n  _getIndexByKey: function (key) {\n    return this._editStrategy.getIndexByKey(key);\n  },\n  _getIndexByItemData: function (itemData) {\n    return this._editStrategy.getIndexByItemData(itemData);\n  },\n  _isKeySpecified: function () {\n    return !!(this._dataSource && this._dataSource.key());\n  },\n  _getCombinedFilter: function () {\n    return this._dataSource && this._dataSource.filter();\n  },\n  key: function () {\n    if (this.option(\"keyExpr\")) {\n      return this.option(\"keyExpr\");\n    }\n\n    return this._dataSource && this._dataSource.key();\n  },\n  keyOf: function (item) {\n    var key = item;\n\n    var store = this._dataSource && this._dataSource.store();\n\n    if (this.option(\"keyExpr\")) {\n      key = this._keyGetter(item);\n    } else if (store) {\n      key = store.keyOf(item);\n    }\n\n    return key;\n  },\n  _nullValueSelectionSupported: function () {\n    return false;\n  },\n  _initSelectionModule: function () {\n    var that = this;\n    var itemsGetter = that._editStrategy.itemsGetter;\n    this._selection = new Selection({\n      allowNullValue: this._nullValueSelectionSupported(),\n      mode: this.option(\"selectionMode\"),\n      maxFilterLengthInRequest: this.option(\"maxFilterLengthInRequest\"),\n      equalByReference: !this._isKeySpecified(),\n      onSelectionChanged: function (args) {\n        if (args.addedItemKeys.length || args.removedItemKeys.length) {\n          that.option(\"selectedItems\", that._getItemsByKeys(args.selectedItemKeys, args.selectedItems));\n\n          that._updateSelectedItems(args);\n        }\n      },\n      filter: that._getCombinedFilter.bind(that),\n      totalCount: function () {\n        var items = that.option(\"items\");\n        var dataSource = that._dataSource;\n        return dataSource && dataSource.totalCount() >= 0 ? dataSource.totalCount() : that._getItemsCount(items);\n      },\n      key: that.key.bind(that),\n      keyOf: that.keyOf.bind(that),\n      load: function (options) {\n        if (that._dataSource) {\n          var loadOptions = that._dataSource.loadOptions();\n\n          options.customQueryParams = loadOptions.customQueryParams;\n          options.userData = that._dataSource._userData;\n        }\n\n        var store = that._dataSource && that._dataSource.store();\n\n        if (store) {\n          return store.load(options).done(function (loadResult) {\n            if (that._disposed) {\n              return;\n            }\n\n            var items = normalizeLoadResult(loadResult).data;\n\n            that._dataSource._applyMapFunction(items);\n          });\n        } else {\n          return new Deferred().resolve(this.plainItems());\n        }\n      },\n      dataFields: function () {\n        return that._dataSource && that._dataSource.select();\n      },\n      plainItems: itemsGetter.bind(that._editStrategy)\n    });\n  },\n  _getItemsCount: function (items) {\n    return items.reduce((itemsCount, item) => itemsCount + (item.items ? this._getItemsCount(item.items) : 1), 0);\n  },\n  _initEditStrategy: function () {\n    var Strategy = PlainEditStrategy;\n    this._editStrategy = new Strategy(this);\n  },\n  _getSelectedItemIndices: function (keys) {\n    var that = this;\n    var indices = [];\n    keys = keys || this._selection.getSelectedItemKeys();\n\n    that._editStrategy.beginCache();\n\n    each(keys, function (_, key) {\n      var selectedIndex = that._getIndexByKey(key);\n\n      if (indexExists(selectedIndex)) {\n        indices.push(selectedIndex);\n      }\n    });\n\n    that._editStrategy.endCache();\n\n    return indices;\n  },\n  _initMarkup: function () {\n    this._rendering = true;\n\n    if (!this._dataSource || !this._dataSource.isLoading()) {\n      this._syncSelectionOptions().done(() => this._normalizeSelectedItems());\n    }\n\n    this.callBase();\n  },\n  _render: function () {\n    this.callBase();\n    this._rendering = false;\n  },\n  _fireContentReadyAction: function () {\n    this._rendering = false;\n    this._rendered = true;\n    this.callBase.apply(this, arguments);\n  },\n  _syncSelectionOptions: function (byOption) {\n    byOption = byOption || this._chooseSelectOption();\n    var selectedItem;\n    var selectedIndex;\n    var selectedItemKeys;\n    var selectedItems;\n\n    switch (byOption) {\n      case \"selectedIndex\":\n        selectedItem = this._editStrategy.getItemDataByIndex(this.option(\"selectedIndex\"));\n\n        if (isDefined(selectedItem)) {\n          this._setOptionWithoutOptionChange(\"selectedItems\", [selectedItem]);\n\n          this._setOptionWithoutOptionChange(\"selectedItem\", selectedItem);\n\n          this._setOptionWithoutOptionChange(\"selectedItemKeys\", this._editStrategy.getKeysByItems([selectedItem]));\n        } else {\n          this._setOptionWithoutOptionChange(\"selectedItems\", []);\n\n          this._setOptionWithoutOptionChange(\"selectedItemKeys\", []);\n\n          this._setOptionWithoutOptionChange(\"selectedItem\", null);\n        }\n\n        break;\n\n      case \"selectedItems\":\n        selectedItems = this.option(\"selectedItems\") || [];\n        selectedIndex = selectedItems.length ? this._editStrategy.getIndexByItemData(selectedItems[0]) : NOT_EXISTING_INDEX;\n\n        if (this.option(\"selectionRequired\") && !indexExists(selectedIndex)) {\n          return this._syncSelectionOptions(\"selectedIndex\");\n        }\n\n        this._setOptionWithoutOptionChange(\"selectedItem\", selectedItems[0]);\n\n        this._setOptionWithoutOptionChange(\"selectedIndex\", selectedIndex);\n\n        this._setOptionWithoutOptionChange(\"selectedItemKeys\", this._editStrategy.getKeysByItems(selectedItems));\n\n        break;\n\n      case \"selectedItem\":\n        selectedItem = this.option(\"selectedItem\");\n        selectedIndex = this._editStrategy.getIndexByItemData(selectedItem);\n\n        if (this.option(\"selectionRequired\") && !indexExists(selectedIndex)) {\n          return this._syncSelectionOptions(\"selectedIndex\");\n        }\n\n        if (isDefined(selectedItem)) {\n          this._setOptionWithoutOptionChange(\"selectedItems\", [selectedItem]);\n\n          this._setOptionWithoutOptionChange(\"selectedIndex\", selectedIndex);\n\n          this._setOptionWithoutOptionChange(\"selectedItemKeys\", this._editStrategy.getKeysByItems([selectedItem]));\n        } else {\n          this._setOptionWithoutOptionChange(\"selectedItems\", []);\n\n          this._setOptionWithoutOptionChange(\"selectedItemKeys\", []);\n\n          this._setOptionWithoutOptionChange(\"selectedIndex\", NOT_EXISTING_INDEX);\n        }\n\n        break;\n\n      case \"selectedItemKeys\":\n        selectedItemKeys = this.option(\"selectedItemKeys\");\n\n        if (this.option(\"selectionRequired\")) {\n          var selectedItemIndex = this._getIndexByKey(selectedItemKeys[0]);\n\n          if (!indexExists(selectedItemIndex)) {\n            return this._syncSelectionOptions(\"selectedIndex\");\n          }\n        }\n\n        return this._selection.setSelection(selectedItemKeys);\n    }\n\n    return new Deferred().resolve().promise();\n  },\n  _chooseSelectOption: function () {\n    var optionName = \"selectedIndex\";\n\n    var isOptionDefined = function (optionName) {\n      var optionValue = this.option(optionName);\n      var length = isDefined(optionValue) && optionValue.length;\n      return length || optionName in this._userOptions;\n    }.bind(this);\n\n    if (isOptionDefined(\"selectedItems\")) {\n      optionName = \"selectedItems\";\n    } else if (isOptionDefined(\"selectedItem\")) {\n      optionName = \"selectedItem\";\n    } else if (isOptionDefined(\"selectedItemKeys\")) {\n      optionName = \"selectedItemKeys\";\n    }\n\n    return optionName;\n  },\n  _compareKeys: function (oldKeys, newKeys) {\n    if (oldKeys.length !== newKeys.length) {\n      return false;\n    }\n\n    for (var i = 0; i < newKeys.length; i++) {\n      if (oldKeys[i] !== newKeys[i]) {\n        return false;\n      }\n    }\n\n    return true;\n  },\n  _normalizeSelectedItems: function () {\n    if (\"none\" === this.option(\"selectionMode\")) {\n      this._setOptionWithoutOptionChange(\"selectedItems\", []);\n\n      this._syncSelectionOptions(\"selectedItems\");\n    } else if (\"single\" === this.option(\"selectionMode\")) {\n      var newSelection = this.option(\"selectedItems\");\n\n      if (newSelection.length > 1 || !newSelection.length && this.option(\"selectionRequired\") && this.option(\"items\") && this.option(\"items\").length) {\n        var currentSelection = this._selection.getSelectedItems();\n\n        var normalizedSelection = void 0 === newSelection[0] ? currentSelection[0] : newSelection[0];\n\n        if (void 0 === normalizedSelection) {\n          normalizedSelection = this._editStrategy.itemsGetter()[0];\n        }\n\n        if (this.option(\"grouped\") && normalizedSelection && normalizedSelection.items) {\n          normalizedSelection.items = [normalizedSelection.items[0]];\n        }\n\n        this._selection.setSelection(this._getKeysByItems([normalizedSelection]));\n\n        this._setOptionWithoutOptionChange(\"selectedItems\", [normalizedSelection]);\n\n        return this._syncSelectionOptions(\"selectedItems\");\n      } else {\n        this._selection.setSelection(this._getKeysByItems(newSelection));\n      }\n    } else {\n      var newKeys = this._getKeysByItems(this.option(\"selectedItems\"));\n\n      var oldKeys = this._selection.getSelectedItemKeys();\n\n      if (!this._compareKeys(oldKeys, newKeys)) {\n        this._selection.setSelection(newKeys);\n      }\n    }\n\n    return new Deferred().resolve().promise();\n  },\n  _itemClickHandler: function (e) {\n    var itemSelectPromise = new Deferred().resolve();\n    var callBase = this.callBase;\n\n    this._createAction(function (e) {\n      var _this$_itemSelectHand;\n\n      itemSelectPromise = null !== (_this$_itemSelectHand = this._itemSelectHandler(e.event)) && void 0 !== _this$_itemSelectHand ? _this$_itemSelectHand : itemSelectPromise;\n    }.bind(this), {\n      validatingTargetName: \"itemElement\"\n    })({\n      itemElement: $(e.currentTarget),\n      event: e\n    });\n\n    itemSelectPromise.always(() => {\n      callBase.apply(this, arguments);\n    });\n  },\n  _itemSelectHandler: function (e) {\n    var _itemSelectPromise;\n\n    var itemSelectPromise;\n\n    if (!this.option(\"selectionByClick\")) {\n      return;\n    }\n\n    var $itemElement = e.currentTarget;\n\n    if (this.isItemSelected($itemElement)) {\n      this.unselectItem(e.currentTarget);\n    } else {\n      itemSelectPromise = this.selectItem(e.currentTarget);\n    }\n\n    return null === (_itemSelectPromise = itemSelectPromise) || void 0 === _itemSelectPromise ? void 0 : _itemSelectPromise.promise();\n  },\n  _selectedItemElement: function (index) {\n    return this._itemElements().eq(index);\n  },\n  _postprocessRenderItem: function (args) {\n    if (\"none\" !== this.option(\"selectionMode\")) {\n      var $itemElement = $(args.itemElement);\n\n      var normalizedItemIndex = this._editStrategy.getNormalizedIndex($itemElement);\n\n      var isItemSelected = this._isItemSelected(normalizedItemIndex);\n\n      this._processSelectableItem($itemElement, isItemSelected);\n    }\n  },\n  _processSelectableItem: function ($itemElement, isSelected) {\n    $itemElement.toggleClass(this._selectedItemClass(), isSelected);\n\n    this._setAriaSelected($itemElement, String(isSelected));\n  },\n  _updateSelectedItems: function (args) {\n    var that = this;\n    var addedItemKeys = args.addedItemKeys;\n    var removedItemKeys = args.removedItemKeys;\n\n    if (that._rendered && (addedItemKeys.length || removedItemKeys.length)) {\n      var selectionChangePromise = that._selectionChangePromise;\n\n      if (!that._rendering) {\n        var addedSelection = [];\n        var normalizedIndex;\n        var removedSelection = [];\n\n        that._editStrategy.beginCache();\n\n        for (var i = 0; i < addedItemKeys.length; i++) {\n          normalizedIndex = that._getIndexByKey(addedItemKeys[i]);\n          addedSelection.push(normalizedIndex);\n\n          that._addSelection(normalizedIndex);\n        }\n\n        for (var _i = 0; _i < removedItemKeys.length; _i++) {\n          normalizedIndex = that._getIndexByKey(removedItemKeys[_i]);\n          removedSelection.push(normalizedIndex);\n\n          that._removeSelection(normalizedIndex);\n        }\n\n        that._editStrategy.endCache();\n\n        that._updateSelection(addedSelection, removedSelection);\n      }\n\n      when(selectionChangePromise).done(function () {\n        that._fireSelectionChangeEvent(args.addedItems, args.removedItems);\n      });\n    }\n  },\n  _fireSelectionChangeEvent: function (addedItems, removedItems) {\n    this._createActionByOption(\"onSelectionChanged\", {\n      excludeValidators: [\"disabled\", \"readOnly\"]\n    })({\n      addedItems: addedItems,\n      removedItems: removedItems\n    });\n  },\n  _updateSelection: noop,\n  _setAriaSelected: function ($target, value) {\n    this.setAria(\"selected\", value, $target);\n  },\n  _removeSelection: function (normalizedIndex) {\n    var $itemElement = this._editStrategy.getItemElement(normalizedIndex);\n\n    if (indexExists(normalizedIndex)) {\n      this._processSelectableItem($itemElement, false);\n\n      eventsEngine.triggerHandler($itemElement, \"stateChanged\", false);\n    }\n  },\n  _addSelection: function (normalizedIndex) {\n    var $itemElement = this._editStrategy.getItemElement(normalizedIndex);\n\n    if (indexExists(normalizedIndex)) {\n      this._processSelectableItem($itemElement, true);\n\n      eventsEngine.triggerHandler($itemElement, \"stateChanged\", true);\n    }\n  },\n  _isItemSelected: function (index) {\n    var key = this._getKeyByIndex(index);\n\n    return this._selection.isItemSelected(key, {\n      checkPending: true\n    });\n  },\n  _optionChanged: function (args) {\n    switch (args.name) {\n      case \"selectionMode\":\n        this._invalidate();\n\n        break;\n\n      case \"dataSource\":\n        if (!args.value || Array.isArray(args.value) && !args.value.length) {\n          this.option(\"selectedItemKeys\", []);\n        }\n\n        this.callBase(args);\n        break;\n\n      case \"selectedIndex\":\n      case \"selectedItem\":\n      case \"selectedItems\":\n      case \"selectedItemKeys\":\n        this._syncSelectionOptions(args.name).done(() => this._normalizeSelectedItems());\n\n        break;\n\n      case \"keyExpr\":\n        this._initKeyGetter();\n\n        break;\n\n      case \"selectionRequired\":\n        this._normalizeSelectedItems();\n\n        break;\n\n      case \"selectionByClick\":\n      case \"onSelectionChanged\":\n      case \"onItemDeleting\":\n      case \"onItemDeleted\":\n      case \"onItemReordered\":\n      case \"maxFilterLengthInRequest\":\n        break;\n\n      default:\n        this.callBase(args);\n    }\n  },\n  _clearSelectedItems: function () {\n    this._setOptionWithoutOptionChange(\"selectedItems\", []);\n\n    this._syncSelectionOptions(\"selectedItems\");\n  },\n  _waitDeletingPrepare: function ($itemElement) {\n    if ($itemElement.data(ITEM_DELETING_DATA_KEY)) {\n      return new Deferred().resolve().promise();\n    }\n\n    $itemElement.data(ITEM_DELETING_DATA_KEY, true);\n    var deferred = new Deferred();\n    var deletingActionArgs = {\n      cancel: false\n    };\n\n    var deletePromise = this._itemEventHandler($itemElement, \"onItemDeleting\", deletingActionArgs, {\n      excludeValidators: [\"disabled\", \"readOnly\"]\n    });\n\n    when(deletePromise).always(function (value) {\n      var deletePromiseExists = !deletePromise;\n      var deletePromiseResolved = !deletePromiseExists && \"resolved\" === deletePromise.state();\n      var argumentsSpecified = !!arguments.length;\n      var shouldDelete = deletePromiseExists || deletePromiseResolved && !argumentsSpecified || deletePromiseResolved && value;\n      when(fromPromise(deletingActionArgs.cancel)).always(function () {\n        $itemElement.data(ITEM_DELETING_DATA_KEY, false);\n      }).done(function (cancel) {\n        shouldDelete && !cancel ? deferred.resolve() : deferred.reject();\n      }).fail(deferred.reject);\n    }.bind(this));\n    return deferred.promise();\n  },\n  _deleteItemFromDS: function ($item) {\n    if (!this._dataSource) {\n      return new Deferred().resolve().promise();\n    }\n\n    var deferred = new Deferred();\n    var disabledState = this.option(\"disabled\");\n\n    var dataStore = this._dataSource.store();\n\n    this.option(\"disabled\", true);\n\n    if (!dataStore.remove) {\n      throw errors.Error(\"E1011\");\n    }\n\n    dataStore.remove(dataStore.keyOf(this._getItemData($item))).done(function (key) {\n      if (void 0 !== key) {\n        deferred.resolve();\n      } else {\n        deferred.reject();\n      }\n    }).fail(function () {\n      deferred.reject();\n    });\n    deferred.always(function () {\n      this.option(\"disabled\", disabledState);\n    }.bind(this));\n    return deferred;\n  },\n  _tryRefreshLastPage: function () {\n    var deferred = new Deferred();\n\n    if (this._isLastPage() || this.option(\"grouped\")) {\n      deferred.resolve();\n    } else {\n      this._refreshLastPage().done(function () {\n        deferred.resolve();\n      });\n    }\n\n    return deferred.promise();\n  },\n  _refreshLastPage: function () {\n    this._expectLastItemLoading();\n\n    return this._dataSource.load();\n  },\n  _updateSelectionAfterDelete: function (index) {\n    var key = this._getKeyByIndex(index);\n\n    this._selection.deselect([key]);\n  },\n  _updateIndicesAfterIndex: function (index) {\n    var itemElements = this._itemElements();\n\n    for (var i = index + 1; i < itemElements.length; i++) {\n      $(itemElements[i]).data(this._itemIndexKey(), i - 1);\n    }\n  },\n  _simulateOptionChange: function (optionName) {\n    var optionValue = this.option(optionName);\n\n    if (optionValue instanceof DataSource) {\n      return;\n    }\n\n    this._optionChangedAction({\n      name: optionName,\n      fullName: optionName,\n      value: optionValue\n    });\n  },\n  isItemSelected: function (itemElement) {\n    return this._isItemSelected(this._editStrategy.getNormalizedIndex(itemElement));\n  },\n  selectItem: function (itemElement) {\n    if (\"none\" === this.option(\"selectionMode\")) {\n      return;\n    }\n\n    var itemIndex = this._editStrategy.getNormalizedIndex(itemElement);\n\n    if (!indexExists(itemIndex)) {\n      return;\n    }\n\n    var key = this._getKeyByIndex(itemIndex);\n\n    if (this._selection.isItemSelected(key)) {\n      return;\n    }\n\n    if (\"single\" === this.option(\"selectionMode\")) {\n      return this._selection.setSelection([key]);\n    } else {\n      var selectedItemKeys = this.option(\"selectedItemKeys\") || [];\n      return this._selection.setSelection([...selectedItemKeys, key], [key]);\n    }\n  },\n  unselectItem: function (itemElement) {\n    var itemIndex = this._editStrategy.getNormalizedIndex(itemElement);\n\n    if (!indexExists(itemIndex)) {\n      return;\n    }\n\n    var selectedItemKeys = this._selection.getSelectedItemKeys();\n\n    if (this.option(\"selectionRequired\") && selectedItemKeys.length <= 1) {\n      return;\n    }\n\n    var key = this._getKeyByIndex(itemIndex);\n\n    if (!this._selection.isItemSelected(key, {\n      checkPending: true\n    })) {\n      return;\n    }\n\n    this._selection.deselect([key]);\n  },\n  _deleteItemElementByIndex: function (index) {\n    this._updateSelectionAfterDelete(index);\n\n    this._updateIndicesAfterIndex(index);\n\n    this._editStrategy.deleteItemAtIndex(index);\n  },\n  _afterItemElementDeleted: function ($item, deletedActionArgs) {\n    var changingOption = this._dataSource ? \"dataSource\" : \"items\";\n\n    this._simulateOptionChange(changingOption);\n\n    this._itemEventHandler($item, \"onItemDeleted\", deletedActionArgs, {\n      beforeExecute: function () {\n        $item.remove();\n      },\n      excludeValidators: [\"disabled\", \"readOnly\"]\n    });\n\n    this._renderEmptyMessage();\n  },\n  deleteItem: function (itemElement) {\n    var that = this;\n    var deferred = new Deferred();\n\n    var $item = this._editStrategy.getItemElement(itemElement);\n\n    var index = this._editStrategy.getNormalizedIndex(itemElement);\n\n    var itemResponseWaitClass = this._itemResponseWaitClass();\n\n    if (indexExists(index)) {\n      this._waitDeletingPrepare($item).done(function () {\n        $item.addClass(itemResponseWaitClass);\n\n        var deletedActionArgs = that._extendActionArgs($item);\n\n        that._deleteItemFromDS($item).done(function () {\n          that._deleteItemElementByIndex(index);\n\n          that._afterItemElementDeleted($item, deletedActionArgs);\n\n          that._tryRefreshLastPage().done(function () {\n            deferred.resolveWith(that);\n          });\n        }).fail(function () {\n          $item.removeClass(itemResponseWaitClass);\n          deferred.rejectWith(that);\n        });\n      }).fail(function () {\n        deferred.rejectWith(that);\n      });\n    } else {\n      deferred.rejectWith(that);\n    }\n\n    return deferred.promise();\n  },\n  reorderItem: function (itemElement, toItemElement) {\n    var deferred = new Deferred();\n    var that = this;\n    var strategy = this._editStrategy;\n    var $movingItem = strategy.getItemElement(itemElement);\n    var $destinationItem = strategy.getItemElement(toItemElement);\n    var movingIndex = strategy.getNormalizedIndex(itemElement);\n    var destinationIndex = strategy.getNormalizedIndex(toItemElement);\n    var changingOption = this._dataSource ? \"dataSource\" : \"items\";\n    var canMoveItems = indexExists(movingIndex) && indexExists(destinationIndex) && movingIndex !== destinationIndex;\n\n    if (canMoveItems) {\n      deferred.resolveWith(this);\n    } else {\n      deferred.rejectWith(this);\n    }\n\n    return deferred.promise().done(function () {\n      $destinationItem[strategy.itemPlacementFunc(movingIndex, destinationIndex)]($movingItem);\n      strategy.moveItemAtIndexToIndex(movingIndex, destinationIndex);\n\n      this._updateIndicesAfterIndex(movingIndex);\n\n      that.option(\"selectedItems\", that._getItemsByKeys(that._selection.getSelectedItemKeys(), that._selection.getSelectedItems()));\n\n      if (\"items\" === changingOption) {\n        that._simulateOptionChange(changingOption);\n      }\n\n      that._itemEventHandler($movingItem, \"onItemReordered\", {\n        fromIndex: strategy.getIndex(movingIndex),\n        toIndex: strategy.getIndex(destinationIndex)\n      }, {\n        excludeValidators: [\"disabled\", \"readOnly\"]\n      });\n    });\n  }\n});\nexport default CollectionWidget;","map":{"version":3,"names":["$","eventsEngine","BaseCollectionWidget","errors","extend","each","noop","isDefined","PlainEditStrategy","compileGetter","DataSource","normalizeLoadResult","Selection","when","Deferred","fromPromise","ITEM_DELETING_DATA_KEY","NOT_EXISTING_INDEX","indexExists","index","CollectionWidget","inherit","_setOptionsByReference","callBase","_optionsByReference","selectedItem","_getDefaultOptions","selectionMode","selectionRequired","selectionByClick","selectedItems","selectedItemKeys","maxFilterLengthInRequest","keyExpr","selectedIndex","onSelectionChanged","onItemReordered","onItemDeleting","onItemDeleted","ctor","element","options","_userOptions","_init","_initEditStrategy","_initKeyGetter","_initSelectionModule","_keyGetter","option","_getKeysByItems","_editStrategy","getKeysByItems","_getItemsByKeys","getItemsByKeys","_getKeyByIndex","getKeyByIndex","_getIndexByKey","key","getIndexByKey","_getIndexByItemData","itemData","getIndexByItemData","_isKeySpecified","_dataSource","_getCombinedFilter","filter","keyOf","item","store","_nullValueSelectionSupported","that","itemsGetter","_selection","allowNullValue","mode","equalByReference","args","addedItemKeys","length","removedItemKeys","_updateSelectedItems","bind","totalCount","items","dataSource","_getItemsCount","load","loadOptions","customQueryParams","userData","_userData","done","loadResult","_disposed","data","_applyMapFunction","resolve","plainItems","dataFields","select","reduce","itemsCount","Strategy","_getSelectedItemIndices","keys","indices","getSelectedItemKeys","beginCache","_","push","endCache","_initMarkup","_rendering","isLoading","_syncSelectionOptions","_normalizeSelectedItems","_render","_fireContentReadyAction","_rendered","apply","arguments","byOption","_chooseSelectOption","getItemDataByIndex","_setOptionWithoutOptionChange","selectedItemIndex","setSelection","promise","optionName","isOptionDefined","optionValue","_compareKeys","oldKeys","newKeys","i","newSelection","currentSelection","getSelectedItems","normalizedSelection","_itemClickHandler","e","itemSelectPromise","_createAction","_this$_itemSelectHand","_itemSelectHandler","event","validatingTargetName","itemElement","currentTarget","always","_itemSelectPromise","$itemElement","isItemSelected","unselectItem","selectItem","_selectedItemElement","_itemElements","eq","_postprocessRenderItem","normalizedItemIndex","getNormalizedIndex","_isItemSelected","_processSelectableItem","isSelected","toggleClass","_selectedItemClass","_setAriaSelected","String","selectionChangePromise","_selectionChangePromise","addedSelection","normalizedIndex","removedSelection","_addSelection","_i","_removeSelection","_updateSelection","_fireSelectionChangeEvent","addedItems","removedItems","_createActionByOption","excludeValidators","$target","value","setAria","getItemElement","triggerHandler","checkPending","_optionChanged","name","_invalidate","Array","isArray","_clearSelectedItems","_waitDeletingPrepare","deferred","deletingActionArgs","cancel","deletePromise","_itemEventHandler","deletePromiseExists","deletePromiseResolved","state","argumentsSpecified","shouldDelete","reject","fail","_deleteItemFromDS","$item","disabledState","dataStore","remove","Error","_getItemData","_tryRefreshLastPage","_isLastPage","_refreshLastPage","_expectLastItemLoading","_updateSelectionAfterDelete","deselect","_updateIndicesAfterIndex","itemElements","_itemIndexKey","_simulateOptionChange","_optionChangedAction","fullName","itemIndex","_deleteItemElementByIndex","deleteItemAtIndex","_afterItemElementDeleted","deletedActionArgs","changingOption","beforeExecute","_renderEmptyMessage","deleteItem","itemResponseWaitClass","_itemResponseWaitClass","addClass","_extendActionArgs","resolveWith","removeClass","rejectWith","reorderItem","toItemElement","strategy","$movingItem","$destinationItem","movingIndex","destinationIndex","canMoveItems","itemPlacementFunc","moveItemAtIndexToIndex","fromIndex","getIndex","toIndex"],"sources":["E:/MisaProject/W2022_06/MISA.EMIS.FE/node_modules/devextreme/esm/ui/collection/ui.collection_widget.edit.js"],"sourcesContent":["/**\r\n * DevExtreme (esm/ui/collection/ui.collection_widget.edit.js)\r\n * Version: 22.1.4\r\n * Build date: Fri Jul 22 2022\r\n *\r\n * Copyright (c) 2012 - 2022 Developer Express Inc. ALL RIGHTS RESERVED\r\n * Read about DevExtreme licensing here: https://js.devexpress.com/Licensing/\r\n */\r\nimport $ from \"../../core/renderer\";\r\nimport eventsEngine from \"../../events/core/events_engine\";\r\nimport BaseCollectionWidget from \"./ui.collection_widget.base\";\r\nimport errors from \"../widget/ui.errors\";\r\nimport {\r\n    extend\r\n} from \"../../core/utils/extend\";\r\nimport {\r\n    each\r\n} from \"../../core/utils/iterator\";\r\nimport {\r\n    noop\r\n} from \"../../core/utils/common\";\r\nimport {\r\n    isDefined\r\n} from \"../../core/utils/type\";\r\nimport PlainEditStrategy from \"./ui.collection_widget.edit.strategy.plain\";\r\nimport {\r\n    compileGetter\r\n} from \"../../core/utils/data\";\r\nimport {\r\n    DataSource\r\n} from \"../../data/data_source/data_source\";\r\nimport {\r\n    normalizeLoadResult\r\n} from \"../../data/data_source/utils\";\r\nimport Selection from \"../selection/selection\";\r\nimport {\r\n    when,\r\n    Deferred,\r\n    fromPromise\r\n} from \"../../core/utils/deferred\";\r\nvar ITEM_DELETING_DATA_KEY = \"dxItemDeleting\";\r\nvar NOT_EXISTING_INDEX = -1;\r\nvar indexExists = function(index) {\r\n    return index !== NOT_EXISTING_INDEX\r\n};\r\nvar CollectionWidget = BaseCollectionWidget.inherit({\r\n    _setOptionsByReference: function() {\r\n        this.callBase();\r\n        extend(this._optionsByReference, {\r\n            selectedItem: true\r\n        })\r\n    },\r\n    _getDefaultOptions: function() {\r\n        return extend(this.callBase(), {\r\n            selectionMode: \"none\",\r\n            selectionRequired: false,\r\n            selectionByClick: true,\r\n            selectedItems: [],\r\n            selectedItemKeys: [],\r\n            maxFilterLengthInRequest: 1500,\r\n            keyExpr: null,\r\n            selectedIndex: NOT_EXISTING_INDEX,\r\n            selectedItem: null,\r\n            onSelectionChanged: null,\r\n            onItemReordered: null,\r\n            onItemDeleting: null,\r\n            onItemDeleted: null\r\n        })\r\n    },\r\n    ctor: function(element, options) {\r\n        this._userOptions = options || {};\r\n        this.callBase(element, options)\r\n    },\r\n    _init: function() {\r\n        this._initEditStrategy();\r\n        this.callBase();\r\n        this._initKeyGetter();\r\n        this._initSelectionModule()\r\n    },\r\n    _initKeyGetter: function() {\r\n        this._keyGetter = compileGetter(this.option(\"keyExpr\"))\r\n    },\r\n    _getKeysByItems: function(selectedItems) {\r\n        return this._editStrategy.getKeysByItems(selectedItems)\r\n    },\r\n    _getItemsByKeys: function(selectedItemKeys, selectedItems) {\r\n        return this._editStrategy.getItemsByKeys(selectedItemKeys, selectedItems)\r\n    },\r\n    _getKeyByIndex: function(index) {\r\n        return this._editStrategy.getKeyByIndex(index)\r\n    },\r\n    _getIndexByKey: function(key) {\r\n        return this._editStrategy.getIndexByKey(key)\r\n    },\r\n    _getIndexByItemData: function(itemData) {\r\n        return this._editStrategy.getIndexByItemData(itemData)\r\n    },\r\n    _isKeySpecified: function() {\r\n        return !!(this._dataSource && this._dataSource.key())\r\n    },\r\n    _getCombinedFilter: function() {\r\n        return this._dataSource && this._dataSource.filter()\r\n    },\r\n    key: function() {\r\n        if (this.option(\"keyExpr\")) {\r\n            return this.option(\"keyExpr\")\r\n        }\r\n        return this._dataSource && this._dataSource.key()\r\n    },\r\n    keyOf: function(item) {\r\n        var key = item;\r\n        var store = this._dataSource && this._dataSource.store();\r\n        if (this.option(\"keyExpr\")) {\r\n            key = this._keyGetter(item)\r\n        } else if (store) {\r\n            key = store.keyOf(item)\r\n        }\r\n        return key\r\n    },\r\n    _nullValueSelectionSupported: function() {\r\n        return false\r\n    },\r\n    _initSelectionModule: function() {\r\n        var that = this;\r\n        var itemsGetter = that._editStrategy.itemsGetter;\r\n        this._selection = new Selection({\r\n            allowNullValue: this._nullValueSelectionSupported(),\r\n            mode: this.option(\"selectionMode\"),\r\n            maxFilterLengthInRequest: this.option(\"maxFilterLengthInRequest\"),\r\n            equalByReference: !this._isKeySpecified(),\r\n            onSelectionChanged: function(args) {\r\n                if (args.addedItemKeys.length || args.removedItemKeys.length) {\r\n                    that.option(\"selectedItems\", that._getItemsByKeys(args.selectedItemKeys, args.selectedItems));\r\n                    that._updateSelectedItems(args)\r\n                }\r\n            },\r\n            filter: that._getCombinedFilter.bind(that),\r\n            totalCount: function() {\r\n                var items = that.option(\"items\");\r\n                var dataSource = that._dataSource;\r\n                return dataSource && dataSource.totalCount() >= 0 ? dataSource.totalCount() : that._getItemsCount(items)\r\n            },\r\n            key: that.key.bind(that),\r\n            keyOf: that.keyOf.bind(that),\r\n            load: function(options) {\r\n                if (that._dataSource) {\r\n                    var loadOptions = that._dataSource.loadOptions();\r\n                    options.customQueryParams = loadOptions.customQueryParams;\r\n                    options.userData = that._dataSource._userData\r\n                }\r\n                var store = that._dataSource && that._dataSource.store();\r\n                if (store) {\r\n                    return store.load(options).done((function(loadResult) {\r\n                        if (that._disposed) {\r\n                            return\r\n                        }\r\n                        var items = normalizeLoadResult(loadResult).data;\r\n                        that._dataSource._applyMapFunction(items)\r\n                    }))\r\n                } else {\r\n                    return (new Deferred).resolve(this.plainItems())\r\n                }\r\n            },\r\n            dataFields: function() {\r\n                return that._dataSource && that._dataSource.select()\r\n            },\r\n            plainItems: itemsGetter.bind(that._editStrategy)\r\n        })\r\n    },\r\n    _getItemsCount: function(items) {\r\n        return items.reduce((itemsCount, item) => itemsCount + (item.items ? this._getItemsCount(item.items) : 1), 0)\r\n    },\r\n    _initEditStrategy: function() {\r\n        var Strategy = PlainEditStrategy;\r\n        this._editStrategy = new Strategy(this)\r\n    },\r\n    _getSelectedItemIndices: function(keys) {\r\n        var that = this;\r\n        var indices = [];\r\n        keys = keys || this._selection.getSelectedItemKeys();\r\n        that._editStrategy.beginCache();\r\n        each(keys, (function(_, key) {\r\n            var selectedIndex = that._getIndexByKey(key);\r\n            if (indexExists(selectedIndex)) {\r\n                indices.push(selectedIndex)\r\n            }\r\n        }));\r\n        that._editStrategy.endCache();\r\n        return indices\r\n    },\r\n    _initMarkup: function() {\r\n        this._rendering = true;\r\n        if (!this._dataSource || !this._dataSource.isLoading()) {\r\n            this._syncSelectionOptions().done(() => this._normalizeSelectedItems())\r\n        }\r\n        this.callBase()\r\n    },\r\n    _render: function() {\r\n        this.callBase();\r\n        this._rendering = false\r\n    },\r\n    _fireContentReadyAction: function() {\r\n        this._rendering = false;\r\n        this._rendered = true;\r\n        this.callBase.apply(this, arguments)\r\n    },\r\n    _syncSelectionOptions: function(byOption) {\r\n        byOption = byOption || this._chooseSelectOption();\r\n        var selectedItem;\r\n        var selectedIndex;\r\n        var selectedItemKeys;\r\n        var selectedItems;\r\n        switch (byOption) {\r\n            case \"selectedIndex\":\r\n                selectedItem = this._editStrategy.getItemDataByIndex(this.option(\"selectedIndex\"));\r\n                if (isDefined(selectedItem)) {\r\n                    this._setOptionWithoutOptionChange(\"selectedItems\", [selectedItem]);\r\n                    this._setOptionWithoutOptionChange(\"selectedItem\", selectedItem);\r\n                    this._setOptionWithoutOptionChange(\"selectedItemKeys\", this._editStrategy.getKeysByItems([selectedItem]))\r\n                } else {\r\n                    this._setOptionWithoutOptionChange(\"selectedItems\", []);\r\n                    this._setOptionWithoutOptionChange(\"selectedItemKeys\", []);\r\n                    this._setOptionWithoutOptionChange(\"selectedItem\", null)\r\n                }\r\n                break;\r\n            case \"selectedItems\":\r\n                selectedItems = this.option(\"selectedItems\") || [];\r\n                selectedIndex = selectedItems.length ? this._editStrategy.getIndexByItemData(selectedItems[0]) : NOT_EXISTING_INDEX;\r\n                if (this.option(\"selectionRequired\") && !indexExists(selectedIndex)) {\r\n                    return this._syncSelectionOptions(\"selectedIndex\")\r\n                }\r\n                this._setOptionWithoutOptionChange(\"selectedItem\", selectedItems[0]);\r\n                this._setOptionWithoutOptionChange(\"selectedIndex\", selectedIndex);\r\n                this._setOptionWithoutOptionChange(\"selectedItemKeys\", this._editStrategy.getKeysByItems(selectedItems));\r\n                break;\r\n            case \"selectedItem\":\r\n                selectedItem = this.option(\"selectedItem\");\r\n                selectedIndex = this._editStrategy.getIndexByItemData(selectedItem);\r\n                if (this.option(\"selectionRequired\") && !indexExists(selectedIndex)) {\r\n                    return this._syncSelectionOptions(\"selectedIndex\")\r\n                }\r\n                if (isDefined(selectedItem)) {\r\n                    this._setOptionWithoutOptionChange(\"selectedItems\", [selectedItem]);\r\n                    this._setOptionWithoutOptionChange(\"selectedIndex\", selectedIndex);\r\n                    this._setOptionWithoutOptionChange(\"selectedItemKeys\", this._editStrategy.getKeysByItems([selectedItem]))\r\n                } else {\r\n                    this._setOptionWithoutOptionChange(\"selectedItems\", []);\r\n                    this._setOptionWithoutOptionChange(\"selectedItemKeys\", []);\r\n                    this._setOptionWithoutOptionChange(\"selectedIndex\", NOT_EXISTING_INDEX)\r\n                }\r\n                break;\r\n            case \"selectedItemKeys\":\r\n                selectedItemKeys = this.option(\"selectedItemKeys\");\r\n                if (this.option(\"selectionRequired\")) {\r\n                    var selectedItemIndex = this._getIndexByKey(selectedItemKeys[0]);\r\n                    if (!indexExists(selectedItemIndex)) {\r\n                        return this._syncSelectionOptions(\"selectedIndex\")\r\n                    }\r\n                }\r\n                return this._selection.setSelection(selectedItemKeys)\r\n        }\r\n        return (new Deferred).resolve().promise()\r\n    },\r\n    _chooseSelectOption: function() {\r\n        var optionName = \"selectedIndex\";\r\n        var isOptionDefined = function(optionName) {\r\n            var optionValue = this.option(optionName);\r\n            var length = isDefined(optionValue) && optionValue.length;\r\n            return length || optionName in this._userOptions\r\n        }.bind(this);\r\n        if (isOptionDefined(\"selectedItems\")) {\r\n            optionName = \"selectedItems\"\r\n        } else if (isOptionDefined(\"selectedItem\")) {\r\n            optionName = \"selectedItem\"\r\n        } else if (isOptionDefined(\"selectedItemKeys\")) {\r\n            optionName = \"selectedItemKeys\"\r\n        }\r\n        return optionName\r\n    },\r\n    _compareKeys: function(oldKeys, newKeys) {\r\n        if (oldKeys.length !== newKeys.length) {\r\n            return false\r\n        }\r\n        for (var i = 0; i < newKeys.length; i++) {\r\n            if (oldKeys[i] !== newKeys[i]) {\r\n                return false\r\n            }\r\n        }\r\n        return true\r\n    },\r\n    _normalizeSelectedItems: function() {\r\n        if (\"none\" === this.option(\"selectionMode\")) {\r\n            this._setOptionWithoutOptionChange(\"selectedItems\", []);\r\n            this._syncSelectionOptions(\"selectedItems\")\r\n        } else if (\"single\" === this.option(\"selectionMode\")) {\r\n            var newSelection = this.option(\"selectedItems\");\r\n            if (newSelection.length > 1 || !newSelection.length && this.option(\"selectionRequired\") && this.option(\"items\") && this.option(\"items\").length) {\r\n                var currentSelection = this._selection.getSelectedItems();\r\n                var normalizedSelection = void 0 === newSelection[0] ? currentSelection[0] : newSelection[0];\r\n                if (void 0 === normalizedSelection) {\r\n                    normalizedSelection = this._editStrategy.itemsGetter()[0]\r\n                }\r\n                if (this.option(\"grouped\") && normalizedSelection && normalizedSelection.items) {\r\n                    normalizedSelection.items = [normalizedSelection.items[0]]\r\n                }\r\n                this._selection.setSelection(this._getKeysByItems([normalizedSelection]));\r\n                this._setOptionWithoutOptionChange(\"selectedItems\", [normalizedSelection]);\r\n                return this._syncSelectionOptions(\"selectedItems\")\r\n            } else {\r\n                this._selection.setSelection(this._getKeysByItems(newSelection))\r\n            }\r\n        } else {\r\n            var newKeys = this._getKeysByItems(this.option(\"selectedItems\"));\r\n            var oldKeys = this._selection.getSelectedItemKeys();\r\n            if (!this._compareKeys(oldKeys, newKeys)) {\r\n                this._selection.setSelection(newKeys)\r\n            }\r\n        }\r\n        return (new Deferred).resolve().promise()\r\n    },\r\n    _itemClickHandler: function(e) {\r\n        var itemSelectPromise = (new Deferred).resolve();\r\n        var callBase = this.callBase;\r\n        this._createAction(function(e) {\r\n            var _this$_itemSelectHand;\r\n            itemSelectPromise = null !== (_this$_itemSelectHand = this._itemSelectHandler(e.event)) && void 0 !== _this$_itemSelectHand ? _this$_itemSelectHand : itemSelectPromise\r\n        }.bind(this), {\r\n            validatingTargetName: \"itemElement\"\r\n        })({\r\n            itemElement: $(e.currentTarget),\r\n            event: e\r\n        });\r\n        itemSelectPromise.always(() => {\r\n            callBase.apply(this, arguments)\r\n        })\r\n    },\r\n    _itemSelectHandler: function(e) {\r\n        var _itemSelectPromise;\r\n        var itemSelectPromise;\r\n        if (!this.option(\"selectionByClick\")) {\r\n            return\r\n        }\r\n        var $itemElement = e.currentTarget;\r\n        if (this.isItemSelected($itemElement)) {\r\n            this.unselectItem(e.currentTarget)\r\n        } else {\r\n            itemSelectPromise = this.selectItem(e.currentTarget)\r\n        }\r\n        return null === (_itemSelectPromise = itemSelectPromise) || void 0 === _itemSelectPromise ? void 0 : _itemSelectPromise.promise()\r\n    },\r\n    _selectedItemElement: function(index) {\r\n        return this._itemElements().eq(index)\r\n    },\r\n    _postprocessRenderItem: function(args) {\r\n        if (\"none\" !== this.option(\"selectionMode\")) {\r\n            var $itemElement = $(args.itemElement);\r\n            var normalizedItemIndex = this._editStrategy.getNormalizedIndex($itemElement);\r\n            var isItemSelected = this._isItemSelected(normalizedItemIndex);\r\n            this._processSelectableItem($itemElement, isItemSelected)\r\n        }\r\n    },\r\n    _processSelectableItem: function($itemElement, isSelected) {\r\n        $itemElement.toggleClass(this._selectedItemClass(), isSelected);\r\n        this._setAriaSelected($itemElement, String(isSelected))\r\n    },\r\n    _updateSelectedItems: function(args) {\r\n        var that = this;\r\n        var addedItemKeys = args.addedItemKeys;\r\n        var removedItemKeys = args.removedItemKeys;\r\n        if (that._rendered && (addedItemKeys.length || removedItemKeys.length)) {\r\n            var selectionChangePromise = that._selectionChangePromise;\r\n            if (!that._rendering) {\r\n                var addedSelection = [];\r\n                var normalizedIndex;\r\n                var removedSelection = [];\r\n                that._editStrategy.beginCache();\r\n                for (var i = 0; i < addedItemKeys.length; i++) {\r\n                    normalizedIndex = that._getIndexByKey(addedItemKeys[i]);\r\n                    addedSelection.push(normalizedIndex);\r\n                    that._addSelection(normalizedIndex)\r\n                }\r\n                for (var _i = 0; _i < removedItemKeys.length; _i++) {\r\n                    normalizedIndex = that._getIndexByKey(removedItemKeys[_i]);\r\n                    removedSelection.push(normalizedIndex);\r\n                    that._removeSelection(normalizedIndex)\r\n                }\r\n                that._editStrategy.endCache();\r\n                that._updateSelection(addedSelection, removedSelection)\r\n            }\r\n            when(selectionChangePromise).done((function() {\r\n                that._fireSelectionChangeEvent(args.addedItems, args.removedItems)\r\n            }))\r\n        }\r\n    },\r\n    _fireSelectionChangeEvent: function(addedItems, removedItems) {\r\n        this._createActionByOption(\"onSelectionChanged\", {\r\n            excludeValidators: [\"disabled\", \"readOnly\"]\r\n        })({\r\n            addedItems: addedItems,\r\n            removedItems: removedItems\r\n        })\r\n    },\r\n    _updateSelection: noop,\r\n    _setAriaSelected: function($target, value) {\r\n        this.setAria(\"selected\", value, $target)\r\n    },\r\n    _removeSelection: function(normalizedIndex) {\r\n        var $itemElement = this._editStrategy.getItemElement(normalizedIndex);\r\n        if (indexExists(normalizedIndex)) {\r\n            this._processSelectableItem($itemElement, false);\r\n            eventsEngine.triggerHandler($itemElement, \"stateChanged\", false)\r\n        }\r\n    },\r\n    _addSelection: function(normalizedIndex) {\r\n        var $itemElement = this._editStrategy.getItemElement(normalizedIndex);\r\n        if (indexExists(normalizedIndex)) {\r\n            this._processSelectableItem($itemElement, true);\r\n            eventsEngine.triggerHandler($itemElement, \"stateChanged\", true)\r\n        }\r\n    },\r\n    _isItemSelected: function(index) {\r\n        var key = this._getKeyByIndex(index);\r\n        return this._selection.isItemSelected(key, {\r\n            checkPending: true\r\n        })\r\n    },\r\n    _optionChanged: function(args) {\r\n        switch (args.name) {\r\n            case \"selectionMode\":\r\n                this._invalidate();\r\n                break;\r\n            case \"dataSource\":\r\n                if (!args.value || Array.isArray(args.value) && !args.value.length) {\r\n                    this.option(\"selectedItemKeys\", [])\r\n                }\r\n                this.callBase(args);\r\n                break;\r\n            case \"selectedIndex\":\r\n            case \"selectedItem\":\r\n            case \"selectedItems\":\r\n            case \"selectedItemKeys\":\r\n                this._syncSelectionOptions(args.name).done(() => this._normalizeSelectedItems());\r\n                break;\r\n            case \"keyExpr\":\r\n                this._initKeyGetter();\r\n                break;\r\n            case \"selectionRequired\":\r\n                this._normalizeSelectedItems();\r\n                break;\r\n            case \"selectionByClick\":\r\n            case \"onSelectionChanged\":\r\n            case \"onItemDeleting\":\r\n            case \"onItemDeleted\":\r\n            case \"onItemReordered\":\r\n            case \"maxFilterLengthInRequest\":\r\n                break;\r\n            default:\r\n                this.callBase(args)\r\n        }\r\n    },\r\n    _clearSelectedItems: function() {\r\n        this._setOptionWithoutOptionChange(\"selectedItems\", []);\r\n        this._syncSelectionOptions(\"selectedItems\")\r\n    },\r\n    _waitDeletingPrepare: function($itemElement) {\r\n        if ($itemElement.data(ITEM_DELETING_DATA_KEY)) {\r\n            return (new Deferred).resolve().promise()\r\n        }\r\n        $itemElement.data(ITEM_DELETING_DATA_KEY, true);\r\n        var deferred = new Deferred;\r\n        var deletingActionArgs = {\r\n            cancel: false\r\n        };\r\n        var deletePromise = this._itemEventHandler($itemElement, \"onItemDeleting\", deletingActionArgs, {\r\n            excludeValidators: [\"disabled\", \"readOnly\"]\r\n        });\r\n        when(deletePromise).always(function(value) {\r\n            var deletePromiseExists = !deletePromise;\r\n            var deletePromiseResolved = !deletePromiseExists && \"resolved\" === deletePromise.state();\r\n            var argumentsSpecified = !!arguments.length;\r\n            var shouldDelete = deletePromiseExists || deletePromiseResolved && !argumentsSpecified || deletePromiseResolved && value;\r\n            when(fromPromise(deletingActionArgs.cancel)).always((function() {\r\n                $itemElement.data(ITEM_DELETING_DATA_KEY, false)\r\n            })).done((function(cancel) {\r\n                shouldDelete && !cancel ? deferred.resolve() : deferred.reject()\r\n            })).fail(deferred.reject)\r\n        }.bind(this));\r\n        return deferred.promise()\r\n    },\r\n    _deleteItemFromDS: function($item) {\r\n        if (!this._dataSource) {\r\n            return (new Deferred).resolve().promise()\r\n        }\r\n        var deferred = new Deferred;\r\n        var disabledState = this.option(\"disabled\");\r\n        var dataStore = this._dataSource.store();\r\n        this.option(\"disabled\", true);\r\n        if (!dataStore.remove) {\r\n            throw errors.Error(\"E1011\")\r\n        }\r\n        dataStore.remove(dataStore.keyOf(this._getItemData($item))).done((function(key) {\r\n            if (void 0 !== key) {\r\n                deferred.resolve()\r\n            } else {\r\n                deferred.reject()\r\n            }\r\n        })).fail((function() {\r\n            deferred.reject()\r\n        }));\r\n        deferred.always(function() {\r\n            this.option(\"disabled\", disabledState)\r\n        }.bind(this));\r\n        return deferred\r\n    },\r\n    _tryRefreshLastPage: function() {\r\n        var deferred = new Deferred;\r\n        if (this._isLastPage() || this.option(\"grouped\")) {\r\n            deferred.resolve()\r\n        } else {\r\n            this._refreshLastPage().done((function() {\r\n                deferred.resolve()\r\n            }))\r\n        }\r\n        return deferred.promise()\r\n    },\r\n    _refreshLastPage: function() {\r\n        this._expectLastItemLoading();\r\n        return this._dataSource.load()\r\n    },\r\n    _updateSelectionAfterDelete: function(index) {\r\n        var key = this._getKeyByIndex(index);\r\n        this._selection.deselect([key])\r\n    },\r\n    _updateIndicesAfterIndex: function(index) {\r\n        var itemElements = this._itemElements();\r\n        for (var i = index + 1; i < itemElements.length; i++) {\r\n            $(itemElements[i]).data(this._itemIndexKey(), i - 1)\r\n        }\r\n    },\r\n    _simulateOptionChange: function(optionName) {\r\n        var optionValue = this.option(optionName);\r\n        if (optionValue instanceof DataSource) {\r\n            return\r\n        }\r\n        this._optionChangedAction({\r\n            name: optionName,\r\n            fullName: optionName,\r\n            value: optionValue\r\n        })\r\n    },\r\n    isItemSelected: function(itemElement) {\r\n        return this._isItemSelected(this._editStrategy.getNormalizedIndex(itemElement))\r\n    },\r\n    selectItem: function(itemElement) {\r\n        if (\"none\" === this.option(\"selectionMode\")) {\r\n            return\r\n        }\r\n        var itemIndex = this._editStrategy.getNormalizedIndex(itemElement);\r\n        if (!indexExists(itemIndex)) {\r\n            return\r\n        }\r\n        var key = this._getKeyByIndex(itemIndex);\r\n        if (this._selection.isItemSelected(key)) {\r\n            return\r\n        }\r\n        if (\"single\" === this.option(\"selectionMode\")) {\r\n            return this._selection.setSelection([key])\r\n        } else {\r\n            var selectedItemKeys = this.option(\"selectedItemKeys\") || [];\r\n            return this._selection.setSelection([...selectedItemKeys, key], [key])\r\n        }\r\n    },\r\n    unselectItem: function(itemElement) {\r\n        var itemIndex = this._editStrategy.getNormalizedIndex(itemElement);\r\n        if (!indexExists(itemIndex)) {\r\n            return\r\n        }\r\n        var selectedItemKeys = this._selection.getSelectedItemKeys();\r\n        if (this.option(\"selectionRequired\") && selectedItemKeys.length <= 1) {\r\n            return\r\n        }\r\n        var key = this._getKeyByIndex(itemIndex);\r\n        if (!this._selection.isItemSelected(key, {\r\n                checkPending: true\r\n            })) {\r\n            return\r\n        }\r\n        this._selection.deselect([key])\r\n    },\r\n    _deleteItemElementByIndex: function(index) {\r\n        this._updateSelectionAfterDelete(index);\r\n        this._updateIndicesAfterIndex(index);\r\n        this._editStrategy.deleteItemAtIndex(index)\r\n    },\r\n    _afterItemElementDeleted: function($item, deletedActionArgs) {\r\n        var changingOption = this._dataSource ? \"dataSource\" : \"items\";\r\n        this._simulateOptionChange(changingOption);\r\n        this._itemEventHandler($item, \"onItemDeleted\", deletedActionArgs, {\r\n            beforeExecute: function() {\r\n                $item.remove()\r\n            },\r\n            excludeValidators: [\"disabled\", \"readOnly\"]\r\n        });\r\n        this._renderEmptyMessage()\r\n    },\r\n    deleteItem: function(itemElement) {\r\n        var that = this;\r\n        var deferred = new Deferred;\r\n        var $item = this._editStrategy.getItemElement(itemElement);\r\n        var index = this._editStrategy.getNormalizedIndex(itemElement);\r\n        var itemResponseWaitClass = this._itemResponseWaitClass();\r\n        if (indexExists(index)) {\r\n            this._waitDeletingPrepare($item).done((function() {\r\n                $item.addClass(itemResponseWaitClass);\r\n                var deletedActionArgs = that._extendActionArgs($item);\r\n                that._deleteItemFromDS($item).done((function() {\r\n                    that._deleteItemElementByIndex(index);\r\n                    that._afterItemElementDeleted($item, deletedActionArgs);\r\n                    that._tryRefreshLastPage().done((function() {\r\n                        deferred.resolveWith(that)\r\n                    }))\r\n                })).fail((function() {\r\n                    $item.removeClass(itemResponseWaitClass);\r\n                    deferred.rejectWith(that)\r\n                }))\r\n            })).fail((function() {\r\n                deferred.rejectWith(that)\r\n            }))\r\n        } else {\r\n            deferred.rejectWith(that)\r\n        }\r\n        return deferred.promise()\r\n    },\r\n    reorderItem: function(itemElement, toItemElement) {\r\n        var deferred = new Deferred;\r\n        var that = this;\r\n        var strategy = this._editStrategy;\r\n        var $movingItem = strategy.getItemElement(itemElement);\r\n        var $destinationItem = strategy.getItemElement(toItemElement);\r\n        var movingIndex = strategy.getNormalizedIndex(itemElement);\r\n        var destinationIndex = strategy.getNormalizedIndex(toItemElement);\r\n        var changingOption = this._dataSource ? \"dataSource\" : \"items\";\r\n        var canMoveItems = indexExists(movingIndex) && indexExists(destinationIndex) && movingIndex !== destinationIndex;\r\n        if (canMoveItems) {\r\n            deferred.resolveWith(this)\r\n        } else {\r\n            deferred.rejectWith(this)\r\n        }\r\n        return deferred.promise().done((function() {\r\n            $destinationItem[strategy.itemPlacementFunc(movingIndex, destinationIndex)]($movingItem);\r\n            strategy.moveItemAtIndexToIndex(movingIndex, destinationIndex);\r\n            this._updateIndicesAfterIndex(movingIndex);\r\n            that.option(\"selectedItems\", that._getItemsByKeys(that._selection.getSelectedItemKeys(), that._selection.getSelectedItems()));\r\n            if (\"items\" === changingOption) {\r\n                that._simulateOptionChange(changingOption)\r\n            }\r\n            that._itemEventHandler($movingItem, \"onItemReordered\", {\r\n                fromIndex: strategy.getIndex(movingIndex),\r\n                toIndex: strategy.getIndex(destinationIndex)\r\n            }, {\r\n                excludeValidators: [\"disabled\", \"readOnly\"]\r\n            })\r\n        }))\r\n    }\r\n});\r\nexport default CollectionWidget;\r\n"],"mappings":"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"},"metadata":{},"sourceType":"module"}