{"ast":null,"code":"/**\r\n * DevExtreme (esm/viz/core/export.js)\r\n * Version: 22.1.4\r\n * Build date: Fri Jul 22 2022\r\n *\r\n * Copyright (c) 2012 - 2022 Developer Express Inc. ALL RIGHTS RESERVED\r\n * Read about DevExtreme licensing here: https://js.devexpress.com/Licensing/\r\n */\nimport { extend } from \"../../core/utils/extend\";\nimport { getWindow } from \"../../core/utils/window\";\nimport { patchFontOptions } from \"./utils\";\nimport { HIDDEN_FOR_EXPORT } from \"../../core/utils/svg\";\nimport { export as _export, image as imageExporter, svg as svgExporter, pdf as pdfExporter } from \"../../exporter\";\nimport messageLocalization from \"../../localization/message\";\nimport { isDefined } from \"../../core/utils/type\";\nimport { getTheme } from \"../themes\";\nimport { start as hoverEventStart, end as hoverEventEnd } from \"../../events/hover\";\nimport pointerEvents from \"../../events/pointer\";\nimport { logger } from \"../../core/utils/console\";\nimport { getWidth } from \"../../core/utils/size\";\nvar pointerActions = [pointerEvents.down, pointerEvents.move].join(\" \");\nvar BUTTON_SIZE = 35;\nvar ICON_COORDS = [[9, 12, 26, 12, 26, 14, 9, 14], [9, 17, 26, 17, 26, 19, 9, 19], [9, 22, 26, 22, 26, 24, 9, 24]];\nvar LIST_PADDING_TOP = 4;\nvar LIST_WIDTH = 120;\nvar VERTICAL_TEXT_MARGIN = 8;\nvar HORIZONTAL_TEXT_MARGIN = 15;\nvar MENU_ITEM_HEIGHT = 30;\nvar LIST_STROKE_WIDTH = 1;\nvar MARGIN = 10;\nvar SHADOW_OFFSET = 2;\nvar SHADOW_BLUR = 3;\nvar DEFAULT_EXPORT_FORMAT = \"PNG\";\nvar ALLOWED_IMAGE_FORMATS = [DEFAULT_EXPORT_FORMAT, \"JPEG\", \"GIF\"];\nvar ALLOWED_EXTRA_FORMATS = [\"PDF\", \"SVG\"];\nvar EXPORT_CSS_CLASS = \"dx-export-menu\";\nvar A4WidthCm = \"21cm\";\nvar EXPORT_DATA_KEY = \"export-element-type\";\nvar FORMAT_DATA_KEY = \"export-element-format\";\nvar GET_COLOR_REGEX = /data-backgroundcolor=\"([^\"]*)\"/;\n\nfunction getValidFormats() {\n  var imageFormats = imageExporter.testFormats(ALLOWED_IMAGE_FORMATS);\n  return {\n    unsupported: imageFormats.unsupported,\n    supported: imageFormats.supported.concat(ALLOWED_EXTRA_FORMATS)\n  };\n}\n\nfunction validateFormat(format, incidentOccurred, validFormats) {\n  validFormats = validFormats || getValidFormats();\n  format = String(format).toUpperCase();\n\n  if (-1 !== validFormats.supported.indexOf(format)) {\n    return format;\n  }\n\n  if (-1 !== validFormats.unsupported.indexOf(format)) {\n    incidentOccurred && incidentOccurred(\"W2108\", [format]);\n  }\n}\n\nfunction getCreatorFunc(format) {\n  if (\"SVG\" === format) {\n    return svgExporter.getData;\n  } else if (\"PDF\" === format) {\n    return pdfExporter.getData;\n  } else {\n    return imageExporter.getData;\n  }\n}\n\nfunction print(imageSrc, options) {\n  var document = getWindow().document;\n  var iFrame = document.createElement(\"iframe\");\n  iFrame.onload = setPrint(imageSrc, options);\n  iFrame.style.position = \"fixed\";\n  iFrame.style.width = \"0\";\n  iFrame.style.height = \"0\";\n  iFrame.style.right = \"0\";\n  iFrame.style.bottom = \"0\";\n  document.body.appendChild(iFrame);\n}\n\nfunction calculatePrintPageWidth(iFrameBody) {\n  iFrameBody.style.width = A4WidthCm;\n  var width = getWidth(iFrameBody);\n  iFrameBody.style.width = \"\";\n  return width;\n}\n\nfunction setPrint(imageSrc, options) {\n  return function () {\n    var window = this.contentWindow;\n    var img = window.document.createElement(\"img\");\n    window.document.body.appendChild(img);\n    var widthRatio = calculatePrintPageWidth(window.document.body) / options.width;\n\n    if (widthRatio < 1) {\n      window.document.body.style.transform = \"scale(\".concat(widthRatio, \")\");\n      window.document.body.style[\"transform-origin\"] = \"0 0\";\n    }\n\n    var removeFrame = () => {\n      this.parentElement.removeChild(this);\n    };\n\n    img.addEventListener(\"load\", () => {\n      window.focus();\n      window.print();\n    });\n    img.addEventListener(\"error\", removeFrame);\n    window.addEventListener(\"afterprint\", () => {\n      setTimeout(removeFrame, 0);\n    });\n    img.src = imageSrc;\n  };\n}\n\nfunction getItemAttributes(options, type, itemIndex) {\n  var x = BUTTON_SIZE - LIST_WIDTH;\n  var y = BUTTON_SIZE + LIST_PADDING_TOP + LIST_STROKE_WIDTH + itemIndex * MENU_ITEM_HEIGHT;\n  var attr = {\n    rect: {\n      width: LIST_WIDTH - 2 * LIST_STROKE_WIDTH,\n      height: MENU_ITEM_HEIGHT,\n      x: x + LIST_STROKE_WIDTH,\n      y: y\n    },\n    text: {\n      x: x + (options.rtl ? LIST_WIDTH - HORIZONTAL_TEXT_MARGIN : HORIZONTAL_TEXT_MARGIN),\n      y: y + MENU_ITEM_HEIGHT - VERTICAL_TEXT_MARGIN\n    }\n  };\n\n  if (\"printing\" === type) {\n    attr.separator = {\n      stroke: options.button.default.borderColor,\n      \"stroke-width\": LIST_STROKE_WIDTH,\n      cursor: \"pointer\",\n      sharp: \"v\",\n      d: \"M \" + x + \" \" + (y + MENU_ITEM_HEIGHT - LIST_STROKE_WIDTH) + \" L \" + (x + LIST_WIDTH) + \" \" + (y + MENU_ITEM_HEIGHT - LIST_STROKE_WIDTH)\n    };\n  }\n\n  return attr;\n}\n\nfunction createMenuItem(renderer, options, settings) {\n  var itemData = {};\n  var type = settings.type;\n  var format = settings.format;\n  var attr = getItemAttributes(options, type, settings.itemIndex);\n  var fontStyle = patchFontOptions(options.font);\n  fontStyle[\"pointer-events\"] = \"none\";\n  var menuItem = renderer.g().attr({\n    class: EXPORT_CSS_CLASS + \"-list-item\"\n  });\n  itemData[EXPORT_DATA_KEY] = type;\n\n  if (format) {\n    itemData[FORMAT_DATA_KEY] = format;\n  }\n\n  var rect = renderer.rect();\n  rect.attr(attr.rect).css({\n    cursor: \"pointer\",\n    \"pointer-events\": \"all\"\n  }).data(itemData);\n  rect.on(hoverEventStart + \".export\", () => rect.attr({\n    fill: options.button.hover.backgroundColor\n  })).on(hoverEventEnd + \".export\", () => rect.attr({\n    fill: null\n  }));\n  rect.append(menuItem);\n  var text = renderer.text(settings.text).css(fontStyle).attr(attr.text).append(menuItem);\n\n  if (\"printing\" === type) {\n    renderer.path(null, \"line\").attr(attr.separator).append(menuItem);\n  }\n\n  return {\n    g: menuItem,\n    rect: rect,\n    resetState: () => rect.attr({\n      fill: null\n    }),\n    fixPosition: () => {\n      var textBBox = text.getBBox();\n      text.move(attr.text.x - textBBox.x - (options.rtl ? textBBox.width : 0));\n    }\n  };\n}\n\nfunction createMenuItems(renderer, options) {\n  var items = [];\n\n  if (options.printingEnabled) {\n    items.push(createMenuItem(renderer, options, {\n      type: \"printing\",\n      text: messageLocalization.format(\"vizExport-printingButtonText\"),\n      itemIndex: items.length\n    }));\n  }\n\n  items = options.formats.reduce((r, format) => {\n    r.push(createMenuItem(renderer, options, {\n      type: \"exporting\",\n      text: messageLocalization.getFormatter(\"vizExport-exportButtonText\")(format),\n      format: format,\n      itemIndex: r.length\n    }));\n    return r;\n  }, items);\n  return items;\n}\n\nfunction getBackgroundColorFromMarkup(markup) {\n  var parsedMarkup = GET_COLOR_REGEX.exec(markup);\n  return null === parsedMarkup || void 0 === parsedMarkup ? void 0 : parsedMarkup[1];\n}\n\nexport var exportFromMarkup = function (markup, options) {\n  options.format = validateFormat(options.format) || DEFAULT_EXPORT_FORMAT;\n  options.fileName = options.fileName || \"file\";\n  options.exportingAction = options.onExporting;\n  options.exportedAction = options.onExported;\n  options.fileSavingAction = options.onFileSaving;\n  options.margin = isDefined(options.margin) ? options.margin : MARGIN;\n  options.backgroundColor = isDefined(options.backgroundColor) ? options.backgroundColor : getBackgroundColorFromMarkup(markup) || getTheme().backgroundColor;\n\n  _export(markup, options, getCreatorFunc(options.format));\n};\nexport var getMarkup = widgets => combineMarkups(widgets).markup;\nexport var exportWidgets = function (widgets, options) {\n  options = options || {};\n  var markupInfo = combineMarkups(widgets, {\n    gridLayout: options.gridLayout,\n    verticalAlignment: options.verticalAlignment,\n    horizontalAlignment: options.horizontalAlignment\n  });\n  options.width = markupInfo.width;\n  options.height = markupInfo.height;\n  exportFromMarkup(markupInfo.markup, options);\n};\nexport var combineMarkups = function (widgets) {\n  var options = arguments.length > 1 && void 0 !== arguments[1] ? arguments[1] : {};\n\n  if (!Array.isArray(widgets)) {\n    widgets = [[widgets]];\n  } else if (!Array.isArray(widgets[0])) {\n    widgets = widgets.map(item => [item]);\n  }\n\n  var compactView = !options.gridLayout;\n  var exportItems = widgets.reduce((r, row, rowIndex) => {\n    var rowInfo = row.reduce((r, item, colIndex) => {\n      var size = item.getSize();\n      var backgroundColor = item.option(\"backgroundColor\") || getTheme(item.option(\"theme\")).backgroundColor;\n      backgroundColor && -1 === r.backgroundColors.indexOf(backgroundColor) && r.backgroundColors.push(backgroundColor);\n      r.hOffset = r.width;\n      r.width += size.width;\n      r.height = Math.max(r.height, size.height);\n      r.itemWidth = Math.max(r.itemWidth, size.width);\n      r.items.push({\n        markup: item.svg(),\n        width: size.width,\n        height: size.height,\n        c: colIndex,\n        r: rowIndex,\n        hOffset: r.hOffset\n      });\n      return r;\n    }, {\n      items: [],\n      height: 0,\n      itemWidth: 0,\n      hOffset: 0,\n      width: 0,\n      backgroundColors: r.backgroundColors\n    });\n    r.rowOffsets.push(r.totalHeight);\n    r.rowHeights.push(rowInfo.height);\n    r.totalHeight += rowInfo.height;\n    r.items = r.items.concat(rowInfo.items);\n    r.itemWidth = Math.max(r.itemWidth, rowInfo.itemWidth);\n    r.maxItemLen = Math.max(r.maxItemLen, rowInfo.items.length);\n    r.totalWidth = compactView ? Math.max(r.totalWidth, rowInfo.width) : r.maxItemLen * r.itemWidth;\n    return r;\n  }, {\n    items: [],\n    rowOffsets: [],\n    rowHeights: [],\n    itemWidth: 0,\n    totalHeight: 0,\n    maxItemLen: 0,\n    totalWidth: 0,\n    backgroundColors: []\n  });\n  var backgroundColor = 'data-backgroundcolor=\"'.concat(1 === exportItems.backgroundColors.length ? exportItems.backgroundColors[0] : \"\", '\" ');\n\n  var getVOffset = item => {\n    var align = options.verticalAlignment;\n    var dy = exportItems.rowHeights[item.r] - item.height;\n    return exportItems.rowOffsets[item.r] + (\"bottom\" === align ? dy : \"center\" === align ? dy / 2 : 0);\n  };\n\n  var getHOffset = item => {\n    if (compactView) {\n      return item.hOffset;\n    }\n\n    var align = options.horizontalAlignment;\n    var colWidth = exportItems.itemWidth;\n    var dx = colWidth - item.width;\n    return item.c * colWidth + (\"right\" === align ? dx : \"center\" === align ? dx / 2 : 0);\n  };\n\n  var totalHeight = exportItems.totalHeight;\n  var totalWidth = exportItems.totalWidth;\n  return {\n    markup: \"<svg \" + backgroundColor + 'height=\"' + totalHeight + '\" width=\"' + totalWidth + '\" version=\"1.1\" xmlns=\"http://www.w3.org/2000/svg\">' + exportItems.items.map(item => '<g transform=\"translate('.concat(getHOffset(item), \",\").concat(getVOffset(item), ')\">').concat(item.markup, \"</g>\")).join(\"\") + \"</svg>\",\n    width: totalWidth,\n    height: totalHeight\n  };\n};\nexport var ExportMenu = function (params) {\n  var renderer = this._renderer = params.renderer;\n  this._incidentOccurred = params.incidentOccurred;\n  this._exportTo = params.exportTo;\n  this._print = params.print;\n  this._shadow = renderer.shadowFilter(\"-50%\", \"-50%\", \"200%\", \"200%\", SHADOW_OFFSET, 6, SHADOW_BLUR);\n\n  this._shadow.attr({\n    opacity: .8\n  });\n\n  this._group = renderer.g().attr({\n    class: EXPORT_CSS_CLASS,\n    [HIDDEN_FOR_EXPORT]: true\n  }).linkOn(renderer.root, {\n    name: \"export-menu\",\n    after: \"peripheral\"\n  });\n  this._buttonGroup = renderer.g().attr({\n    class: EXPORT_CSS_CLASS + \"-button\"\n  }).append(this._group);\n  this._listGroup = renderer.g().attr({\n    class: EXPORT_CSS_CLASS + \"-list\"\n  }).append(this._group);\n  this._overlay = renderer.rect(-LIST_WIDTH + BUTTON_SIZE, BUTTON_SIZE + LIST_PADDING_TOP, LIST_WIDTH, 0);\n\n  this._overlay.attr({\n    \"stroke-width\": LIST_STROKE_WIDTH,\n    cursor: \"pointer\",\n    rx: 4,\n    ry: 4,\n    filter: this._shadow.id\n  });\n\n  this._overlay.data({\n    \"export-element-type\": \"list\"\n  });\n\n  this.validFormats = getValidFormats();\n\n  this._subscribeEvents();\n};\nextend(ExportMenu.prototype, {\n  getLayoutOptions() {\n    if (this._hiddenDueToLayout) {\n      return {\n        width: 0,\n        height: 0,\n        cutSide: \"vertical\",\n        cutLayoutSide: \"top\"\n      };\n    }\n\n    var bBox = this._buttonGroup.getBBox();\n\n    bBox.cutSide = \"vertical\";\n    bBox.cutLayoutSide = \"top\";\n    bBox.height += MARGIN;\n    bBox.position = {\n      vertical: \"top\",\n      horizontal: \"right\"\n    };\n    bBox.verticalAlignment = \"top\";\n    bBox.horizontalAlignment = \"right\";\n    return bBox;\n  },\n\n  shift(_, y) {\n    this._group.attr({\n      translateY: this._group.attr(\"translateY\") + y\n    });\n  },\n\n  draw(width, height, canvas) {\n    this._group.move(width - BUTTON_SIZE - SHADOW_OFFSET - SHADOW_BLUR + canvas.left, Math.floor(height / 2 - BUTTON_SIZE / 2));\n\n    var layoutOptions = this.getLayoutOptions();\n\n    if (layoutOptions.width > width || layoutOptions.height > height) {\n      this.freeSpace();\n    }\n\n    return this;\n  },\n\n  show() {\n    this._group.linkAppend();\n  },\n\n  hide() {\n    this._group.linkRemove();\n  },\n\n  setOptions(options) {\n    this._options = options;\n\n    if (options.formats) {\n      options.formats = options.formats.reduce((r, format) => {\n        format = validateFormat(format, this._incidentOccurred, this.validFormats);\n        format && r.push(format);\n        return r;\n      }, []);\n    } else {\n      options.formats = this.validFormats.supported.slice();\n    }\n\n    options.printingEnabled = void 0 === options.printingEnabled ? true : options.printingEnabled;\n\n    if (options.enabled && (options.formats.length || options.printingEnabled)) {\n      this.show();\n\n      this._updateButton();\n\n      this._updateList();\n\n      this._hideList();\n    } else {\n      this.hide();\n    }\n  },\n\n  dispose() {\n    this._unsubscribeEvents();\n\n    this._group.linkRemove().linkOff();\n\n    this._group.dispose();\n\n    this._shadow.dispose();\n  },\n\n  layoutOptions() {\n    return this._options.enabled && {\n      horizontalAlignment: \"right\",\n      verticalAlignment: \"top\",\n      weak: true\n    };\n  },\n\n  measure() {\n    this._fillSpace();\n\n    var margin = this._options.button.margin;\n    return [BUTTON_SIZE + margin.left + margin.right, BUTTON_SIZE + margin.top + margin.bottom];\n  },\n\n  move(rect) {\n    var margin = this._options.button.margin;\n\n    this._group.attr({\n      translateX: Math.round(rect[0]) + margin.left,\n      translateY: Math.round(rect[1]) + margin.top\n    });\n  },\n\n  _fillSpace() {\n    this._hiddenDueToLayout = false;\n    this.show();\n  },\n\n  freeSpace() {\n    this._incidentOccurred(\"W2107\");\n\n    this._hiddenDueToLayout = true;\n    this.hide();\n  },\n\n  _hideList() {\n    this._listGroup.remove();\n\n    this._listShown = false;\n\n    this._setButtonState(\"default\");\n\n    this._menuItems.forEach(item => item.resetState());\n  },\n\n  _showList() {\n    this._listGroup.append(this._group);\n\n    this._listShown = true;\n\n    this._menuItems.forEach(item => item.fixPosition());\n  },\n\n  _setButtonState(state) {\n    var style = this._options.button[state];\n\n    this._button.attr({\n      stroke: style.borderColor,\n      fill: style.backgroundColor\n    });\n\n    this._icon.attr({\n      fill: style.color\n    });\n  },\n\n  _subscribeEvents() {\n    this._renderer.root.on(pointerEvents.up + \".export\", e => {\n      var elementType = e.target[EXPORT_DATA_KEY];\n\n      if (!elementType) {\n        if (this._button) {\n          this._hideList();\n        }\n\n        return;\n      }\n\n      if (\"button\" === elementType) {\n        if (this._listShown) {\n          this._setButtonState(\"default\");\n\n          this._hideList();\n        } else {\n          this._setButtonState(\"focus\");\n\n          this._showList();\n        }\n      } else if (\"printing\" === elementType) {\n        this._print();\n\n        this._hideList();\n      } else if (\"exporting\" === elementType) {\n        this._exportTo(e.target[FORMAT_DATA_KEY]);\n\n        this._hideList();\n      }\n    });\n\n    this._listGroup.on(pointerActions, e => e.stopPropagation());\n\n    this._buttonGroup.on(pointerEvents.enter, () => this._setButtonState(\"hover\"));\n\n    this._buttonGroup.on(pointerEvents.leave, () => this._setButtonState(this._listShown ? \"focus\" : \"default\"));\n\n    this._buttonGroup.on(pointerEvents.down + \".export\", () => this._setButtonState(\"active\"));\n  },\n\n  _unsubscribeEvents() {\n    this._renderer.root.off(\".export\");\n\n    this._listGroup.off();\n\n    this._buttonGroup.off();\n  },\n\n  _updateButton() {\n    var renderer = this._renderer;\n    var options = this._options;\n    var exportData = {\n      \"export-element-type\": \"button\"\n    };\n\n    if (!this._button) {\n      this._button = renderer.rect(0, 0, BUTTON_SIZE, BUTTON_SIZE).append(this._buttonGroup);\n\n      this._button.attr({\n        rx: 4,\n        ry: 4,\n        fill: options.button.default.backgroundColor,\n        stroke: options.button.default.borderColor,\n        \"stroke-width\": 1,\n        cursor: \"pointer\"\n      });\n\n      this._button.data(exportData);\n\n      this._icon = renderer.path(ICON_COORDS).append(this._buttonGroup);\n\n      this._icon.attr({\n        fill: options.button.default.color,\n        cursor: \"pointer\"\n      });\n\n      this._icon.data(exportData);\n\n      this._buttonGroup.setTitle(messageLocalization.format(\"vizExport-titleMenuText\"));\n    }\n  },\n\n  _updateList() {\n    var options = this._options;\n    var buttonDefault = options.button.default;\n    var listGroup = this._listGroup;\n    var items = createMenuItems(this._renderer, options);\n\n    this._shadow.attr({\n      color: options.shadowColor\n    });\n\n    this._overlay.attr({\n      height: items.length * MENU_ITEM_HEIGHT + 2 * LIST_STROKE_WIDTH,\n      fill: buttonDefault.backgroundColor,\n      stroke: buttonDefault.borderColor\n    });\n\n    listGroup.clear();\n\n    this._overlay.append(listGroup);\n\n    items.forEach(item => item.g.append(listGroup));\n    this._menuItems = items;\n  }\n\n});\n\nfunction getExportOptions(widget, exportOptions, fileName, format) {\n  if (format || exportOptions.format) {\n    format = validateFormat(format || exportOptions.format, widget._incidentOccurred);\n  }\n\n  var {\n    width: width,\n    height: height\n  } = widget.getSize();\n  return {\n    format: format || DEFAULT_EXPORT_FORMAT,\n    fileName: fileName || exportOptions.fileName || \"file\",\n    proxyUrl: exportOptions.proxyUrl,\n    backgroundColor: exportOptions.backgroundColor,\n    width: width,\n    height: height,\n    margin: exportOptions.margin,\n    svgToCanvas: exportOptions.svgToCanvas,\n    forceProxy: exportOptions.forceProxy,\n    exportingAction: widget._createActionByOption(\"onExporting\", {\n      excludeValidators: [\"disabled\"]\n    }),\n    exportedAction: widget._createActionByOption(\"onExported\", {\n      excludeValidators: [\"disabled\"]\n    }),\n    fileSavingAction: widget._createActionByOption(\"onFileSaving\", {\n      excludeValidators: [\"disabled\"]\n    })\n  };\n}\n\nexport var plugin = {\n  name: \"export\",\n\n  init() {\n    this._exportMenu = new ExportMenu({\n      renderer: this._renderer,\n      incidentOccurred: this._incidentOccurred,\n      print: () => this.print(),\n      exportTo: format => this.exportTo(void 0, format)\n    });\n\n    this._layout.add(this._exportMenu);\n  },\n\n  dispose() {\n    this._exportMenu.dispose();\n  },\n\n  members: {\n    _getExportMenuOptions() {\n      return extend({}, this._getOption(\"export\"), {\n        rtl: this._getOption(\"rtlEnabled\", true)\n      });\n    },\n\n    _disablePointerEvents() {\n      var pointerEventsValue = this._renderer.root.attr(\"pointer-events\");\n\n      this._renderer.root.attr({\n        \"pointer-events\": \"none\"\n      });\n\n      return pointerEventsValue;\n    },\n\n    exportTo(fileName, format) {\n      var menu = this._exportMenu;\n      var options = getExportOptions(this, this._getOption(\"export\") || {}, fileName, format);\n      menu && menu.hide();\n\n      var pointerEventsValue = this._disablePointerEvents();\n\n      var promise = _export(this._renderer.root.element, options, getCreatorFunc(options.format)).fail(logger.error).always(() => {\n        this._renderer.root.attr({\n          \"pointer-events\": pointerEventsValue\n        });\n      });\n\n      menu && menu.show();\n      return promise;\n    },\n\n    print() {\n      var menu = this._exportMenu;\n      var options = getExportOptions(this, this._getOption(\"export\") || {});\n      options.exportingAction = null;\n      options.exportedAction = null;\n      options.margin = 0;\n      options.format = \"PNG\";\n      options.forceProxy = true;\n\n      options.fileSavingAction = eventArgs => {\n        print(\"data:image/png;base64,\".concat(eventArgs.data), {\n          width: options.width,\n          __test: options.__test\n        });\n        eventArgs.cancel = true;\n      };\n\n      var pointerEventsValue = this._disablePointerEvents();\n\n      menu && menu.hide();\n\n      var promise = _export(this._renderer.root.element, options, getCreatorFunc(options.format)).fail(logger.error).always(() => {\n        this._renderer.root.attr({\n          \"pointer-events\": pointerEventsValue\n        });\n      });\n\n      menu && menu.show();\n      return promise;\n    }\n\n  },\n\n  customize(constructor) {\n    var proto = constructor.prototype;\n    constructor.addChange({\n      code: \"EXPORT\",\n\n      handler() {\n        this._exportMenu.setOptions(this._getExportMenuOptions());\n\n        this._change([\"LAYOUT\"]);\n      },\n\n      isThemeDependent: true,\n      isOptionChange: true,\n      option: \"export\"\n    });\n    proto._optionChangesMap.onExporting = \"EXPORT\";\n    proto._optionChangesMap.onExported = \"EXPORT\";\n    proto._optionChangesMap.onFileSaving = \"EXPORT\";\n  },\n\n  fontFields: [\"export.font\"]\n};","map":{"version":3,"names":["extend","getWindow","patchFontOptions","HIDDEN_FOR_EXPORT","export","_export","image","imageExporter","svg","svgExporter","pdf","pdfExporter","messageLocalization","isDefined","getTheme","start","hoverEventStart","end","hoverEventEnd","pointerEvents","logger","getWidth","pointerActions","down","move","join","BUTTON_SIZE","ICON_COORDS","LIST_PADDING_TOP","LIST_WIDTH","VERTICAL_TEXT_MARGIN","HORIZONTAL_TEXT_MARGIN","MENU_ITEM_HEIGHT","LIST_STROKE_WIDTH","MARGIN","SHADOW_OFFSET","SHADOW_BLUR","DEFAULT_EXPORT_FORMAT","ALLOWED_IMAGE_FORMATS","ALLOWED_EXTRA_FORMATS","EXPORT_CSS_CLASS","A4WidthCm","EXPORT_DATA_KEY","FORMAT_DATA_KEY","GET_COLOR_REGEX","getValidFormats","imageFormats","testFormats","unsupported","supported","concat","validateFormat","format","incidentOccurred","validFormats","String","toUpperCase","indexOf","getCreatorFunc","getData","print","imageSrc","options","document","iFrame","createElement","onload","setPrint","style","position","width","height","right","bottom","body","appendChild","calculatePrintPageWidth","iFrameBody","window","contentWindow","img","widthRatio","transform","removeFrame","parentElement","removeChild","addEventListener","focus","setTimeout","src","getItemAttributes","type","itemIndex","x","y","attr","rect","text","rtl","separator","stroke","button","default","borderColor","cursor","sharp","d","createMenuItem","renderer","settings","itemData","fontStyle","font","menuItem","g","class","css","data","on","fill","hover","backgroundColor","append","path","resetState","fixPosition","textBBox","getBBox","createMenuItems","items","printingEnabled","push","length","formats","reduce","r","getFormatter","getBackgroundColorFromMarkup","markup","parsedMarkup","exec","exportFromMarkup","fileName","exportingAction","onExporting","exportedAction","onExported","fileSavingAction","onFileSaving","margin","getMarkup","widgets","combineMarkups","exportWidgets","markupInfo","gridLayout","verticalAlignment","horizontalAlignment","arguments","Array","isArray","map","item","compactView","exportItems","row","rowIndex","rowInfo","colIndex","size","getSize","option","backgroundColors","hOffset","Math","max","itemWidth","c","rowOffsets","totalHeight","rowHeights","maxItemLen","totalWidth","getVOffset","align","dy","getHOffset","colWidth","dx","ExportMenu","params","_renderer","_incidentOccurred","_exportTo","exportTo","_print","_shadow","shadowFilter","opacity","_group","linkOn","root","name","after","_buttonGroup","_listGroup","_overlay","rx","ry","filter","id","_subscribeEvents","prototype","getLayoutOptions","_hiddenDueToLayout","cutSide","cutLayoutSide","bBox","vertical","horizontal","shift","_","translateY","draw","canvas","left","floor","layoutOptions","freeSpace","show","linkAppend","hide","linkRemove","setOptions","_options","slice","enabled","_updateButton","_updateList","_hideList","dispose","_unsubscribeEvents","linkOff","weak","measure","_fillSpace","top","translateX","round","remove","_listShown","_setButtonState","_menuItems","forEach","_showList","state","_button","_icon","color","up","e","elementType","target","stopPropagation","enter","leave","off","exportData","setTitle","buttonDefault","listGroup","shadowColor","clear","getExportOptions","widget","exportOptions","proxyUrl","svgToCanvas","forceProxy","_createActionByOption","excludeValidators","plugin","init","_exportMenu","_layout","add","members","_getExportMenuOptions","_getOption","_disablePointerEvents","pointerEventsValue","menu","promise","element","fail","error","always","eventArgs","__test","cancel","customize","constructor","proto","addChange","code","handler","_change","isThemeDependent","isOptionChange","_optionChangesMap","fontFields"],"sources":["E:/MisaProject/W2022_06/misa_emis/node_modules/devextreme/esm/viz/core/export.js"],"sourcesContent":["/**\r\n * DevExtreme (esm/viz/core/export.js)\r\n * Version: 22.1.4\r\n * Build date: Fri Jul 22 2022\r\n *\r\n * Copyright (c) 2012 - 2022 Developer Express Inc. ALL RIGHTS RESERVED\r\n * Read about DevExtreme licensing here: https://js.devexpress.com/Licensing/\r\n */\r\nimport {\r\n    extend\r\n} from \"../../core/utils/extend\";\r\nimport {\r\n    getWindow\r\n} from \"../../core/utils/window\";\r\nimport {\r\n    patchFontOptions\r\n} from \"./utils\";\r\nimport {\r\n    HIDDEN_FOR_EXPORT\r\n} from \"../../core/utils/svg\";\r\nimport {\r\n    export as _export,\r\n    image as imageExporter,\r\n    svg as svgExporter,\r\n    pdf as pdfExporter\r\n} from \"../../exporter\";\r\nimport messageLocalization from \"../../localization/message\";\r\nimport {\r\n    isDefined\r\n} from \"../../core/utils/type\";\r\nimport {\r\n    getTheme\r\n} from \"../themes\";\r\nimport {\r\n    start as hoverEventStart,\r\n    end as hoverEventEnd\r\n} from \"../../events/hover\";\r\nimport pointerEvents from \"../../events/pointer\";\r\nimport {\r\n    logger\r\n} from \"../../core/utils/console\";\r\nimport {\r\n    getWidth\r\n} from \"../../core/utils/size\";\r\nvar pointerActions = [pointerEvents.down, pointerEvents.move].join(\" \");\r\nvar BUTTON_SIZE = 35;\r\nvar ICON_COORDS = [\r\n    [9, 12, 26, 12, 26, 14, 9, 14],\r\n    [9, 17, 26, 17, 26, 19, 9, 19],\r\n    [9, 22, 26, 22, 26, 24, 9, 24]\r\n];\r\nvar LIST_PADDING_TOP = 4;\r\nvar LIST_WIDTH = 120;\r\nvar VERTICAL_TEXT_MARGIN = 8;\r\nvar HORIZONTAL_TEXT_MARGIN = 15;\r\nvar MENU_ITEM_HEIGHT = 30;\r\nvar LIST_STROKE_WIDTH = 1;\r\nvar MARGIN = 10;\r\nvar SHADOW_OFFSET = 2;\r\nvar SHADOW_BLUR = 3;\r\nvar DEFAULT_EXPORT_FORMAT = \"PNG\";\r\nvar ALLOWED_IMAGE_FORMATS = [DEFAULT_EXPORT_FORMAT, \"JPEG\", \"GIF\"];\r\nvar ALLOWED_EXTRA_FORMATS = [\"PDF\", \"SVG\"];\r\nvar EXPORT_CSS_CLASS = \"dx-export-menu\";\r\nvar A4WidthCm = \"21cm\";\r\nvar EXPORT_DATA_KEY = \"export-element-type\";\r\nvar FORMAT_DATA_KEY = \"export-element-format\";\r\nvar GET_COLOR_REGEX = /data-backgroundcolor=\"([^\"]*)\"/;\r\n\r\nfunction getValidFormats() {\r\n    var imageFormats = imageExporter.testFormats(ALLOWED_IMAGE_FORMATS);\r\n    return {\r\n        unsupported: imageFormats.unsupported,\r\n        supported: imageFormats.supported.concat(ALLOWED_EXTRA_FORMATS)\r\n    }\r\n}\r\n\r\nfunction validateFormat(format, incidentOccurred, validFormats) {\r\n    validFormats = validFormats || getValidFormats();\r\n    format = String(format).toUpperCase();\r\n    if (-1 !== validFormats.supported.indexOf(format)) {\r\n        return format\r\n    }\r\n    if (-1 !== validFormats.unsupported.indexOf(format)) {\r\n        incidentOccurred && incidentOccurred(\"W2108\", [format])\r\n    }\r\n}\r\n\r\nfunction getCreatorFunc(format) {\r\n    if (\"SVG\" === format) {\r\n        return svgExporter.getData\r\n    } else if (\"PDF\" === format) {\r\n        return pdfExporter.getData\r\n    } else {\r\n        return imageExporter.getData\r\n    }\r\n}\r\n\r\nfunction print(imageSrc, options) {\r\n    var document = getWindow().document;\r\n    var iFrame = document.createElement(\"iframe\");\r\n    iFrame.onload = setPrint(imageSrc, options);\r\n    iFrame.style.position = \"fixed\";\r\n    iFrame.style.width = \"0\";\r\n    iFrame.style.height = \"0\";\r\n    iFrame.style.right = \"0\";\r\n    iFrame.style.bottom = \"0\";\r\n    document.body.appendChild(iFrame)\r\n}\r\n\r\nfunction calculatePrintPageWidth(iFrameBody) {\r\n    iFrameBody.style.width = A4WidthCm;\r\n    var width = getWidth(iFrameBody);\r\n    iFrameBody.style.width = \"\";\r\n    return width\r\n}\r\n\r\nfunction setPrint(imageSrc, options) {\r\n    return function() {\r\n        var window = this.contentWindow;\r\n        var img = window.document.createElement(\"img\");\r\n        window.document.body.appendChild(img);\r\n        var widthRatio = calculatePrintPageWidth(window.document.body) / options.width;\r\n        if (widthRatio < 1) {\r\n            window.document.body.style.transform = \"scale(\".concat(widthRatio, \")\");\r\n            window.document.body.style[\"transform-origin\"] = \"0 0\"\r\n        }\r\n        var removeFrame = () => {\r\n            this.parentElement.removeChild(this)\r\n        };\r\n        img.addEventListener(\"load\", () => {\r\n            window.focus();\r\n            window.print()\r\n        });\r\n        img.addEventListener(\"error\", removeFrame);\r\n        window.addEventListener(\"afterprint\", () => {\r\n            setTimeout(removeFrame, 0)\r\n        });\r\n        img.src = imageSrc\r\n    }\r\n}\r\n\r\nfunction getItemAttributes(options, type, itemIndex) {\r\n    var x = BUTTON_SIZE - LIST_WIDTH;\r\n    var y = BUTTON_SIZE + LIST_PADDING_TOP + LIST_STROKE_WIDTH + itemIndex * MENU_ITEM_HEIGHT;\r\n    var attr = {\r\n        rect: {\r\n            width: LIST_WIDTH - 2 * LIST_STROKE_WIDTH,\r\n            height: MENU_ITEM_HEIGHT,\r\n            x: x + LIST_STROKE_WIDTH,\r\n            y: y\r\n        },\r\n        text: {\r\n            x: x + (options.rtl ? LIST_WIDTH - HORIZONTAL_TEXT_MARGIN : HORIZONTAL_TEXT_MARGIN),\r\n            y: y + MENU_ITEM_HEIGHT - VERTICAL_TEXT_MARGIN\r\n        }\r\n    };\r\n    if (\"printing\" === type) {\r\n        attr.separator = {\r\n            stroke: options.button.default.borderColor,\r\n            \"stroke-width\": LIST_STROKE_WIDTH,\r\n            cursor: \"pointer\",\r\n            sharp: \"v\",\r\n            d: \"M \" + x + \" \" + (y + MENU_ITEM_HEIGHT - LIST_STROKE_WIDTH) + \" L \" + (x + LIST_WIDTH) + \" \" + (y + MENU_ITEM_HEIGHT - LIST_STROKE_WIDTH)\r\n        }\r\n    }\r\n    return attr\r\n}\r\n\r\nfunction createMenuItem(renderer, options, settings) {\r\n    var itemData = {};\r\n    var type = settings.type;\r\n    var format = settings.format;\r\n    var attr = getItemAttributes(options, type, settings.itemIndex);\r\n    var fontStyle = patchFontOptions(options.font);\r\n    fontStyle[\"pointer-events\"] = \"none\";\r\n    var menuItem = renderer.g().attr({\r\n        class: EXPORT_CSS_CLASS + \"-list-item\"\r\n    });\r\n    itemData[EXPORT_DATA_KEY] = type;\r\n    if (format) {\r\n        itemData[FORMAT_DATA_KEY] = format\r\n    }\r\n    var rect = renderer.rect();\r\n    rect.attr(attr.rect).css({\r\n        cursor: \"pointer\",\r\n        \"pointer-events\": \"all\"\r\n    }).data(itemData);\r\n    rect.on(hoverEventStart + \".export\", () => rect.attr({\r\n        fill: options.button.hover.backgroundColor\r\n    })).on(hoverEventEnd + \".export\", () => rect.attr({\r\n        fill: null\r\n    }));\r\n    rect.append(menuItem);\r\n    var text = renderer.text(settings.text).css(fontStyle).attr(attr.text).append(menuItem);\r\n    if (\"printing\" === type) {\r\n        renderer.path(null, \"line\").attr(attr.separator).append(menuItem)\r\n    }\r\n    return {\r\n        g: menuItem,\r\n        rect: rect,\r\n        resetState: () => rect.attr({\r\n            fill: null\r\n        }),\r\n        fixPosition: () => {\r\n            var textBBox = text.getBBox();\r\n            text.move(attr.text.x - textBBox.x - (options.rtl ? textBBox.width : 0))\r\n        }\r\n    }\r\n}\r\n\r\nfunction createMenuItems(renderer, options) {\r\n    var items = [];\r\n    if (options.printingEnabled) {\r\n        items.push(createMenuItem(renderer, options, {\r\n            type: \"printing\",\r\n            text: messageLocalization.format(\"vizExport-printingButtonText\"),\r\n            itemIndex: items.length\r\n        }))\r\n    }\r\n    items = options.formats.reduce((r, format) => {\r\n        r.push(createMenuItem(renderer, options, {\r\n            type: \"exporting\",\r\n            text: messageLocalization.getFormatter(\"vizExport-exportButtonText\")(format),\r\n            format: format,\r\n            itemIndex: r.length\r\n        }));\r\n        return r\r\n    }, items);\r\n    return items\r\n}\r\n\r\nfunction getBackgroundColorFromMarkup(markup) {\r\n    var parsedMarkup = GET_COLOR_REGEX.exec(markup);\r\n    return null === parsedMarkup || void 0 === parsedMarkup ? void 0 : parsedMarkup[1]\r\n}\r\nexport var exportFromMarkup = function(markup, options) {\r\n    options.format = validateFormat(options.format) || DEFAULT_EXPORT_FORMAT;\r\n    options.fileName = options.fileName || \"file\";\r\n    options.exportingAction = options.onExporting;\r\n    options.exportedAction = options.onExported;\r\n    options.fileSavingAction = options.onFileSaving;\r\n    options.margin = isDefined(options.margin) ? options.margin : MARGIN;\r\n    options.backgroundColor = isDefined(options.backgroundColor) ? options.backgroundColor : getBackgroundColorFromMarkup(markup) || getTheme().backgroundColor;\r\n    _export(markup, options, getCreatorFunc(options.format))\r\n};\r\nexport var getMarkup = widgets => combineMarkups(widgets).markup;\r\nexport var exportWidgets = function(widgets, options) {\r\n    options = options || {};\r\n    var markupInfo = combineMarkups(widgets, {\r\n        gridLayout: options.gridLayout,\r\n        verticalAlignment: options.verticalAlignment,\r\n        horizontalAlignment: options.horizontalAlignment\r\n    });\r\n    options.width = markupInfo.width;\r\n    options.height = markupInfo.height;\r\n    exportFromMarkup(markupInfo.markup, options)\r\n};\r\nexport var combineMarkups = function(widgets) {\r\n    var options = arguments.length > 1 && void 0 !== arguments[1] ? arguments[1] : {};\r\n    if (!Array.isArray(widgets)) {\r\n        widgets = [\r\n            [widgets]\r\n        ]\r\n    } else if (!Array.isArray(widgets[0])) {\r\n        widgets = widgets.map(item => [item])\r\n    }\r\n    var compactView = !options.gridLayout;\r\n    var exportItems = widgets.reduce((r, row, rowIndex) => {\r\n        var rowInfo = row.reduce((r, item, colIndex) => {\r\n            var size = item.getSize();\r\n            var backgroundColor = item.option(\"backgroundColor\") || getTheme(item.option(\"theme\")).backgroundColor;\r\n            backgroundColor && -1 === r.backgroundColors.indexOf(backgroundColor) && r.backgroundColors.push(backgroundColor);\r\n            r.hOffset = r.width;\r\n            r.width += size.width;\r\n            r.height = Math.max(r.height, size.height);\r\n            r.itemWidth = Math.max(r.itemWidth, size.width);\r\n            r.items.push({\r\n                markup: item.svg(),\r\n                width: size.width,\r\n                height: size.height,\r\n                c: colIndex,\r\n                r: rowIndex,\r\n                hOffset: r.hOffset\r\n            });\r\n            return r\r\n        }, {\r\n            items: [],\r\n            height: 0,\r\n            itemWidth: 0,\r\n            hOffset: 0,\r\n            width: 0,\r\n            backgroundColors: r.backgroundColors\r\n        });\r\n        r.rowOffsets.push(r.totalHeight);\r\n        r.rowHeights.push(rowInfo.height);\r\n        r.totalHeight += rowInfo.height;\r\n        r.items = r.items.concat(rowInfo.items);\r\n        r.itemWidth = Math.max(r.itemWidth, rowInfo.itemWidth);\r\n        r.maxItemLen = Math.max(r.maxItemLen, rowInfo.items.length);\r\n        r.totalWidth = compactView ? Math.max(r.totalWidth, rowInfo.width) : r.maxItemLen * r.itemWidth;\r\n        return r\r\n    }, {\r\n        items: [],\r\n        rowOffsets: [],\r\n        rowHeights: [],\r\n        itemWidth: 0,\r\n        totalHeight: 0,\r\n        maxItemLen: 0,\r\n        totalWidth: 0,\r\n        backgroundColors: []\r\n    });\r\n    var backgroundColor = 'data-backgroundcolor=\"'.concat(1 === exportItems.backgroundColors.length ? exportItems.backgroundColors[0] : \"\", '\" ');\r\n    var getVOffset = item => {\r\n        var align = options.verticalAlignment;\r\n        var dy = exportItems.rowHeights[item.r] - item.height;\r\n        return exportItems.rowOffsets[item.r] + (\"bottom\" === align ? dy : \"center\" === align ? dy / 2 : 0)\r\n    };\r\n    var getHOffset = item => {\r\n        if (compactView) {\r\n            return item.hOffset\r\n        }\r\n        var align = options.horizontalAlignment;\r\n        var colWidth = exportItems.itemWidth;\r\n        var dx = colWidth - item.width;\r\n        return item.c * colWidth + (\"right\" === align ? dx : \"center\" === align ? dx / 2 : 0)\r\n    };\r\n    var totalHeight = exportItems.totalHeight;\r\n    var totalWidth = exportItems.totalWidth;\r\n    return {\r\n        markup: \"<svg \" + backgroundColor + 'height=\"' + totalHeight + '\" width=\"' + totalWidth + '\" version=\"1.1\" xmlns=\"http://www.w3.org/2000/svg\">' + exportItems.items.map(item => '<g transform=\"translate('.concat(getHOffset(item), \",\").concat(getVOffset(item), ')\">').concat(item.markup, \"</g>\")).join(\"\") + \"</svg>\",\r\n        width: totalWidth,\r\n        height: totalHeight\r\n    }\r\n};\r\nexport var ExportMenu = function(params) {\r\n    var renderer = this._renderer = params.renderer;\r\n    this._incidentOccurred = params.incidentOccurred;\r\n    this._exportTo = params.exportTo;\r\n    this._print = params.print;\r\n    this._shadow = renderer.shadowFilter(\"-50%\", \"-50%\", \"200%\", \"200%\", SHADOW_OFFSET, 6, SHADOW_BLUR);\r\n    this._shadow.attr({\r\n        opacity: .8\r\n    });\r\n    this._group = renderer.g().attr({\r\n        class: EXPORT_CSS_CLASS,\r\n        [HIDDEN_FOR_EXPORT]: true\r\n    }).linkOn(renderer.root, {\r\n        name: \"export-menu\",\r\n        after: \"peripheral\"\r\n    });\r\n    this._buttonGroup = renderer.g().attr({\r\n        class: EXPORT_CSS_CLASS + \"-button\"\r\n    }).append(this._group);\r\n    this._listGroup = renderer.g().attr({\r\n        class: EXPORT_CSS_CLASS + \"-list\"\r\n    }).append(this._group);\r\n    this._overlay = renderer.rect(-LIST_WIDTH + BUTTON_SIZE, BUTTON_SIZE + LIST_PADDING_TOP, LIST_WIDTH, 0);\r\n    this._overlay.attr({\r\n        \"stroke-width\": LIST_STROKE_WIDTH,\r\n        cursor: \"pointer\",\r\n        rx: 4,\r\n        ry: 4,\r\n        filter: this._shadow.id\r\n    });\r\n    this._overlay.data({\r\n        \"export-element-type\": \"list\"\r\n    });\r\n    this.validFormats = getValidFormats();\r\n    this._subscribeEvents()\r\n};\r\nextend(ExportMenu.prototype, {\r\n    getLayoutOptions() {\r\n        if (this._hiddenDueToLayout) {\r\n            return {\r\n                width: 0,\r\n                height: 0,\r\n                cutSide: \"vertical\",\r\n                cutLayoutSide: \"top\"\r\n            }\r\n        }\r\n        var bBox = this._buttonGroup.getBBox();\r\n        bBox.cutSide = \"vertical\";\r\n        bBox.cutLayoutSide = \"top\";\r\n        bBox.height += MARGIN;\r\n        bBox.position = {\r\n            vertical: \"top\",\r\n            horizontal: \"right\"\r\n        };\r\n        bBox.verticalAlignment = \"top\";\r\n        bBox.horizontalAlignment = \"right\";\r\n        return bBox\r\n    },\r\n    shift(_, y) {\r\n        this._group.attr({\r\n            translateY: this._group.attr(\"translateY\") + y\r\n        })\r\n    },\r\n    draw(width, height, canvas) {\r\n        this._group.move(width - BUTTON_SIZE - SHADOW_OFFSET - SHADOW_BLUR + canvas.left, Math.floor(height / 2 - BUTTON_SIZE / 2));\r\n        var layoutOptions = this.getLayoutOptions();\r\n        if (layoutOptions.width > width || layoutOptions.height > height) {\r\n            this.freeSpace()\r\n        }\r\n        return this\r\n    },\r\n    show() {\r\n        this._group.linkAppend()\r\n    },\r\n    hide() {\r\n        this._group.linkRemove()\r\n    },\r\n    setOptions(options) {\r\n        this._options = options;\r\n        if (options.formats) {\r\n            options.formats = options.formats.reduce((r, format) => {\r\n                format = validateFormat(format, this._incidentOccurred, this.validFormats);\r\n                format && r.push(format);\r\n                return r\r\n            }, [])\r\n        } else {\r\n            options.formats = this.validFormats.supported.slice()\r\n        }\r\n        options.printingEnabled = void 0 === options.printingEnabled ? true : options.printingEnabled;\r\n        if (options.enabled && (options.formats.length || options.printingEnabled)) {\r\n            this.show();\r\n            this._updateButton();\r\n            this._updateList();\r\n            this._hideList()\r\n        } else {\r\n            this.hide()\r\n        }\r\n    },\r\n    dispose() {\r\n        this._unsubscribeEvents();\r\n        this._group.linkRemove().linkOff();\r\n        this._group.dispose();\r\n        this._shadow.dispose()\r\n    },\r\n    layoutOptions() {\r\n        return this._options.enabled && {\r\n            horizontalAlignment: \"right\",\r\n            verticalAlignment: \"top\",\r\n            weak: true\r\n        }\r\n    },\r\n    measure() {\r\n        this._fillSpace();\r\n        var margin = this._options.button.margin;\r\n        return [BUTTON_SIZE + margin.left + margin.right, BUTTON_SIZE + margin.top + margin.bottom]\r\n    },\r\n    move(rect) {\r\n        var margin = this._options.button.margin;\r\n        this._group.attr({\r\n            translateX: Math.round(rect[0]) + margin.left,\r\n            translateY: Math.round(rect[1]) + margin.top\r\n        })\r\n    },\r\n    _fillSpace() {\r\n        this._hiddenDueToLayout = false;\r\n        this.show()\r\n    },\r\n    freeSpace() {\r\n        this._incidentOccurred(\"W2107\");\r\n        this._hiddenDueToLayout = true;\r\n        this.hide()\r\n    },\r\n    _hideList() {\r\n        this._listGroup.remove();\r\n        this._listShown = false;\r\n        this._setButtonState(\"default\");\r\n        this._menuItems.forEach(item => item.resetState())\r\n    },\r\n    _showList() {\r\n        this._listGroup.append(this._group);\r\n        this._listShown = true;\r\n        this._menuItems.forEach(item => item.fixPosition())\r\n    },\r\n    _setButtonState(state) {\r\n        var style = this._options.button[state];\r\n        this._button.attr({\r\n            stroke: style.borderColor,\r\n            fill: style.backgroundColor\r\n        });\r\n        this._icon.attr({\r\n            fill: style.color\r\n        })\r\n    },\r\n    _subscribeEvents() {\r\n        this._renderer.root.on(pointerEvents.up + \".export\", e => {\r\n            var elementType = e.target[EXPORT_DATA_KEY];\r\n            if (!elementType) {\r\n                if (this._button) {\r\n                    this._hideList()\r\n                }\r\n                return\r\n            }\r\n            if (\"button\" === elementType) {\r\n                if (this._listShown) {\r\n                    this._setButtonState(\"default\");\r\n                    this._hideList()\r\n                } else {\r\n                    this._setButtonState(\"focus\");\r\n                    this._showList()\r\n                }\r\n            } else if (\"printing\" === elementType) {\r\n                this._print();\r\n                this._hideList()\r\n            } else if (\"exporting\" === elementType) {\r\n                this._exportTo(e.target[FORMAT_DATA_KEY]);\r\n                this._hideList()\r\n            }\r\n        });\r\n        this._listGroup.on(pointerActions, e => e.stopPropagation());\r\n        this._buttonGroup.on(pointerEvents.enter, () => this._setButtonState(\"hover\"));\r\n        this._buttonGroup.on(pointerEvents.leave, () => this._setButtonState(this._listShown ? \"focus\" : \"default\"));\r\n        this._buttonGroup.on(pointerEvents.down + \".export\", () => this._setButtonState(\"active\"))\r\n    },\r\n    _unsubscribeEvents() {\r\n        this._renderer.root.off(\".export\");\r\n        this._listGroup.off();\r\n        this._buttonGroup.off()\r\n    },\r\n    _updateButton() {\r\n        var renderer = this._renderer;\r\n        var options = this._options;\r\n        var exportData = {\r\n            \"export-element-type\": \"button\"\r\n        };\r\n        if (!this._button) {\r\n            this._button = renderer.rect(0, 0, BUTTON_SIZE, BUTTON_SIZE).append(this._buttonGroup);\r\n            this._button.attr({\r\n                rx: 4,\r\n                ry: 4,\r\n                fill: options.button.default.backgroundColor,\r\n                stroke: options.button.default.borderColor,\r\n                \"stroke-width\": 1,\r\n                cursor: \"pointer\"\r\n            });\r\n            this._button.data(exportData);\r\n            this._icon = renderer.path(ICON_COORDS).append(this._buttonGroup);\r\n            this._icon.attr({\r\n                fill: options.button.default.color,\r\n                cursor: \"pointer\"\r\n            });\r\n            this._icon.data(exportData);\r\n            this._buttonGroup.setTitle(messageLocalization.format(\"vizExport-titleMenuText\"))\r\n        }\r\n    },\r\n    _updateList() {\r\n        var options = this._options;\r\n        var buttonDefault = options.button.default;\r\n        var listGroup = this._listGroup;\r\n        var items = createMenuItems(this._renderer, options);\r\n        this._shadow.attr({\r\n            color: options.shadowColor\r\n        });\r\n        this._overlay.attr({\r\n            height: items.length * MENU_ITEM_HEIGHT + 2 * LIST_STROKE_WIDTH,\r\n            fill: buttonDefault.backgroundColor,\r\n            stroke: buttonDefault.borderColor\r\n        });\r\n        listGroup.clear();\r\n        this._overlay.append(listGroup);\r\n        items.forEach(item => item.g.append(listGroup));\r\n        this._menuItems = items\r\n    }\r\n});\r\n\r\nfunction getExportOptions(widget, exportOptions, fileName, format) {\r\n    if (format || exportOptions.format) {\r\n        format = validateFormat(format || exportOptions.format, widget._incidentOccurred)\r\n    }\r\n    var {\r\n        width: width,\r\n        height: height\r\n    } = widget.getSize();\r\n    return {\r\n        format: format || DEFAULT_EXPORT_FORMAT,\r\n        fileName: fileName || exportOptions.fileName || \"file\",\r\n        proxyUrl: exportOptions.proxyUrl,\r\n        backgroundColor: exportOptions.backgroundColor,\r\n        width: width,\r\n        height: height,\r\n        margin: exportOptions.margin,\r\n        svgToCanvas: exportOptions.svgToCanvas,\r\n        forceProxy: exportOptions.forceProxy,\r\n        exportingAction: widget._createActionByOption(\"onExporting\", {\r\n            excludeValidators: [\"disabled\"]\r\n        }),\r\n        exportedAction: widget._createActionByOption(\"onExported\", {\r\n            excludeValidators: [\"disabled\"]\r\n        }),\r\n        fileSavingAction: widget._createActionByOption(\"onFileSaving\", {\r\n            excludeValidators: [\"disabled\"]\r\n        })\r\n    }\r\n}\r\nexport var plugin = {\r\n    name: \"export\",\r\n    init() {\r\n        this._exportMenu = new ExportMenu({\r\n            renderer: this._renderer,\r\n            incidentOccurred: this._incidentOccurred,\r\n            print: () => this.print(),\r\n            exportTo: format => this.exportTo(void 0, format)\r\n        });\r\n        this._layout.add(this._exportMenu)\r\n    },\r\n    dispose() {\r\n        this._exportMenu.dispose()\r\n    },\r\n    members: {\r\n        _getExportMenuOptions() {\r\n            return extend({}, this._getOption(\"export\"), {\r\n                rtl: this._getOption(\"rtlEnabled\", true)\r\n            })\r\n        },\r\n        _disablePointerEvents() {\r\n            var pointerEventsValue = this._renderer.root.attr(\"pointer-events\");\r\n            this._renderer.root.attr({\r\n                \"pointer-events\": \"none\"\r\n            });\r\n            return pointerEventsValue\r\n        },\r\n        exportTo(fileName, format) {\r\n            var menu = this._exportMenu;\r\n            var options = getExportOptions(this, this._getOption(\"export\") || {}, fileName, format);\r\n            menu && menu.hide();\r\n            var pointerEventsValue = this._disablePointerEvents();\r\n            var promise = _export(this._renderer.root.element, options, getCreatorFunc(options.format)).fail(logger.error).always(() => {\r\n                this._renderer.root.attr({\r\n                    \"pointer-events\": pointerEventsValue\r\n                })\r\n            });\r\n            menu && menu.show();\r\n            return promise\r\n        },\r\n        print() {\r\n            var menu = this._exportMenu;\r\n            var options = getExportOptions(this, this._getOption(\"export\") || {});\r\n            options.exportingAction = null;\r\n            options.exportedAction = null;\r\n            options.margin = 0;\r\n            options.format = \"PNG\";\r\n            options.forceProxy = true;\r\n            options.fileSavingAction = eventArgs => {\r\n                print(\"data:image/png;base64,\".concat(eventArgs.data), {\r\n                    width: options.width,\r\n                    __test: options.__test\r\n                });\r\n                eventArgs.cancel = true\r\n            };\r\n            var pointerEventsValue = this._disablePointerEvents();\r\n            menu && menu.hide();\r\n            var promise = _export(this._renderer.root.element, options, getCreatorFunc(options.format)).fail(logger.error).always(() => {\r\n                this._renderer.root.attr({\r\n                    \"pointer-events\": pointerEventsValue\r\n                })\r\n            });\r\n            menu && menu.show();\r\n            return promise\r\n        }\r\n    },\r\n    customize(constructor) {\r\n        var proto = constructor.prototype;\r\n        constructor.addChange({\r\n            code: \"EXPORT\",\r\n            handler() {\r\n                this._exportMenu.setOptions(this._getExportMenuOptions());\r\n                this._change([\"LAYOUT\"])\r\n            },\r\n            isThemeDependent: true,\r\n            isOptionChange: true,\r\n            option: \"export\"\r\n        });\r\n        proto._optionChangesMap.onExporting = \"EXPORT\";\r\n        proto._optionChangesMap.onExported = \"EXPORT\";\r\n        proto._optionChangesMap.onFileSaving = \"EXPORT\"\r\n    },\r\n    fontFields: [\"export.font\"]\r\n};\r\n"],"mappings":"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"},"metadata":{},"sourceType":"module"}