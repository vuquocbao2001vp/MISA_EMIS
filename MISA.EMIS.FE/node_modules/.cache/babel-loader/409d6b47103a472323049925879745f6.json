{"ast":null,"code":"/**\r\n * DevExtreme (esm/ui/html_editor/modules/mentions.js)\r\n * Version: 22.1.4\r\n * Build date: Fri Jul 22 2022\r\n *\r\n * Copyright (c) 2012 - 2022 Developer Express Inc. ALL RIGHTS RESERVED\r\n * Read about DevExtreme licensing here: https://js.devexpress.com/Licensing/\r\n */\nimport $ from \"../../../core/renderer\";\nimport Quill from \"devextreme-quill\";\nimport { compileGetter } from \"../../../core/utils/data\";\nimport { isString } from \"../../../core/utils/type\";\nimport { extend } from \"../../../core/utils/extend\";\nimport { getPublicElement } from \"../../../core/element\";\nimport eventsEngine from \"../../../events/core/events_engine\";\nimport BaseModule from \"./base\";\nimport PopupModule from \"./popup\";\nimport Mention from \"../formats/mention\";\nvar MentionModule = BaseModule;\n\nif (Quill) {\n  var USER_ACTION = \"user\";\n  var DEFAULT_MARKER = \"@\";\n  var KEYS = {\n    ARROW_UP: \"upArrow\",\n    ARROW_DOWN: \"downArrow\",\n    ARROW_LEFT: \"leftArrow\",\n    ARROW_RIGHT: \"rightArrow\",\n    ENTER: \"enter\",\n    ESCAPE: \"escape\",\n    SPACE: \"space\",\n    PAGE_UP: \"pageUp\",\n    PAGE_DOWN: \"pageDown\",\n    END: \"end\",\n    HOME: \"home\"\n  };\n  var NAVIGATION_KEYS = [KEYS.ARROW_LEFT, KEYS.ARROW_RIGHT, KEYS.PAGE_UP, KEYS.PAGE_DOWN, KEYS.END, KEYS.HOME];\n  var ALLOWED_PREFIX_CHARS = [\" \", \"\\n\"];\n  var DISABLED_STATE_CLASS = \"dx-state-disabled\";\n  Quill.register({\n    \"formats/mention\": Mention\n  }, true);\n  MentionModule = class extends PopupModule {\n    _getDefaultOptions() {\n      var baseConfig = super._getDefaultOptions();\n\n      return extend(baseConfig, {\n        itemTemplate: \"item\",\n        valueExpr: \"this\",\n        displayExpr: \"this\",\n        template: null,\n        searchExpr: null,\n        searchTimeout: 500,\n        minSearchLength: 0\n      });\n    }\n\n    constructor(quill, options) {\n      super(quill, options);\n      this._mentions = {};\n      options.mentions.forEach(item => {\n        var marker = item.marker;\n\n        if (!marker) {\n          item.marker = marker = DEFAULT_MARKER;\n        }\n\n        var template = item.template;\n\n        if (template) {\n          var preparedTemplate = this.editorInstance._getTemplate(template);\n\n          preparedTemplate && Mention.addTemplate(marker, preparedTemplate);\n        }\n\n        this._mentions[marker] = extend({}, this._getDefaultOptions(), item);\n      });\n\n      this._attachKeyboardHandlers();\n\n      this.addCleanCallback(this.clean.bind(this));\n      this.quill.on(\"text-change\", this.onTextChange.bind(this));\n    }\n\n    _attachKeyboardHandlers() {\n      this.quill.keyboard.addBinding({\n        key: KEYS.ARROW_UP\n      }, this._moveToItem.bind(this, \"prev\"));\n      this.quill.keyboard.addBinding({\n        key: KEYS.ARROW_DOWN\n      }, this._moveToItem.bind(this, \"next\"));\n      this.quill.keyboard.addBinding({\n        key: [KEYS.ENTER, KEYS.SPACE]\n      }, this._selectItemHandler.bind(this));\n      var enterBindings = this.quill.keyboard.bindings[KEYS.ENTER];\n      enterBindings.unshift(enterBindings.pop());\n      this.quill.keyboard.addBinding({\n        key: KEYS.ESCAPE\n      }, this._escapeKeyHandler.bind(this));\n      this.quill.keyboard.addBinding({\n        key: [KEYS.ARROW_LEFT, KEYS.ARROW_RIGHT],\n        shiftKey: true\n      }, this._ignoreKeyHandler.bind(this));\n      this.quill.keyboard.addBinding({\n        key: NAVIGATION_KEYS\n      }, this._ignoreKeyHandler.bind(this));\n    }\n\n    _moveToItem(direction) {\n      var dataSource = this._list.getDataSource();\n\n      if (this._isMentionActive && !dataSource.isLoading()) {\n        var $focusedItem = $(this._list.option(\"focusedElement\"));\n        var defaultItemPosition = \"next\" === direction ? \"first\" : \"last\";\n        var $nextItem = $focusedItem[direction]();\n        $nextItem = $nextItem.length ? $nextItem : this._activeListItems[defaultItemPosition]();\n\n        this._list.option(\"focusedElement\", getPublicElement($nextItem));\n\n        this._list.scrollToItem($nextItem);\n      }\n\n      return !this._isMentionActive;\n    }\n\n    _ignoreKeyHandler() {\n      return !this._isMentionActive;\n    }\n\n    _fitIntoRange(value, start, end) {\n      if (value > end) {\n        return start;\n      }\n\n      if (value < start) {\n        return end;\n      }\n\n      return value;\n    }\n\n    _selectItemHandler() {\n      if (this._isMentionActive) {\n        this._list.option(\"items\").length ? this._list.selectItem(this._list.option(\"focusedElement\")) : this._popup.hide();\n      }\n\n      return !this._isMentionActive;\n    }\n\n    _escapeKeyHandler() {\n      if (this._isMentionActive) {\n        this._popup.hide();\n      }\n\n      return !this._isMentionActive;\n    }\n\n    renderList($container, options) {\n      this.compileGetters(this.options);\n      super.renderList($container, options);\n    }\n\n    compileGetters(_ref) {\n      var {\n        displayExpr: displayExpr,\n        valueExpr: valueExpr\n      } = _ref;\n      this._valueGetter = compileGetter(displayExpr);\n      this._idGetter = compileGetter(valueExpr);\n    }\n\n    _getListConfig(options) {\n      var baseConfig = super._getListConfig(options);\n\n      return extend(baseConfig, {\n        itemTemplate: this.options.itemTemplate,\n        onContentReady: () => {\n          if (this._hasSearch) {\n            this._popup.repaint();\n\n            this._focusFirstElement();\n\n            this._hasSearch = false;\n          }\n        }\n      });\n    }\n\n    insertEmbedContent() {\n      var markerLength = this._activeMentionConfig.marker.length;\n      var textLength = markerLength + this._searchValue.length;\n      var caretPosition = this.getPosition();\n\n      var selectedItem = this._list.option(\"selectedItem\");\n\n      var value = {\n        value: this._valueGetter(selectedItem),\n        id: this._idGetter(selectedItem),\n        marker: this._activeMentionConfig.marker\n      };\n      var Delta = Quill.import(\"delta\");\n      var startIndex = Math.max(0, caretPosition - markerLength);\n      var retainCorrection = \"\\n\" === this._getCharByIndex(startIndex) ? 1 : 0;\n      startIndex += retainCorrection;\n      var newDelta = new Delta().retain(startIndex).delete(textLength).insert({\n        mention: value\n      }).insert(\" \");\n      this.quill.updateContents(newDelta);\n      this.quill.setSelection(startIndex + 2);\n    }\n\n    _getLastInsertOperation(ops) {\n      var lastOperation = ops[ops.length - 1];\n      var isLastOperationInsert = (\"insert\" in lastOperation);\n\n      if (isLastOperationInsert) {\n        return lastOperation;\n      }\n\n      var isLastOperationDelete = (\"delete\" in lastOperation);\n\n      if (isLastOperationDelete && ops.length >= 2) {\n        var penultOperation = ops[ops.length - 2];\n        var isPenultOperationInsert = (\"insert\" in penultOperation);\n        var isSelectionReplacing = isLastOperationDelete && isPenultOperationInsert;\n\n        if (isSelectionReplacing) {\n          return penultOperation;\n        }\n      }\n\n      return null;\n    }\n\n    onTextChange(newDelta, oldDelta, source) {\n      if (source === USER_ACTION) {\n        var lastOperation = newDelta.ops[newDelta.ops.length - 1];\n\n        if (this._isMentionActive && this._isPopupVisible) {\n          this._processSearchValue(lastOperation) && this._filterList(this._searchValue);\n        } else {\n          var {\n            ops: ops\n          } = newDelta;\n\n          var lastInsertOperation = this._getLastInsertOperation(ops);\n\n          if (lastInsertOperation) {\n            this.checkMentionRequest(lastInsertOperation, ops);\n          }\n        }\n      }\n    }\n\n    get _isPopupVisible() {\n      var _this$_popup;\n\n      return null === (_this$_popup = this._popup) || void 0 === _this$_popup ? void 0 : _this$_popup.option(\"visible\");\n    }\n\n    _processSearchValue(operation) {\n      var isInsertOperation = (\"insert\" in operation);\n\n      if (isInsertOperation) {\n        this._searchValue += operation.insert;\n      } else if (!this._searchValue.length || operation.delete > 1) {\n        this._popup.hide();\n\n        return false;\n      } else {\n        this._searchValue = this._searchValue.slice(0, -1);\n      }\n\n      return true;\n    }\n\n    checkMentionRequest(_ref2, ops) {\n      var {\n        insert: insert\n      } = _ref2;\n      var caret = this.quill.getSelection();\n\n      if (!insert || !isString(insert) || !caret || this._isMarkerPartOfText(ops[0].retain)) {\n        return;\n      }\n\n      this._activeMentionConfig = this._mentions[insert];\n\n      if (this._activeMentionConfig) {\n        this._updateList(this._activeMentionConfig);\n\n        this.savePosition(caret.index);\n\n        this._popup.option(\"position\", this._popupPosition);\n\n        this._searchValue = \"\";\n\n        this._popup.show();\n      }\n    }\n\n    _isMarkerPartOfText(retain) {\n      if (!retain || -1 !== ALLOWED_PREFIX_CHARS.indexOf(this._getCharByIndex(retain - 1))) {\n        return false;\n      }\n\n      return true;\n    }\n\n    _getCharByIndex(index) {\n      return this.quill.getContents(index, 1).ops[0].insert;\n    }\n\n    _updateList(_ref3) {\n      var {\n        dataSource: dataSource,\n        displayExpr: displayExpr,\n        valueExpr: valueExpr,\n        itemTemplate: itemTemplate,\n        searchExpr: searchExpr\n      } = _ref3;\n      this.compileGetters({\n        displayExpr: displayExpr,\n        valueExpr: valueExpr\n      });\n\n      this._list.unselectAll();\n\n      this._list.option({\n        dataSource: dataSource,\n        displayExpr: displayExpr,\n        itemTemplate: itemTemplate,\n        searchExpr: searchExpr\n      });\n    }\n\n    _filterList(searchValue) {\n      if (!this._isMinSearchLengthExceeded(searchValue)) {\n        this._resetFilter();\n\n        return;\n      }\n\n      var searchTimeout = this._activeMentionConfig.searchTimeout;\n\n      if (searchTimeout) {\n        clearTimeout(this._searchTimer);\n        this._searchTimer = setTimeout(() => {\n          this._search(searchValue);\n        }, searchTimeout);\n      } else {\n        this._search(searchValue);\n      }\n    }\n\n    _isMinSearchLengthExceeded(searchValue) {\n      return searchValue.length >= this._activeMentionConfig.minSearchLength;\n    }\n\n    _resetFilter() {\n      clearTimeout(this._searchTimer);\n\n      this._search(null);\n    }\n\n    _search(searchValue) {\n      this._hasSearch = true;\n\n      this._list.option(\"searchValue\", searchValue);\n    }\n\n    _focusFirstElement() {\n      if (!this._list) {\n        return;\n      }\n\n      var $firstItem = this._activeListItems.first();\n\n      this._list.option(\"focusedElement\", getPublicElement($firstItem));\n\n      this._list.scrollToItem($firstItem);\n    }\n\n    get _popupPosition() {\n      var position = this.getPosition();\n      var {\n        left: mentionLeft,\n        top: mentionTop,\n        height: mentionHeight\n      } = this.quill.getBounds(position ? position - 1 : position);\n      var {\n        left: leftOffset,\n        top: topOffset\n      } = $(this.quill.root).offset();\n      var positionEvent = eventsEngine.Event(\"positionEvent\", {\n        pageX: leftOffset + mentionLeft,\n        pageY: topOffset + mentionTop\n      });\n      return {\n        of: positionEvent,\n        offset: {\n          v: mentionHeight\n        },\n        my: \"top left\",\n        at: \"top left\",\n        collision: {\n          y: \"flip\",\n          x: \"flipfit\"\n        }\n      };\n    }\n\n    _getPopupConfig() {\n      return extend(super._getPopupConfig(), {\n        hideOnParentScroll: false,\n        onShown: () => {\n          this._isMentionActive = true;\n          this._hasSearch = false;\n\n          this._focusFirstElement();\n        },\n        onHidden: () => {\n          this._list.unselectAll();\n\n          this._list.option(\"focusedElement\", null);\n\n          this._isMentionActive = false;\n\n          this._search(null);\n        },\n        focusStateEnabled: false\n      });\n    }\n\n    get _activeListItems() {\n      return this._list.itemElements().filter(\":not(.\".concat(DISABLED_STATE_CLASS, \")\"));\n    }\n\n    clean() {\n      Object.keys(this._mentions).forEach(marker => {\n        if (this._mentions[marker].template) {\n          Mention.removeTemplate(marker);\n        }\n      });\n    }\n\n  };\n}\n\nexport default MentionModule;","map":{"version":3,"names":["$","Quill","compileGetter","isString","extend","getPublicElement","eventsEngine","BaseModule","PopupModule","Mention","MentionModule","USER_ACTION","DEFAULT_MARKER","KEYS","ARROW_UP","ARROW_DOWN","ARROW_LEFT","ARROW_RIGHT","ENTER","ESCAPE","SPACE","PAGE_UP","PAGE_DOWN","END","HOME","NAVIGATION_KEYS","ALLOWED_PREFIX_CHARS","DISABLED_STATE_CLASS","register","_getDefaultOptions","baseConfig","itemTemplate","valueExpr","displayExpr","template","searchExpr","searchTimeout","minSearchLength","constructor","quill","options","_mentions","mentions","forEach","item","marker","preparedTemplate","editorInstance","_getTemplate","addTemplate","_attachKeyboardHandlers","addCleanCallback","clean","bind","on","onTextChange","keyboard","addBinding","key","_moveToItem","_selectItemHandler","enterBindings","bindings","unshift","pop","_escapeKeyHandler","shiftKey","_ignoreKeyHandler","direction","dataSource","_list","getDataSource","_isMentionActive","isLoading","$focusedItem","option","defaultItemPosition","$nextItem","length","_activeListItems","scrollToItem","_fitIntoRange","value","start","end","selectItem","_popup","hide","renderList","$container","compileGetters","_ref","_valueGetter","_idGetter","_getListConfig","onContentReady","_hasSearch","repaint","_focusFirstElement","insertEmbedContent","markerLength","_activeMentionConfig","textLength","_searchValue","caretPosition","getPosition","selectedItem","id","Delta","import","startIndex","Math","max","retainCorrection","_getCharByIndex","newDelta","retain","delete","insert","mention","updateContents","setSelection","_getLastInsertOperation","ops","lastOperation","isLastOperationInsert","isLastOperationDelete","penultOperation","isPenultOperationInsert","isSelectionReplacing","oldDelta","source","_isPopupVisible","_processSearchValue","_filterList","lastInsertOperation","checkMentionRequest","_this$_popup","operation","isInsertOperation","slice","_ref2","caret","getSelection","_isMarkerPartOfText","_updateList","savePosition","index","_popupPosition","show","indexOf","getContents","_ref3","unselectAll","searchValue","_isMinSearchLengthExceeded","_resetFilter","clearTimeout","_searchTimer","setTimeout","_search","$firstItem","first","position","left","mentionLeft","top","mentionTop","height","mentionHeight","getBounds","leftOffset","topOffset","root","offset","positionEvent","Event","pageX","pageY","of","v","my","at","collision","y","x","_getPopupConfig","hideOnParentScroll","onShown","onHidden","focusStateEnabled","itemElements","filter","concat","Object","keys","removeTemplate"],"sources":["E:/MisaProject/W2022_06/misa_emis/node_modules/devextreme/esm/ui/html_editor/modules/mentions.js"],"sourcesContent":["/**\r\n * DevExtreme (esm/ui/html_editor/modules/mentions.js)\r\n * Version: 22.1.4\r\n * Build date: Fri Jul 22 2022\r\n *\r\n * Copyright (c) 2012 - 2022 Developer Express Inc. ALL RIGHTS RESERVED\r\n * Read about DevExtreme licensing here: https://js.devexpress.com/Licensing/\r\n */\r\nimport $ from \"../../../core/renderer\";\r\nimport Quill from \"devextreme-quill\";\r\nimport {\r\n    compileGetter\r\n} from \"../../../core/utils/data\";\r\nimport {\r\n    isString\r\n} from \"../../../core/utils/type\";\r\nimport {\r\n    extend\r\n} from \"../../../core/utils/extend\";\r\nimport {\r\n    getPublicElement\r\n} from \"../../../core/element\";\r\nimport eventsEngine from \"../../../events/core/events_engine\";\r\nimport BaseModule from \"./base\";\r\nimport PopupModule from \"./popup\";\r\nimport Mention from \"../formats/mention\";\r\nvar MentionModule = BaseModule;\r\nif (Quill) {\r\n    var USER_ACTION = \"user\";\r\n    var DEFAULT_MARKER = \"@\";\r\n    var KEYS = {\r\n        ARROW_UP: \"upArrow\",\r\n        ARROW_DOWN: \"downArrow\",\r\n        ARROW_LEFT: \"leftArrow\",\r\n        ARROW_RIGHT: \"rightArrow\",\r\n        ENTER: \"enter\",\r\n        ESCAPE: \"escape\",\r\n        SPACE: \"space\",\r\n        PAGE_UP: \"pageUp\",\r\n        PAGE_DOWN: \"pageDown\",\r\n        END: \"end\",\r\n        HOME: \"home\"\r\n    };\r\n    var NAVIGATION_KEYS = [KEYS.ARROW_LEFT, KEYS.ARROW_RIGHT, KEYS.PAGE_UP, KEYS.PAGE_DOWN, KEYS.END, KEYS.HOME];\r\n    var ALLOWED_PREFIX_CHARS = [\" \", \"\\n\"];\r\n    var DISABLED_STATE_CLASS = \"dx-state-disabled\";\r\n    Quill.register({\r\n        \"formats/mention\": Mention\r\n    }, true);\r\n    MentionModule = class extends PopupModule {\r\n        _getDefaultOptions() {\r\n            var baseConfig = super._getDefaultOptions();\r\n            return extend(baseConfig, {\r\n                itemTemplate: \"item\",\r\n                valueExpr: \"this\",\r\n                displayExpr: \"this\",\r\n                template: null,\r\n                searchExpr: null,\r\n                searchTimeout: 500,\r\n                minSearchLength: 0\r\n            })\r\n        }\r\n        constructor(quill, options) {\r\n            super(quill, options);\r\n            this._mentions = {};\r\n            options.mentions.forEach(item => {\r\n                var marker = item.marker;\r\n                if (!marker) {\r\n                    item.marker = marker = DEFAULT_MARKER\r\n                }\r\n                var template = item.template;\r\n                if (template) {\r\n                    var preparedTemplate = this.editorInstance._getTemplate(template);\r\n                    preparedTemplate && Mention.addTemplate(marker, preparedTemplate)\r\n                }\r\n                this._mentions[marker] = extend({}, this._getDefaultOptions(), item)\r\n            });\r\n            this._attachKeyboardHandlers();\r\n            this.addCleanCallback(this.clean.bind(this));\r\n            this.quill.on(\"text-change\", this.onTextChange.bind(this))\r\n        }\r\n        _attachKeyboardHandlers() {\r\n            this.quill.keyboard.addBinding({\r\n                key: KEYS.ARROW_UP\r\n            }, this._moveToItem.bind(this, \"prev\"));\r\n            this.quill.keyboard.addBinding({\r\n                key: KEYS.ARROW_DOWN\r\n            }, this._moveToItem.bind(this, \"next\"));\r\n            this.quill.keyboard.addBinding({\r\n                key: [KEYS.ENTER, KEYS.SPACE]\r\n            }, this._selectItemHandler.bind(this));\r\n            var enterBindings = this.quill.keyboard.bindings[KEYS.ENTER];\r\n            enterBindings.unshift(enterBindings.pop());\r\n            this.quill.keyboard.addBinding({\r\n                key: KEYS.ESCAPE\r\n            }, this._escapeKeyHandler.bind(this));\r\n            this.quill.keyboard.addBinding({\r\n                key: [KEYS.ARROW_LEFT, KEYS.ARROW_RIGHT],\r\n                shiftKey: true\r\n            }, this._ignoreKeyHandler.bind(this));\r\n            this.quill.keyboard.addBinding({\r\n                key: NAVIGATION_KEYS\r\n            }, this._ignoreKeyHandler.bind(this))\r\n        }\r\n        _moveToItem(direction) {\r\n            var dataSource = this._list.getDataSource();\r\n            if (this._isMentionActive && !dataSource.isLoading()) {\r\n                var $focusedItem = $(this._list.option(\"focusedElement\"));\r\n                var defaultItemPosition = \"next\" === direction ? \"first\" : \"last\";\r\n                var $nextItem = $focusedItem[direction]();\r\n                $nextItem = $nextItem.length ? $nextItem : this._activeListItems[defaultItemPosition]();\r\n                this._list.option(\"focusedElement\", getPublicElement($nextItem));\r\n                this._list.scrollToItem($nextItem)\r\n            }\r\n            return !this._isMentionActive\r\n        }\r\n        _ignoreKeyHandler() {\r\n            return !this._isMentionActive\r\n        }\r\n        _fitIntoRange(value, start, end) {\r\n            if (value > end) {\r\n                return start\r\n            }\r\n            if (value < start) {\r\n                return end\r\n            }\r\n            return value\r\n        }\r\n        _selectItemHandler() {\r\n            if (this._isMentionActive) {\r\n                this._list.option(\"items\").length ? this._list.selectItem(this._list.option(\"focusedElement\")) : this._popup.hide()\r\n            }\r\n            return !this._isMentionActive\r\n        }\r\n        _escapeKeyHandler() {\r\n            if (this._isMentionActive) {\r\n                this._popup.hide()\r\n            }\r\n            return !this._isMentionActive\r\n        }\r\n        renderList($container, options) {\r\n            this.compileGetters(this.options);\r\n            super.renderList($container, options)\r\n        }\r\n        compileGetters(_ref) {\r\n            var {\r\n                displayExpr: displayExpr,\r\n                valueExpr: valueExpr\r\n            } = _ref;\r\n            this._valueGetter = compileGetter(displayExpr);\r\n            this._idGetter = compileGetter(valueExpr)\r\n        }\r\n        _getListConfig(options) {\r\n            var baseConfig = super._getListConfig(options);\r\n            return extend(baseConfig, {\r\n                itemTemplate: this.options.itemTemplate,\r\n                onContentReady: () => {\r\n                    if (this._hasSearch) {\r\n                        this._popup.repaint();\r\n                        this._focusFirstElement();\r\n                        this._hasSearch = false\r\n                    }\r\n                }\r\n            })\r\n        }\r\n        insertEmbedContent() {\r\n            var markerLength = this._activeMentionConfig.marker.length;\r\n            var textLength = markerLength + this._searchValue.length;\r\n            var caretPosition = this.getPosition();\r\n            var selectedItem = this._list.option(\"selectedItem\");\r\n            var value = {\r\n                value: this._valueGetter(selectedItem),\r\n                id: this._idGetter(selectedItem),\r\n                marker: this._activeMentionConfig.marker\r\n            };\r\n            var Delta = Quill.import(\"delta\");\r\n            var startIndex = Math.max(0, caretPosition - markerLength);\r\n            var retainCorrection = \"\\n\" === this._getCharByIndex(startIndex) ? 1 : 0;\r\n            startIndex += retainCorrection;\r\n            var newDelta = (new Delta).retain(startIndex).delete(textLength).insert({\r\n                mention: value\r\n            }).insert(\" \");\r\n            this.quill.updateContents(newDelta);\r\n            this.quill.setSelection(startIndex + 2)\r\n        }\r\n        _getLastInsertOperation(ops) {\r\n            var lastOperation = ops[ops.length - 1];\r\n            var isLastOperationInsert = \"insert\" in lastOperation;\r\n            if (isLastOperationInsert) {\r\n                return lastOperation\r\n            }\r\n            var isLastOperationDelete = \"delete\" in lastOperation;\r\n            if (isLastOperationDelete && ops.length >= 2) {\r\n                var penultOperation = ops[ops.length - 2];\r\n                var isPenultOperationInsert = \"insert\" in penultOperation;\r\n                var isSelectionReplacing = isLastOperationDelete && isPenultOperationInsert;\r\n                if (isSelectionReplacing) {\r\n                    return penultOperation\r\n                }\r\n            }\r\n            return null\r\n        }\r\n        onTextChange(newDelta, oldDelta, source) {\r\n            if (source === USER_ACTION) {\r\n                var lastOperation = newDelta.ops[newDelta.ops.length - 1];\r\n                if (this._isMentionActive && this._isPopupVisible) {\r\n                    this._processSearchValue(lastOperation) && this._filterList(this._searchValue)\r\n                } else {\r\n                    var {\r\n                        ops: ops\r\n                    } = newDelta;\r\n                    var lastInsertOperation = this._getLastInsertOperation(ops);\r\n                    if (lastInsertOperation) {\r\n                        this.checkMentionRequest(lastInsertOperation, ops)\r\n                    }\r\n                }\r\n            }\r\n        }\r\n        get _isPopupVisible() {\r\n            var _this$_popup;\r\n            return null === (_this$_popup = this._popup) || void 0 === _this$_popup ? void 0 : _this$_popup.option(\"visible\")\r\n        }\r\n        _processSearchValue(operation) {\r\n            var isInsertOperation = \"insert\" in operation;\r\n            if (isInsertOperation) {\r\n                this._searchValue += operation.insert\r\n            } else if (!this._searchValue.length || operation.delete > 1) {\r\n                this._popup.hide();\r\n                return false\r\n            } else {\r\n                this._searchValue = this._searchValue.slice(0, -1)\r\n            }\r\n            return true\r\n        }\r\n        checkMentionRequest(_ref2, ops) {\r\n            var {\r\n                insert: insert\r\n            } = _ref2;\r\n            var caret = this.quill.getSelection();\r\n            if (!insert || !isString(insert) || !caret || this._isMarkerPartOfText(ops[0].retain)) {\r\n                return\r\n            }\r\n            this._activeMentionConfig = this._mentions[insert];\r\n            if (this._activeMentionConfig) {\r\n                this._updateList(this._activeMentionConfig);\r\n                this.savePosition(caret.index);\r\n                this._popup.option(\"position\", this._popupPosition);\r\n                this._searchValue = \"\";\r\n                this._popup.show()\r\n            }\r\n        }\r\n        _isMarkerPartOfText(retain) {\r\n            if (!retain || -1 !== ALLOWED_PREFIX_CHARS.indexOf(this._getCharByIndex(retain - 1))) {\r\n                return false\r\n            }\r\n            return true\r\n        }\r\n        _getCharByIndex(index) {\r\n            return this.quill.getContents(index, 1).ops[0].insert\r\n        }\r\n        _updateList(_ref3) {\r\n            var {\r\n                dataSource: dataSource,\r\n                displayExpr: displayExpr,\r\n                valueExpr: valueExpr,\r\n                itemTemplate: itemTemplate,\r\n                searchExpr: searchExpr\r\n            } = _ref3;\r\n            this.compileGetters({\r\n                displayExpr: displayExpr,\r\n                valueExpr: valueExpr\r\n            });\r\n            this._list.unselectAll();\r\n            this._list.option({\r\n                dataSource: dataSource,\r\n                displayExpr: displayExpr,\r\n                itemTemplate: itemTemplate,\r\n                searchExpr: searchExpr\r\n            })\r\n        }\r\n        _filterList(searchValue) {\r\n            if (!this._isMinSearchLengthExceeded(searchValue)) {\r\n                this._resetFilter();\r\n                return\r\n            }\r\n            var searchTimeout = this._activeMentionConfig.searchTimeout;\r\n            if (searchTimeout) {\r\n                clearTimeout(this._searchTimer);\r\n                this._searchTimer = setTimeout(() => {\r\n                    this._search(searchValue)\r\n                }, searchTimeout)\r\n            } else {\r\n                this._search(searchValue)\r\n            }\r\n        }\r\n        _isMinSearchLengthExceeded(searchValue) {\r\n            return searchValue.length >= this._activeMentionConfig.minSearchLength\r\n        }\r\n        _resetFilter() {\r\n            clearTimeout(this._searchTimer);\r\n            this._search(null)\r\n        }\r\n        _search(searchValue) {\r\n            this._hasSearch = true;\r\n            this._list.option(\"searchValue\", searchValue)\r\n        }\r\n        _focusFirstElement() {\r\n            if (!this._list) {\r\n                return\r\n            }\r\n            var $firstItem = this._activeListItems.first();\r\n            this._list.option(\"focusedElement\", getPublicElement($firstItem));\r\n            this._list.scrollToItem($firstItem)\r\n        }\r\n        get _popupPosition() {\r\n            var position = this.getPosition();\r\n            var {\r\n                left: mentionLeft,\r\n                top: mentionTop,\r\n                height: mentionHeight\r\n            } = this.quill.getBounds(position ? position - 1 : position);\r\n            var {\r\n                left: leftOffset,\r\n                top: topOffset\r\n            } = $(this.quill.root).offset();\r\n            var positionEvent = eventsEngine.Event(\"positionEvent\", {\r\n                pageX: leftOffset + mentionLeft,\r\n                pageY: topOffset + mentionTop\r\n            });\r\n            return {\r\n                of: positionEvent,\r\n                offset: {\r\n                    v: mentionHeight\r\n                },\r\n                my: \"top left\",\r\n                at: \"top left\",\r\n                collision: {\r\n                    y: \"flip\",\r\n                    x: \"flipfit\"\r\n                }\r\n            }\r\n        }\r\n        _getPopupConfig() {\r\n            return extend(super._getPopupConfig(), {\r\n                hideOnParentScroll: false,\r\n                onShown: () => {\r\n                    this._isMentionActive = true;\r\n                    this._hasSearch = false;\r\n                    this._focusFirstElement()\r\n                },\r\n                onHidden: () => {\r\n                    this._list.unselectAll();\r\n                    this._list.option(\"focusedElement\", null);\r\n                    this._isMentionActive = false;\r\n                    this._search(null)\r\n                },\r\n                focusStateEnabled: false\r\n            })\r\n        }\r\n        get _activeListItems() {\r\n            return this._list.itemElements().filter(\":not(.\".concat(DISABLED_STATE_CLASS, \")\"))\r\n        }\r\n        clean() {\r\n            Object.keys(this._mentions).forEach(marker => {\r\n                if (this._mentions[marker].template) {\r\n                    Mention.removeTemplate(marker)\r\n                }\r\n            })\r\n        }\r\n    }\r\n}\r\nexport default MentionModule;\r\n"],"mappings":"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"},"metadata":{},"sourceType":"module"}